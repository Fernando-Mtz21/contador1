Introducción
1.0.1
¿Por qué debería tomar este módulo?

¡Bienvenido a la configuración básica del dispositivo!

¡Bienvenido al primer módulo en CCNA Switching, Enrutamiento y Wireless Essentials!. Sabe que los switches y routers vienen con alguna configuración integrada, así que ¿por qué necesitarás aprender a configurar más switches y routers?

Imagina que compraste un juego de tren modelo. Después de haberla configurado, te diste cuenta de que la pista era sólo una forma ovalada simple y que los vagones de tren sólo funcionaban en el sentido de las agujas del reloj. Es posible que desee que la pista sea una figura de ocho con un paso elevado. Es posible que desee tener dos trenes que operen independientemente el uno del otro y sean capaces de moverse en diferentes direcciones. ¿Cómo pudiste hacer que eso pasara? Tendrías que volver a configurar la pista y los controles. Es lo mismo con los dispositivos de red. Como administrador de red, necesita un control detallado de los dispositivos de su red. Esto significa configurar con precisión switches y routeres para que su red haga lo que desea que haga. Este módulo tiene muchas actividades de Comprobador de sintaxis y trazador de paquetes para ayudarle a desarrollar estas habilidades. Comencemos ya mismo.
1.0.2
¿Qué aprenderé en este módulo?

Título del módulo: Configuración básica de dispositivos

Objetivos del módulo: Configuración de los dispositivos mediante los procedimientos recomendados de seguridad.
Leyenda de la tabla
Título del tema 	Objetivo del tema
Configuración de Parámetros Iniciales de un Switch 	Configurar los parámetros iniciales en un switch Cisco.
Configuración de Puertos de un Switch. 	Configurar los puertos de un switch para cumplir con los requisitos de red.
Acceso remoto seguro 	Configurar el acceso de administración seguro en un switch.
Configuración básica de un router 	Configurar los ajustes básicos en un router para enrutar entre dos redes conectadas directamente, utilizando CLI.
Verificar redes conectadas directamente 	Verificar la conectividad entre dos redes que están conectadas directamente a un router.
1.0.3
Video: descargue e instale Packet Tracer

Este video le mostrará cómo descargar e instalar Packet Tracer. Utilizará Packet Tracer para simular la creación y prueba de redes en su equipo. Packet Tracer es un programa de software flexible y divertido que te dará la oportunidad de usar las representaciones de red y teorías que acabas de aprender a construir modelos de red y explorar LAN y WAN relativamente complejas.

Por lo general, los estudiantes usan Packet Tracer para lo siguiente:

    Preparase para un examen de certificación.
    Practicar lo aprendido en los cursos de redes.
    Refinar sus habilidades para una entrevista laboral.
    Examinar el impacto de agregar nuevas tecnologías a los diseños de red existentes.
    Desarrollar sus habilidades para realizar trabajos en Internet de las cosas.
    Competir en desafíos globales de diseño (consulte 2017 PT 7 Desafío de diseño en Facebook).

Packet Tracer es una herramienta esencial de aprendizaje que se utiliza en muchos cursos de Cisco Networking Academy.

Para obtener e instalar Cisco Packet Tracer siga estos pasos:
Paso 1. Iniciar sesión en la página de "I'm Learning" de Cisco Networking Academy.
Paso 2. Seleccione Recursos.
Paso 3. Seleccione Descargar Packet Tracer.
Paso 4. Seleccione la versión de Packet Tracer que necesita.
Paso 5. Guarde el archivo en la computadora.
Paso 6. Inicie el programa de instalación de Packet Tracer.

Haga clic en Reproducir en el video para realizar un recorrido detallado del proceso de descarga e instalación de Packet Tracer.
1.0.4
Vídeo - Introducción a Cisco Packet Tracer

Packet Tracer es una herramienta que permite simular redes reales. Proporciona tres menús principales:

    Puede agregar dispositivos y conectarlos a través de cables o inalámbricos.
    Puede seleccionar, eliminar, inspeccionar, etiquetar y agrupar componentes dentro de la red.
    Puede administrar su red abriendo una red existente o de muestra, guardando la red actual y modificando su perfil de usuario o preferencias.

Si ha utilizado algún programa, como un procesador de textos o una hoja de cálculo, ya está familiarizado con los comandos del menú Archivo ubicados en la barra de menús superior. Los comandos Abrir, Guardar, Guardar como y Salir funcionan como lo harían con cualquier programa, pero hay dos comandos especiales para Packet Tracer.

El comando Open Samples mostrará un directorio de ejemplos preconstruidos de características y configuraciones de varios dispositivos de red e Internet de las cosas incluidos en Packet Tracer.

El comando Salir y cerrar sesión eliminará la información de registro de esta copia de Packet Tracer y requerirá que el siguiente usuario de esta copia de Packet Tracer realice el procedimiento de inicio de sesión de nuevo.

Haga clic en Reproducir en el vídeo para aprender a utilizar los menús y a crear su primera red Packet Tracer.
1.0.5
Packet Tracer - Exploración de Modo Lógico y Físico

El modelo de red de esta actividad Packet Tracer Physical Mode (PTPM) incorpora muchas de las tecnologías que puede dominar en los cursos de Cisco Networking Academy. y representa una versión simplificada de la forma en que podría verse una red de pequeña o mediana empresa.

La mayoría de los dispositivos de la sucursal de Seward y del Centro de Datos de Warrenton ya están implementados y configurados. Usted acaba de ser contratado para revisar los dispositivos y redes implementados. No es importante que comprenda todo lo que vea y haga en esta actividad. Siéntase libre de explorar la red por usted mismo. Si desea hacerlo de manera más sistemática, siga estos pasos. Responda las preguntas lo mejor que pueda.

Configuración de parámetros iniciales de un switch
1.1.1
Secuencia de arranque de un switch

Antes de poder configurar un switch, debe encenderlo y permitirle pasar por la secuencia de arranque de cinco pasos. En este tema se tratan los conceptos básicos de la configuración de un switch e incluye un laboratorio al final.

Después de encender un switch Cisco, pasa por la siguiente secuencia de inicio de cinco pasos:

Paso 1: Primero, el switch carga un programa de autodiagnóstico al encender (POST) almacenado en la memoria ROM. El POST verifica el subsistema de la CPU. Este comprueba la CPU, la memoria DRAM y la parte del dispositivo flash que integra el sistema de archivos flash.
Paso 2: A continuación, el switch carga el software del cargador de arranque. El cargador de arranque es un pequeño programa almacenado en la memoria ROM que se ejecuta inmediatamente después de que el POST se completa correctamente.
Paso 3: El cargador de arranque lleva a cabo la inicialización de la CPU de bajo nivel. Inicializa los registros de la CPU, que controlan dónde está asignada la memoria física, la cantidad de memoria y su velocidad.
Paso 4: El cargador de arranque inicia el sistema de archivos flash en la placa del sistema.
Paso 5: Por último, el cargador de arranque localiza y carga una imagen de software del sistema operativo de IOS en la memoria y delega el control del switch a IOS.
1.1.2
El comando boot system

Después de encender un switch Cisco, pasa por la siguiente secuencia de inicio de cinco pasos: Si no se establece esta variable, el switch intenta cargar y ejecutar el primer archivo ejecutable que puede encontrar. En los switches de la serie Catalyst 2960, el archivo de imagen generalmente se encuentra en un directorio que tiene el mismo nombre que el archivo de imagen (excepto la extensión de archivo .bin).

El sistema operativo IOS luego inicializa las interfaces utilizando los comandos Cisco IOS que se encuentran en el archivo de configuración de inicio. Se llama al archivo startup-config config.text y se encuentra en flash.

En el ejemplo, la variable de entorno BOOT se establece mediante el boot system comando del modo de configuración global. Observe que el IOS se ubica en una carpeta distinta y que se especifica la ruta de la carpeta. Use el comando show boot para ver en qué está configurado el archivo de arranque IOS actual.

S1(config)# boot system flash:/c2960-lanbasek9-mz.150-2.SE/c2960-lanbasek9-mz.150-2.SE.bin

La tabla define cada parte del comando boot system.
Leyenda de la tabla
Comando	Definición

boot system

	El comando principal

flash: 

	The storage device

c2960-lanbasek9-mz.150-2.SE/

	La ruta al sistema de archivos

c2960-lanbasek9-mz.150-2.SE.bin

	El nombre del archivo IOS
1.1.3
Indicadores LED del switch

Los switches Cisco Catalyst tienen varios indicadores luminosos LED de estado. Puede usar los LED del switch para controlar rápidamente la actividad y el rendimiento del switch. Los diferentes modelos y conjuntos de características de los switches tienen diferentes LED, y la ubicación de estos en el panel frontal del switch también puede variar.

En la ilustración, se muestran los LED y el botón Mode de un switch Cisco Catalyst 2960.

La figura muestra los indicadores LED, el botón de modo y los puertos en la parte delantera izquierda de un interruptor. Los indicadores LED numerados 1 - 6 de arriba a abajo son: SYST, RPS, STAT, DUPLX, SPEED y PoE. Debajo de los indicadores LED y etiquetados 7 en la figura está el botón de modo. Por encima de los puertos de conmutación y etiquetados 8 en la figura están los LEDs de puerto.

El botón Modo (7 en la figura) se usa para alternar entre el estado del puerto, el dúplex del puerto, la velocidad del puerto y, si es compatible, el estado de la alimentación a través de Ethernet (PoE) de los LED del puerto (8 en la figura).

Haga clic en cada botón para aprender el propósito de los indicadores LED (1-6 en la figura), y el significado de sus colores:

LED del sistema

Muestra si el sistema está recibiendo energía y funciona correctamente. Si el LED está apagado, significa que el sistema no está encendido. Si el LED es de color verde, el sistema funciona normalmente. Si el LED es de color ámbar, el sistema recibe alimentación pero no funciona correctamente.

LED del sistema de alimentación redundante (RPS)

Muestra el estado de RPS. Si el LED está apagado, el RPS está apagado o no está conectado correctamente. Si el LED es de color verde, el RPS está conectado y listo para proporcionar alimentación de respaldo. Si el LED parpadea y es de color verde, el RPS está conectado pero no está disponible porque está proporcionando alimentación a otro dispositivo. Si el LED es de color ámbar, el RPS está en modo de reserva o presenta una falla. Si el LED parpadea y es de color ámbar, la fuente de alimentación interna del switch presenta una falla, y el RPS está proporcionando alimentación.

LED de estado del puerto

Indica que el modo de estado del puerto está seleccionado cuando el LED está verde. Este es el modo predeterminado. Al seleccionarlo, los indicadores LED del puerto muestran colores con diferentes significados. Si el LED está apagado, no hay enlace, o el puerto estaba administrativamente inactivo. Si el LED es de color verde, hay un enlace presente. Si el LED parpadea y es de color verde, hay actividad, y el puerto está enviando o recibiendo datos. Si el LED alterna entre verde y ámbar, hay una falla en el enlace. Si el LED es de color ámbar, el puerto está bloqueado para asegurar que no haya un bucle en el dominio de reenvío y no reenvía datos (normalmente, los puertos permanecen en este estado durante los primeros 30 segundos posteriores a su activación). Si el LED parpadea y es de color ámbar, el puerto está bloqueado para evitar un posible bucle en el dominio de reenvío.

LED de modo dúplex del puerto

Indica que el modo dúplex del puerto está seleccionado cuando el LED está verde. Al seleccionarlo, los LED del puerto que están apagados están en modo semidúplex. Si el LED del puerto es de color verde, el puerto está en modo dúplex completo.

LED de velocidad del puerto

Indica que el modo de velocidad del puerto está seleccionado. Al seleccionarlo, los indicadores LED del puerto muestran colores con diferentes significados. Si el LED está apagado, el puerto está funcionando a 10 Mbps. Si el LED es verde, el puerto está funcionando a 100 Mbps. Si el LED parpadea en verde, el puerto está funcionando a 1000 Mbps.

LED de modo de alimentación por Ethernet

Si se admite PoE, estará presente un LED de modo PoE. Si el LED está apagado, indica que no se seleccionó el modo de alimentación por Ethernet, que a ninguno de los puertos se le negó el suministro de alimentación y ninguno presenta fallas. Si el LED está parpadeando en ámbar, el modo PoE no está seleccionado, pero al menos uno de los puertos ha sido denegado o tiene una falla PoE. Si el LED es de color verde, indica que se seleccionó el modo de alimentación por Ethernet, y los LED del puerto muestran colores con diferentes significados. Si el LED del puerto está apagado, la alimentación por Ethernet está desactivada. Si el LED del puerto es de color verde, la alimentación por Ethernet está activada. Si el LED del puerto alterna entre verde y ámbar, se niega la alimentación por Ethernet, ya que, si se suministra energía al dispositivo alimentado, se excede la capacidad de alimentación del switch. Si el LED parpadea en ámbar, PoE está apagado debido a una falla. Si el LED es de color ámbar, se inhabilitó la alimentación por Ethernet para el puerto.

1.1.4
Recuperarse de un bloqueo del sistema

El cargador de arranque proporciona acceso al switch si no se puede usar el sistema operativo debido a la falta de archivos de sistema o al daño de estos. El cargador de arranque tiene una línea de comandos que proporciona acceso a los archivos almacenados en la memoria flash.

Se puede acceder al cargador de arranque mediante una conexión de consola con los siguientes pasos:

Paso 1. Conecte una computadora al puerto de consola del switch con un cable de consola. Configure el software de emulación de terminal para conectarse al switch.
Paso 2. Desconecte el cable de alimentación del switch.
Paso 3. Vuelva a conectar el cable de alimentación al interruptor y, en 15 segundos, presione y mantenga presionado el botón Mode mientras el LED del sistema todavía parpadea en verde.
Paso 4. Continúe presionando el botón Mode hasta que el LED del sistema se vuelva brevemente ámbar y luego verde sólido; luego suelte el botón Mode.
Paso 5. The boot loader switch: El mensaje aparece en el software de emulación de terminal en la PC.

Escriba help o ? en el símbolo del gestor de arranque para ver una lista de comandos disponibles.

De manera predeterminada, el switch intenta iniciarse automáticamente mediante el uso de información en la variable de entorno BOOT. Para ver la ruta de acceso de la variable de entorno BOOT del switch, escriba el comando set. A continuación, inicialice el sistema de archivos flash utilizando el comando flash_init para ver los archivos actuales en flash, como se muestra en la salida.

switch: set
BOOT=flash:/c2960-lanbasek9-mz.122-55.SE7/c2960-lanbasek9-mz.122-55.SE7.bin
(output omitted)
switch: flash_init
Initializing Flash...
flashfs[0]: 2 files, 1 directories
flashfs[0]: 0 orphaned files, 0 orphaned directories
flashfs[0]: Total bytes: 32514048
flashfs[0]: Bytes used: 11838464
flashfs[0]: Bytes available: 20675584
flashfs[0]: flashfs fsck took 10 seconds.
...done Initializing Flash.

Después de que flash haya terminado de inicializar, puede ingresar el dir flash: comando para ver los directorios y archivos en flash, como se muestra en la salida.

switch: dir flash: 
Directory of flash:/
    2  -rwx  11834846                 c2960-lanbasek9-mz.150-2.SE8.bin
    3  -rwx  2072                     multiple-fs

Introduzca el BOOT=flash comando para cambiar la ruta de la variable de entorno BOOT que utiliza el switch para cargar el nuevo IOS en flash. Para verificar la nueva ruta de la variable de entorno BOOT, vuelva a set ejecutar el comando. Finalmente, para cargar el nuevo IOS escriba el boot comando sin ningún argumento, como se muestra en la salida.

switch: BOOT=flash:c2960-lanbasek9-mz.150-2.SE8.bin
switch: set
BOOT=flash:c2960-lanbasek9-mz.150-2.SE8.bin
(output omitted)
switch: boot

Los comandos del gestor de arranque admiten la inicialización de flash, el formateo de flash, la instalación de un nuevo IOS, el cambio de la variable de entorno BOOT y la recuperación de contraseñas pérdidas u olvidadas.
1.1.5
Acceso a administración de switches

Para el acceso a la administración remota de un switch, este se debe configurar con una dirección IP y una máscara de subred. Tenga en cuenta que para administrar el switch desde una red remota, el switch debe configurarse con una puerta de enlace predeterminada. Este es un proceso muy similar a la configuración de la información de dirección IP en los dispositivos host. En la ilustración, se debe asignar una dirección IP a la interfaz virtual del switch (SVI) de S1. La SVI es una interfaz virtual, no un puerto físico del switch. Se utiliza un cable de consola para acceder a una PC de modo que el switch puede configurar específicamente.

switch con una conexión de red a un router y una conexión por cable de consola a un equipo host
2001:db8:acad:99::1/64 172.17.99.1 VLAN 99172.17.99.11/242001:db8:acad:99::11/64 S1 R1 PC1
R1
Cable de consola
1.1.6
Ejemplo de Configuración de Switch SVI

De manera predeterminada, el switch está configurado para controlar su administración a través de la VLAN 1. Todos los puertos se asignan a la VLAN 1 de manera predeterminada. Por motivos de seguridad, se considera una práctica recomendada utilizar una VLAN distinta de la VLAN 1 para la VLAN de administración, como la VLAN 99 en el ejemplo.

Haga clic en cada botón para conocer los pasos para configurar el acceso a la administración del switch.

Paso 1

Configuración de la interfaz de administración

Desde el modo de configuración de la interfaz VLAN, se aplica una dirección IPv4 y una máscara de subred a la SVI de administración del switch.

Nota: El SVI para VLAN 99 no aparecerá como "activo / activo" hasta que se cree VLAN 99 y haya un dispositivo conectado a un puerto de switch asociado con VLAN 99.

Nota:Es posible que el switch debata configurar para IPv6. Por ejemplo, antes de que pueda configurar el direccionamiento IPv6 en un Cisco Catalyst 2960 que ejecute IOS versión 15.0, deberá ingresar el comando de configuración global sdm prefer dual-ipv4-and-ipv6 default y, a continuación, reload el switch.

TaskIOSIntroduzca el modo de configuración global.s1configurar TerminalEnter# configurar TerminalEnter modo de configuración de interfaz para el SVI.S1(config)# interfaz vlan 99 Configure la dirección IPv4 de la interfaz de administración. S1(config-if)#dirección IP 172.17.99.11 255.255.255.0 Configuración de la interfaz de administración IPv6 addressS1(config-if)# ipv6 address 2001:db8:acad:99: :1/64Habilite el interfaz de administración. S1(config-if)# sin apagarVolver al EXEC privilegiado mode.S1(config-if)# endSave the running config to the startup config.S1# copy running-config startup-config
Tarea 	Comandos IOS
Ingrese al modo de configuración global.	

S1# configure terminal

Ingrese al modo de configuración de interfaz para la SVI.	

S1(config)# interface vlan 99

Configure la dirección IPv4 de la interfaz de administración.	

S1(config-if)# ip address 172.17.99.11 255.255.255.0

Configure la dirección IPv6 de la interfaz de administración	

S1(config-if)# ipv6 address 2001:db8:acad:99::1/64

Habilite la interfaz de administración.	

S1(config-if)# no shutdown

Vuelva al modo EXEC privilegiado.	

S1(config-if)# end

Guarde la configuración en ejecución en la configuración de inicio.	

S1# copy running-config startup-config

Paso 2

Configuración del gateway predeterminado

Si el switch se va a administrar de forma remota desde redes que no están conectadas directamente, se debe configurar con un gateway predeterminado.

Nota: Dado que recibirá la información de la puerta de enlace predeterminada de un mensaje de anuncio de router (RA), el switch no requiere una puerta de enlace predeterminada IPv6.
Leyenda de la tabla
Tarea 	Comandos IOS
Ingrese al modo de configuración global.	

S1# configure terminal

Configure el gateway predeterminado para el switch.	

S1(config)# ip default-gateway 172.17.99.1

Vuelva al modo EXEC privilegiado.	

S1(config-if)# end

Guarde la configuración en ejecución en la configuración de inicio.	

S1# copy running-config startup-config

Paso 3

Verificar la configuración

Los show ip interface brief comandos show ipv6 interface brief y son útiles para determinar el estado de las interfaces físicas y virtuales. La información que se muestra confirma que la interfaz VLAN 99 se ha configurado con una dirección IPv4 e IPv6.

Nota: Una dirección IP aplicada al SVI es solo para el acceso de administración remota al switch; esto no permite que el switch enrute paquetes de Capa 3.

S1# show ip interface brief
Interface IP-Address OK? Method Status Protocol
Vlan99 172.17.99.11 SÍ manual hacia abajo
(resultado omitido)
S1# show ipv6 interface brief
Vlan99 [abajo/abajo]
    FE80: :C27B:BCFF:FEC4:A9C1
    2001:DB8:ACAD:99: :1
(resultado omitido)

1.1.7
Práctica de laboratorio: configuración básica de un switch
Oportunidad de Práctica de habilidades

Tendrá la oportunidad de practicar las siguientes habilidades:

    Part 1: Tender el cableado de red y verificar la configuración predeterminada del switch
    Part 2: Configurar los parámetros básicos de los dispositivos de red
    Part 3: Verificar y probar la conectividad de red

Podrá practicar estas habilidades usando Packet Tracer o equipo de laboratorio, de estar disponible.

Configuración de puertos de un switch
1.2.1
Comunicación dúplex

Los puertos de un switch se pueden configurar de forma independiente para diferentes necesidades. En este tema se describe cómo configurar los puertos del switch, cómo verificar las configuraciones, errores comunes y cómo solucionar problemas de configuración del switch.

La comunicación en dúplex completo aumenta el ancho de banda eficaz al permitir que ambos extremos de una conexión transmitan y reciban datos simultáneamente. Esto también se conoce como comunicación bidireccional y requiere microsegmentación. Las LAN microsegmentadas se crean cuando un puerto de switch tiene solo un dispositivo conectado y funciona en modo dúplex completo. Cuando un puerto de switch opera en modo dúplex completo, no hay dominio de colisión conectado al puerto.

A diferencia de la comunicación en dúplex completo, la comunicación en semidúplex es unidireccional. La comunicación en semidúplex genera problemas de rendimiento debido a que los datos fluyen en una sola dirección por vez, lo que a menudo provoca colisiones. Las conexiones semidúplex suelen verse en los dispositivos de hardware más antiguos, como los hubs. La comunicación en dúplex completo reemplazó a la semidúplex en la mayoría del hardware.

En la ilustración, se muestra la comunicación en dúplex completo y semidúplex.

La figura ilustra la diferencia entre las comunicaciones full-duplex y half-duplex entre dos switches. El diagrama en la parte superior muestra dúplex completo con flechas en ambas direcciones en el enlace entre los dos interruptores con el texto: Enviar Y recibir, simultáneamente. El diagrama inferior muestra semidúplex con sólo una flecha que fluye de un interruptor a otro con el texto: Enviar OR recibir.
PC4
Comunicación dúplex completoComunicación semidúplexEnvió Y recepción simultáneosEnvío O recepción

Gigabit Ethernet y NIC de 10 Gb requieren conexiones full-duplex para funcionar. En el modo dúplex completo, el circuito de detección de colisiones de la NIC se encuentra inhabilitado. Dúplex completo ofrece el 100% de eficacia en ambas direcciones (transmisión y recepción). Esto da como resultado una duplicación del uso potencial del ancho de banda establecido.
1.2.2
Configuración de puertos de switch en la capa física

Los puertos de switch se pueden configurar manualmente con parámetros específicos de dúplex y de velocidad. Use el comando duplex del modo de configuración de interfaz duplex para especificar manualmente el modo dúplex de un puerto de switch. Use el speed comando del modo de configuración de la interfaz para especificar manualmente la velocidad. Por ejemplo, ambos switches de la topología deben funcionar siempre en dúplex completo a 100 Mbps.

topología de red que muestra una conexión entre dos switches que funcionan en modo dúplex completo a 100/Mpbs
PC1 PC2 S1 S2 F0/18 F0/1
F0/1
Full-Duplex Mode 100/Mbps.Full-Duplex Mode 100/Mbps.

La tabla muestra los comandos para S1. Los mismos comandos se pueden aplicar a S2.
TaskIOSIntroduzca el modo de configuración global.s1configurar TerminalEnter# configurar TerminalEnter modo de configuración de interfaz. S1(config)# interfaz FastEthernet 0/1Configurar el dúplex de interfaz. S1(config-if)# dúplex completoConfigurar la interfaz velocidad. S1(config-if)# velocidad 100Volver al EXEC privilegiado mode.S1(config-if)# endSave the running config to the startup config.S1# copy running-config startup-config
Tarea 	Comandos IOS
Ingrese al modo de configuración global.	

S1# configure terminal

Ingrese el modo de configuración de interfaz.	

S1(config)# interface FastEthernet 0/1

Configure el modo dúplex de la interfaz.	

S1(config-if)# duplex full

Configure la velocidad de la interfaz.	

S1(config-if)# speed 100

Vuelva al modo EXEC privilegiado.	

S1(config-if)# end

Guarda la configuración en ejecución en la configuración de inicio.	

S1# copy running-config startup-config

La configuración predeterminada de dúplex y velocidad para los puertos de switch en los switches Cisco Catalyst 2960 y 3560 es automática. Los puertos 10/100/1000 funcionan en modo semidúplex o semidúplex cuando están configurados en 10 o 100 Mbps y operan solo en modo dúplex completo cuando está configurado en 1000 Mbps (1 Gbps). La negociación automática es útil cuando la configuración de velocidad y dúplex del dispositivo que se conecta al puerto es desconocida o puede cambiar. Cuando se conecta a dispositivos conocidos como servidores, estaciones de trabajo dedicadas o dispositivos de red, la mejor práctica es establecer manualmente la configuración de velocidad y dúplex.

Cuando se solucionan problemas relacionados con el puerto del switch, es importante que se verifique la configuración de dúplex y velocidad.

Nota: Si la configuración para el modo dúplex y la velocidad de puertos del switch presenta incompatibilidades, se pueden producir problemas de conectividad. Una falla de autonegociación provoca incompatibilidades en la configuración.

Todos los puertos de fibra óptica, como los puertos 1000BASE-SX, solo funcionan a una velocidad predefinida y siempre son dúplex completo.
1.2.3
Auto-MDIX (MDIX automático)

Hasta hace poco, se requerían determinados tipos de cable (cruzado o directo) para conectar dispositivos. Las conexiones switch a switch o switch a router requerían el uso de diferentes cables Ethernet. Mediante el uso de la característica automática de conexión cruzada de interfaz dependiente del medio (auto-MDIX) en una interfaz, se elimina este problema. Al habilitar la característica auto-MDIX, la interfaz detecta automáticamente el tipo de conexión de cable requerido (directo o cruzado) y configura la conexión conforme a esa información. Al conectarse a los switches sin la función auto-MDIX, los cables directos deben utilizarse para conectar a dispositivos como servidores, estaciones de trabajo o routers. Los cables cruzados se deben utilizar para conectarse a otros switches o repetidores.

Con la característica auto-MDIX habilitada, se puede usar cualquier tipo de cable para conectarse a otros dispositivos, y la interfaz se ajusta de manera automática para proporcionar comunicaciones satisfactorias. En los switches Cisco más nuevos, el comando mdix auto del modo de configuración de interfaz habilita la función. Al usar auto-MDIX en una interfaz, la velocidad de la interfaz y el dúplex deben configurarse para que la función auto funcione correctamente.

El comando para habilitar Auto-MDIX se emite en el modo de configuración de interfaz en el switch como se muestra:

S1(config-if)# mdix auto

Nota: La función auto-MDIX está habilitada de manera predeterminada en los switches Catalyst 2960 y Catalyst 3560, pero no está disponible en los switches Catalyst 2950 y Catalyst 3550 anteriores.

Para examinar la configuración de auto-MDIX para una interfaz específica, use el comando show controllers ethernet-controller con la palabra clave phy. Para limitar la salida a líneas que hagan referencia a auto-MDIX, use el filtro include Auto-MDIX Como se muestra el resultado indica On (Habilitada) u Off (Deshabilitada) para la característica.

S1# show controllers ethernet-controller fa0/1 phy | include MDIX
 Auto-MDIX           :  On   [AdminState=1   Flags=0x00052248]

1.2.4
Switch Verification Commands

En la tabla se resumen algunos de los comandos de verificación de conmutación más útiles.
Comandos de TaskiOS Mostrar el estado de la interfaz y configuración.s1# mostrar interfaces [interface-id] Mostrar la configuración de inicio actual.s1# mostrar Startup-ConfigDisplay actual en funcionamiento Config.s1# mostrar running-config Muestra información sobre el sistema de archivos flash..S1# show estado del software y hardware del sistema flashDisplay.S1# show versionDisplay historial del comando ingresado.S1# show historyMostrar información IP acerca de un Interface.s1# show ip interface [interface-id] Mostrar la dirección MAC table.S1# show mac-address-tableORS1# show mac address-table
Tarea 	Comandos IOS
Muestra el estado y la configuración de la interfaz.	

S1# show interfaces [interface-id]

Muestra la configuración de inicio actual.	

S1# show startup-config

Muestra la configuración actual en ejecución.	

S1# show running-config

Muestra información sobre el sistema de archivos flash.	

S1# show flash

Muestra el estado del hardware y el software del sistema.	

S1# show version

Muestra la configuración actual en ejecución.	

S1# show history

Muestra información de IP de una interfaz.	

S1# show ip interface [interface-id]

O

S1# show ipv6 interface [interface-id]

Muestra la tabla de direcciones MAC.	

S1# show mac-address-table

O

S1# show mac address-table

1.2.5
Verificar la configuración de puertos del switch.

El comando show running-config se puede usar para verificar que el switch se haya configurado correctamente. De la salida abreviada de muestra en S1, se muestra alguna información importante en la figura:

    La interfaz Fast Ethernet 0/18 se configura con la VLAN de administración 99
    La VLAN 99 está configurada con una dirección IPv4 de 172.17.99.11 255.255.255.0
    La puerta de enlace predeterminada está establecida en 172.17.99.1

S1# show running-config
Building configuration...
Current configuration : 1466 bytes
!
interface FastEthernet0/18
 switchport access vlan 99
 switchport mode access
!
(output omitted)
!
interface Vlan99
 ip address 172.17.99.11 255.255.255.0
 ipv6 address 2001:DB8:ACAD:99::1/64
!
ip default-gateway 172.17.99.1 

El comando show interfaces es otro comando de uso común, que muestra información de estado y estadísticas en las interfaces de red del switch. El comando show interfaces se usa con frecuencia al configurar y monitorear dispositivos de red.

La primera línea de salida para el comando show interfaces fastEthernet 0/18 indica que la interfaz FastEthernet 0/18 está activa / activa, lo que significa que está operativa. Más abajo en el resultado, se muestra que el modo dúplex es full (completo) y la velocidad es de 100 Mb/s.

S1# show interfaces fastEthernet 0/18
FastEthernet0/18 is up, line protocol is up (connected)
  Hardware is Fast Ethernet, address is 0025.83e6.9092 (bia 0025.83e6.9092)
  MTU 1500 bytes, BW 100000 Kbit/sec, DLY 100 usec,
     reliability 255/255, txload 1/255, rxload 1/255
  Encapsulation ARPA, loopback not set
  Keepalive set (10 sec)
  Full-duplex, 100Mb/s, media type is 10/100BaseTX

1.2.6
Problemas de la capa de acceso a la red

El resultado del comando show interfaces es útil para detectar problemas comunes de medios. Una de las partes más importantes de esta salida es la visualización de la línea y el estado del protocolo de enlace de datos, como se muestra en el ejemplo.

S1# show interfaces fastEthernet 0/18
FastEthernet0/18 is up, line protocol is up (connected)
Hardware is Fast Ethernet, address is 0025.83e6.9092 (bia 0025.83e6.9092)MTU 1500 bytes, BW 100000 Kbit/sec, DLY 100 usec,

El primer parámetro (FastEthernet0 / 18 está activo) se refiere a la capa de hardware e indica si la interfaz está recibiendo una señal de detección de portadora. El segundo parámetro (line protocol is up) se refiere a la capa de enlace de datos e indica si se reciben los keepalives del protocolo de capa de enlace de datos.

Según el resultado del comando show interfaces, los posibles problemas se pueden solucionar de la siguiente manera:

    Si la interfaz está activa y el protocolo de línea está inactivo, hay un problema. Puede haber una incompatibilidad en el tipo de encapsulación, la interfaz en el otro extremo puede estar inhabilitada por errores o puede haber un problema de hardware.
    Si el protocolo de línea y la interfaz están inactivos, no hay un cable conectado o existe algún otro problema de interfaz. Por ejemplo, en una conexión directa, el otro extremo de la conexión puede estar administrativamente inactivo.
    If the interface is administratively down, it has been manually disabled (the **** shutdown) en la configuración activa.

El resultado del comando show interfaces muestra contadores y estadísticas para la interfaz Fastethernet0/18, como se destaca en el ejemplo.

S1# show interfaces fastEthernet 0/18
FastEthernet0/18 is up, line protocol is up (connected)
  Hardware is Fast Ethernet, address is 0025.83e6.9092 (bia 0025.83e6.9092)
  MTU 1500 bytes, BW 100000 Kbit/sec, DLY 100 usec,
     reliability 255/255, txload 1/255, rxload 1/255
  Encapsulation ARPA, loopback not set
  Keepalive set (10 sec)
  Full-duplex, 100Mb/s, media type is 10/100BaseTX
  input flow-control is off, output flow-control is unsupported
  ARP type: ARPA, ARP Timeout 04:00:00
  Last input never, output 00:00:01, output hang never
  Last clearing of "show interface" counters never
  Input queue: 0/75/0/0 (size/max/drops/flushes); Total output drops: 0
  Queueing strategy: fifo
  Output queue: 0/40 (size/max)
  5 minute input rate 0 bits/sec, 0 packets/sec
  5 minute output rate 0 bits/sec, 0 packets/sec
     2295197 packets input, 305539992 bytes, 0 no buffer
     Received 1925500 broadcasts (74 multicasts)
     0 runts, 0 giants, 0 throttles
     3 input errors, 3 CRC, 0 frame, 0 overrun, 0 ignored
     0 watchdog, 74 multicast, 0 pause input
     0 input packets with dribble condition detected
     3594664 packets output, 436549843 bytes, 0 underruns
     8 output errors, 1790 collisions, 10 interface resets
     0 unknown protocol drops
     0 babbles, 235 late collision, 0 deferred

Algunos errores de los medios no son lo suficientemente graves como para hacer que el circuito falle, pero causan problemas de rendimiento de la red. La tabla explica algunos de estos errores comunes que se pueden detectar con el comando show interfaces.
Tipo de errorDescriptionError de entradaNúmero total de errores. Incluye runas, gigantes, sin búfer, CRC, frame, overrun e ignorado recuentos. se descartan porque son más pequeños que el tamaño mínimo de paquete para Medio Por ejemplo, cualquier paquete de Ethernet que tenga menos de 64 bytes es considera un runt.GiantsPackets que se descartan porque superan el valor tamaño máximo del paquete para el medio. Por ejemplo, cualquier paquete Ethernet que sea mayor que 1,518 bytes se considera un giant.CrcCRC errores se generan cuando la suma de verificación calculada no es la misma que la suma de verificación recibida. Errores Suma de todos los errores que impidieron la transmisión final de datagramas fuera de la interfaz que se está examinando.CollisionsNúmero de mensajes retransmitido debido a una colisión Ethernet. Colisiones tardíasUna colisión eso ocurre después de que se hayan transmitido 512 bits de la trama.
Tipo de error 	Descripción
Errores de entrada 	Cantidad total de errores. Incluye runts, gigantes, sin buffer, CRC, , desbordamiento y recuentos ignorados.
Fragmentos de colisión 	Paquetes que se descartan porque son más pequeños que el mínimo tamaño del paquete para el medio. Por ejemplo, cualquier paquete Ethernet que sea menos de 64 bytes se considera un runt.
Gigantes 	Paquetes que se descartan porque exceden el tamaño máximo de paquete para el medio. Por ejemplo, cualquier paquete de Ethernet que sea mayor que 1.518 bytes se considera un gigante.
CRC 	Los errores de CRC se generan cuando la suma de comprobación calculada no es la misma que la suma de comprobación recibida.
Errores de salida 	Suma de todos los errores que impidieron la transmisión final de datagramas de la interfaz que se está examinando.
Colisiones 	Cantidad de mensajes retransmitidos debido a una colisión de Ethernet.
Colisiones tardías 	Una colisión que ocurre después de 512 bits de la trama han sido Transmitido
1.2.7
Errores de entrada y salida de interfaz

“Input errors” indica la suma de todos los errores en los datagramas que se recibieron en la interfaz que se analiza. Estos incluyen los recuentos de fragmentos de colisión, de fragmentos gigantes, de los que no están almacenados en buffer, de CRC, de tramas, de saturación y de ignorados. Los errores de entrada informados del comando show interfaces incluyen lo siguiente:

    Runt Frames - las tramas Ethernet que son más cortas que la longitud mínima permitida de 64 bytes se llaman runts. La NIC en mal funcionamiento son la causa habitual de las tramas excesivas de fragmentos de colisión, pero también pueden deberse a colisiones.
    Giants -Las tramas de Ethernet que son más grandes que el tamaño máximo permitido se llaman gigantes.
    CRC errors -En las interfaces Ethernet y serie, los errores de CRC generalmente indican un error de medios o cable. Las causas más comunes incluyen interferencia eléctrica, conexiones flojas o dañadas o cableado incorrecto. Si aparecen muchos errores de CRC, hay demasiado ruido en el enlace, y se debe examinar el cable. También se deben buscar y eliminar las fuentes de ruido.

“Output errors” es la suma de todos los errores que impiden la transmisión final de los datagramas por la interfaz que se analiza. Los errores de salida informados del comando show interfaces incluyen lo siguiente:

    Colisión - Las colisiones en operaciones half-duplex son normales. Sin embargo, nunca debe observar colisiones en una interfaz configurada para la comunicación en dúplex completo.
    Colisiones tardías -Una colisión tardía se refiere a una colisión que ocurre después de que se han transmitido 512 bits de la trama. La longitud excesiva de los cables es la causa más frecuente de las colisiones tardías. Otra causa frecuente es la configuración incorrecta de dúplex. Por ejemplo, el extremo de una conexión puede estar configurado para dúplex completo y el otro para semidúplex. Las colisiones tardías se verían en la interfaz que está configurada para semidúplex. En ese caso, debe configurar los mismos parámetros de dúplex en ambos extremos. Una red diseñada y configurada correctamente nunca debería tener colisiones tardías.

1.2.8
Resolución de problemas de la capa de acceso a la red

La mayoría de los problemas que afectan a las redes conmutadas se produce durante la implementación inicial. En teoría, una vez instaladas, las redes continúan funcionando sin problemas. Sin embargo, los cables se dañan, la configuración cambia, y se conectan al switch nuevos dispositivos que requieren cambios de configuración en este. Se requiere el mantenimiento y la resolución de problemas de infraestructura de la red de forma permanente.

Una colisión tardía se refiere a una colisión que ocurre después de que se han transmitido 512 bits de la trama.

La figura es un diagrama de flujo para solucionar problemas de una conexión incorrecta o ninguna conexión entre dispositivos de red. El paso superior es realizar un show interfaces. Esto fluye a la pregunta, ¿está la interfaz activa? Si la respuesta es no, esto pasa a los siguientes pasos: verificar los cables adecuados; comprobar si hay daños en los cables y conectores y verificar que la velocidad esté correctamente ajustada en ambos extremos. Si la respuesta es afirmativa, esto pasa a los siguientes pasos: ¿hay indicios de EMI/ruido? En caso afirmativo, elimine las fuentes; y verifique que la configuración dúplex esté configurada correctamente en ambos extremos. Estos fluyen hasta la pregunta, ¿está resuelto el problema? Si la respuesta es no, entonces el siguiente paso es documentar el trabajo realizado y escalar el problema. Si la respuesta es sí, entonces listo.
Realizar un show interfaces¿La interfaz está activa? ¿Se solucionó el problema?

    ¿Hay indicios de EMI o de ruido? De ser así, elimine las fuentes de estos.
    Verifique que la configuración de dúplex sea la correcta en ambos extremos.

Registre el trabajo y eleve el problema.Listo

    Verifique que los cables sean los adecuados.
    Revise los cables y los conectores para detectar daños.
    Verifique que la velocidad configurada sea la correcta en ambos extremos.

SíSíNoNo

Utilice el comando show interfaces para verificar el estado de la interfaz.

Si la interfaz está inactiva, realice lo siguiente:

    Verifique que se usen los cables adecuados. Además, revise los cables y los conectores para detectar daños. Si se sospecha que hay un cable defectuoso o incorrecto, reemplácelo.
    Si la interfaz continúa inactiva, el problema puede deberse a una incompatibilidad en la configuración de velocidad. La velocidad de una interfaz generalmente se negocia automáticamente; por lo tanto, incluso si se aplica manualmente a una interfaz, la interfaz de conexión debe negociarse automáticamente en consecuencia. Si se produce una incompatibilidad de velocidad debido a una configuración incorrecta o a un problema de hardware o de software, esto podría provocar que la interfaz quede inactiva. Establezca manualmente la misma velocidad en ambos extremos de la conexión si se sospecha que hay un problema.

Si la interfaz está activa pero aún hay problemas de conectividad, realice lo siguiente:

    Using the comando show interfaces , verifique si hay indicios de ruido excesivo. Los indicios pueden incluir un aumento en los contadores de fragmentos de colisión, de fragmentos gigantes y de errores de CRC. Si hay un exceso de ruido, primero busque el origen del ruido y, si es posible, elimínelo. Además, verifique qué tipo de cable se utiliza y que el cable no supere la longitud máxima.
    Si no hay problemas de ruido, verifique si hay un exceso de colisiones. Si hay colisiones o colisiones tardías, verifique la configuración de dúplex en ambos extremos de la conexión. Al igual que la configuración de velocidad, la configuración dúplex generalmente se negocia automáticamente. Si parece haber una diferencia entre dúplex, configure manualmente el dúplex como full (completo) en ambos extremos de la conexión.

1.2.9
Comprobador de sintaxis: configurar puertos de switch

Configure una interfaz de switch basada en los requisitos especificados

Ingrese al modo de configuración y configure FastEthernet0 / 1 dúplex, velocidad y MDIX en automático y guarde la configuración en NVRAM.
S1#configure terminal

Enter configuration commands, one per line. End with CNTL/Z.

S1(config)#interface FastEthernet0/1
S1(config-if)#duplex auto
S1(config-if)#speed auto
S1(config-if)#mdix auto

Ingrese al modo de configuración y configure FastEthernet0 / 1 dúplex, velocidad y MDIX en automático y guarde la configuración en NVRAM.
S1(config-if)#end

%SYS-5-CONFIG_I: Configured from console by console

S1#copy running-config startup-config

Ha configurado correctamente los valores de dúplex, velocidad y MDIX automático en una interfaz de switch y ha guardado la configuración en NVRAM.

Acceso remoto seguro
1.3.1
Operación Telnet

Es posible que no siempre tenga acceso directo al switch cuando necesite configurarlo. Necesita poder acceder a él de forma remota y es imperativo que su acceso sea seguro. En este tema se explica cómo configurar Secure Shell (SSH) para el acceso remoto. Una actividad Packet Tracer le da la oportunidad de probar esto usted mismo.

Telnet utiliza el puerto TCP 23. Es un protocolo más antiguo que utiliza la transmisión de texto sin formato segura tanto de la autenticación de inicio de sesión (nombre de usuario y contraseña) como de los datos transmitidos entre los dispositivos de comunicación. Un actor de amenazas puede monitorear paquetes usando Wireshark. Por ejemplo, en la figura, el actor de amenazas capturó el nombre de usuario admin y la contraseña ccna de una sesión Telnet.

captura de pantalla de una captura WireShark de una sesión Telnet que muestra el nombre de usuario y la contraseña enviados en texto sin formato
1.3.2
Funcionamiento de SSH

Secure Shell (SSH) es un protocolo seguro que utiliza el puerto TCP 22. Proporciona una conexión de administración segura (encriptada) a un dispositivo remoto. El SSH debe reemplazar a Telnet para las conexiones de administración. SSH proporciona seguridad para las conexiones remotas mediante el cifrado seguro cuando se autentica un dispositivo (nombre de usuario y contraseña) y también para los datos transmitidos entre los dispositivos que se comunican.

Por ejemplo, la figura muestra una captura Wireshark de una sesión SSH. Proporciona una conexión de administración segura (encriptada) a un dispositivo remoto. Sin embargo, a diferencia de Telnet, con SSH el nombre de usuario y la contraseña están cifrados.

captura de pantalla de una captura WireShark de una sesión SSH que muestra el nombre de usuario y la contraseña están cifrados
1.3.3
Verifique que el switch admita SSH

Para habilitar SSH en un switch Catalyst 2960, el switch debe usar una versión del software IOS que incluya características y capacidades criptográficas (cifradas). Utilice el comando show version del switch para ver qué IOS está ejecutando el switch. Un nombre de archivo de IOS que incluye la combinación «k9» admite características y capacidades criptográficas (cifradas). El ejemplo muestra la salida del comando show version.

S1# show version
Cisco IOS Software, C2960 Software (C2960-LANBASEK9-M), Version 15.0(2)SE7, RELEASE SOFTWARE (fc1)

1.3.4
Configuración de SSH

Antes de configurar SSH, el switch debe tener configurado, como mínimo, un nombre de host único y los parámetros correctos de conectividad de red.

Haga clic en cada botón para aprender los pasos para configurar SSH.

Paso 1

Verifique support SSH.

Use el comando show ip ssh para verificar que el switch sea compatible con SSH. Si el switch no ejecuta un IOS que admita características criptográficas, este comando no se reconoce.

S1#  show ip ssh

Paso 2

Configure el IP domain.

Configure el nombre de dominio IP de la red utilizando el comando ip domain-name domain-name modo de configuración global. En la figura, el valor domain-name es cisco.com.

S1(config)# ip domain-name cisco.com

Paso 3

Genere un par de claves RSA.

No todas las versiones del IOS utilizan la versión 2 de SSH de manera predeterminada, y la versión 1 de SSH tiene fallas de seguridad conocidas. Para configurar SSH versión 2, emita el comando del modo de configuración global ip ssh version 2. La creación de un par de claves RSA habilita SSH automáticamente. Use el comando del modo de configuración global crypto key generate rsa, para habilitar el servidor SSH en el switch y generar un par de claves RSA. Al crear claves RSA, se solicita al administrador que introduzca una longitud de módulo. La configuración de ejemplo en la figura 1 utiliza un tamaño de módulo de 1024 bits. Una longitud de módulo mayor es más segura, pero se tarda más en generarlo y utilizarlo.

Nota:Para eliminar el par de claves RSA, use el comando del modo de configuración global crypto key zeroize rsa. Después de eliminarse el par de claves RSA, el servidor SSH se deshabilita automáticamente.

S1(config)# crypto key generate rsa
How many bits in the modulus [512]: 1024

Paso 4

Configure autenticación de usuarios.

El servidor SSH puede autenticar a los usuarios localmente o con un servidor de autenticación. Para usar el método de autenticación local, cree un par de nombre de usuario y contraseña con el comando username username secret password modo de configuración global. En el ejemplo, se asignó la contraseña ccna al usuario admin.

S1(config)# username admin secret ccna

Paso 5

Configure las lineas vty.

Habilite el protocolo SSH en las líneas vty utilizando el comando del modo de configuración de línea transport input ssh. El switch Catalyst 2960 tiene líneas vty que van de 0 a 15. Esta configuración evita las conexiones que no son SSH (como Telnet) y limita al switch a que acepte solo las conexiones SSH. Use el comando line vty del modo de configuración global y luego el comando login local del modo de configuración de línea para requerir autenticación local para las conexiones SSH de la base de datos de nombre de usuario local.

S1(config)# line vty 0 15
S1(config-line)# transport input ssh
S1(config-line)# login local
S1(config-line)# salida

Paso 6

EHabilite SSH versión 2.

De manera predeterminada, SSH admite las versiones 1 y 2. Al admitir ambas versiones, esto se muestra en la salida show ip ssh como compatible con la versión 2. Habilite la versión SSH utilizando el comando de configuración global ip ssh version 2.

S1(config)# ip ssh version 2

1.3.5
Verifique que SSH esté operativo

En las computadoras se usa un cliente SSH, como PuTTY, para conectarse a un servidor SSH. Por ejemplo, suponga que se configura lo siguiente:

    SSH está habilitado en el interruptor S1
    Interfaz VLAN 99 (SVI) con la dirección IPv4 172.17.99.11 en el switch S1.
    PC1 con la dirección IPv4 172.17.99.21.

La figura muestra la configuración de PuTTy para PC1 para iniciar una conexión SSH a la dirección SVI VLAN IPv4 de S1.

La figura muestra un host conectado a un switch y la configuración PuTTY para iniciar una conexión SSH al SVI del switch. El PC1 del host, con dirección 172.17.99.21, tiene una conexión de red a un switch S1, con dirección 172.17.99.11. Una captura de pantalla de la configuración PuTTY en PC1 muestra la dirección 172.17.99.11 introducida en el cuadro bajo Nombre de host (o dirección IP) y 22 introducida en el cuadro bajo Puerto. SSH se ha seleccionado como el tipo de conexión.
172.17.99.11 172.17.99.21 PC1
S1

Cuando está conectado, se solicita al usuario un nombre de usuario y una contraseña como se muestra en el ejemplo. Usando la configuración del ejemplo anterior, se ingresan el nombre de usuario: admin y la contraseña: ccna Después de ingresar la combinación correcta, el usuario se conecta a través de SSH a la interfaz de línea de comando (CLI) en el switch Catalyst 2960.

Login as: admin
Using keyboard-interactive
Authentication.
Password:
S1> enable
Password: 
S1#

Para mostrar los datos de la versión y de configuración de SSH en el dispositivo que configuró como servidor SSH, use el comando show ip ssh. En el ejemplo, se habilitó la versión 2 de SSH.

S1# show ip ssh
SSH Enabled - version 2.0
Authentication timeout: 120 secs; Authentication retries: 3
To check the SSH connections to the device, use the show ssh command as shown.
S1# show ssh
%No SSHv1 server connections running.
Connection Version Mode Encryption  Hmac                State          Username
0          2.0     IN   aes256-cbc  hmac-sha1    Session started       admin
0          2.0     OUT  aes256-cbc  hmac-sha1    Session started       admin
S1#

Configuración básica de un router
1.4.1
Configuración de parámetros básicos del router

Hasta ahora, este módulo solo ha cubierto switches. Si desea que los dispositivos puedan enviar y recibir datos fuera de su red, deberá configurar routeres. En este tema se enseña la configuración básica del router y se proporcionan dos Comprobadores de sintaxis y una actividad de Rastreador de paquetes para que pueda practicar estas habilidades.

Los routers y switches Cisco tienen muchas similitudes. Admiten sistemas operativos modales y estructuras de comandos similares, así como muchos de los mismos comandos. Además, los pasos de configuración inicial son similares para ambos dispositivos. Por ejemplo, las siguientes tareas de configuración siempre deben realizarse. Asigne un nombre al dispositivo para distinguirlo de otros routeres y configure contraseñas, como se muestra en el ejemplo.

Router# configure terminal
Enter configuration commands, one per line.  End with CNTL/Z.
Router(config)# hostname R1
R1(config)# enable secret class
R1(config)# line console 0
R1(config-line)# password cisco
R1(config-line)# login
R1(config-line)# exit
R1(config)# line vty 0 4
R1(config-line)# password cisco
R1(config-line)# login
R1(config-line)# exit
R1(config)# service password-encryption
R1(config)#

Configure un banner para proporcionar notificaciones legales de acceso no autorizado, como se muestra en el ejemplo.

R1(config)# banner motd #Authorized Access Only!#
R1(config)#

Guarde los cambios en un router, como se muestra en el ejemplo.

R1# copy running-config startup-config
Destination filename [startup-config]? 
Building configuration...
[OK]

1.4.2
Comprobador de sintaxis - Configurar los ajustes básicos del router

En esta Actividad de sintaxis, configurará los valores básicos para R2.

Ingrese al modo de configuración global y asigne un nombre al router R2.
Router#configure terminal

Enter configuration commands, one per line. End with CNTL/Z.

Router(config)#hostname R2

Configurar classcomo la contraseña secreta.
R1(config)#enable secret class

Configure ciscocomo la contraseña de la línea de consola y solicite a los usuarios que inicien sesión. Luego, salga del modo de configuración de línea.
R1(config)#line console 0
R1(config-line)#password cisco
R1(config-line)#login
R1(config-line)#exit

Configure cisco como contraseña vty para las líneas 0 a 4 y requiera que los usuarios inicien sesión .
R1(config)#line vty 0 4
R1(config-line)#password cisco
R1(config-line)#login

Salga del modo de configuración de línea y cifre todas las contraseñas de texto sin formato.
R1(config-line)#exit
R1(config)#service password-encryption

Ingrese el banner Authorized Access Only!y úselo# como carácter delimitador.
R1(config)#banner motd #Authorized Access Only!#

Salga del modo de configuración global y guarde la configuración.
R1(config)#exit
R1#copy running-config startup-config

Destination filename [startup-config]?   
Building configuration...  
[OK]

Configuró correctamente el R2 con los parámetros iniciales.

1.4.3
Topología de doble pila

Una característica que distingue a los switches de los routers es el tipo de interfaces que admite cada uno. Por ejemplo, los switches de capa 2 admiten LAN; por lo tanto, tienen múltiples puertos FastEthernet o Gigabit Ethernet. La topología de pila dual de la figura se utiliza para demostrar la configuración de las interfaces IPv4 e IPv6 del router.

topología de red de doble pila que consta de múltiples hosts, switches y routeres con interfaces configuradas con direcciones IPv4 e IPv6
PC1 PC2 PC3 PC4 S1 S2 S4 R1 R2 .10 .10 .10 .10 ::10 ::10 ::10 ::10 192.168.10.0/24 192.168.11.0/24 10.1.1.0/24 10.1.2.0/24 2001:db8:acad:1::/64 2001:db8:acad:2::/64 2001:db8:acad:4::/64 2001:db8:acad:5::/64 G0/0/0 G0/0/0 G0/0/1 G0/0/1 209.165.200.224/30 2001:db8:acad:3::/64 .1 ::1 .1 ::1 .1 ::1 .1 ::1 .225 ::225 .226 ::226 S0/1/0 S0/1/0
S3
1.4.4
Configurar interfaces de routers

Los routers admiten redes LAN y WAN, y pueden interconectar distintos tipos de redes; por lo tanto, admiten muchos tipos de interfaces. Por ejemplo, los ISR G2 tienen una o dos interfaces Gigabit Ethernet integradas y ranuras para tarjetas de interfaz WAN de alta velocidad (HWIC) para admitir otros tipos de interfaces de red, incluidas las interfaces seriales, DSL y de cable.

Para que una interfaz esté disponible, debe cumplir los siguientes requisitos:

    Configurado con al menos una dirección IP: - Utilice los comandos de configuración de ip address ip-address subnet-mask y ipv6 address ipv6-address/prefix interface.
    Activado: - Las interfaces LAN y WAN no están activadas de manera predeterminada (shutdown). Para habilitar una interfaz, esta se debe activar mediante el comando no shutdown. (Es como encender la interfaz.) La interfaz también debe estar conectada a otro dispositivo (un hub, un switch u otro router) para que la capa física se active.
    Descripción - Opcionalmente, la interfaz también se puede configurar con una breve descripción de hasta 240 caracteres. Es aconsejable configurar una descripción en cada interfaz. En las redes de producción, los beneficios de las descripciones de la interfaz se obtienen rápidamente, ya que son útiles para solucionar problemas e identificar una conexión de terceros y la información de contacto.

El siguiente ejemplo muestra la configuración de las interfaces en R1.

R1(config)# interface gigabitethernet 0/0/0
R1(config-if)# ip address 192.168.10.1 255.255.255.0 
R1(config-if)# ipv6 address 2001:db8:acad:1::1/64 
R1(config-if)# description Link to LAN 1
R1(config-if)# no shutdown
R1(config-if)# exit
R1(config)# interface gigabitethernet 0/0/1
R1(config-if)# ip address 192.168.11.1 255.255.255.0 
R1(config-if)# ipv6 address 2001:db8:acad:2::1/64 
R1(config-if)# description Link to LAN 2
R1(config-if)# no shutdown
R1(config-if)# exit
R1(config)# interface serial 0/0/0
R1(config-if)# ip address 209.165.200.225 255.255.255.252 
R1(config-if)# ipv6 address 2001:db8:acad:3::225/64 
R1(config-if)# description Link to R2
R1(config-if)# no shutdown
R1(config-if)# exit
R1(config)#

1.4.5
Comprobador de sintaxis - Configurar interfaces de router

En esta actividad del Comprobador de sintaxis, configurará R2 con sus interfaces IPv4 e IPv6.

Configure GigabitEthernet 0/0/0.

    Use g0/0/0 para ingresar al modo de configuración de la interfaz.
    Configure the IPv4 address 10.1.1.1 and subnet mask 255.255.255.0.
    Configure the IPv6 address 2001:db8:acad:4: :1/64.
    Describe the link as Enlace a LAN 3.
    Active la interfaz.

Router(config)#interface g0/0/0
Router(config-if)#ip address 10.1.1.1 255.255.255.0
Router(config-if)#ipv6 address 2001:db8:acad:4::1/64
Router(config-if)#description Link to LAN 3
Router(config-if)#no shutdown

%LINK-3-UPDOWN: Interface GigabitEthernet0/0/0, changed state to up
%LINEPROTO-5-UPDOWN: Line protocol on Interface GigabitEthernet0/0/0, changed state to up

Configure GigabitEthernet 0/0/1.

    Use g0/0/1 para ingresar al modo de configuración de la interfaz.
    Configure the IPv4 address 10.1.2.1 and subnet mask 255.255.255.0.
    Configure the IPv6 address 2001:db8:acad:5: :1/64.
    Describe the link as Enlace a LAN 4.
    Active la interfaz.

Router(config-if)#interface g0/0/1
Router(config-if)#ip address 10.1.2.1 255.255.255.0
Router(config-if)#ipv6 address 2001:db8:acad:5::1/64
Router(config-if)#description Link to LAN 4
Router(config-if)#no shutdown

%LINK-3-UPDOWN: Interface GigabitEthernet0/0/1, changed state to up
%LINEPROTO-5-UPDOWN: Line protocol on Interface GigabitEthernet0/0/1, changed state to up

Configurar serie 0/0/0.

    Use s0/0/0 para ingresar al modo de configuración de la interfaz.
    Configure the IPv4 address 209.165.200.226 and subnet mask 255.255.255.252.
    Configure the IPv6 address 2001:db8:acad:3: :226/64.
    Describe the link as Enlace a R1.
    Active la interfaz.

Router(config-if)#interface s0/0/0
Router(config-if)#ip address 209.165.200.226 255.255.255.252
Router(config-if)#ipv6 address 2001:db8:acad:3::226/64
Router(config-if)#description Link to R1
Router(config-if)#no shutdown

%LINK-3-UPDOWN: Interface Serial0/0/0, changed state to up
%LINEPROTO-5-UPDOWN: Line protocol on Interface Serial0/0/0, changed state to up

Ha configurado correctamente las interfaces del router R2.

1.4.6
Interfaces de bucle invertido IPv4

Otra configuración común de los routers Cisco IOS es la habilitación de una interfaz loopback.

La interfaz de bucle invertido es una interfaz lógica interna del router. No está asignado a un puerto físico y nunca se puede conectar a ningún otro dispositivo. Se la considera una interfaz de software que se coloca automáticamente en estado "up" (activo), siempre que el router esté en funcionamiento.

La interfaz loopback es útil para probar y administrar un dispositivo Cisco IOS, ya que asegura que por lo menos una interfaz esté siempre disponible. Por ejemplo, se puede usar con fines de prueba, como la prueba de procesos de routing interno, mediante la emulación de redes detrás del router.

Las interfaces de bucle invertido también se utilizan comúnmente en entornos de laboratorio para crear interfaces adicionales. Por ejemplo, puede crear varias interfaces de bucle invertido en un router para simular más redes con fines de práctica de configuración y pruebas. En este plan de estudios, a menudo usamos una interfaz de bucle invertido para simular un enlace a Internet.

El proceso de habilitación y asignación de una dirección de loopback es simple:

Router(config)# interface loopback number 

Router(config-if)# ip address ip-address subnet-mask 

Se pueden habilitar varias interfaces loopback en un router. La dirección IPv4 para cada interfaz de bucle invertido debe ser única y no debe ser utilizada por ninguna otra interfaz, como se muestra en la configuración de ejemplo de la interfaz de bucle invertido 0 en R1.

R1(config)# interface loopback 0
R1(config-if)# ip address 10.0.0.1 255.255.255.0
R1(config-if)# exit
R1(config)#
%LINEPROTO-5-UPDOWN: Line protocol on Interface Loopback0, changed state to up

Verificar redes conectadas directamente
1.5.1
Comandos de verificación de interfaz

No tiene sentido configurar el router a menos que verifique la configuración y la conectividad. En este tema se describen los comandos que se van a utilizar para comprobar las redes conectadas directamente. Incluye dos verificadores de sintaxis y un trazador de paquetes.

Hay varios comandos show que se pueden usar para verificar el funcionamiento y la configuración de una interfaz. La topología de la figura se utiliza para demostrar la verificación de la configuración de la interfaz del router.
PC1 PC2 PC3 PC4 S1 S2 S4 R1 R2 .10 .10 .10 .10 ::10 ::10 ::10 ::10 192.168.10.0/24 192.168.11.0/24 10.1.1.0/24 10.1.2.0/24 2001:db8:acad:1::/64 2001:db8:acad:2::/64 2001:db8:acad:4::/64 2001:db8:acad:5::/64 G0/0/0 G0/0/0 G0/0/1 G0/0/1 209.165.200.224/30 2001:db8:acad:3::/64 .1 ::1 .1 ::1 .1 ::1 .1 ::1 .225 ::225 .226 ::226 S0/1/0 S0/1/0
S3

Los siguientes comandos son especialmente útiles para identificar rápidamente el estado de una interfaz:

    show ip interface brief y show ipv6 interface brief -Estos muestran un resumen de todas las interfaces, incluida la dirección IPv4 o IPv6 de la interfaz y el estado operativo actual.
    show running-config interface interface-id -Esto muestra los comandos aplicados a la interfaz especificada.
    show ip route y show ipv6 route - Este muestra el contenido de la tabla IPv4 o IPv6 almacenada en la memoria RAM. En Cisco IOS 15, las interfaces activas deben aparecer en la tabla de ruteo con dos entradas relacionadas identificadas con el código 'C' (Conectado) o 'L' (Local). En versiones anteriores de IOS, solo aparece una entrada con el código 'C'.

1.5.2
Verificación del estado de una interfaz

La salida de los comandos show ip interface brief y show ipv6 interface brief y se puede usar para revelar rápidamente el estado de todas las interfaces en el router. Puede verificar que las interfaces están activas y operativas como se indica en el estado de «up» y el protocolo de «up», como se muestra en el ejemplo. Un resultado distinto indicaría un problema con la configuración o el cableado.

R1# show ip interface brief
Interface              IP-Address      OK? Method Status                Protocol
GigabitEthernet0/0/0   192.168.10.1    YES manual up                    up
GigabitEthernet0/0/1   192.168.11.1    YES manual up                    up
Serial0/1/0            209.165.200.225 YES manual up                    up
Serial0/1/1            unassigned      YES unset  administratively down down
R1# show ipv6 interface brief
GigabitEthernet0/0/0   [up/up]
    FE80::7279:B3FF:FE92:3130
    2001:DB8:ACAD:1::1
GigabitEthernet0/0/1   [up/up]
    FE80::7279:B3FF:FE92:3131
    2001:DB8:ACAD:2::1
Serial0/1/0            [up/up]
    FE80::7279:B3FF:FE92:3130
    2001:DB8:ACAD:3::1
Serial0/1/1            [down/down]     Unassigned

1.5.3
Verificar direcciones locales y multidifusión de vínculos IPv6

El resultado del comando  show ipv6 interface brief show ipv6 interface brief show ipv6 interface brief  muestra dos direcciones IPv6 configuradas por interfaz. Una de las direcciones es la dirección de unidifusión global de IPv6 que se introdujo manualmente. La otra, que comienza con FE80, es la dirección de unidifusión link-local para la interfaz. La dirección link-local se agrega automáticamente a una interfaz cuando se asigna una dirección de unidifusión global. Las interfaces de red IPv6 deben tener una dirección link-local, pero no necesariamente una dirección de unidifusión global.

El comando show ipv6 interface gigabitethernet 0/0/0 muestra el estado de la interfaz y todas las direcciones IPv6 que pertenecen a la interfaz. Junto con la dirección local del enlace y la dirección de unidifusión global, la salida incluye las direcciones de multidifusión asignadas a la interfaz, comenzando con el prefijo FF02, como se muestra en el ejemplo.

R1# show ipv6 interface gigabitethernet 0/0/0
GigabitEthernet0/0/0 is up, line protocol is up
  IPv6 is enabled, link-local address is FE80::7279:B3FF:FE92:3130
  No Virtual link-local address(es):
  Global unicast address(es):
    2001:DB8:ACAD:1::1, subnet is 2001:DB8:ACAD:1::/64
  Joined group address(es):
    FF02::1
    FF02::1:FF00:1
    FF02::1:FF92:3130
  MTU is 1500 bytes
  ICMP error messages limited to one every 100 milliseconds
  ICMP redirects are enabled
  ICMP unreachables are sent
  ND DAD is enabled, number of DAD attempts: 1
  ND reachable time is 30000 milliseconds (using 30000)
  ND advertised reachable time is 0 (unspecified)
  ND advertised retransmit interval is 0 (unspecified)
  ND router advertisements are sent every 200 seconds
  ND router advertisements live for 1800 seconds
  ND advertised default router preference is Medium

1.5.4
Verificar la configuración de la interfaz

Junto con la dirección local del enlace y la dirección de unidifusión global, show running-config interface la salida incluye las direcciones de multidifusión asignadas a la interfaz, comenzando con el prefijo FF02, como se muestra en el ejemplo.

R1 show running-config interface gigabitethernet 0/0/0
Building configuration...
Current configuration : 158 bytes
!
interface GigabitEthernet0/0/0
 description Link to LAN 1
 ip address 192.168.10.1 255.255.255.0
 negotiation auto
 ipv6 address 2001:DB8:ACAD:1::1/64
end
R1#

Los dos comandos siguientes se usan para recopilar información más detallada sobre la interfaz:

    show interfaces - Muestra la información de la interfaz y el recuento de flujo de paquetes para todas las interfaces en el dispositivo.
    show ip interface and show ipv6 interface -Muestra la información relacionada con IPv4 e IPv6 para todas las interfaces en un router.

1.5.5
Verificar rutas

La salida de los show ip route comandos show ipv6 route y muestra las tres entradas de red conectadas directamente y las tres entradas de interfaz de ruta de host local, como se muestra en el ejemplo. La ruta de host local tiene una distancia administrativa de 0. También tiene una máscara /32 para IPv4 y una máscara /128 para IPv6. La ruta del host local es para rutas en el router que posee la dirección IP. Estas se usan para permitir que el router procese los paquetes destinados a esa dirección IP.

R1# show ip route
Codes: L - local, C - connected, S - static, R - RIP, M - mobile, B - BGP
       
Gateway of last resort is not set
      192.168.10.0/24 is variably subnetted, 2 subnets, 2 masks
C        192.168.10.0/24 is directly connected, GigabitEthernet0/0/0
L        192.168.10.1/32 is directly connected, GigabitEthernet0/0/0
      192.168.11.0/24 is variably subnetted, 2 subnets, 2 masks
C        192.168.11.0/24 is directly connected, GigabitEthernet0/0/1
L        192.168.11.1/32 is directly connected, GigabitEthernet0/0/1
      209.165.200.0/24 is variably subnetted, 2 subnets, 2 masks
C        209.165.200.224/30 is directly connected, Serial0/1/0
L        209.165.200.225/32 is directly connected, Serial0/1/0
R1# show ipv6 route
IPv6 Routing Table - default - 7 entries
Codes: C - Connected, L - Local, S - Static, U - Per-user Static route
       
C   2001:DB8:ACAD:1::/64 [0/0]
     via GigabitEthernet0/0/0, directly connected
L   2001:DB8:ACAD:1::1/128 [0/0]
     via GigabitEthernet0/0/0, receive
C   2001:DB8:ACAD:2::/64 [0/0]
     via GigabitEthernet0/0/1, directly connected
L   2001:DB8:ACAD:2::1/128 [0/0]
     via GigabitEthernet0/0/1, receive
C   2001:DB8:ACAD:3::/64 [0/0]
     via Serial0/1/0, directly connected
L   2001:DB8:ACAD:3::1/128 [0/0]
     via Serial0/1/0, receive
L   FF00::/8 [0/0]
     via Null0, receive
R1#

Una ‘C’ junto a una ruta dentro de la tabla de enrutamiento indica que se trata de una red conectada directamente. Cuando la interfaz del router está configurada con una dirección de unidifusión global y está en el estado "arriba / arriba", el prefijo IPv6 y la longitud del prefijo se agregan a la tabla de enrutamiento IPv6 como una ruta conectada.

La dirección de unidifusión global IPv6 aplicada a la interfaz también se instala en la tabla de enrutamiento como una ruta local. La ruta local tiene un prefijo /128. La tabla de routing utiliza las rutas locales para procesar eficazmente los paquetes cuyo destino es la dirección de la interfaz del router.

El ping comando para IPv6 es idéntico al comando usado con IPv4, excepto que se usa una dirección IPv6. Como se muestra en el ejemplo, el ping comando se usa para verificar la conectividad de Capa 3 entre R1 y PC1.

R1# ping 2001:db8:acad:1::10
Type escape sequence to abort.
Sending 5, 100-byte ICMP Echos to 2001:DB8:ACAD:1::10, timeout is 2 seconds:
!!!!!
Success rate is 100 percent (5/5), round-trip min/avg/max = 1/1/1 ms

1.5.6
Filtrado de los resultados del comando show

Los comandos que generan varias pantallas de resultados se pausan al cabo de 24 líneas de manera predeterminada. Al final del resultado detenido, se muestra el texto --More--. Al presionar Enter se muestra la siguiente línea y al presionar la barra espaciadora se muestra el siguiente conjunto de líneas. Use el terminal length comando para especificar el número de líneas que se mostrarán. Un valor 0 (cero) evita que el router haga una pausa entre las pantallas de resultados.

Otra característica muy útil que mejora la experiencia del usuario en la CLI es el show filtrado de salida. Los comandos de filtrado se pueden utilizar para mostrar secciones específicas de los resultados. Para habilitar el comando de filtrado, ingrese una barra vertical partida (|) después del show comando y luego ingrese un parámetro de filtrado y una expresión de filtrado.

Hay cuatro parámetros de filtrado que se pueden configurar después de la tubería.

section

Muestra la sección completa que comienza con la expresión de filtrado, como se muestra en el ejemplo.

R1# show running-config | section line vty
line vty 0 4
 password 7 110A1016141D
 login
 transport input all

include

Incluye todas las líneas de salida que coinciden con la expresión de filtrado, como se muestra en el ejemplo.

R1# show ip interface brief
Interface IP-Address OK? Method Status Protocol
GigabitEthernet0 / 0/0 192.168.10.1 SÍ manual arriba
GigabiteThernet0/0/1 192.168.11.1 SÍ manual arriba
Serie0 / 1/0 209.165.200.225 SÍ manual arriba
Serial0/1/1 unassigned NO unset down down
R1#
R1# show ip interface brief | include up
GigabitEthernet0 / 0/0 192.168.10.1 SÍ manual arriba
GigabiteThernet0/0/1 192.168.11.1 SÍ manual arriba
Serie0 / 1/0 209.165.200.225 SÍ manual arriba

exclude

Excluye todas las líneas de salida que coinciden con la expresión de filtrado, como se muestra en el ejemplo.

R1# show ip interface brief
Interface IP-Address OK? Method Status Protocol
GigabitEthernet0 / 0/0 192.168.10.1 SÍ manual arriba
GigabiteThernet0/0/1 192.168.11.1 SÍ manual arriba
Serie0 / 1/0 209.165.200.225 SÍ manual arriba
Serial0/1/1 unassigned NO unset down down
R1#
R1# show ip interface brief | exclude unassigned
Interface IP-Address OK? Method Status Protocol
GigabitEthernet0 / 0/0 192.168.10.1 SÍ manual arriba
GigabiteThernet0/0/1 192.168.11.1 SÍ manual arriba
Serie0 / 1/0 209.165.200.225 SÍ manual arriba

begin

Muestra todas las líneas de salida desde un punto determinado, comenzando con la línea que coincide con la expresión de filtrado, como se muestra en el ejemplo.

R1# show ip route | begin Gateway
Gateway of last resort is not set
      192.168.10.0/24 is variably subnetted, 2 subnets, 2 masks
C 192.168.10.0/24 está directamente conectado, GigabitEthernet0/0/0
L 192.168.10.1/32está directamente conectado, GigabitEthernet0/0/0
      192.168.11.0/24 is variably subnetted, 2 subnets, 2 masks
C 192.168.10.0/24 está directamente conectado, GigabitEthernet0/0/0
L 192.168.10.1/32está directamente conectado, GigabitEthernet0/0/0
      209.165.200.0/24 is variably subnetted, 2 subnets, 2 masks
C 209.165.200.224/30está directamente conectado, Serial0/1/0
L 209.165.200.225/32 está conectado directamente, Serie0 / 1/0

Nota: Los filtros de salida se pueden usar en combinación con cualquier show comando.
1.5.7
Comprobador de sintaxis - Salida del comando Mostrar filtro

En esta actividad del Comprobador de sintaxis, filtrará la salida de los comandos show.

Introduzca el comando para filtrar el resultado del comando show running-config para la sección 'line con'.
R1#show running-config | section line con

line con 0
 password 7 05080F1C2243
 transport input none

Introduzca el comando para filtrar las interfaces con estado “down” (inactivo) en la lista resumida.
R1#show ip interface brief | include down

Serial0/1/1   unassigned   NO  unset  down  down

Introduzca el comando para excluir las interfaces con estado “up” (activo) en la lista resumida.
R1#show ip interface brief | exclude up

Interface            IP-Address      OK? Method Status                Protocol
Serial0/1/1            unassigned      NO  unset  down                  down

Introduzca el comando para filtrar el resultado del comando show running-config para que comience desde la palabra “line”.
R1#show running-config | begin line

line con 0
 password 7 05080F1C2243
 transport input none
 stopbits 1
line vty 0 4
 password 7 110A1016141D
 login
 transport input all

Ha ejecutado correctamente los comandos show filtrados.

1.5.8
Historial de comandos

La función de historial de comandos es útil porque almacena temporalmente la lista de comandos ejecutados para recuperar.

Para recuperar comandos en el búfer de historial, presione Ctrl+P o la Up Arrow tecla. El resultado de los comandos comienza con el comando más reciente. Repita la secuencia de teclas para recuperar sucesivamente los comandos más antiguos. Para volver a los comandos más recientes en el búfer de historial, presione Ctrl+N o la Down Arrow tecla. Repita la secuencia de teclas para recuperar sucesivamente los comandos más recientes.

De manera predeterminada, el historial de comandos está habilitado, y el sistema captura las últimas 10 líneas de comandos en el búfer de historial. Utilice el show history comando EXEC privilegiado para mostrar el contenido del búfer.

También es práctico aumentar la cantidad de líneas de comandos que registra el búfer de historial solamente durante la sesión de terminal actual. Use el terminal history size comando EXEC del usuario para aumentar o disminuir el tamaño del búfer.

Un ejemplo de los comandos terminal history size y show history se muestra en la figura.

R1# terminal history size 200
R1# show history
  show ip int brief
  show interface g0/0/0
  show ip route
  show running-config
  show history
  terminal history size 200
  

1.5.9

Comprobador de## sintaxis - Características del historial de comandos

En esta actividad de comprobación de sintaxis, utilizará la función de historial de comandos.

Introduzca el comando para establecer la cantidad de líneas en historial de comandos en 200.
R1>terminal history size 200

Introduzca el comando para mostrar el historial de comandos.
R1>show history

  show running-config | section line con
  show ip interface brief | include down
  show ip interface brief | exclude up
  show running-config | begin line
  terminal history size 200
  show history
R1>

Ha configurado y mostrado correctamente el historial de comandos.

1.5.11
Compruebe su comprensión - Verificar las redes conectadas directamente

Verifique su comprensión de verificar las redes conectadas directamente eligiendo la MEJOR respuesta a las siguientes preguntas.

    ¿Qué comando mostrará un resumen de todas las interfaces habilitadas para IPv6 en un router que incluya la dirección IPv6 y el estado operativo?

Al verificar rutas, ¿qué código se utiliza para identificar rutas conectadas directamente en la tabla de enrutamiento?

¿Qué comando mostrará recuentos de flujo de paquetes, colisiones y fallas de búfer en una interfaz?

Se requiere una interfaz habilitada para IPv6 para tener qué tipo de dirección?

¿Qué carácter se utiliza para habilitar el filtrado de comandos?

¿Qué expresión de filtrado mostrará todas las líneas de salida a partir de la línea que coincida con la expresión de filtrado?

1.6.3
¿Qué aprenderé en este módulo?

Configuración de parámetros iniciales de un switch

Después de encender un switch Cisco, pasa por una secuencia de arranque de cinco pasos. La variable de entorno BOOT se establece utilizando el boot system comando del modo de configuración global. El IOS se encuentra en una carpeta distinta y se especifica la ruta de la carpeta. Utilice los LED del interruptor para supervisar la actividad y el rendimiento del interruptor: SYST, RPS, STAT, DUPLX, SPEED y PoE. El cargador de arranque proporciona acceso al switch si no se puede usar el sistema operativo debido a la falta de archivos de sistema o al daño de estos. El cargador de arranque tiene una línea de comando que proporciona acceso a los archivos almacenados en la memoria flash. Para el acceso a la administración remota de un switch, este se debe configurar con una dirección IP y una máscara de subred. Para administrar el switch desde una red remota, el switch debe configurarse con una puerta de enlace predeterminada. Para configurar el switch SVI, primero debe configurar la interfaz de administración, luego configurar la puerta de enlace predeterminada y, finalmente, verificar la configuración.

Configuración de puertos de un switch

La comunicación en dúplex completo aumenta el ancho de banda eficaz al permitir que ambos extremos de una conexión transmitan y reciban datos simultáneamente. La comunicación semidúplex es unidireccional. Los puertos de switch se pueden configurar manualmente con parámetros específicos de dúplex y de velocidad. Utilice la negociación automática cuando la configuración de velocidad y dúplex del dispositivo que se conecta al puerto sea desconocida o pueda cambiar. Al habilitar la característica auto-MDIX, la interfaz detecta automáticamente el tipo de conexión de cable requerido (directo o cruzado) y configura la conexión conforme a esa información. Hay varios show comandos que se pueden utilizar al verificar las configuraciones del switch. Utilice el show running-config comando y el show interfaces comando para verificar la configuración de un puerto de switch. El resultado del show interfaces comando también es útil para detectar problemas comunes de capa de acceso a la red, ya que muestra el estado del protocolo de línea y vínculo de datos. Los errores de entrada reportados desde el show interfaces comando incluyen: tramas runt, gigantes, errores CRC, junto con colisiones y colisiones tardías. Utilícelo show interfaces para determinar si la red no tiene conexión o una conexión incorrecta entre un switch y otro dispositivo.

Acceso remoto seguro

Telnet (que usa el puerto TCP 23) es un protocolo más antiguo que utiliza la transmisión de texto sin formato segura tanto de la autenticación de inicio de sesión (nombre de usuario y contraseña) como de los datos transmitidos entre los dispositivos de comunicación. SSH (utilizando el puerto TCP 22) es un protocolo seguro que proporciona una conexión de administración cifrada a un dispositivo remoto. SSH proporciona seguridad para las conexiones remotas mediante el cifrado seguro cuando se autentica un dispositivo (nombre de usuario y contraseña) y también para los datos transmitidos entre los dispositivos que se comunican. Utilice el show version comando del switch para ver qué IOS está ejecutando el switch. Un nombre de archivo de IOS que incluye la combinación «k9» admite características y capacidades criptográficas. Para configurar SSH, debe verificar que el switch lo admita, configurar el dominio IP, generar pares de claves RSA, configurar la autenticación de uso, configurar las líneas VTY y habilitar SSH versión 2. Para verificar que SSH esté operativo, use el show ip ssh comando para mostrar la versión y los datos de configuración de SSH en el dispositivo.

Configuración básica de un router

Siempre se deben realizar las siguientes tareas de configuración inicial: nombrar el dispositivo para distinguirlo de otros routeres y configurar contraseñas, configurar un banner para proporcionar notificación legal de acceso no autorizado y guardar los cambios en un router. Una característica que distingue a los switches de los routers es el tipo de interfaces que admite cada uno. Por ejemplo, los switches de capa 2 admiten redes LAN y, por lo tanto, tienen varios puertos FastEthernet o Gigabit Ethernet. La topología de pila dual se utiliza para demostrar la configuración de las interfaces IPv4 e IPv6 del router. Los routers admiten redes LAN y WAN, y pueden interconectar distintos tipos de redes; por lo tanto, admiten muchos tipos de interfaces. Por ejemplo, los ISR G2 tienen una o dos interfaces Gigabit Ethernet integradas y ranuras para tarjetas de interfaz WAN de alta velocidad (HWIC) para admitir otros tipos de interfaces de red, incluidas las interfaces seriales, DSL y de cable. La interfaz de bucle invertido IPv4 es una interfaz lógica interna del router. No está asignado a un puerto físico y nunca se puede conectar a ningún otro dispositivo.

Verificar redes conectadas directamente

Utilice los siguientes comandos para identificar rápidamente el estado de una interfaz: show ip interface brief y show ipv6 interface brief para ver un resumen de todas las interfaces (direcciones IPv4 e IPv6 y estado operativo), show running-config interface interface-id para ver los comandos aplicados a una interfaz especificada show ip route y show ipv6 route para ver el de la tabla de enrutamiento IPv4 o IPv6 almacenada en la RAM. La salida de los show ip interface brief comandos show ipv6 interface brief y se puede usar para revelar rápidamente el estado de todas las interfaces en el enrutador. El show ipv6 interface gigabitethernet 0/0/0 comando muestra el estado de la interfaz y todas las direcciones IPv6 que pertenecen a la interfaz. Junto con la dirección local del enlace y la dirección de unidifusión global, la salida incluye las direcciones de multidifusión asignadas a la interfaz. La salida del show running-config interface comando muestra los comandos actuales aplicados a una interfaz específica. El show interfaces comando muestra la información de la interfaz y el recuento de flujo de paquetes para todas las interfaces en el dispositivo. Verifique la configuración de la interfaz mediante show ip interface los comandos show ipv6 interface y, que muestran la información relacionada con IPv4 e IPv6 para todas las interfaces de un router. Compruebe las rutas mediante los show ip route comandos show ipv6 route y. Filtrar la salida del comando show usando el carácter pipe (|). Usar expresiones de filtro: sección, inclusión, exclusión y comienzo. De forma predeterminada, el historial de comandos está habilitado y el sistema captura las últimas 10 líneas de comando en su búfer de historial. Utilice el show history comando EXEC privilegiado para mostrar el contenido del búfer.
1.6.4
Prueba del módulo: configuración básica del dispositivo

    ¿Qué tareas se pueden realizar mediante la función de historial de comandos? (Escoja dos opciones).

¿Qué declaración describe el funcionamiento del LED del sistema en los switches Catalyst de Cisco?

¿Qué tipo de cable Ethernet se utilizaría para conectar un switch a otro cuando ninguno de los dos admite la función Auto-MDIX?

¿Qué ventajas brinda SSH en comparación con Telnet?

Un administrador de red ha configurado VLAN 99 como VLAN de administración y la ha configurado con una dirección IP y una máscara de subred. El administrador emite el show interface vlan 99 comando y observa que el protocolo de línea está inhabilitado. ¿Qué acción puede cambiar el estado del protocolo de línea a arriba?

¿Qué enunciado describe los SVI?

¿Qué mensaje se muestra cuando un administrador de red accede correctamente al gestor de arranque en un switch para recuperarse de un fallo del sistema?

¿Qué secuencia de arranque del router es correcta?

¿Cuál es la primera acción en la secuencia de arranque cuando un switch está encendido?

¿Con qué debe contar un administrador para restablecer una contraseña olvidada en un router?

Al configurar un switch para el acceso SSH, ¿qué otro comando asociado con el login local comando es necesario ingresar en el switch?

¿Qué comando proporcionará información sobre el estado de todas las interfaces, incluyendo el número de gigantes, runts y colisiones en la interfaz?

2. Conceptos de switching

Introducción
2.0.1
¿Por qué debería tomar este módulo?

¡Bienvenido a conceptos de Switching!

Puede conectar y configurar switches, ¡eso es genial!. Pero incluso una red con la tecnología más reciente desarrolla sus propios problemas eventualmente. Si tiene que solucionar problemas de la red, necesita saber cómo funcionan los switches. Este módulo le proporciona los fundamentos de los switches y su funcionamiento. Por suerte, el funcionamiento del switch es fácil de entender.
2.0.2
¿Qué aprenderé en este módulo?

Título del módulo: Conceptos de switching

Objetivos del módulo: Explique cómo los switches de capa 2 reenvían datos.
Leyenda de la tabla
Título del tema 	Objetivo del tema
Reenvío de tramas 	Explique la forma en la que las tramas se reenvían en una red conmutada.
Dominios de switching 	Compare un dominio de colisión con un dominio de difusión.

Reenvío de tramas
2.1.1
Switching en la red

El concepto de switching y reenvío de tramas es universal en la tecnología de redes y en las telecomunicaciones. En las redes LAN, WAN y en la red pública de telefonía conmutada (PSTN), se usan diversos tipos de switches.

La decisión sobre cómo un switch reenvía el tráfico se toma en relación con el flujo de ese tráfico. Hay dos términos asociados a las tramas que entran y salen de una interfaz:

    Entrada - Este término se usa para describir el puerto por donde una trama ingresa al dispositivo.
    Salida - Este término se usa para describir el puerto que las tramas utilizarán al salir del dispositivo.

Un switch LAN mantiene una tabla a la que hace referencia al reenviar tráfico a través del switch. La única inteligencia de un switch LAN es su capacidad de usar su tabla para reenviar tráfico. Un switch LAN reenvía tráfico basado en el puerto de entrada y la dirección MAC de destino de una trama Ethernet. Con un switch LAN, hay solamente una tabla de switching principal que describe una asociación estricta entre las direcciones MAC y los puertos; por lo tanto, una trama Ethernet con una dirección de destino determinada siempre sale por el mismo puerto de salida, independientemente del puerto de entrada por el que ingresa.

Nota: Una trama Ethernet nunca se reenviará fuera del mismo puerto en el que se recibió.

Haga clic en el botón Reproducir para ver una animación del proceso de switching.

La animación muestra un rectángulo para identificar un switch con 6 cuadrados numerados para 6 puertos de switch. La tabla de direcciones MAC muestra una dirección mac registrada en cada número de puerto
Tabla de puertos
Direcciones de destino 	Puerto
EE 	1
AA 	2
BA 	3
EA 	4
AC 	5
AB 	6
2.1.2
Tabla de direcciones MAC del switch

Un switch se compone de circuitos integrados y del software complementario que controla las rutas de datos a través del switch. Los switches usan direcciones MAC de destino para dirigir las comunicaciones de red a través del switch, fuera del puerto apropiado, hacia el destino.

Para definir qué puerto usar para transmitir una trama, el switch primero debe saber qué dispositivos existen en cada puerto. A medida que el switch aprende la relación de los puertos con los dispositivos, construye una tabla llamada tabla de direcciones MAC. Esta tabla se almacena en la Memoria de Contenido Direccionable (Content-Addressable Memory, CAM), la cual es un tipo especial de memoria utilizada en aplicaciones de búsqueda de alta velocidad. Por esta razón, la tabla de direcciones MAC a veces también se denomina tabla CAM.

Los switches LAN determinan cómo manejar las tramas de datos entrantes manteniendo la tabla de direcciones MAC. Un switch llena su tabla de direcciones MAC al registrar la dirección MAC de origen de cada dispositivo conectado a cada uno de sus puertos. El switch hace referencia a la información en la tabla de direcciones MAC para enviar tramas destinadas a un dispositivo específico fuera del puerto que se ha asignado a ese dispositivo.
2.1.3
El método Aprender y Reenviar del Switch

El siguiente proceso de dos pasos se realiza para cada trama de Ethernet que ingresa a un switch.

Paso 1. Aprender - Examinando la dirección Origen MAC

Se revisa cada trama que ingresa a un switch para obtener información nueva. Esto se realiza examinando la dirección MAC de origen de la trama y el número de puerto por el que ingresó al switch.

    Si la dirección MAC de origen no existe en la tabla de direcciones MAC, la dirección MAC y el número de puerto entrante son agregados a la tabla.
    Si la dirección MAC de origen existe, el switch actualiza el temporizador para esa entrada. De manera predeterminada, la mayoría de los switches Ethernet guardan una entrada en la tabla durante cinco minutos. Si la dirección MAC de origen existe en la tabla, pero en un puerto diferente, el switch la trata como una entrada nueva. La entrada se reemplaza con la misma dirección MAC, pero con el número de puerto más actual.

Paso 2. Reenviar - Examinadno la dirección destino MAC

Si la dirección MAC de destino es una dirección de unidifusión, el switch busca una coincidencia entre la dirección MAC de destino de la trama y una entrada de la tabla de direcciones MAC:

    Si la dirección MAC de destino está en la tabla, reenviará la trama por el puerto especificado.
    Si la dirección MAC de destino no está en la tabla, el switch reenviará la trama por todos los puertos, excepto por el de entrada. Esto se conoce como unidifusión desconocida. Si la dirección MAC de destino es de difusión o de multidifusión, la trama también se envía por todos los puertos, excepto por el de entrada.

2.1.4
Video: Tablas de direcciones MAC en switches conectados

En la ilustración, haga clic en Reproducir para ver una demostración de cómo dos switches conectados arman tablas de direcciones MAC.
2.1.5
Métodos de reenvío del switch

Los switches toman decisiones de reenvío de capa 2 muy rápidamente. Esto se debe al software en los circuitos integrados para aplicaciones específicas (ASIC, por sus siglas en ingles). Los ASIC reducen el tiempo de manejo de paquetes dentro del dispositivo y permiten que el dispositivo pueda manejar una mayor cantidad de puertos sin disminuir el rendimiento.

Los switches de capa 2 utilizan uno de estos dos métodos para cambiar tramas:

    Almacenamiento y reenvío de switching - Este método toma una decisión de reenvío en una trama después de haber recibido la trama completa y revisada para la detección de errores mediante un mecanismo matemático de verificación de errores conocido como Verificación por Redundancia Cíclica (Cyclic Redundancy Check, CRC). El intercambio por almacenamiento y envío es el método principal de switching LAN de Cisco.
    Método de corte - Este método inicia el proceso de reenvío una vez que se determinó la dirección MAC de destino de una trama entrante y se estableció el puerto de salida.

2.1.6
Intercambio de almacenamiento y reenvío

El intercambio de almacenamiento y reenvío, a diferencia del intercambio de corte, tiene laS siguientes características principales:

    Verificación de errores - Después de recibir la trama completa en el puerto de entrada, el switch compara el valor de Secuencia de Verificación de Trama (Frame Check Sequence, FCS) en el último campo del datagrama con sus propios cálculos de FCS. FCS es un proceso de verificación de errores que contribuye a asegurar que la trama no contenga errores físicos ni de enlace de datos. Si la trama no posee errores, el switch la reenvía. De lo contrario, se descartan las tramas.
    Almacenamiento en búfer automático - El proceso de almacenamiento en buffer que usan los switches de almacenamiento y envío proporciona la flexibilidad para admitir cualquier combinación de velocidades de Ethernet. Por ejemplo, manejar una trama entrante que viaja a un puerto Ethernet de 100 Mbps que debe enviarse a una interfaz de 1 Gbps, requeriría utilizar el método de almacenamiento y reenvío. Ante cualquier incompatibilidad de las velocidades de los puertos de entrada y salida, el switch almacena la trama completa en un buffer, calcula la verificación de FCS, la reenvía al buffer del puerto de salida y después la envía.

La figura ilustra cómo almacenar y reenviar toma una decisión basada en la trama Ethernet.

muestra un diagrama de una trama Ethernet y resalta el hecho de que en el cambio de almacenamiento y reenvío, el switch lee toda la trama, incluidos todos los encabezados, los datos y la secuencia de comprobación de tramas antes de reenviarlo
8 6 6 2
4
Encabezado de redEncabezado de la tramaPreámbuloDirección MAC de destinoDirección MAC de origenTipoChecksum de FCS (CRC)Encabezado de transporteDatosBytesEl switching por almacenamiento y envío exige la recepción de la trama completa (hasta aproximadamente 9,200 bytes para las tramas gigantes) antes de tomar una decisión con respecto al reenvío.
2.1.7
Switching por método de corte

El método de switching de almacenamiento y reenvío elimina las tramas que no pasan la comprobación FCS. Por lo tanto, no reenvía tramas no válidas.

Por el contrario, los switches que usan el método de corte pueden reenviar tramas no válidas, ya que no realizan la verificación de FCS. Sin embargo, el switching de corte tiene la capacidad de realizar un cambio de trama rápida. Esto significa que los switches que usan el método de corte pueden tomar una decisión de reenvío tan pronto como encuentren la dirección MAC de destino de la trama en la tabla de direcciones MAC, tal y como se muestra en la ilustración.

muestra un diagrama de una trama Ethernet, y resalta el hecho de que en el switching de corte puede reenviar la trama una vez que lee la dirección MAC de destino
8 6 6 2
4
Encabezado de redEncabezado de la tramaPreámbuloDirección MAC de destinoDirección MAC de origenTipoChecksum de FCS (CRC)Encabezado de transporteDatosBytesLas tramas pueden comenzar a reenviarse en cuanto se recibe la MAC de destino.

El switch no tiene que esperar a que el resto de la trama ingrese al puerto de entrada antes de tomar la decisión de reenvío.

El switching libre de fragmentos es una forma modificada de corte, en la que el switch solo comienza a reenviar la trama después de haber leído el campo Tipo. El switching libre de fragmentos proporciona una mejor verificación de errores que el método de corte, con prácticamente ningún aumento de latencia.

La velocidad de latencia más baja del switching por corte hace que resulte más adecuado para las aplicaciones mas demandantes de Tecnología Informática de Alto Rendimiento (High-Performance Computing, HPC) que requieren latencias de proceso a proceso de 10 microsegundos o menos.

El método switching de corte puede reenviar tramas con errores. Si hay un índice de error alto (tramas no válidas) en la red, el switching por método de corte puede tener un impacto negativo en el ancho de banda, de esta forma, se obstruye el ancho de banda con las tramas dañadas y no válidas.
2.1.8
Actividad: El Switch!

Utilice esta actividad para comprobar su comprensión de cómo un switch aprende y reenvía tramas.
Trama
Preámbulo
	
Destino MAC
	
Origen MAC
	
Tipo/Longitud
	
Trama
	
Fin de Trama
	0F	0E			

Tabla MAC
Fa1	Fa2	Fa3	Fa4	Fa5	Fa6	Fa7	Fa8	Fa9	Fa10	Fa11	Fa12
0A		0B							0F			
Pregunta 1 - ¿Adónde reenviará la trama el switch?
Pregunta 2 - ¿Cuáles de estas afirmaciones sobre el reenvío de una trama por parte del switch son verdaderas?

Dominios de switching
2.2.1
Dominios de colisiones

En el tema anterior, obtuvo una mejor comprensión de lo que es un switch y cómo funciona. En este tema se explica cómo funcionan los switches entre sí y con otros dispositivos para eliminar colisiones y reducir la congestión de la red. Los términos colisiones y congestión se utilizan aquí de la misma manera que se utilizan en el tráfico callejero.

En segmentos Ethernet basados en hubs antiguos, los dispositivos de red compitieron por el medio compartido. Los segmentos de red que comparten el mismo ancho de banda entre dispositivos se conocen como dominios de colisión. Cuando dos o más dispositivos del mismo dominio de colisión tratan de comunicarse al mismo tiempo, se produce una colisión.

Si un puerto Ethernet de switch funciona en semidúplex, cada segmento está en su propio dominio de colisión. No hay dominios de colisión cuando los puertos del switch funcionan en dúplex completo. Sin embargo, podría haber un dominio de colisión si un puerto de switch funciona en semidúplex.

De manera predeterminada, los puertos de Ethernet del switch negociarán automáticamente el dúplex completo cuando el dispositivo adyacente también pueda funcionar en dúplex completo. Si el puerto del switch está conectado a un dispositivo que funciona en semidúplex, como por ejemplo un hub antiguo, el puerto de switch funcionará en modo semidúplex. En el caso de semidúplex, el puerto de switch formará parte de un dominio de colisión.

Como se muestra en la figura, se elige dúplex completo si ambos dispositivos cuentan con la funcionalidad, junto con su ancho de banda común más elevado.

el diagrama muestra que un PC y un switch negociarán automáticamente la configuración y las velocidades dúplex correspondientes. En este caso dúplex completo y 100Mb por segundo
S2
PC A
DúplexDúplexVelocidadVelocidadCompletoMedioCompletoMedio100 Mbps10 Mbps100 Mbps10 Mbps1000 MbpsPuerto 1Autonegociación
2.2.2
Dominios de difusión

Una serie de switches interconectados forma un dominio de difusión simple. Solo los dispositivos de capa de red, como los routers, pueden dividir un dominio de difusión de capa 2. Los routers se utilizan para segmentar los dominios de difusión, pero también segmentan un dominio de colisión.

Cuando un dispositivo desea enviar una difusión de capa 2, la dirección MAC de destino de la trama se establece solo en números uno binarios.

El dominio de difusión de capa 2 se denomina “dominio de difusión MAC”. El dominio de difusión MAC consta de todos los dispositivos en la LAN que reciben tramas de difusión de un host.

Haga clic en Reproducir en la ilustración para verlo en la primera mitad de la animación.

muestra una animación de diagrama de un mensaje de difusión que viaja a cada host conectado al switch, y también de switch a switch, dentro del dominio de difusión o LAN

Cuando un switch recibe una trama de difusión, la reenvía por cada uno de sus puertos, excepto por el puerto de entrada en el que se recibió la trama de difusión. Cada dispositivo conectado al switch recibe una copia de la trama de difusión y la procesa.

En ocasiones, las difusiones son necesarias para localizar inicialmente otros dispositivos y servicios de red, pero también reducen la eficacia de la red. El ancho de banda de red se usa para propagar el tráfico de difusión. Si hay demasiadas difusiones y una carga de tráfico intensa en una red, se puede producir una congestión, lo que reduce el rendimiento de la red.

Cuando hay dos switches conectados entre sí, se aumenta el dominio de difusión, como se ve en la segunda mitad de la animación. En este caso, se reenvía una trama de difusión a todos los puertos conectados en el switch S1. El switch S1 está conectado al switch S2. Luego, la trama se propaga a todos los dispositivos conectados al switch S2.
2.2.3
Alivio de la congestión en la red

Los switches LAN tienen características especiales que los hacen eficaces para aliviar la congestión de una red. De manera predeterminada, los puertos de switch interconectados tratan de establecer un enlace en dúplex completo y por lo tanto se eliminan los dominios de colisión. Cada puerto dúplex completo del switch ofrece el ancho de banda completo a los dispositivos conectados a dicho puerto. Las conexiones dúplex completas aumentaron notablemente el rendimiento de las redes LAN y se requieren para velocidades de Ethernet de 1 Gb/s y superiores.

Los switches interconectan segmentos LAN, usan una tabla de direcciones MAC para determinar los puertos de salida y pueden reducir o eliminar por completo las colisiones. Las características de los switches que alivian la congestión de la red incluyen las siguientes:

    Velocidades de puertos rápidas : las velocidades de los puertos del switch Ethernet varían según el modelo y el propósito. Por ejemplo, la mayoría de los switches de capa de acceso admiten velocidades de puerto de 100 Mbps y 1 Gbps. Los switches de capa de distribución admiten velocidades de puerto de 100 Mbps, 1 Gbps y 10 Gbps y los switches de nivel central y centro de datos admiten velocidades de puerto de 100 Gbps, 40 Gbps y 10 Gbps. Los switches con velocidades de puerto más rápidas cuestan más pero pueden reducir la congestión.
    Cambio interno rápido : los switches utilizan un bus interno rápido o memoria compartida para proporcionar un alto rendimiento.
    Búferes de trama grande : los switches utilizan búferes de memoria grande para almacenar temporalmente más tramas recibidas antes de tener que empezar a descartarlas. Esto permite que el tráfico de entrada desde un puerto más rápido (por ejemplo, 1 Gbps) se reenvíe a un puerto de salida más lento (por ejemplo, 100 Mbps) sin perder tramas.
    Alta densidad de puertos : un switch de alta densidad de puertos reduce los costos generales porque reduce el número de switches requeridos. Por ejemplo, si se necesitaran 96 puertos de acceso, sería menos costoso comprar dos switches de 48 puertos en lugar de cuatro switches de 24 puertos. Los switches de alta densidad de puertos también ayudan a mantener el tráfico local, lo que ayuda a aliviar la congestión.

2.2.4
Verifique su comprensión - Cambiar dominios

Verifique su comprensión sobre dominios de switches eligiendo la MEJOR respuesta a las siguientes preguntas.

    ¿Qué velocidad de puerto se negociará automáticamente entre un host con una NIC de 1 Gbps que se conecta a un switch Cisco Catalyst 2960 con un puerto de 100 Mbps?

¿Qué dispositivo separa los dominios de difusión?

¿Qué dos características especiales utilizan los switches LAN para aliviar la congestión de la red? (Escoja dos opciones).

Práctica del módulo y cuestionario
2.3.1
¿Qué aprenderé en este módulo?

Reenvío de trama

La decisión sobre cómo un switch reenvía el tráfico se toma en relación con el flujo de ese tráfico. El término ingreso describe el puerto donde una trama ingresa a un dispositivo. El término salida describe el puerto que las tramas utilizarán al salir del dispositivo. Una trama Ethernet nunca será reenviada fuera del puerto donde ingresó. Para definir qué puerto usar para transmitir una trama, el switch primero debe saber qué dispositivos existen en cada puerto. A medida que el switch aprende la relación de los puertos con los dispositivos, construye una tabla llamada tabla de direcciones MAC. Cada trama que ingresa a un switch se comprueba para obtener información nueva examinando la dirección MAC de origen de la trama y el número de puerto donde la trama ingresó al switch. Si la dirección MAC de destino es una dirección de unidifusión, el switch busca una coincidencia entre la dirección MAC de destino de la trama y una entrada en la tabla de direcciones MAC. Los métodos de reenvío de switches incluyen almacenamiento y reenvío y corte. Almacenaje y reenvío utiliza la comprobación de errores y el almacenamiento en búfer automático. El corte no comprueba errores. En su lugar, realiza un cambio rápido de trama. Esto significa que el switch puede tomar una decisión de reenvío tan pronto como haya buscado la dirección MAC de destino de la trama en su tabla de direcciones MAC.

Cambio de Dominio

Si un puerto Ethernet de switch funciona en semidúplex, cada segmento está en su propio dominio de colisión. No hay dominios de colisión cuando los puertos del switch funcionan en dúplex completo. De manera predeterminada, los puertos de Ethernet del switch negociarán automáticamente el dúplex completo cuando el dispositivo adyacente también pueda funcionar en dúplex completo. Una serie de switches interconectados forma un dominio de difusión simple. Solo los dispositivos de capa de red, como los routers, pueden dividir un dominio de difusión de capa 2. El dominio de difusión de capa 2 se denomina “dominio de difusión MAC”. El dominio de difusión MAC consta de todos los dispositivos en la LAN que reciben tramas de difusión de un host. Cuando un switch recibe una trama de difusión, la reenvía por cada uno de sus puertos, excepto el puerto de entrada en el que se recibió la trama de difusión. Cada dispositivo conectado al switch recibe una copia de la trama de difusión y la procesa. Los switches pueden: interconectar segmentos LAN, usar una tabla de direcciones MAC para determinar los puertos de salida y pueden reducir o eliminar por completo las colisiones. Para ayudar a aliviar la congestión, los switches utilizan velocidades de puerto rápidas, cambio interno rápido, búferes de tramas grandes y densidades de puertos altas
2.3.2
Prueba del módulo: conceptos de switches

    ¿Qué declaración es verdadera sobre los dominios de difusión y colisión?

¿Cuál es una función de un switch de capa 2?

¿Cuál es la diferencia mas significativa entre un hub y un switch LAN de capa 2?

¿Qué hace un switch LAN de Cisco si recibe una trama entrante y la dirección MAC de destino no figura en la tabla de direcciones MAC?

¿Qué característica del switch ayuda a aliviar la congestión de la red cuando un puerto de 10 Gbps reenvía datos a un puerto de 1 Gbps?

¿Qué método de switching utiliza el valor FCS?

¿Qué representa el término "densidad de puertos" para un switch Ethernet?

¿Qué información utiliza un switch para mantener actualizada la información de la tabla de direcciones MAC?

¿Qué dos afirmaciones son ciertas acerca de las comunicaciones semidúplex y dúplex completo? (Escoja dos opciones).

¿Qué tipo de dirección utiliza un switch para generar la tabla de direcciones MAC?

¿Qué opción describe correctamente un método de switching?

¿Qué dispositivo de red puede funcionar como límite para dividir un dominio de difusión de capa 2?

¿Cuál es el propósito de los búferes de trama en un switch?

¿Qué dispositivo de red se puede usar para eliminar colisiones en una red Ethernet?


Introducción
3.0.1
¿Por qué debería tomar este módulo?

¡Bienvenido a las VLAN!

Imagina que estás a cargo de una conferencia muy grande. Hay personas de todas partes que comparten un interés común y algunas que también tienen una experiencia especial. Imagínese si cada experto que quisiera presentar su información a un público más pequeño tuviera que hacerlo en la misma sala grande con todos los demás expertos y sus audiencias más pequeñas. Nadie podría oír nada. Tendrías que encontrar salas separadas para todos los expertos y sus audiencias más pequeñas. La LAN virtual (VLAN) hace algo similar en una red. Las VLAN se crean en la Capa 2 para reducir o eliminar el tráfico de difusión. Las VLAN son la forma en que divide la red en redes más pequeñas, de modo que los dispositivos y las personas dentro de una sola VLAN se comunican entre sí y no tienen que administrar el tráfico de otras redes. El administrador de red puede organizar las VLAN por ubicación, quién las está utilizando, el tipo de dispositivo o cualquier categoría que se necesite. Sabes que quieres aprender a hacer esto, ¡así que no esperes!
3.0.2
¿Qué aprenderé en este módulo?

Título del módulo: VLANs

Objetivos del módulo: Implemente VLAN y enlaces troncales en una red conmutada.
Leyenda de la tabla
Título del tema 	Objetivo del tema
Descripción general de las VLAN 	Explique la finalidad de las VLAN en una red conmutada.
Redes VLAN en un entorno conmutado múltiple 	Explique cómo un switch reenvía tramas según la configuración de VLAN en un entorno conmutado múltiple.
Configuración de VLAN 	Configure un puerto para switch que se asignará a una VLAN según los requisitos.
Enlaces troncales de la VLAN 	Configure un puerto de enlace troncal en un switch LAN.
Protocolo de enlace troncal dinámico 	Configure el protocolo de enlace troncal dinámico (DTP).

3 VLANs

Descripción general de las VLAN
3.1.1
Definiciones de VLAN

Por supuesto, organizar su red en redes más pequeñas no es tan simple como separar tornillos y ponerlos en frascos. Pero hará que su red sea más fácil de administrar. Dentro de una red conmutada, las VLAN proporcionan la segmentación y la flexibilidad organizativa. Un grupo de dispositivos dentro de una VLAN se comunica como si cada dispositivo estuviera conectados al mismo cable. Las VLAN se basan en conexiones lógicas, en lugar de conexiones físicas.

Como se muestra en la figura, las VLAN en una red conmutada permiten a los usuarios de varios departamentos (por ejemplo, TI, recursos humanos y ventas) conectarse a la misma red, independientemente del switch físico que se esté utilizando o de la ubicación en una LAN del campus.

La figura muestra un edificio de 3 plantas con un interruptor en cada planta. Los switches están conectados a otro switch que está conectado a un router. Cada planta tiene múltiples hosts conectados a ella. Hay tres VLAN que abarcan las tres plantas y contienen varios hosts en cada planta. Las VLAN son: VLAN 2, IT, 10.0.2.0/24; VLAN 3, HR, 10.0.3.0/24; VLAN 4, Sales, 10.0.4.0/24.
Tercer pisoSegundo pisoPrimer pisoVLAN 2
IT
10.0.2.0/24VLAN 3
HR
10.0.3.0/24VLAN 4
Sales
10.0.4.0/24

Las VLAN permiten que el administrador divida las redes en segmentos según factores como la función, el equipo del proyecto o la aplicación, sin tener en cuenta la ubicación física del usuario o del dispositivo. Cada VLAN se considera una red lógica diferente. Los dispositivos dentro de una VLAN funcionan como si estuvieran en su propia red independiente, aunque compartan una misma infraestructura con otras VLAN. Cualquier puerto de switch puede pertenecer a una VLAN.

Los paquetes de unidifusión, difusión y multidifusión se reenvían solamente a terminales dentro de la VLAN donde los paquetes son de origen. Los paquetes destinados a dispositivos que no pertenecen a la VLAN se deben reenviar a través de un dispositivo que admita el routing.

Varias subredes IP pueden existir en una red conmutada, sin el uso de varias VLAN. Sin embargo, los dispositivos estarán en el mismo dominio de difusión de capa 2. Esto significa que todas las difusiones de capa 2, tales como una solicitud de ARP, serán recibidas por todos los dispositivos de la red conmutada, incluso por aquellos que no se quiere que reciban la difusión.

Una VLAN crea un dominio de difusión lógico que puede abarcar varios segmentos LAN físicos. Las VLAN mejoran el rendimiento de la red mediante la división de grandes dominios de difusión en otros más pequeños. Si un dispositivo en una VLAN envía una trama de Ethernet de difusión, todos los dispositivos en la VLAN reciben la trama, pero los dispositivos en otras VLAN no la reciben.

Mediante las VLAN, los administradores de red pueden implementar políticas de acceso y seguridad de acuerdo con a grupos específicos de usuarios. Cada puerto de switch se puede asignar a una sola VLAN (a excepción de un puerto conectado a un teléfono IP o a otro switch).
3.1.2
Ventajas de un diseño de VLAN

Cada VLAN en una red conmutada corresponde a una red IP. Por lo tanto, el diseño de VLAN debe tener en cuenta la implementación de un esquema de direccionamiento de red jerárquico. El direccionamiento jerárquico de la red significa que los números de red IP se aplican a los segmentos de red o a las VLAN de manera ordenada, lo que permite que la red se tome en cuenta como conjunto. Los bloques de direcciones de red contiguas se reservan para los dispositivos en un área específica de la red y se configuran en estos, como se muestra en la ilustración.

La figura muestra una topología de red con varios conmutadores, varias VLAN y direccionamiento de red contiguo. En la parte superior de la topología hay un router R1 conectado a un switch de abajo. El switch está conectado a otros dos switches. El conmutador de la izquierda tiene tres hosts conectados a él, cada uno asignado a una VLAN diferente. PC1 conectado al puerto F0/11 tiene la siguiente asignación: Facultad, VLAN 10, 172.17.10.21/24. PC2 conectado al puerto F0/18 tiene la siguiente asignación: Estudiante, VLAN 20, 172.17.20.22/24. PC3 conectado al puerto F0/6 tiene la siguiente asignación: Invitado, VLAN 30, 172.17.30.23/24. El conmutador de la derecha también tiene tres hosts conectados a él, cada uno asignado a una VLAN diferente. PC4 conectado al puerto F0/11 tiene la siguiente asignación: Facultad, VLAN 10, 172.17.10.24/24. PC5 conectado al puerto F0/18 tiene la siguiente asignación: Estudiante, VLAN 20, 172.17.20.25/24. PC6 conectado al puerto F0/6 tiene la siguiente asignación: Invitado, VLAN 30, 172.1.7.20.26/24.
R1 PC1 PC2 PC3 PC6 PC5 PC4 F0/18 Fa0/1 F0/3 F0/11 F0/11 F0/18 F0/6 F0/6 G0/0/1 F0/3 F0/5
Fa0/1
Cuerpo docente
VLAN 10
172.17.10.21/24Estudiante
VLAN 20
172.17.20.22/24Invitado
VLAN 30
172.17.30.23/24Invitado
VLAN 30
172.17.30.26/24Estudiante
VLAN 20
172.17.20.25/24Cuerpo docente
VLAN 10
172.17.10.24/24

En la tabla se enumeran las ventajas de diseñar una red con VLAN.
beneficioDescripciónDominios de difusión más pequeñosDividir una red en VLAN reduce el número de dispositivos en el dominio de difusión. En la figura: son seis ordenadores en la red, pero sólo tres dominios de difusión (es decir, Faculty, Student e Invitado) .Mejorada seguridadSólo usuarios en la misma VLAN puede comunicarse juntos.En la figura, el tráfico de la red de profesores en VLAN 10 está completamente separado y protegido de los usuarios en otros VLAN.IT mejorado EfficiencyVLAN simplifican la administración de red porque los usuarios con se pueden configurar en la misma VLAN. Las VLAN se pueden denominar para que sean más fáciles de identificar. En la figura, VLAN 10 fue nombrado «Facultad», VLAN 20 «Estudiante» y VLAN 30 «Invitado». Costes reducidos Las VLAN reducen la necesidad de costosas actualizaciones de red y utilizar el ancho de banda existente y los enlaces ascendentes más eficientemente, lo que resulta en ahorros de costos.Mejores rendimientosBroadcast Maller reducen el tráfico innecesario en la red y mejoran rendimiento.Administración de aplicaciones y proyectos más sencillasUsuarios agregados de VLAN y dispositivos de red para apoyar los requisitos empresariales o geográficos. Tener funciones separadas hace que la gestión de un proyecto o el trabajo con un aplicación más fácil; un ejemplo de tal aplicación es un e-learning plataforma de desarrollo para profesores.
Ventaja 	Descripción
Dominios de difusión más pequeños	

    Dividir una red en VLAN reduce el número de dispositivos en el broadcast domain.
    En la figura, hay seis computadoras en la red, pero solo tres dominios de difusión (es decir, Facultad, Estudiante e Invitado).

Seguridad mejorada	

    Sólo los usuarios de la misma VLAN pueden comunicarse juntos.
    En la figura, el tráfico de red de profesores en la VLAN 10 es completamente separados y protegidos de los usuarios en otras VLAN.

Mejora la eficiencia del departamento de IT.	

    Las VLAN simplifican la administración de la red porque los usuarios con una red similar se pueden configurar en la misma VLAN.
    Las VLAN se pueden nombrar para facilitar su identificación.
    En la figura, VLAN 10 fue nombrado «Facultad», VLAN 20 «Estudiante», y VLAN 30 «Invitado. »

Reducción de costos	Las VLAN reducen la necesidad de realizar costosas actualizaciones de red y utilizan el ancho de banda existente y enlaces ascendentes de manera más eficiente, lo que resulta en costos Ahorro
Mejor rendimiento	Los dominios de difusión más pequeños reducen el tráfico innecesario en la red y mejorar el rendimiento.
Administración más simple de proyectos y aplicaciones	

    Las VLAN agregan usuarios y dispositivos de red para admitir empresas o necesidades geográficas.
    Tener funciones separadas hace que administrar un proyecto o trabajar con un aplicación especializada más fácil; un ejemplo de tal aplicación es una plataforma de desarrollo de e-learning para profesores.

3.1.3
Tipos de VLAN

Las VLAN se utilizan por diferentes razones en las redes modernas. Algunos tipos de VLAN se definen según las clases de tráfico. Otros tipos de VLAN se definen según la función específica que cumplen.

VLAN predeterminada

La VLAN predeterminada para los switches Cisco es la VLAN 1. Por lo tanto, todos los puertos del switch están en VLAN 1 a menos que esté configurado explícitamente para estar en otra VLAN. Todo el tráfico de control de capa 2 se asocia a la VLAN 1 de manera predeterminada.

Entre los datos importantes que hay que recordar acerca de la VLAN 1 se incluyen los siguientes:

    Todos los puertos se asignan a la VLAN 1 de manera predeterminada.
    De manera predeterminada, la VLAN nativa es la VLAN 1.
    De manera predeterminada, la VLAN de administración es la VLAN 1.
    No es posible eliminar ni cambiar el nombre de VLAN 1.

Por ejemplo, en la show vlan brief ilustración, todos los puertos están asignados a la VLAN 1 predeterminada. No hay ninguna VLAN nativa asignada explícitamente ni otras VLAN activas; por lo tanto, la VLAN nativa de la red que se diseñó es la VLAN de administración. Esto se considera un riesgo de seguridad.

Switch# show vlan brief 
VLAN Name Status Ports
— — — —
1 default active Fa0/1, Fa0/2, Fa0/3, Fa0/4
                                Fa0/5, Fa0/6, Fa0/7, Fa0/8
                                Fa0/9, Fa0/10, Fa0/11, Fa0/12
                                Fa0/13, Fa0/14, Fa0/15, Fa0/16
                                Fa0/17, Fa0/18, Fa0/19, Fa0/20
                                Fa0/21, Fa0/22, Fa0/23, Fa0/24
                                Gi0/1, Gi0/2
1002 fddi-default act/unsup
1003 token-ring-default act/unsup
1004 fddinet-default act/unsup
1005 trnet-default act/unsup

VLAN de datos

Las VLAN de datos son VLAN configuradas para separar el tráfico generado por el usuario. Las VLAN de datos se usan para dividir la red en grupos de usuarios o dispositivos. Una red moderna tendría muchas VLAN de datos en función de los requisitos organizativos. Tenga en cuenta que no se debe permitir el tráfico de administración de voz y red en las VLAN de datos.

VLAN nativa

El tráfico de usuario de una VLAN debe etiquetarse con su ID de VLAN cuando se envía a otro switch. Los puertos troncal se utilizan entre conmutadores para admitir la transmisión de tráfico etiquetado. Específicamente, un puerto troncal 802.1Q inserta una etiqueta de 4 bytes en el encabezado de trama Ethernet para identificar la VLAN a la que pertenece la trama.

Es posible que un switch también tenga que enviar tráfico sin etiqueta a través de un enlace troncal. El tráfico sin etiquetas es generado por un switch y también puede provenir de dispositivos heredados. El puerto de enlace troncal 802.1Q coloca el tráfico sin etiquetar en la VLAN nativa. La VLAN nativa en un switch Cisco es VLAN 1 (es decir, VLAN predeterminada).

Se recomienda configurar la VLAN nativa como VLAN sin utilizar, independiente de la VLAN 1 y de otras VLAN. De hecho, es común utilizar una VLAN fija para que funcione como VLAN nativa para todos los puertos de enlace troncal en el dominio conmutado.

VLAN de administración

Una VLAN de administración es una VLAN de datos configurada específicamente para el tráfico de administración de red, incluyendo SSH, Telnet, HTTPS, HHTP y SNMP. De forma predeterminada, la VLAN 1 se configura como la VLAN de administración en un conmutador de capa 2.

VLAN de voz

Se necesita una VLAN separada para admitir la tecnología de voz sobre IP (VoIP). Para el tráfico de VoIP, se necesita lo siguiente:

    Ancho de banda garantizado para asegurar la calidad de la voz
    Prioridad de la transmisión sobre los tipos de tráfico de la red
    Capacidad para ser enrutado en áreas congestionadas de la red
    Una demora inferior a 150 ms a través de la red

Para cumplir estos requerimientos, se debe diseñar la red completa para que admita VoIP.

En la figura, la VLAN 150 se diseña para enviar tráfico de voz. La computadora del estudiante PC5 está conectada al teléfono IP de Cisco y el teléfono está conectado al switch S3. La PC5 está en la VLAN 20 que se utiliza para los datos de los estudiantes.

La figura muestra un host conectado a un teléfono IP que muestra la configuración de una VLAN de voz y datos. En la parte superior del diagrama se encuentra el router R1 conectado a través de la interfaz G0/0/1 al conmutador S1 en el puerto F0/5. S1 está configurado para admitir el tráfico de voz de la siguiente manera: utiliza VLAN 150 para VLAN de voz y prioriza el tráfico de voz. S1 está conectado a través del puerto F0/3 para conmutar S3 en el puerto F0/3. S3 se conecta a través del puerto F0/18 a un teléfono IP que luego se conecta al host PC5. PC5 tiene la siguiente tarea: Estudiante, VLAN 20, 172.17.20.25. El puerto F0/18 en S3 está configurado para soportar el tráfico de voz: el puerto envía tramas CDP para proporcionar información utilizada por el teléfono IP y el puerto reenvía tramas asociadas con VLAN 150.
G0/0/1 F0/5 F0/3 F0/3 F0/18 R1 PC5 S1
S3
Alumno
VLAN 20: 172.17.20.25Puerto de switch configurado para admitir tráfico de voz:

    El puerto envía tramas CDP para proporcionar la información que utiliza el teléfono IP.
    El puerto reenvía las tramas asociadas a la VLAN 150.

Switch configurado para admitir tráfico de voz:

    Utiliza la VLAN 150 para VLAN de voz.
    Prioriza el tráfico de voz.

3.1.5
Compruebe su comprensión - Descripción general de las VLAN

Elija la MEJOR repuesta para las siguientes preguntas y compruebe su conocimiento sobre VLANs.

    ¿Verdadero o falso? Las VLAN mejoran el rendimiento de la red mediante la división de grandes dominios de difusión en otros más pequeños.

¿Verdadero o falso? Las VLAN pueden mejorar la seguridad al aislar los datos confidenciales del resto de la red.

¿Qué tipo de VLAN se asigna a los puertos troncal 802.1Q para transportar tráfico sin etiqueta?

¿Verdadero o falso? Se recomienda configurar la VLAN nativa como VLAN 1.

¿Cuál es el caso de la VLAN 1? (Elija todas las opciones que correspondan).

Redes VLAN en un entorno conmutado múltiple
3.2.1
Definición de troncos de VLAN

Las VLAN no serían muy útiles sin los enlaces troncales de VLAN. Los troncos de VLAN permiten que todo el tráfico de VLAN se propague entre conmutadores. Esto permite que los dispositivos conectados a diferentes switches pero en la misma VLAN se comuniquen sin pasar por un router.

Un enlace troncal es un enlace punto a punto entre dos dispositivos de red que lleva más de una VLAN. Un enlace troncal de VLAN amplía las VLAN a través de toda la red. Cisco admite IEEE 802.1Q para coordinar enlaces troncales en las interfaces Fast Ethernet, Gigabit Ethernet y 10-Gigabit Ethernet.

Un enlace troncal no pertenece a una VLAN específica. Es más bien un conducto para las VLAN entre los switches y los routers. También se puede utilizar un enlace troncal entre un dispositivo de red y un servidor u otro dispositivo que cuente con una NIC con capacidad 802.1Q. En los switches Cisco Catalyst, se admiten todas las VLAN en un puerto de enlace troncal de manera predeterminada.

En la ilustración, los enlaces entre los switches S1 y S2, y S1 y S3 se configuraron para transmitir el tráfico proveniente de las VLAN 10, 20, 30 y 99 a través de la red. Esta red no podría funcionar sin los enlaces troncales de VLAN.

La figura es una topología de red con varios conmutadores y varias VLAN que resaltan los vínculos troncal de VLAN entre los conmutadores. En la parte superior de la topología está el interruptor S1. S1 está conectado a través del puerto F0/1 al conmutador S2 en el puerto F0/1. Esta conexión se resalta. S1 también está conectado a través del puerto F0/3 para conmutar S3 en el puerto F0/3. Esta conexión también se resalta. Tanto S2 como S3 tienen tres hosts conectados a ellos, cada uno asignado a una VLAN diferente. Están conectados a S2 PC1, PC2 y PC3. PC1 está conectado al puerto F0/11 tiene la siguiente asignación: Facultad, VLAN 10, 172.17.10.21. PC2 está conectado al puerto F0/18 tiene la siguiente asignación: Estudiante, VLAN 20, 172.17.20.22. PC3 está conectado al puerto F0/6 tiene la siguiente asignación: Invitado, VLAN 30, 172.17.30.23. Están conectados a S3 PC4, PC5 y PC6. PC4 está conectado al puerto F0/11 tiene la siguiente asignación: Facultad, VLAN 10, 172.17.10.24. PC5 está conectado al puerto F0/18 tiene la siguiente asignación: Estudiante, VLAN 20, 172.17.20.25. PC6 está conectado al puerto F0/6 tiene la siguiente asignación: Invitado, VLAN 30, 172.1.7.20.26.
PC2 PC3 PC6 PC5 PC4 S2 S3 S1 PC1 F0/18 F0/1 F0/3 F0/11 F0/11 F0/18 F0/6 F0/6 F0/1
F0/3
Invitado
VLAN 30 -
172.17.30.26Invitado
VLAN 30 -
172.17.30.23Cuerpo docente
VLAN 10 -
172.17.10.21Cuerpo docente
VLAN 10:
172.17.10.24Estudiante
VLAN 20 -
172.17.20.22Estudiante
VLAN 20 -
172.17.20.25
3.2.2
Redes sin VLAN

En condiciones normales de funcionamiento, cuando un switch recibe una trama de difusión en uno de sus puertos, reenvía la trama por todos los demás puertos, excepto el puerto por donde recibió la difusión. En la animación de la figura se configuró toda la red en la misma subred (172.17.40.0/24), y no se configuró ninguna VLAN. Como consecuencia, cuando la computadora del cuerpo docente (PC1) envía una trama de difusión, el switch S2 envía dicha trama de difusión por todos sus puertos. Finalmente, toda la red recibe la difusión porque la red es un dominio de difusión.
Difusión
Difusión
Difusión
La PC1 envía una difusión de capa 2 local. Los switches reenvían la trama del broadcast a todos los puertos disponibles.
Cuerpo docente
172.17.40.21/24
Estudiante
172.17.40.22/24
Invitado
172.17.40.23/24
Cuerpo docente
172.17.40.24/24
Estudiante
172.17.40.25/24
Invitado
172.17.40.26/24
3.2.3
Red con VLAN

Haga clic en Reproducir en la animación para ver que la misma red se ha segmentado utilizando dos VLAN. Los dispositivos del cuerpo docente se asignaron a la VLAN 10, y los dispositivos de los estudiantes se asignaron a la VLAN 20. Cuando se envía una trama de difusión desde la computadora del cuerpo docente, la PC1, al switch S2, el switch reenvía esa trama de difusión solo a los puertos de switch configurados para admitir la VLAN 10.
La PC1 envía una difusión de capa 2 local. Los switches reenvían la trama de la difusión solamente a los puertos configurados para VLAN 10.
Enlaces troncales de VLAN configurados para admitir las VLAN 10 y 20.
Cuerpo docente
VLAN 10
172.17.10.21/24
Estudiante
VLAN 20
172.17.20.22/24
Cuerpo docente
VLAN 10
172.17.10.24/24
Estudiante
VLAN 20
172.17.20.25/24

Los puertos que componen la conexión entre los switches S2 y S1 (puertos F0/1), y entre el S1 y el S3 (puertos F0/3) son enlaces troncales y se configuraron para admitir todas las VLAN en la red.

Cuando el S1 recibe la trama de difusión en el puerto F0/1, reenvía la trama de difusión por el único puerto configurado para admitir la VLAN 10, que es el puerto F0/3. Cuando el S3 recibe la trama de difusión en el puerto F0/3, reenvía la trama de difusión por el único puerto configurado para admitir la VLAN 10, que es el puerto F0/11. La trama de difusión llega a la única otra computadora de la red configurada en la VLAN 10, que es la computadora PC4 del cuerpo docente.

Cuando se implementan las VLAN en un switch, la transmisión del tráfico de unidifusión, multidifusión y difusión desde un host en una VLAN en particular se limita a los dispositivos presentes en esa VLAN.
3.2.4
Identificación de VLAN con etiqueta

El encabezado de trama Ethernet estándar no contiene información sobre la VLAN a la que pertenece la trama. Por lo tanto, cuando las tramas de Ethernet se ubican en un enlace troncal, se necesita agregar información sobre las VLAN a las que pertenecen. Este proceso, denominado “etiquetado”, se logra mediante el uso del encabezado IEEE 802.1Q, especificado en el estándar IEEE 802.1Q. El encabezado 802.1Q incluye una etiqueta de 4 bytes insertada en el encabezado de la trama de Ethernet original que especifica la VLAN a la que pertenece la trama.

Cuando el switch recibe una trama en un puerto configurado en modo de acceso y asignado a una VLAN, el switch coloca una etiqueta VLAN en el encabezado de la trama, vuelve a calcular la Secuencia de Verificación de Tramas (FCS) y envía la trama etiquetada por un puerto de enlace troncal.

Detalles del campo VLAN Tag

Como se muestra en la figura el campo de etiqueta de la VLAN consta de un campo de tipo, un campo de prioridad, un campo de identificador de formato canónico y un campo de ID de la VLAN:

    Tipo - Un valor de 2 bytes denominado “ID de Protocolo de Etiqueta” (TPID). Para Ethernet, este valor se establece en 0x8100 hexadecimal.
    Prioridad de usuario - Es un valor de 3 bits que admite la implementación de nivel o de servicio.
    Identificador de Formato Canónico (CFI) - Es un identificador de 1 bit que habilita las tramas Token Ring que se van a transportar a través de los enlaces Ethernet.
    VLAN ID (VID) - Es un número de identificación de VLAN de 12 bits que admite hasta 4096 ID de VLAN.

Una vez que el switch introduce los campos tipo y de información de control de etiquetas, vuelve a calcular los valores de la FCS e inserta la nueva FCS en la trama.

La figura muestra una etiqueta de VLAN que se inserta en un encabezado de trama. En la parte superior de la figura hay un marco que muestra los siguientes campos: Dst MAC, SRC MAC, Tipo/Longitud, Datos y FCS. Debajo está el marco que se muestra de nuevo, esta vez con el campo Etiqueta insertado entre los campos MAC de Src y Tipo/Longitud. Debajo están los siguientes subcampos de la etiqueta y su longitud: Tipo (0x8100), longitud 2 Bytes; Pri, longitud 3 bits; CFI, longitud 1 bit; y VID, longitud 12 bits.
MAC de destinoMAC de origenEtiquetaTipo/LongitudDatosFCSTipo (0 x 8100)MAC de destinoMAC de origenTipo/LongitudDatosFCS2 bytes3 bits1 bit12 bitsVIDPriCFI
3.2.5
VLAN nativas y etiquetado de 802.1Q

El estándar IEEE 802.1Q especifica una VLAN nativa para los enlaces troncal, que por defecto es VLAN 1. Cuando un marco sin etiqueta llega a un puerto troncal, se asigna a la VLAN nativa. Las tramas de administración que se envían entre conmutadores es un ejemplo de tráfico que normalmente no se etiqueta. Si el vínculo entre dos switches es un tronco, el switch envía el tráfico sin etiqueta en la VLAN nativa.

Marcos etiquetados en la VLAN nativa

Algunos dispositivos que admiten los enlaces troncales agregan una etiqueta VLAN al tráfico de las VLAN nativas. El tráfico de control que se envía por la VLAN nativa no se debe etiquetar. Si un puerto de enlace troncal 802.1Q recibe una trama etiquetada con la misma ID de VLAN que la VLAN nativa, descarta la trama. Por consiguiente, al configurar un puerto de un switch Cisco, configure los dispositivos de modo que no envíen tramas etiquetadas por la VLAN nativa. Los dispositivos de otros proveedores que admiten tramas etiquetadas en la VLAN nativa incluyen: teléfonos IP, servidores, routers y switches que no pertenecen a Cisco.

Marcos sin etiquetas en la VLAN nativa

Cuando un puerto de enlace troncal de un switch Cisco recibe tramas sin etiquetar (poco usuales en las redes bien diseñadas), envía esas tramas a la VLAN nativa. Si no hay dispositivos asociados a la VLAN nativa (lo que es usual) y no existen otros puertos de enlace troncal (es usual), se descarta la trama. La VLAN nativa predeterminada es la VLAN 1. Al configurar un puerto de enlace troncal 802.1Q, se asigna el valor de la ID de VLAN nativa a la ID de VLAN de puerto (PVID) predeterminada. Todo el tráfico sin etiquetar entrante o saliente del puerto 802.1Q se reenvía según el valor de la PVID. Por ejemplo, si se configura la VLAN 99 como VLAN nativa, la PVID es 99, y todo el tráfico sin etiquetar se reenvía a la VLAN 99. Si no se volvió a configurar la VLAN nativa, el valor de la PVID se establece en VLAN 1.

En la ilustración, la PC1 está conectada a un enlace troncal 802.1Q mediante un hub.

La figura es una topología de red que muestra el flujo de tráfico sin etiqueta en la VLAN nativa. En la parte superior de la figura hay un interruptor. El conmutador está conectado a otros cuatro conmutadores a través de un enlace troncal 802.1Q a cada uno. Entre el conmutador superior y el conmutador en el extremo izquierdo hay un concentrador al que está conectado el PC1 host. El conmutador extremo izquierdo tiene un puerto en VLAN 1 y un puerto en VLAN 2. El segundo conmutador de la izquierda tiene un puerto en VLAN 3. El tercer conmutador de la izquierda tiene un puerto en la VLAN 1. El switch de la derecha tiene un puerto en VLAN 2 y un puerto en VLAN 3. Las flechas anaranjadas muestran el tráfico enviado desde los flujos PC1 al concentrador que lo envía a ambos conmutadores conectados. El conmutador extremo izquierdo lo envía por el puerto de la VLAN 1. El conmutador superior lo envía al tercer conmutador desde la izquierda, que lo envía por el puerto conectado a la VLAN 1.
PC1
VLAN 1VLAN 2VLAN 3VLAN 1VLAN 2VLAN 3Enlace troncal de 802.1QEnlace troncal de 802.1QEnlace troncal de 802.1QEnlace troncal de 802.1Q

La PC1 envía el tráfico sin etiquetar, que los switches asocian a la VLAN nativa configurada en los puertos de enlace troncal y que reenvían según corresponda. El tráfico etiquetado del enlace troncal que recibe la PC1 se descarta. Esta situación refleja un diseño de red deficiente por varios motivos: utiliza un hub, tiene un host conectado a un enlace troncal y esto implica que los switches tengan puertos de acceso asignados a la VLAN nativa. También ilustra la motivación de la especificación IEEE 802.1Q para que las VLAN nativas sean un medio de manejo de entornos antiguos.
3.2.6
Etiquetado de VLAN de voz

Se necesita una red VLAN de voz separada para admitir VoIP. Esto permite aplicar políticas de calidad de servicio (QoS) y seguridad al tráfico de voz.

Un teléfono IP de Cisco se conecta directamente a un puerto del switch. Un host IP puede conectarse al teléfono IP para obtener conectividad de red también. Un puerto de acceso que conecta un teléfono IP de Cisco puede configurarse para utilizar dos VLAN separadas: Una VLAN es para el tráfico de voz y la otra es una VLAN de datos para admitir el tráfico de host. El enlace entre el switch y el teléfono IP funciona como un enlace troncal para transportar tanto el tráfico de la VLAN de voz como el tráfico de la VLAN de datos.

Específicamente, el teléfono IP Cisco contiene un switch 10/100 de tres puertos integrado. Los puertos proporcionan conexiones dedicadas para estos dispositivos:

    El puerto 1 se conecta al switch o a otro dispositivo VoIP.
    El puerto 2 es una interfaz interna 10/100 que envía el tráfico del teléfono IP.
    El puerto 3 (puerto de acceso) se conecta a una PC u otro dispositivo.

El puerto de acceso del switch envía paquetes CDP que indican al teléfono IP conectado que envíe tráfico de voz de una de las tres maneras. El método utilizado varía según el tipo de tráfico:

    El tráfico VLAN de voz debe etiquetarse con un valor de prioridad CoS de Capa 2 adecuado.
    En una VLAN de acceso con una etiqueta de valor de prioridad de CoS de capa 2
    En una VLAN de acceso sin etiqueta (sin valor de prioridad de CoS de capa 2)

En la figura, la computadora del estudiante PC5 está conectada a un teléfono IP de Cisco, y el teléfono está conectado al switch S3. La VLAN 150 está diseñada para transportar tráfico de voz, mientras que la PC5 está en la VLAN 20, que se usa para los datos de los estudiantes.

host conectado a un teléfono IP conectado a un switch que muestra la configuración de una VLAN de voz y datos
F0/18 P1 P2 P3 S3
PC5
Puerto de switch configurado para admitir tráfico de voz:

    Indica al teléfono que etiquete las tramas de voz con la VLAN 150.
    Prioriza las tramas de voz.
    Reenvía la trama de datos para VLAN 20.

Configurado para etiquetar las tramas de tráfico de voz con VLAN 150.Teléfono IP de CiscoTeléfono
ASICPuerto de accesoSwitch de 3 puertos
3.2.7
Ejemplo de verificación de VLAN de voz

Se muestra la salida de ejemplo para el show interface fa0/18 switchport comando. El análisis de los comandos de voz de Cisco IOS excede el ámbito de este curso, pero las áreas resaltadas en el resultado de ejemplo muestran que la interfaz F0/18 se configuró con una VLAN configurada para datos (VLAN 20) y una VLAN configurada para voz (VLAN 150).

S1# show interfaces fa0/18 switchport  
Name: Fa0/18
Switchport: Enabled
Administrative Mode: static access
Operational Mode: static access
Administrative Trunking Encapsulation: negotiate
Operational Trunking Encapsulation: native
Negotiation of Trunking: Off
Access Mode VLAN: 20 (student) 
Trunking Native Mode VLAN: 1 (default)
Administrative Native VLAN tagging: enabled
Voice VLAN: 150 (voice) 

3.2.8
Packet Tracer: investigación de la implementación de una VLAN

En esta actividad, observará el modo en que los switches reenvían el tráfico de difusión cuando se configuran las VLAN y cuando no se configuran las VLAN.
Investigar la implementación de una VLAN
3.2.9
Compruebe su comprensión - VLAN en un entorno de multiswitch

Esta actividad Comprobar comprensión utiliza un escenario diferente para cada pregunta.

Haga clic en cada botón para el escenario de VLAN que corresponda a la pregunta.

Pregunta 1 Topología

La topología de red para la pregunta 1 tiene un conmutador en el centro conectado a un conmutador a la izquierda y otro a la derecha. Están conectados al conmutador izquierdo los tres hosts siguientes: PC1 en VLAN 10, PC2 en VLAN 20 y PC3 en VLAN 30. Están conectados al conmutador derecho los tres hosts siguientes: PC4 en VLAN 10, PC5 en VLAN 20 y PC6 en VLAN30.
PC1 PC2 PC3 PC4 PC5
PC6
VLAN 10VLAN 20VLAN 30VLAN 10VLAN 20VLAN 30

    Consulte la ilustración Pregunta 1 Topología. La PC1 envía una trama de difusión ARP. ¿Qué PC recibirá el marco de difusión ARP?

Consulte la ilustración Pregunta 2 Topología. La PC2 envía una trama de difusión ARP. ¿Qué PC recibirá el marco de difusión ARP? (Elija todas las opciones que correspondan).

Consulte la ilustración Pregunta 3 Topología. La PC3 envía una trama de difusión ARP. ¿Qué PC recibirá el marco de difusión ARP?

Pregunta 2 Topología

La topología de red para la pregunta 2 tiene un conmutador en el centro conectado a un conmutador a la izquierda y otro a la derecha. Están conectados al conmutador izquierdo los tres hosts siguientes: PC1 en VLAN 10, PC2 en VLAN 30 y PC3 en VLAN 30. Están conectados al conmutador derecho los tres hosts siguientes: PC4 en VLAN 30, PC5 en VLAN 20 y PC6 en VLAN30.
PC1 PC2 PC3 PC4 PC5
PC6
VLAN 10VLAN 30VLAN 30VLAN 30VLAN 20VLAN 30

    Consulte la ilustración Pregunta 1 Topología. La PC1 envía una trama de difusión ARP. ¿Qué PC recibirá el marco de difusión ARP?
    ¡Lo tienes!

Consulte la ilustración Pregunta 2 Topología. La PC2 envía una trama de difusión ARP. ¿Qué PC recibirá el marco de difusión ARP? (Elija todas las opciones que correspondan).
¡Lo tienes!

Consulte la ilustración Pregunta 3 Topología. La PC3 envía una trama de difusión ARP. ¿Qué PC recibirá el marco de difusión ARP?

Pregunta 3 Topología

La topología de red para la pregunta 3 tiene un conmutador en el centro conectado a un conmutador a la izquierda y otro a la derecha. Están conectados al conmutador izquierdo los tres hosts siguientes: PC1 en VLAN 30, PC2 en VLAN 20 y PC3 en VLAN 10. Están conectados al conmutador derecho los tres hosts siguientes: PC4 en VLAN 30, PC5 en VLAN 10 y PC6 en VLAN30.
PC1 PC2 PC3 PC4 PC5
PC6
VLAN 30VLAN 20VLAN 10VLAN 30VLAN 10VLAN 30

    Consulte la ilustración Pregunta 1 Topología. La PC1 envía una trama de difusión ARP. ¿Qué PC recibirá el marco de difusión ARP?
    ¡Lo tienes!

Consulte la ilustración Pregunta 2 Topología. La PC2 envía una trama de difusión ARP. ¿Qué PC recibirá el marco de difusión ARP? (Elija todas las opciones que correspondan).
¡Lo tienes!

Consulte la ilustración Pregunta 3 Topología. La PC3 envía una trama de difusión ARP. ¿Qué PC recibirá el marco de difusión ARP?

Configuración de VLAN
3.3.1
Rangos de VLAN en los switches Catalyst

Crear VLAN, como la mayoría de los demás aspectos de la red, es cuestión de introducir los comandos apropiados. En este tema se detalla cómo configurar y verificar diferentes tipos de VLAN.

Los distintos switches Cisco Catalyst admiten diversas cantidades de VLAN. La cantidad de VLAN que admiten es suficiente para satisfacer las necesidades de la mayoría de las organizaciones. Por ejemplo, los switches de las series Catalyst 2960 y 3560 admiten más de 4000 VLAN. Las VLAN de rango normal en estos switches se numeran del 1 al 1005, y las VLAN de rango extendido se numeran del 1006 al 4094. En la ilustración, se muestran las VLAN disponibles en un switch Catalyst 2960 que ejecuta IOS de Cisco, versión 15.x.

Switch# show vlan brief

VLAN Name              Status   Ports
---- ----------------- -------  --------------------
1    default           active   Fa0/1, Fa0/2, Fa0/3, Fa0/4
                                Fa0/5, Fa0/6, Fa0/7, Fa0/8
                                Fa0/9, Fa0/10, Fa0/11, Fa0/12
                                Fa0/13, Fa0/14, Fa0/15, Fa0/16
                                Fa0/17, Fa0/18, Fa0/19, Fa0/20
                                Fa0/21, Fa0/22, Fa0/23, Fa0/24
                                Gi0/1, Gi0/2
1002 fddi-default                     act/unsup
1003 token-ring-default               act/unsup
1004 fddinet-default                  act/unsup
1005 trnet-default                    act/unsup

Rango Normal VLANs

Las siguientes son las características de las VLAN de rango normal:

    Se utiliza en redes de pequeños y medianos negocios y empresas.
    Se identifica mediante una ID de VLAN entre 1 y 1005.
    Las ID de 1002 a 1005 se reservan para las VLAN de Token Ring e interfaz de datos distribuidos por fibra óptica (FDDI).
    Las ID 1 y 1002 a 1005 se crean automáticamente y no se pueden eliminar.
    Las configuraciones se almacenan en un archivo de base de datos de VLAN llamado vlan.dat, que se guarda en la memoria flash.
    Cuando se configura, el protocolo de enlace troncal VLAN (VTP) ayuda a sincronizar la base de datos VLAN entre conmutadores.

Rango Extendido VLANs

Las siguientes son las características de las VLAN de rango extendido:

Los proveedores de servicios los* utilizan para dar servicio a varios clientes y por las empresas globales lo suficientemente grandes como para necesitar identificadores de VLAN de rango extendido.

    Se identifican mediante una ID de VLAN entre 1006 y 4094.
    Las configuraciones se guardan en el archivo de configuración en ejecución.
    Admiten menos características de VLAN que las VLAN de rango normal.
    Requiere la configuración del modo transparente VTP para admitir VLAN de rango extendido.

Nota: Nota: la cantidad máxima de VLAN disponibles en los switches Catalyst es 4096, ya que el campo ID de VLAN tiene 12 bits en el encabezado IEEE 802.1Q.
3.3.2
Comandos de creación de VLAN

Al configurar redes VLAN de rango normal, los detalles de configuración se almacenan en la memoria flash del switch en un archivo denominado vlan.dat. La memoria flash es persistente y no requiere el copy running-config startup-config comando. Sin embargo, debido a que en los switches Cisco se suelen configurar otros detalles al mismo tiempo que se crean las VLAN, es aconsejable guardar los cambios a la configuración en ejecución en la configuración de inicio.

En la figura 1, se muestra la sintaxis del comando de IOS de Cisco que se utiliza para agregar una VLAN a un switch y asignarle un nombre. Se recomienda asignarle un nombre a cada VLAN en la configuración de un switch.
Comando TaskiOSIntroduzca el modo de configuración# global.Configuración del conmutador terminal Cree una VLAN con un número de ID válido.Switch(config)# vlan vlan-id Especificar un nombre único para identificar el nombre de la VLAN.Switch(config-vlan)# VLAN-name Vuelva al modo EXEC privilegiado. Switch(config-vlan)# final
Tarea 	Comando de IOS
Ingresa al modo de configuración global.	

Switch# configure terminal

Cree una VLAN con un número de ID válido.	

Switch(config)# vlan vlan-id

Especificar un nombre único para identificar la VLAN.	

Switch(config-vlan)# name vlan-name

Vuelva al modo EXEC privilegiado.	

Switch(config-vlan)# end

3.3.3
Ejemplo de creación de VLAN

En el ejemplo de topología, la computadora del estudiante (PC2) todavía no se asoció a ninguna VLAN, pero tiene la dirección IP 172.17.20.22, que pertenece a la VLAN 20.

PC de estudiante, host PC2, en la dirección 172.17.20.22 está conectado al conmutador S1 en el puerto F0/6 que está conectado a través del puerto F0/1 al conmutador S2 en el puerto F0/1
S2 S1 PC2 F0/06 F0/1 F0/1
172.17.20.22
PC Alumno

En la figura, se muestra cómo se configura la VLAN para estudiantes (VLAN 20) en el switch S1.

S1# configure terminal
S1(config)# vlan 20
S1(config-vlan)# name student
S1(config-vlan)# end

Nota: Además de introducir una única ID de VLAN, se puede introducir una serie de ID de VLAN separadas por comas o un rango de ID de VLAN separado por guiones usando el vlan comando vlan-id . Por ejemplo, al introducir el comando de configuración vlan 100,102,105-107 global se crearían las VLAN 100, 102, 105, 106 y 107.
3.3.4
Comandos de asignación de puertos VLAN

Después de crear una VLAN, el siguiente paso es asignar puertos a la VLAN.

En la figura se muestra la sintaxis para definir un puerto como puerto de acceso y asignarlo a una VLAN. EL switchport mode access comando es optativo, pero se aconseja como práctica recomendada de seguridad. Con este comando, la interfaz cambia al modo de acceso permanente.
Comando TaskiOSIntroduzca el modo de configuración# global.Configuración del conmutador terminalEnter interface configuration mode.Switch(config)# interface Interface-IDEstablezca el puerto para el modo de acceso. modoSwitch(config-if)# de puerto de conmutación AccesoAsignar el puerto a una VLAN. vlanSwitch(config-if)# de acceso al puerto de conmutación VLAN-IDRetorno al modo EXEC privilegiado. Switch(config-if)# final
Tarea 	Comando de IOS
Ingrese al modo de configuración global.	

Switch# configure terminal

Ingrese el modo de configuración de interfaz.	

Switch(config)# interface interface-id

Establezca el puerto en modo de acceso.	

Switch(config-if)# switchport mode access

Asigne el puerto a una VLAN.	

Switch(config-if)# switchport access vlan vlan-id

Vuelva al modo EXEC privilegiado.	

Switch(config-if)# end

Nota: Use el interface range comando para configurar simultáneamente varias interfaces
3.3.5

Ejemplo de asignación de puerto## VLAN

En la figura, el puerto F0/6 en el conmutador S1 se configura como un puerto de acceso y se asigna a la VLAN 20. Cualquier dispositivo conectado a ese puerto está asociado con la VLAN 20. Por lo tanto, en nuestro ejemplo, PC2 está en la VLAN 20.

La topología muestra un PC estudiante, host PC2, en la dirección 172.17.20.22 conectado al conmutador S1 en el puerto F0/6 que está conectado a través del puerto F0/1 para el conmutador S2 en el puerto F0/1. Debajo de S1 lee el conmutador 1: puerto F0/6 y VLAN 20.
S2 S1 PC2 172.17.20.22 F0/06 F0/1
F0/1
Switch S1:
Puerto F0/18
VLAN 20PC Alumno

El ejemplo muestra la configuración de S1 para asignar F0/6 a VLAN 20.

S1# configure terminal
S1(config)# interface fa0/6
S1(config-if)# switchport mode access
S1(config-if)# switchport access vlan 20
S1(config-if)# end

Las VLAN se configuran en el puerto del switch y no en el terminal. La PC2 se configura con una dirección IPv4 y una máscara de subred asociadas a la VLAN, que se configura en el puerto de switch. En este ejemplo, es la VLAN 20. Cuando se configura la VLAN 20 en otros switches, el administrador de red debe configurar las otras computadoras de alumnos para que estén en la misma subred que la PC2 (172.17.20.0/24).
3.3.6
VLAN de voz, datos

Un puerto de acceso puede pertenecer a sólo una VLAN a la vez. Sin embargo, un puerto también se puede asociar a una VLAN de voz. Por ejemplo, un puerto conectado a un teléfono IP y un dispositivo final se asociaría con dos VLAN: una para voz y otra para datos.

Consulte la topología en la figura. En este ejemplo, la PC5 está conectada con el teléfono IP de Cisco, que a su vez está conectado a la interfaz FastEthernet 0/18 en S3. Para implementar esta configuración, se crean una VLAN de datos y una VLAN de voz.

El PC5 del host se encuentra en la VLAN 20 del estudiante en la dirección 172.17.20.25. PC5 está conectado a un teléfono IP que está conectado al switch S3 en el puerto F0/18. Un cuadro de texto con una flecha que apunta a este puerto dice: El puerto de conmutación debe admitir el tráfico de VLAN para el tráfico de voz al teléfono IP y el tráfico de datos a PC5. S3 está conectado a través del puerto F0/3 al conmutador S1 en el puerto F0/3.
F0/3 F0/3 F0/18 S1 S3
PC5
El puerto de switch debe admitir el tráfico de VLAN para:

    Tráfico de voz al teléfono IP
    Tráfico de datos a PC5

Alumno
VLAN 20: 172.17.20.25
3.3.7
Ejemplo de VLAN de voz y datos

Utilice el comando switchport voice vlan vlan-id interface configuration para asignar una VLAN de voz a un puerto.

Las redes LAN que admiten tráfico de voz por lo general también tienen la Calidad de Servicio (QoS) habilitada. El tráfico de voz debe etiquetarse como confiable apenas ingrese en la red. Use el mls qos trust [cos | device cisco-phone | dscp | ip-precedence] comando de configuración para establecer el estado confiable de una interfaz, y para indicar qué campos del paquete se usan para clasificar el tráfico.

La configuración en el ejemplo crea las dos VLAN (es decir, VLAN 20 y VLAN 150), y a continuación, asigna la interfaz F0/18 de S3 como un puerto de switch en VLAN 20. También asigna el tráfico de voz en VLAN 150 y permite la clasificación de QoS basada en la Clase de Servicio (CoS) asignado por el teléfono IP.

S3(config)# vlan 20
S3(config-vlan)# name student
S3(config-vlan)# vlan 150
S3(config-vlan)# name VOICE
S3(config-vlan)# exit
S3(config)# interface fa0/18
S3(config-if)# switchport mode access
S3(config-if)# switchport access vlan 20
S3(config-if)# mls qos trust cos
S3(config-if)# switchport voice vlan 150
S3(config-if)# end
S3#

Nota: La implementación de QoS no está contemplada en este curso.

El switchport access vlan comando fuerza la creación de una VLAN si es que aún no existe en el switch. Por ejemplo, la VLAN 30 no está presente en la salida del comando show vlan brief del switch. Si se introduce el comando switchport access vlan 30 en cualquier interfaz sin configuración previa, el switch muestra lo siguiente:

% Access VLAN does not exist. Creating vlan 30 

3.3.8
Verificar la información de la VLAN

Una vez que se configura una VLAN, se puede validar la configuración con los comandos show de IOS de Cisco

El show vlan comando muestra la lista de todas las VLAN configuradas. El show vlan comando también se puede utilizar con opciones. La sintaxis completa es show vlan [brief | id vlan-id | name vlan-name | summary].

En la tabla se describen las opciones de show vlan comando.
TaskCommand OptionMuestra el nombre de VLAN, el estado y sus puertos una VLAN por línea.briefMuestra información sobre el número de ID de VLAN identificado. Por ejemplo, vlan-id, el rango es de 1 a 4094.id VLAN-idMuestra información sobre el nombre de VLAN identificado. El nombre de la VLAN es una cadena ASCII de 1 a 32 caracteres. characters.name VLAN-nameMuestra información de resumen de VLAN.summary
Tarea	Opción de comando
Muestra el nombre de VLAN, el estado y sus puertos una VLAN por linea.	

brief

Muestra información sobre el número de ID de VLAN identificado. Para vlan-id, the range is 1 to 4094.	

id vlan-id

Muestra información sobre el número de ID de VLAN identificado. El vlan-name es una cadena ASCII de 1 a 32 caracteres.	

name vlan-name

Mostrar el resumen de información de la VLAN.	

summary

El show vlan summary comando muestra la lista de todas las VLAN configuradas.

S1# show vlan summary
Number of existing VLANs              : 7
Number of existing VTP VLANs          : 7
Number of existing extended VLANS     : 0

Otros comandos útiles son el comando show interfaces interface-id switchport y el comando show interfaces vlan vlan-id. Por ejemplo, el show interfaces fa0/18 switchport comando se puede utilizar para confirmar que el puerto FastEthernet 0/18 se ha asignado correctamente a las VLAN de datos y voz.

S1# show interfaces fa0/18 switchport
Name: Fa0/18
Switchport: Enabled
Administrative Mode: static access
Operational Mode: static access
Administrative Trunking Encapsulation: dot1q
Operational Trunking Encapsulation: native
Negotiation of Trunking: Off
Access Mode VLAN: 20 (student) 
Trunking Native Mode VLAN: 1 (default)
Voice VLAN: 150
Administrative private-vlan host-association: none
(Output omitted)

3.3.9
Cambio de pertenencia de puertos de una VLAN

Existen varias maneras de cambiar la pertenencia de puertos de una VLAN.

Si el puerto de acceso del switch se ha asignado incorrectamente a una VLAN, simplemente vuelva a ingresar el comando switchport access vlan vlan-id interface configuration con el ID de VLAN correcto. Por ejemplo, suponga que Fa0/18 se configuró incorrectamente para estar en la VLAN 1 predeterminada en lugar de la VLAN 20. Para cambiar el puerto a VLAN 20, simplemente ingrese switchport access vlan 20.

Para volver a cambiar la pertenencia de un puerto a la VLAN 1 predeterminada, utilice el comando no switchport access vlan interface configuration mode como se muestra.

En la salida, por ejemplo, Fa0/18 está configurado para estar en la VLAN 1 predeterminada, tal como lo confirma el show vlan brief comando.

S1(config)# interface fa0/18
S1(config-if)# no switchport access vlan
S1(config-if)# end
S1#
S1# show vlan brief
VLAN Name                 Status    Ports
---- ------------------ --------- -------------------------------
1    default            active    Fa0/1, Fa0/2, Fa0/3, Fa0/4
                                  Fa0/5, Fa0/6, Fa0/7, Fa0/8
                                  Fa0/9, Fa0/10, Fa0/11, Fa0/12
                                  Fa0/13, Fa0/14, Fa0/15, Fa0/16
                                  Fa0/17, Fa0/18, Fa0/19, Fa0/20
                                  Fa0/21, Fa0/22, Fa0/23, Fa0/24
                                  Gi0/1, Gi0/2
20   student            active    
1002 fddi-default       act/unsup 
1003 token-ring-default act/unsup 
1004 fddinet-default    act/unsup 
1005 trnet-default      act/unsup

Nota que la VLAN 20 sigue activa, aunque no tenga puertos asignados.

La show interfaces f0/18 switchport salida también se puede utilizar para verificar que la VLAN de acceso para la interfaz F0/18 se ha restablecido a la VLAN 1 como se muestra en la salida.

S1# show interfaces fa0/18 switchport
Name: Fa0/18
Switchport: Enabled
Administrative Mode: static access
Operational Mode: static access
Administrative Trunking Encapsulation: negotiate
Operational Trunking Encapsulation: native
Negotiation of Trunking: Off
Access Mode VLAN: 1 (default)
Trunking Native Mode VLAN: 1 (default)

3.3.10
Eliminar las VLAN

El comando de modo de configuración global no vlan vlan-id se usa para remover una VLAN desde el archivo del switch vlan.dat.

Precaución: Antes de borrar una VLAN, reasigne todos los puertos miembros a una VLAN distinta. Los puertos que no se trasladen a una VLAN activa no se podrán comunicar con otros hosts una vez que se elimine la VLAN y hasta que se asignen a una VLAN activa.

Se puede eliminar el archivo vlan.dat en su totalidad con el comando delete flash:vlan.dat delete flash:vlan.datdel modo EXEC con privilegios. Se puede utilizar la versión abreviada del comando (delete vlan.dat) delete vlan.dat si no se trasladó el archivo vlan.dat de su ubicación predeterminada. Después de emitir este comando y de volver a cargar el switch, las VLAN configuradas anteriormente ya no están presentes. Esto vuelve al switch a la condición predeterminada de fábrica con respecto a la configuración de VLAN.

Nota: Para restaurar un conmutador Catalyst a su condición predeterminada de fábrica, desconecte todos los cables excepto la consola y el cable de alimentación del conmutador. A continuación, introduzca el comando de modo EXEC erase startup-config privilegiado seguido del delete vlan.dat comando.
3.3.11
Comprobador de sintaxis - Configuración de VLAN

En esta actividad del Comprobador de sintaxis, implementará y verificará una configuración de VLAN para interfaces de switch según los requisitos especificados.

Complete estos pasos para crear una VLAN:

    Ingresa al modo de configuración global.
    Cree la VLAN 20.
    Name the VLAN **estudiante
    Volver al modo EXEC privilegiado.

S1#configure terminal

Enter configuration commands, one per line. End with CNTL/Z.

S1(config)#vlan 20
S1(config-vlan)#name student
S1(config-vlan)#end

*Mar 31, 08:55:14.5555: %SYS-5-CONFIG_I: Configured from console by console

Muestre la información resumida de la VLAN.
S1#show vlan brief

VLAN Name                             Status    Ports
---- -------------------------------- --------- -------------------------------
1    default                          active    Fa0/1, Fa0/2, Fa0/3, Fa0/4
                                                Fa0/5, Fa0/6, Fa0/7, Fa0/8
                                                Fa0/9, Fa0/10, Fa0/11, Fa0/12
                                                Fa0/13, Fa0/14, Fa0/15, Fa0/16
                                                Fa0/17, Fa0/18, Fa0/19, Fa0/20
                                                Fa0/21, Fa0/22, Fa0/23, Fa0/24
                                                Gi0/1, Gi0/2
20   student                          active
1002 fddi-default                     act/unsup
1003 token-ring-default               act/unsup
1004 fddinet-default                  act/unsup
1005 trnet-default                    act/unsup

Complete estos pasos para crear una VLAN:

    Ingresa al modo de configuración global.
    Crear VLAN 150.
    Name the VLAN **Voz
    Vuelva al modo de configuración global.

S1#configure terminal
S1(config)#vlan 150
S1(config-vlan)#name VOICE
S1(config-vlan)#exit

Complete los siguientes pasos para asignar las VLAN de voz y datos a un puerto:

    Enter interface configuration mode. Use fa0/18 como designación de interfaz.
    Configure los puertos como puertos de acceso.
    Asigne VLAN 20 de datos al puerto.
    Enable QoS settings with the mls qos trust cos command.
    Asignar la red VLAN de voz 150 al puerto de switch.
    Volver al modo EXEC privilegiado.

S1(config)#interface fa0/18
S1(config-if)#switchport mode access
S1(config-if)#switchport access vlan 20
S1(config-if)#mls qos trust cos
S1(config-if)#switchport voice vlan 150
S1(config-if)#end

Muestre la información resumida de la VLAN.
S1#show vlan brief

LAN Name                             Status    Ports
---- -------------------------------- --------- -------------------------------
1    default                          active    Fa0/1, Fa0/2, Fa0/3, Fa0/4
                                                Fa0/5, Fa0/6, Fa0/7, Fa0/8
                                                Fa0/9, Fa0/10, Fa0/11, Fa0/12
                                                Fa0/13, Fa0/14, Fa0/15, Fa0/16
                                                Fa0/17, Fa0/19, Fa0/20, Fa0/21
                                                Fa0/22, Fa0/23, Fa0/24, Gi0/1
                                                Gi0/2
20   student                          active    Fa0/18
150  VOICE                            active    Fa0/18
1002 fddi-default                     act/unsup
1003 token-ring-default               act/unsup
1004 fddinet-default                  act/unsup
1005 trnet-default                    act/unsup

Complete los siguientes pasos para eliminar y verificar una VLAN eliminada en un puerto:

    Ingresa al modo de configuración global.
    Enter interface configuration mode. Use fa0/18 como designación de interfaz.
    Elimine la asignación de la VLAN del puerto. la forma * Use the do del comando muestra la información resumida de la VLAN.

S1#configure terminal
S1(config)#interface fa0/18
S1(config-if)#no switchport access vlan
S1(config-if)#do show vlan brief

VLAN Name                             Status    Ports
---- -------------------------------- --------- -------------------------------
1    default                          active    Fa0/1, Fa0/2, Fa0/3, Fa0/4
                                                Fa0/5, Fa0/6, Fa0/7, Fa0/8
                                                Fa0/9, Fa0/10, Fa0/11, Fa0/12
                                                Fa0/13, Fa0/14, Fa0/15, Fa0/16
                                                Fa0/17, Fa0/18, Fa0/19, Fa0/20
                                                Fa0/21, Fa0/22, Fa0/23, Fa0/24
                                                Gi0/1, Gi0/2
20   student                          active
150  VOICE                            active    Fa0/18
1002 fddi-default                     act/unsup
1003 token-ring-default               act/unsup
1004 fddinet-default                  act/unsup
1005 trnet-default                    act/unsup

Complete los siguientes pasos para asignar VLAN 20 a otra interfaz.

    Enter interface configuration mode. Use fa0/11 como designación de interfaz.
    Asigne VLAN 20 al puerto.
    Volver al modo EXEC privilegiado.

S1(config-if)#interface fa0/11
S1(config-if)#switchport mode access
S1(config-if)#switchport access vlan 20
S1(config-if)#end

Muestre la información resumida de la VLAN.
S1#show vlan brief

LAN Name                             Status    Ports
---- -------------------------------- --------- -------------------------------
1    default                          active    Fa0/1, Fa0/2, Fa0/3, Fa0/4
                                                Fa0/5, Fa0/6, Fa0/7, Fa0/8
                                                Fa0/9, Fa0/10, Fa0/12, Fa0/13
                                                Fa0/14, Fa0/15, Fa0/16, Fa0/17
                                                Fa0/19, Fa0/20, Fa0/21, Fa0/22
                                                Fa0/23, Fa0/24, Gig0/1, Gig0/2
20   student                          active    Fa0/11 
150  VOICE                            active    Fa0/18
1002 fddi-default                     act/unsup
1003 token-ring-default               act/unsup
1004 fddinet-default                  act/unsup
1005 trnet-default                    act/unsup

Muestre la información de VLAN específica para la VLAN Student (Estudiante).
S1#show vlan name student

VLAN Name                             Status    Ports
---- -------------------------------- --------- -------------------------------
20   student                          active    Fa0/11, Fa0/18
VLAN Type  SAID       MTU   Parent RingNo BridgeNo Stp  BrdgMode Trans1 Trans2
---- ----- ---------- ----- ------ ------ -------- ---- -------- ------ ------
20   enet  100020     1500  -      -      -        -    -        0      0

Muestre la información resumida de las VLAN.
S1#show vlan summary

Number of existing VLANs : 7 
Number of existing VTP VLANs : 7 
Number of existing extended VLANS : 0

Muestre la información del puerto de switch. fa0/11 Utilícelo para la designación de interfaz.
S1#show interface fa0/11 switchport

Name: Fa0/11 
Switchport: Enabled 
Administrative Mode: static access 
Operational Mode: down 
Administrative Trunking Encapsulation: dot1q 
Operational Trunking Encapsulation: native 
Negotiation of Trunking: Off 
Access Mode VLAN: 20 (Students) 
Trunking Native Mode VLAN: 1 (default) 
Voice VLAN: none
(output omitted)

Ha configurado y verificado correctamente la configuración de VLAN en las interfaces del switch.

Enlaces troncales de la VLAN
3.4.1
Comandos de configuración troncal

Ahora que ha configurado y verificado VLAN, ha llegado el momento de configurar y verificar los troncos de VLAN. Un enlace troncal de VLAN es un enlace de capa 2 del modelo OSI entre dos switches que transporta el tráfico para todas las VLAN (a menos que se restrinja la lista de VLAN permitidas de manera manual o dinámica).

Para habilitar los vínculos troncal, configure los puertos de interconexión con el conjunto de comandos de configuración de interfaz que se muestran en la tabla.
Comando TaskiOSIntroduzca el modo de configuración# global.Configuración del conmutador terminalEnter interface configuration mode.Switch(config)# interface Interface-IDEstablezca el puerto en modo de enlace troncal permanente.Switch(config-if)# troncos de modo de puerto de conmutadorEstablece la VLAN nativa en algo distinto de VLAN 1. Switch(config-if)# switchport trunk native vlan VLAN-idEspecifique la lista de VLAN que se permitirán en el enlace troncal. troncalSwitch(config-if)# de puerto de conmutación allowed vlan vlan-list Vuelva al modo EXEC privilegiado.Switch(config-if)# finalizar
Tarea 	Comando de IOS
Ingrese al modo de configuración global.	

Switch# configure terminal

Ingrese el modo de configuración de interfaz.	

Switch(config)# interface interface-id

Establezca el puerto en modo de enlace troncal permanente.	

Switch(config-if)# switchport mode trunk

Cambie la configuración de la VLAN nativa a otra opción que no sea VLAN 1.	

Switch(config-if)# switchport trunk native vlan vlan-id

Especifique la lista de VLAN que se permitirán en el enlace troncal.	

Switch(config-if)# switchport trunk allowed vlan vlan-list

Vuelva al modo EXEC privilegiado.	

Switch(config-if)# end

3.4.2
Ejemplo de configuración de troncal

En la figura 2, las VLAN 10, 20 y 30 admiten las computadoras de Cuerpo docente, Estudiante e Invitado (PC1, PC2 y PC3). El puerto F0/1 del switch S1 se configuró como puerto de enlace troncal y reenvía el tráfico para las VLAN 10, 20 y 30. La VLAN 99 se configuró como VLAN nativa.

Una topología de red muestra tres hosts en diferentes VLAN conectados al mismo switch, S2. PC1 está en la Facultad VLAN 10 con dirección 172.17.10.21. PC2 está en el Student VLAN 20 con la dirección 172.17.20.22. PC3 está en la VLAN invitada 30 con la dirección 172.17.30.23. S2 está conectado a través del puerto F0/1 al conmutador S1 en F0/1. Esta conexión está rotulada como troncal.
PC2 PC1 PC3 S2 S1 F0/1
F0/1
TroncalDocentes
VLAN 10
172.17.10.21Estudiante
VLAN 20
172.17.20.22Invitado
VLAN 30
172.17.30.23

Las subredes asociadas a cada VLAN son:

    VLAN 10 - Faculty/Staff - 172.17.10.0/24
    VLAN 20 - Students - 172.17.20.0/24
    VLAN 30 - Guests - 172.17.30.0/24
    VLAN 99 - Native - 172.17.99.0/24

El ejemplo muestra la configuración del puerto F0/1 en el conmutador S1 como puerto troncal. La VLAN nativa se cambia a VLAN 99 y la lista de VLAN permitidas se restringe a 10, 20, 30 y 99.

S1(config)# interface fastEthernet 0/1
S1(config-if)# switchport mode trunk
S1(config-if)# switchport trunk native vlan 99
S1(config-if)# switchport trunk allowed vlan 10,20,30,99
S1(config-if)# end

Nota: Esta configuración supone el uso de los switches Cisco Catalyst 2960 que utilizan de manera automática la encapsulación 802.1Q en los enlaces troncales. Es posible que otros switches requieran la configuración manual de la encapsulación. Siempre configure ambos extremos de un enlace troncal con la misma VLAN nativa. Si la configuración de enlace troncal 802.1Q no es la misma en ambos extremos, el software IOS de Cisco registra errores.
3.4.3
Verifique la configuración de enlaces troncales.

La salida del switch muestra la configuración del puerto del switch F0/1 en el switch S1. La configuración se verifica con el show interfaces comando switchport interface-ID.

S1# show interfaces fa0/1 switchport
Name: Fa0/1
Switchport: Enabled
Administrative Mode: trunk
Operational Mode: trunk
Administrative Trunking Encapsulation: dot1q
Operational Trunking Encapsulation: dot1q
Negotiation of Trunking: On
Access Mode VLAN: 1 (default)
Trunking Native Mode VLAN: 99 (VLAN0099)
Voice VLAN: none
Administrative private-vlan host-association: none 
Administrative private-vlan mapping: none 
Administrative private-vlan trunk native VLAN: none
Administrative private-vlan trunk encapsulation: dot1q
Administrative private-vlan trunk normal VLANs: none
Administrative private-vlan trunk associations: none
Administrative private-vlan trunk private VLANs: none 
Operational private-vlan: none
Trunking VLANs Enabled: 10,20,30,99
Pruning VLANs Enabled: 2-1001
(output omitted)

En el área superior resaltada, se muestra que el modo administrativo del puerto F0/1 se estableció en trunk. El puerto está en modo de enlace troncal. En la siguiente área resaltada, se verifica que la VLAN nativa es la VLAN 99. Más abajo en el resultado, en el área inferior resaltada, se muestra que las VLAN 10,20,30 y 99 están habilitadas en el enlace troncal.
3.4.4
Restablecimiento del enlace troncal al estado predeterminado

Use el no switchport trunk allowed vlan y el no switchport trunk native vlan comando para eliminar las VLAN permitidas y restablecer la VLAN nativa del enlace troncal. Cuando se restablece al estado predeterminado, el enlace troncal permite todas las VLAN y utiliza la VLAN 1 como VLAN nativa. El ejemplo muestra los comandos utilizados para restablecer todas las características de enlace troncal de una interfaz troncal a la configuración predeterminada.

S1(config)# interface fa0/1
S1(config-if)# no switchport trunk allowed vlan
S1(config-if)# no switchport trunk native vlan
S1(config-if)# end

The show interfaces f0/1 switchport command reveals that the trunk has been reconfigured to a default state.

S1# show interfaces fa0/1 switchport
Name: Fa0/1
Switchport: Enabled
Administrative Mode: trunk
Operational Mode: trunk
Administrative Trunking Encapsulation: dot1q
Operational Trunking Encapsulation: dot1q
Negotiation of Trunking: On
Access Mode VLAN: 1 (default) 
Trunking Native Mode VLAN: 1 (default)
Administrative Native VLAN tagging: enabled
Voice VLAN: none
Administrative private-vlan host-association: none 
Administrative private-vlan mapping: none 
Administrative private-vlan trunk native VLAN: none
Administrative private-vlan trunk Native VLAN tagging: enabled
Administrative private-vlan trunk encapsulation: dot1q
Administrative private-vlan trunk normal VLANs: none
Administrative private-vlan trunk associations: none
Administrative private-vlan trunk mappings: none
Operational private-vlan: none
Trunking VLANs Enabled: ALL
Pruning VLANs Enabled: 2-1001
(output omitted)

La figura muestra el resultado de los comandos utilizados para eliminar la característica de enlace troncal del puerto F0/1 del switch S1. El show interfaces f0/1 switchport comando revela que la interfaz F0/1 ahora está en modo de acceso estático.

S1(config)# interface fa0/1
S1(config-if)# switchport mode access
S1(config-if)# end
S1# show interfaces fa0/1 switchport
Name: Fa0/1
Switchport: Enabled
Administrative Mode: static access
Operational Mode: static access
Administrative Trunking Encapsulation: dot1q
Operational Trunking Encapsulation: native
Negotiation of Trunking: Off
Access Mode VLAN: 1 (default)
Trunking Native Mode VLAN: 1 (default)
Administrative Native VLAN tagging: enabled
(output omitted)

3.4.5
Packet Tracer: Configuración de enlaces troncales

En esta actividad de Packet Tracer, completará los siguientes objetivos:

    verificar las VLAN
    configurar los enlaces troncales

Protocolo de enlace troncal dinámico
3.5.1
Introducción a DTP

Algunos switches Cisco tienen un protocolo propietario que les permite negociar automáticamente la conexión troncal con un dispositivo vecino. Este protocolo se denomina Protocolo de Enlace Troncal Dinámico (DTP). DTP puede acelerar el proceso de configuración de un administrador de red. Las interfaces troncal Ethernet admiten diferentes modos de enlace troncal. Una interfaz se puede establecer en trunking o no trunking, o para negociar trunking con la interfaz vecina. La negociación de enlaces troncales entre dispositivos de red la maneja el Protocolo de Enlace Troncal Dinámico (DTP), que solo funciona de punto a punto.

DTP es un protocolo exclusivo de Cisco que se habilita de manera automática en los switches de las series Catalyst 2960 y Catalyst 3560. DTP maneja la negociación de enlaces troncales sólo si el puerto del switch vecino está configurado en un modo de enlace troncal que admite DTP. Los switches de otros proveedores no admiten el DTP.

Precaución: Algunos dispositivos de interredes pueden reenviar tramas DTP de manera incorrecta, lo que puede causar errores de configuración. Para evitar esto, desactive el DTP en las interfaces de un switch de Cisco conectado a dispositivos que no admiten DTP.

La configuración DTP predeterminada para los switches Catalyst 2960 y 3650 de Cisco es automática dinámica.

Para habilitar los enlaces troncales desde un switch de Cisco hacia un dispositivo que no admite DTP, utilice los comandos switchport mode trunk y switchport nonegotiate interface configuration mode commands. Esto hace que la interfaz se convierta en un tronco, pero no generará tramas DTP.

S1(config-if)# switchport mode trunk
S1(config-if)# switchport nonegotiate

Para volver a habilitar el protocolo de enlace troncal dinámico, utilice el switchport mode dynamic auto comando.

S1(config-if)# switchport mode dynamic auto

Si los puertos que conectan dos conmutadores están configurados para ignorar todos los anuncios DTP con los switchport mode trunk comandos switchport nonegotiate y, los puertos se quedarán en modo de puerto troncal. Si los puertos de conexión están configurados en automático dinámico, no negociarán un tronco y permanecerán en el estado de modo de acceso, creando un enlace troncal inactivo.

Cuando configure un puerto para que esté en modo de enlace troncal, utilice el switchport mode trunk comando. No existe ambigüedad sobre el estado en que se encuentra el enlace troncal: este se encuentra siempre activo.
3.5.2
Modos de interfaz negociados

El switchport mode comando tiene opciones adicionales para negociar el modo de interfaz. La siguiente es la sintaxis del comando :

Switch(config)# switchport mode { access | dynamic { auto | desirable } | trunk }

Las opciones del comando se describen en la Tabla
OptionDescriptionAccessPermite conectar la interfaz (puerto de acceso) en permanente modo no troncal permanente y negocia para convertir el enlace en un enlace no troncal. se convierte en una interfaz no troncal, independientemente de si el interfaz vecina es una interfaz troncal. Automóviles dinámicos. capaz de convertir el enlace a un enlace tronco.La interfaz se convierte en un tronco si la interfaz vecina se establece en modo troncal o deseable.La interfaz modo de puerto de switch predeterminado para todas las interfaces Ethernet. desirable Hace que el puerto intente convertir el enlace en un enlace troncal. La interfaz se convierte en una interfaz de enlace troncal, si la interfaz vecina configurado en modo automático troncal, deseable o dinámico. TrunkPone la interfaz en Pone el puerto en modo troncal permanente y negocia para convertir el enlace en troncal. La interfaz se convierte en una interfaz de enlace troncal, incluso si la interfaz vecina no es una interfaz troncal.
Opción 	Descripción

access

	

    Pone la interfaz (puerto de acceso) en modo permanente de no trunking y negocia para convertir el enlace en un enlace no troncal.
    La interfaz se convierte en una interfaz no troncal, independientemente de si la interfaz vecina es una interfaz troncal.

dynamic auto

	

    Hace que la interfaz pueda convertir el enlace en un enlace troncal.
    La interfaz se convierte en una interfaz de enlace troncal, si la interfaz vecina está configurado en modo troncal o deseable.
    El modo de puerto de switch predeterminado para todas las interfaces Ethernet es dynamic auto.

dynamic desirable

	

    Hace que el puerto intente convertir el enlace en un enlace troncal. 64 K.
    La interfaz se convierte en una interfaz de enlace troncal, si la interfaz vecina está configurado en modo automático troncal, deseable o dinámico.

trunk

	

    El puerto queda configurado en modo troncal de forma permanente y negocia para que el enlace se convierta en una conexión troncal.
    La interfaz se convierte en una interfaz de enlace troncal, incluso si la interfaz vecina no es una interfaz troncal.

Utilice el comando switchport nonegotiate interface configuration para detener la negociación DTP. El switch no participa en la negociación DTP en esta interfaz. Este comando sólo se puede utilizar cuando el modo interface switchport es access o trunk. Debe configurar manualmente el puerto de vecindad como un puerto troncal para establecer un enlace troncal.
3.5.3
Resultados de una configuración DTP

La tabla ilustra los resultados de las opciones de configuración DTP en extremos opuestos de un enlace troncal conectado a los puertos del switch Catalyst 2960. Una buena practica es configurar los enlaces troncales estáticamente siempre que sea posible.
Dynamic AutoDynamic DesirebleTrunkAccessDynamic AutoAccessRunkTrunkAccessDynamic DesierableTrunkTrunkTrunkTrunkTrunkTrunkTrunkTrunkTrunkLimited conexiónAccesoAccesoAccesoAccesoConectividadAcceso limitado
	Dinámico automático 	Dinámico deseado 	Troncal 	Acceso
Dinámico automático 	Acceso	Troncal	Troncal	Acceso
Dinámico deseado 	Troncal	Troncal	Troncal	Acceso
Troncal 	Troncal	Troncal	Troncal	Conectividad limitada
Acceso 	Acceso	Acceso	Conectividad limitada	Acceso
3.5.4
Verificación del modo de DTP

El modo DTP predeterminado depende de la versión del software Cisco IOS y de la plataforma. Para determinar el modo DTP actual, ejecute el show dtp interface comando como se muestra en la salida.

S1# show dtp interface fa0/1
DTP information for FastEthernet0/1:
TOS/TAS/TNS: ACCESS/AUTO/ACCESS
TOT/TAT/TNT: NATIVE/NEGOTIATE/NATIVE
Neighbor address 1: C80084AEF101
Neighbor address 2: 000000000000
Hello timer expiration (sec/state): 11/RUNNING
Access timer expiration (sec/state): never/STOPPED
Negotiation timer expiration (sec/state): never/STOPPED
Multidrop timer expiration (sec/state): never/STOPPED
FSM state: S2:ACCESS
# times multi & trunk 0
Enabled: yes
In STP: no

Nota: Una mejor práctica general cuando se requiere un enlace troncal es establecer la interfaz en trunk y nonegotiate cuando se necesita un enlace troncal. Se debe inhabilitar DTP en los enlaces cuando no se deben usar enlaces troncales.

3.5.6
Compruebe su comprensión - Protocolo de enlace troncal dinámico

Compruebe su conocimiento sobre DTP, Elija la MEJOR repuesta para las siguientes preguntas

    ¿Verdadero o falso? DTP es un protocolo IEEE estándar abierto que especifica la negociación automática de vínculos troncal del conmutador.

¿Cuál es el modo de switchport predeterminado para los switches Catalyst de Cisco?

¿Verdadero o falso? Dos puertos de conmutación en un enlace ambos configurados como automático dinámico negociarán correctamente un tronco.

¿Qué dos modos DTP formarán un tronco con una interfaz que se configura como automático dinámico? (Escoja dos opciones).

3.6.3
¿Qué aprenderé en este módulo?

Descripción general de las VLANs

Las LANS virtuales (VLANs) es un grupo de dispositivos dentro de una VLAN que puede comunicarse con cada dispositivo como si estuvieran conectados al mismo cable. Las VLAN se basan en conexiones lógicas, en lugar de conexiones físicas. Los administradores utilizan VLAN para segmentar redes en función de factores como la función, el equipo o la aplicación. Cada VLAN se considera una red lógica diferente. Cualquier puerto de switch puede pertenecer a una VLAN. Una VLAN crea un dominio de difusión lógico que puede abarcar varios segmentos LAN físicos. Las VLAN mejoran el rendimiento de la red mediante la división de grandes dominios de difusión en otros más pequeños. Cada VLAN de una red conmutada corresponde a una red IP; por lo tanto, el diseño de VLAN debe utilizar un esquema jerárquico de direccionamiento de red. Los tipos de VLAN incluyen la VLAN predeterminada, las VLAN de datos, la VLAN nativa, las VLAN de administración. y las VLAN de voz.

VLANs en un ambiente Multi-Switched

Un enlace troncal no pertenece a una VLAN específica. Es un conducto para las VLAN entre los switches y los routers. Un enlace troncal es un enlace punto a punto entre dos dispositivos de red que lleva más de una VLAN. Un enlace troncal de VLAN amplía las VLAN a través de toda la red. Cuando se implementan las VLAN en un switch, la transmisión del tráfico de unidifusión, multidifusión y difusión desde un host en una VLAN en particular se limita a los dispositivos presentes en esa VLAN. Los campos de etiqueta de VLAN incluyen el tipo, prioridad de usuario, CFI y VID. Algunos dispositivos que admiten los enlaces troncales agregan una etiqueta VLAN al tráfico de las VLAN nativas. Si un puerto de enlace troncal 802.1Q recibe una trama etiquetada con la misma ID de VLAN que la VLAN nativa, descarta la trama. Se necesita una red VLAN de voz separada para admitir VoIP. Las directivas de QoS y seguridad se pueden aplicar al tráfico de voz. El tráfico VLAN de voz debe etiquetarse con un valor de prioridad CoS de Capa 2 adecuado.

Configuración de VLAN

Los diferentes switches Catalyst de Cisco soportan varias cantidades de VLAN, incluidas las VLAN de rango normal y las VLAN de rango extendido. Al configurar redes VLAN de rango normal, los detalles de configuración se almacenan en la memoria flash del switch en un archivo denominado vlan.dat. Aunque no es necesario, se recomienda guardar los cambios de configuración en ejecución en la configuración de inicio. Después de crear una VLAN, el siguiente paso es asignar puertos a la VLAN. Hay muchos comandos para definir un puerto como puerto de acceso y asignarlo a una VLAN. Las VLAN se configuran en el puerto del switch y no en el terminal. Un puerto de acceso puede pertenecer a sólo una VLAN por vez. Sin embargo un puerto puede tambien estar asociado a una VLAN de voz. Por ejemplo, un puerto conectado a un teléfono IP y un dispositivo final se asociaría con dos VLAN: una para voz y otra para datos. Una vez que se configura una VLAN, se puede validar la configuración con los comandos show show de IOS de Cisco Si el puerto de acceso del switch se ha asignado incorrectamente a una VLAN, simplemente vuelva a ingresar el comando switchport access vlan vlan-id interface configuration con el ID de VLAN correcto. El comando de modo de configuración gloabl no vlan vlan-id se usa para remover una VLAN desde el archivo del switch vl vlan.dat.

Enlace troncal de VLAN

Un enlace troncal de VLAN es un enlace de capa 2 entre dos switches que transporta el tráfico para todas las VLAN. Hay varios comandos para configurar los puertos de interconexión. Para verificar la configuración troncal de VLAN , utilice el switchport comando show interfaces interface-ID. Use el no switchport trunk allowed vlan y el no switchport trunk native vlan comando para eliminar las VLAN permitidas y restablecer la VLAN nativa del enlace troncal.

Protocolo de Enlace Troncal Dinámico

Una interfaz se puede establecer en trunking o no trunking, o para negociar trunking con la interfaz vecina. La negociación de enlaces troncales entre dispositivos de red la maneja el Protocolo de Enlace Troncal Dinámico (DTP), que solo funciona de punto a punto. DTP maneja la negociación de enlaces troncales solo si el puerto del switch vecino está configurado en un modo de enlace troncal que admite DTP. Para habilitar los enlaces troncales desde un switch de Cisco hacia un dispositivo que no admite DTP, utilice los comandos de modo de configuración de interfaz switchport mode trunk y switchport nonegotiate El switchport mode comando tiene opciones adicionales para negociar el modo de interfaz, incluyendo acceso, automático dinámico, dinámico deseable y troncal. Para verificar el modo DTP actual, ejecute el show dtp interface comando.
3.6.4
Módulo Quiz - VLAN

    ¿Qué sucede con un puerto asociado con VLAN 10 cuando el administrador elimina VLAN 10 del switch?

¿En qué ubicación de memoria se almacenan las configuraciones de VLAN de las VLAN de rango normal en un switch Catalyst?

Un administrador está investigando una falla en un enlace troncal entre un switch Cisco y un switch de otro proveedor. Después de algunos show comandos, el administrador nota que los switches no están negociando un tronco. ¿Cuál es una causa probable para este problema?

¿Cuál es el propósito del archivo vlan.dat en un switch?

¿Cuál es el propósito de establecer la VLAN nativa separada de las VLAN de datos?

Cuando un switch Cisco recibe tramas sin etiquetas en un puerto troncal 802.1Q, ¿a qué ID de VLAN se conmuta el tráfico de forma predeterminada?

Un administrador de red está determinando la mejor ubicación de los vínculos troncal de VLAN. ¿Qué dos tipos de conexiones punto a punto utilizan la conexión troncal VLAN? (Elija dos.)

¿Cuáles son los tres principales beneficios de usar redes VLAN? (Elija tres opciones).

En un switch Cisco, ¿dónde se almacena la información de VLAN de rango extendido?

¿En qué ubicación se almacenan de forma predeterminada las VLAN de rango normal en un switch Cisco?

¿Qué tipo distinto de VLAN utiliza un administrador para acceder a un switch y configurarlo?

¿Cuál es el propósito de establecer la VLAN nativa separada de las VLAN de datos?

¿Dónde se almacena el archivo vlan.dat en un switch?

Si una organización está cambiando para incluir los teléfonos IP de Cisco en su red, ¿qué función de diseño debe tenerse en cuenta para garantizar la calidad de la voz?

Actualmente, un switch Cisco permite el tráfico etiquetado con VLAN 10 y 20 a través del puerto troncal Fa0/5. ¿Cuál es el efecto de emitir un switchport trunk allowed vlan 30 comando en Fa0/5?

4 Inter-VLAN Routing

Introducción
4.0.1
¿Por qué debería tomar este módulo?

Bienvenido a Inter-VLAN Routing!

Ahora sabe cómo segmentar y organizar su red en VLAN. Los hosts pueden comunicarse con otros hosts de la misma VLAN y ya no tiene hosts que envíen mensajes de difusión a cualquier otro dispositivo de la red, consumiendo el ancho de banda necesario. Pero, ¿qué pasa si un host de una VLAN necesita comunicarse con un host de otra VLAN? Si es administrador de red, sabe que las personas querrán comunicarse con otras personas fuera de la red. Aquí es donde el inter-VLAN routing puede ayudarle. El inter-VLAN routing utiliza un dispositivo de capa 3, como un router o un switch de capa 3. Vamos a llevar su experiencia VLAN y combinarla con sus habilidades de capa de red y ponerlos a prueba.
4.0.2
¿Qué aprenderé en este módulo?

Título del módulo: Inter-VLAN Routing

Objetivo del módulo: Solución de problemas de inter-VLAN routing en dispositivos de capa 3
Leyenda de la tabla
Título del tema 	Objetivo del tema
Funcionamiento del inter-VLAN routing 	Describa las opciones para configurar inter-VLAN routing
Router-on-a-Stick Inter-VLAN Routing 	Configure router-on-a-Stick inter-VLAN Routing
Inter-VLAN Routing usando switches de capa 3 	Configure inter-VLAN routing mediante un switch de capa&nbsp;3.
Solución de problemas de Inter-VLAN Routing 	Solución de problemas comunes de configuración de inter-VLAN

Funcionamiento de Inter-VLAN Routing
4.1.1
¿Qué es Inter-VLAN Routing

Las VLAN se utilizan para segmentar las redes de switch de Capa 2 por diversas razones. Independientemente del motivo, los hosts de una VLAN no pueden comunicarse con los hosts de otra VLAN a menos que haya un router o un switch de capa 3 para proporcionar servicios de enrutamiento.

Inter-VLA routing es el proceso de reenviar el tráfico de red de una VLAN a otra VLAN.

Hay tres opciones inter-VLAN routing:

    Inter-VLAN Routing heredado - Esta es una solución antigua. No escala bien
    Router-on-a-stick - Esta es una solución aceptable para una red pequeña y mediana.
    Switch de capa 3 con interfaces virtuales (SVIs) : esta es la solución más escalable para organizaciones medianas y grandes.

4.1.2
Inter-VLAN Routing heredado

La primera solución de inter-VLAN routing se basó en el uso de un router con múltiples interfaces Ethernet. Cada interfaz del router estaba conectada a un puerto del switch en diferentes VLAN. Las interfaces del router sirven como default gateways para los hosts locales en la subred de la VLAN.

Por ejemplo, consulte la topología donde R1 tiene dos interfaces conectadas al switch S1.

La topología de red física muestra dos PC, un switch y un router. PC1 a la izquierda tiene la dirección IP 192.168.10.10, está en VLAN 10 y está conectado el switch en el puerto F0/11. PC2 a la derecha tiene la dirección IP 192.168.20.10, está en VLAN 20 y está conectado al switch en el puerto F0/24. El switch, S1, tiene dos enlaces al router, R1. El puerto del switch F0/1 está conectado a la interfaz G0/0/0 en R1. El puerto del switch F0/2 está conectado a la interfaz G0/0/1 en R1. La interfaz del router G0/0/0 tiene la dirección IP 192.168.10.1. La interfaz del router G0/0/1 tiene la dirección IP 192.168.20.1.
PC2 S1 PC1 G0/0/0 192.168.10.1/24 F0/11 F0/24 F0/12 F0/1  G0/0/1 192.168.20.1/24 R1
192.168.10.10/24
VLAN 10192.168.20.10/24
VLAN 20

Nota en la tabla de direcciones MAC de ejemplo de S1 se rellena de la siguiente manera:

El puerto Fa0/1 está asignado a la VLAN 10 y está conectado a la interfaz R1 G0/0/0. El puerto Fa0/11 está asignado a la VLAN 10 y está conectado a PC1. El puerto Fa0/12 está asignado a la VLAN 20 y está conectado a la interfaz R1 G0/0/1. El puerto Fa0/11 está asignado a la VLAN 20 y está conectado a PC2.
MAC Address table for S1
PortMacDirecciónSVLANF0/1R1 G0/0/0 MAC10F0/11PC1 MAC10F0/12R1 G0/0/1 MAC20F0/24PC2 MAC20
Puerto 	Dirección MAC 	VLAN
F0/1	R1 G0/0/0 MAC	10
F0/11	PC1 MAC	10
F0/12	R1 G0/0/1 MAC	20
F0/24	PC2 MAC	20

Cuando PC1 envía un paquete a PC2 en otra red, lo reenvía a su puerta de enlace predeterminada 192.168.10.1. R1 recibe el paquete en su interfaz G0/0/0 y examina la dirección de destino del paquete. R1 luego enruta el paquete hacia fuera de su interfaz G0/0/1 al puerto F0/12 en la VLAN 20 en S1. Finalmente, S1 reenvía la trama a PC2.

Inter-VLAN routing heredado, usa las interfaces fisicas funciona, pero tiene limitaciones significantes. No es razonablemente escalable porque los routers tienen un número limitado de interfaces físicas. Requerir una interfaz física del router por VLAN agota rápidamente la capacidad de la interfaz física del router

En nuestro ejemplo, R1 requería dos interfaces Ethernet separadas para enrutar entre la VLAN 10 y la VLAN 20. ¿Qué ocurre si hubiera seis (o más) VLAN para interconectar? Se necesitaría una interfaz separada para cada VLAN. Obviamente, esta solución no es escalable.

Nota: Este método de inter-VLAN routing ya no se implementa en redes de switches y se incluye únicamente con fines explicativos.
4.1.3
Router-on-a-Stick Inter-VLAN Routing

El método ‘router-on-a-stick’ inter-VLAN routing supera la limitación del método de enrutamiento interVLAN heredado. Solo requiere una interfaz Ethernet física para enrutar el tráfico entre varias VLAN de una red.

Una interfaz Ethernet del router Cisco IOS se configura como un troncal 802.1Q y se conecta a un puerto troncal en un switch de capa 2. Específicamente, la interfaz del router se configura mediante subinterfaces para identificar VLAN enrutables.

Las subinterfaces configuradas son interfaces virtuales basadas en software. Cada uno está asociado a una única interfaz Ethernet física. Estas subinterfaces se configuran en el software del router. Cada una se configura de forma independiente con sus propias direcciones IP y una asignación de VLAN. Las subinterfaces se configuran para subredes diferentes que corresponden a su asignación de VLAN. Esto facilita el enrutamiento lógico.

Cuando el tráfico etiquetado de VLAN entra en la interfaz del router, se reenvía a la subinterfaz de VLAN. Después de tomar una decisión de enrutamiento basada en la dirección de red IP de destino, el router determina la interfaz de salida del tráfico. Si la interfaz de salida está configurada como una subinterfaz 802.1q, las tramas de datos se etiquetan VLAN con la nueva VLAN y se envían de vuelta a la interfaz física.

Haga clic en Reproducir en la figura para ver una animación de la forma en que un router-on-a-stick desempeña su función de routing.
G0/0/0.10
G0/0/0.30
R1 Subinterfaces
G0/0/0.10: 172.17.10.1 [VLAN 10]
G0/0/0.20: 172.17.20.1 [VLAN 20]
G0/0/0.30: 172.17.30.1 [VLAN 30]
Switch S1 Ports
F0/1-F0/3 = Trunk

Switch S2 Ports
F0/11 = VLAN 10
F0/18 = VLAN 20
F0/23 = VLAN 30
F0/1-F0/2 = Trunk
Etiquetado de trama de
VLAN
Etiquetado de trama de
VLAN
Troncal
Troncal
Troncal

Como se ve en la animación, PC1 en la VLAN 10 se comunica con PC3 en la VLAN 30. El router R1 acepta el tráfico de unidifusión etiquetado en la VLAN 10 y lo enruta a la VLAN 30 mediante sus subinterfaces configuradas. El switch S2 elimina la etiqueta de la VLAN de la trama de unidifusión y reenvía la trama a PC3 en el puerto F0/23.

Nota: El método router-on-a-stick de inter-VLAN routing no escala mas allá de 50 VLANs.
4.1.4
Inter-VLAN Routing en un switch de capa 3

El método moderno para realizar inter-VLAN routing es utilizar switches de capa 3 e interfaces virtuales del switch (SVI). Una SVI es una interfaz virtual configurada en un switch multicapa, como se muestra en la figura.

Nota: Un switch de capa 3 también se denomina switch multicapa ya que funciona en la capa 2 y la capa 3. Sin embargo, en este curso usamos el término switch de capa 3.

La topología de red física muestra dos PC, dos switches de capa 2 y un switch de capa 3. El PC de la izquierda está en VLAN 10 y está conectado a un switch de capa 2 que a su vez está conectado al switch de capa 3. El PC de la derecha está en VLAN 20 y está conectado a un switch de capa 2 que a su vez está conectado al switch de capa 3. El switch de capa 3 tiene dos interfaces SVI. SVI1 está en VLAN 10 y tiene la dirección IP 10.1.10.1. SVI2 está en VLAN 20 y tiene la dirección IP 10.1.20.1.
VLAN 10
VLAN 20
SVI Interface
VLAN 20
10.1.20.1SVI Interface
VLAN 10
10.1.10.1

Los SVIs entre VLAN se crean de la misma manera que se configura la interfaz de VLAN de administración. El SVI se crea para una VLAN que existe en el switch. Aunque es virtual, el SVI realiza las mismas funciones para la VLAN que lo haría una interfaz de router. Específicamente, proporciona el procesamiento de Capa 3 para los paquetes que se envían hacia o desde todos los puertos de switch asociados con esa VLAN.

A continuación se presentan las ventajas del uso de switches de capa 3 para inter-VLAN routing:

    Es mucho más veloz que router-on-a-stick, porque todo el switching y el routing se realizan por hardware.
    El routing no requiere enlaces externos del switch al router. No se* limitan a un enlace porque los EtherChannels de Capa 2 se pueden utilizar como enlaces troncal entre los switches para aumentar el ancho de banda.
    La latencia es mucho más baja, dado que los datos no necesitan salir del switch para ser enrutados a una red diferente. Se* implementan con mayor frecuencia en una LAN de campus que en routers.

La única desventaja es que los switches de capa 3 son más caros.
4.1.5
Verifique su comprensión- Operación de Inter-VLAN Routing

Esta actividad de verificación de su comprensión utiliza un escenario diferente para cada pregunta. Haga clic en cada botón para el escenario de operación de Inter-VLAN routing que corresponda a la pregunta.

Escenario A

La topología de red física muestra dos PC, un switch y un router. PC1 tiene la dirección IP 10.17.10.4/24, está en VLAN 10 y está conectado al switch S2. PC2 tiene la dirección IP 1.17.20.4/24, está en VLAN 20 y está conectado al switch S3. Tanto S2 como S3 se conectan al switch de capa 3, S1. S1 tiene una interfaz SVI en VLAN 10 con dirección IP 10.17.10.1/24 y una interfaz SVI en VLAN 20 con dirección IP 10.17.20.1/24
S1 S1 S2 S3 PC1 PC2 10.17.10.4/24 10.17.20.4/24 SVI VLAN 10 - 10.17.10.1/24
SVI VLAN 20 - 10.17.20.1/24
VLAN 20VLAN 10

    Consulte cada una de las topologías de escenario.. ¿Qué instrucciones describen mejor los diferentes tipos de soluciones de inter-VLAN routing? (Elija todas las opciones que correspondan).

Escenario B

La topología de red física muestra dos PC, un switch y un router. PC2 a la izquierda tiene la dirección IP 10.17.20.4/24, está en VLAN 20 y está conectado el switch S1. PC1 a la derecha tiene la dirección IP 10.17.10.4/24, está en VLAN 10 y está conectado el switch S1. El switch, S1, tiene dos enlaces al router, R1 en la interfaz G0/0/0 y G0/0/1. La interfaz del router G0/0/0 tiene la dirección IP 10.17.10.1/25 y la interfaz del router G0/0/1 tiene la dirección IP 10.17.20.1/04.
10.17.20.4/24 10.17.10.4/24 PC2 PC1 S1 R1 G0/0/1 G0/0/0 G0/0/0 - 10.17.10.1/24
G0/0/1 - 10.17.20.1/24
VLAN 20VLAN 10

    Consulte cada una de las topologías de escenario.. ¿Qué instrucciones describen mejor los diferentes tipos de soluciones de inter-VLAN routing? (Elija todas las opciones que correspondan).

Escenario C

La topología de red física muestra tres PC, un switch y un router. PC1 tiene la dirección IP 10.17.10.4/24, está en VLAN 10 y está conectado el switch S1. PC2 tiene la dirección IP 10.17.20.4/24, está en VLAN 20 y está conectado el switch S1. PC3 tiene la dirección IP 10.17.30.4/24, está en VLAN 30 y está conectado el switch S1. El switch, S1, se conecta al router, R1 en la interfaz G0/0/0 está configurado con tres subinterfaces: G0/0/0.10 tiene dirección IP 10.17.10.1/25, G0/0/0.20 tiene dirección IP 10.17.20.1/04, G0/0/0.30 tiene dirección IP 10.17.30.1/04.
10.17.30.4/24 10.17.20.4/24 10.17.10.4/24 G0/0/0 R1 S1 PC1 PC3 PC2 G0/0/0.10 - 10.17.10.1/24 G0/0/0.20 - 10.17.20.1/24
G0/0/0.30 - 10.17.30.1/24
VLAN 30VLAN 20VLAN 10

    Consulte cada una de las topologías de escenario.. ¿Qué instrucciones describen mejor los diferentes tipos de soluciones de inter-VLAN routing? (Elija todas las opciones que correspondan).

Routing entre VLAN con router-on-a-stick
4.2.1
Escenario Router-on-a-Stick

En el tema anterior, se enumeraron tres formas diferentes de crear inter-VLAN routing y se detalló el inter-VLAN routing heredado. Este tema detalla como configurar router-on-a-stick inter-VLAN routing. Puede ver en la figura que el router no está en el centro de la topología, sino que parece estar en un palo cerca del borde, de ahí el nombre.

En la figura, la interfaz R1 GigabitEthernet 0/0/1 está conectada al puerto S1 FastEthernet 0/5. El puerto S1 FastEthernet 0/1 está conectado al puerto S2 FastEthernet 0/1. Estos son enlaces troncales necesarios para reenviar tráfico dentro de las VLAN y entre ellas.

La topología de red física muestra dos PC, dos switches y un router. PC1 tiene la dirección IP 192.168.10.10/24, un default gateway de 192.168.10.1 y está en VLAN 10. PC2 tiene la dirección IP 192.168.20.10/24, un default gateway 192.168.20.1 y está en VLAN 20. PC1 se conecta al switch S1 en el puerto F0/6. PC2 se conecta al switch S2 en el puerto F0/18. El switch S1 y el switch S2 están interconectados entre sí a través de un enlace troncal en el puerto F0/1. El switch S1 está conectado al router R1 a través de un enlace troncal en el puerto del switch F0/5 que se conecta a las interfaces G0/0/1 en R1. La dirección IP de administración en S1 es 192.168.99.2/24. La dirección IP de administración en S1 es 192.168.99.3/24
192.168.10.10/24 G0/0/1 F0/5 192.168.99.2/24 F0/1 F0/1 192.168.99.3/24 F0/6 F0/18 192.168.20.10/24 S1 S2 R1 PC1
PC2
Enlaces troncalesGateway: 192.168.10.1
VLAN 10Gateway: 192.168.20.1
VLAN 20

Para enrutar entre VLAN, la interfaz R1 GigabitEthernet 0/0/1 se divide lógicamente en tres subinterfaces, como se muestra en la tabla. La tabla también muestra las tres VLAN que se configurarán en los switches.
Router R1 Subinterfaces
SubinterfaceVLANIP AddressG0/0/0.1010192.168.10.1/24G0/0/0.2020192.168.20.1/24G0/0/0.3099192.168.99.1/24
subinterfaz 	VLAN 	Dirección IP
G0/0/1.10	10	192.168.10.1/24
G0/0/1.20	20	192.168.20.1/24
G0/0/1.99	99	192.168.99.1/24

Suponga que R1, S1 y S2 tienen configuraciones básicas iniciales. Actualmente, PC1 y PC2 no pueden ping entre sí porque están en redes separadas. Sólo S1 y S2 pueden ping uno al otro, pero son inalcanzables por PC1 o PC2 porque también están en diferentes redes.

Para permitir que los dispositivos se hagan ping entre sí, los switches deben configurarse con VLAN y trunking, y el router debe configurarse para el inter-VLAN routing.
4.2.2
S1 VLAN and configuraciones de enlaces troncales

Complete los siguientes pasos para configurar S1 con VLAN y trunking:

Paso 1. Crear y nombrar las VLANs.

Paso 2. Crear la interfaz de administración

Paso 3. Configurar puertos de acceso.

Paso 4. Configurar puertos de enlace troncal.

La topología de red física muestra dos PC, dos switches y un router. PC1 tiene la dirección IP 192.168.10.10/24. PC2 tiene la dirección IP 192.168.20.10/24. PC1 se conecta al switch S1 en el puerto F0/6. PC2 se conecta al switch S2 en el puerto F0/18. El switch S1 y el switch S2 están interconectados entre sí en el puerto F0/1. El switch S1 está conectado al router R1 en el puerto del switch F0/5 que se conecta a las interfaces G0/0/1 en R1. La dirección IP de administración en S1 es 192.168.99.2/24. La dirección IP de administración en S1 es 192.168.99.3/24.
192.168.10.10/24 G0/0/1 F0/5 192.168.99.2/24 F0/1 F0/1 192.168.99.3/24 F0/6 F0/18 192.168.20.10/24 S1 S2 R1 PC1
PC2
Enlaces troncalesGateway: 192.168.10.1
VLAN 10Gateway: 192.168.20.1
VLAN 20

Haga clic en cada botón para obtener detalles del paso de configuración.

1. Crear y nombrar los VLANs.

En primer lugar, las VLAN se crean y nombran. Las VLAN sólo se crean después de salir del modo de subconfiguración de VLAN.

S1(config)# vlan 10
S1(config-vlan)# name LAN10
S1(config-vlan)# exit
S1(config)# vlan 20
S1(config-vlan)# name LAN20
S1(config-vlan)# exit
S1(config)# vlan 99
S1(config-vlan)# name Management
S1(config-vlan)# exit
S1(config)#

2. Crear la interfaz de administración.

A continuación, se crea la interfaz de administración en VLAN 99 junto con el default gateway de R1.

S1(config)# interface vlan 99
S1(config-if)# ip add 192.168.99.2 255.255.255.0
S1(config-if)# no shut
S1(config-if)# exit
S1(config)# ip default-gateway 192.168.99.1
S1(config)#

3. Configurar puertos de acceso.

A continuación, el puerto Fa0/6 que se conecta a PC1 se configura como un puerto de acceso en la VLAN 10. Supongamos que PC1 se ha configurado con la dirección IP correcta yel default gateway.

S1(config)# interface fa0/6
S1(config-if)# switchport mode access
S1(config-if)# switchport access vlan 10
S1(config-if)# no shut
S1(config-if)# exit
S1(config)#

4. Configurar puertos de enlace troncal.

Por último, los puertos Fa0/1 que se conectan a S2 y Fa05 que se conectan a R1 se configuran como puertos troncal.

S1(config)# interface fa0/1
S1(config-if)# switchport mode trunk
S1(config-if)# no shut
S1(config-if)# exit
S1(config)# interface fa0/5
S1(config-if)# switchport mode trunk
S1(config-if)# no shut
S1(config-if)# end
*Mar 1 00:23:43.093: %LINEPROTO-5-UPDOWN: Line protocol on Interface FastEthernet0/1, changed state to up
*Mar 1 00:23:44.511: %LINEPROTO-5-UPDOWN: Line protocol on Interface FastEthernet0/5, changed state to up

4.2.3
S2 VLAN y configuraciones de enlaces troncales

La configuración para S2 es similar a S1.

La topología de red física muestra dos PC, dos switches y un router. PC1 tiene la dirección IP 192.168.10.10/24, un default gateway de 192.168.10.1 y está en VLAN 10. PC2 tiene la dirección IP 192.168.20.10/24, un default gateway 192.168.20.1 y está en VLAN 20. PC1 se conecta al switch S1 en el puerto F0/6. PC2 se conecta al switch S2 en el puerto F0/18. El switch S1 y el switch S2 están interconectados entre sí a través de un enlace troncal en el puerto F0/1. El switch S1 está conectado al router R1 a través de un enlace troncal en el puerto del switch F0/5 que se conecta a las interfaces G0/0/1 en R1. La dirección IP de administración en S1 es 192.168.99.2/24. La dirección IP de administración en S1 es 192.168.99.3/24.
192.168.10.10/24 G0/0/1 F0/5 192.168.99.2/24 F0/1 F0/1 192.168.99.3/24 F0/6 F0/18 192.168.20.10/24 S1 S2 R1 PC1
PC2
Enlaces troncalesGateway: 192.168.10.1
VLAN 10Gateway: 192.168.20.1
VLAN 20

S2(config)# vlan 10
S2(config-vlan)# name LAN10
S2(config-vlan)# exit
S2(config)# vlan 20
S2(config-vlan)# name LAN20
S2(config-vlan)# exit
S2(config)# vlan 99
S2(config-vlan)# name Management
S2(config-vlan)# exit
S2(config)#
S2(config)# interface vlan 99
S2(config-if)# ip add 192.168.99.3 255.255.255.0
S2(config-if)# no shut
S2(config-if)# exit
S2(config)# ip default-gateway 192.168.99.1
S2(config)# interface fa0/18
S2(config-if)# switchport mode access
S2(config-if)# switchport access vlan 20
S2(config-if)# no shut
S2(config-if)# exit
S2(config)# interface fa0/1
S2(config-if)# switchport mode trunk
S2(config-if)# no shut
S2(config-if)# exit
S2(config-if)# end
*Mar  1 00:23:52.137: %LINEPROTO-5-UPDOWN: Line protocol on Interface FastEthernet0/1, changed state to up

4.2.4
Configuración de subinterfaces de R1

Para el método de router-on-a-stick, se requieren subinterfaces configuradas para cada VLAN que se pueda enrutar.

Se crea una subinterfaz mediante el comando interface interface_id subinterface_id global configuration mode. La sintaxis de la subinterfaz es la interfaz física seguida de un punto y un número de subinterfaz. Aunque no es obligatorio, es costumbre hacer coincidir el número de subinterfaz con el número de VLAN.

A continuación, cada subinterfaz se configura con los dos comandos siguientes:

    encapsulation dot1q vlan_id [native] - This command configures the subinterface to respond to 802.1Q encapsulated traffic from the specified vlan-id. The native keyword sólo se agrega para establecer la VLAN nativa en algo distinto de VLAN 1.
    ip address ip-address subnet-mask - Este comando configura la dirección IPv4 de la subinterfaz. Esta dirección normalmente sirve como default gateway para la VLAN identificada.

Repita el proceso para cada VLAN que se vaya a enrutar. Es necesario asignar una dirección IP a cada subinterfaz del router en una subred única para que se produzca el routing.

Cuando se hayan creado todas las subinterfaces, habilite la interfaz física mediante el comando de configuración de no shutdown interfaz. Si la interfaz física está deshabilitada, todas las subinterfaces están deshabilitadas.

En la siguiente configuración, las subinterfaces R1 G0/0/1 se configuran para las VLAN 10, 20 y 99.

La topología de red física muestra dos PC, dos switches y un router. PC1 tiene la dirección IP 192.168.10.10/24. PC2 tiene la dirección IP 192.168.20.10/24. PC1 se conecta al switch S1 en el puerto F0/6. PC2 se conecta al switch S2 en el puerto F0/18. El switch S1 y el switch S2 están interconectados entre sí en el puerto F0/1. El switch S1 está conectado al router R1 en el puerto del switch F0/5 que se conecta a las interfaces G0/0/1 en R1. La dirección IP de administración en S1 es 192.168.99.2/24. La dirección IP de administración en S1 es 192.168.99.3/24.
192.168.10.10/24 G0/0/1 F0/5 192.168.99.2/24 F0/1 F0/1 192.168.99.3/24 F0/6 F0/18 192.168.20.10/24 S1 S2 R1 PC1
PC2
Enlaces troncalesGateway: 192.168.10.1
VLAN 10Gateway: 192.168.20.1
VLAN 20

R1(config)# interface G0/0/1.10
R1(config-subif)# description Default Gateway for VLAN 10
R1(config-subif)# encapsulation dot1Q 10
R1(config-subif)# ip add 192.168.10.1 255.255.255.0
R1(config-subif)# exit
R1(config)#
R1(config)# interface G0/0/1.20
R1(config-subif)# description Default Gateway for VLAN 20
R1(config-subif)# encapsulation dot1Q 20
R1(config-subif)# ip add 192.168.20.1 255.255.255.0
R1(config-subif)# exit
R1(config)#
R1(config)# interface G0/0/1.99
R1(config-subif)# description Default Gateway for VLAN 99
R1(config-subif)# encapsulation dot1Q 99
R1(config-subif)# ip add 192.168.99.1 255.255.255.0
R1(config-subif)# exit
R1(config)#
R1(config)# interface G0/0/1
R1(config-if)# description Trunk link to S1
R1(config-if)# no shut
R1(config-if)# end
R1#
*Sep 15 19:08:47.015: %LINK-3-UPDOWN: Interface GigabitEthernet0/0/1, changed state to down
*Sep 15 19:08:50.071: %LINK-3-UPDOWN: Interface GigabitEthernet0/0/1, changed state to up
*Sep 15 19:08:51.071: %LINEPROTO-5-UPDOWN: Line protocol on Interface GigabitEthernet0/0/1, changed state to up
R1#

4.2.5
Verificar la conectividad entre PC1 y PC2

La configuración del router-on-a-stick se completa después de configurar los enlaces troncales del switch y las subinterfaces del router. La configuración se puede verificar desde los hosts, el router y el switch.

Desde un host, compruebe la conectividad con un host de otra VLAN mediante el ping comando. Es una buena idea verificar primero la configuración IP del host actual mediante el comando ipconfig Windows host

C:\Users\PC1> ipconfig
Windows IP Configuration
Ethernet adapter Ethernet0:
  Connection-specific DNS Suffix . :
  Link-local IPv6 Address          : fe80::5c43:ee7c:2959:da68%6
  IPv4 Address                     : 192.168.10.10
  Subnet Mask                      : 255.255.255.0
  Default Gateway                  : 192.168.10.1
C:\Users\PC1> 

El resultado confirma la dirección IPv4 y el default gateway de PC1. A continuación, utilice ping para verificar la conectividad con PC2 y S1, como se muestra en la figura. El ping resultado confirma correctamente que el enrutamiento entre VLANs está funcionando.

C:\Users\PC1> ping 192.168.20.10
Pinging 192.168.20.10 with 32 bytes of data:
Reply from 192.168.20.10: bytes=32 time<1ms TTL=127 
Reply from 192.168.20.10: bytes=32 time<1ms TTL=127
Reply from 192.168.20.10: bytes=32 time<1ms TTL=127
Reply from 192.168.20.10: bytes=32 time<1ms TTL=127
Ping statistics for 192.168.20.10:
    Packets: Sent = 4, Received = 4, Lost = 0 (0% loss).
Approximate round trip times in milli-seconds:
    Minimum = 0ms, Maximum = 0ms, Average = 0ms
C:\Users\PC1> 
C:\Users\PC1> ping 192.168.99.2
Pinging 192.168.99.2 with 32 bytes of data:
Request timed out.
Request timed out.
Reply from 192.168.99.2: bytes=32 time=2ms TTL=254
Reply from 192.168.99.2: bytes=32 time=1ms TTL=254	|
Ping statistics for 192.168.99.2:
    Packets: Sent = 4, Received = 2, Lost = 2 (50% loss). 
Approximate round trip times in milli-seconds:
    Minimum = 1ms, Maximum = 2ms, Average = 1ms
C:\Users\PC1> 

4.2.6
Verificación de Router-on-a-Stick Inter-VLAN Routing

Además de utilizar ping entre dispositivos, se pueden utilizar los siguientes show comandos para verificar y solucionar problemas de la configuración del router-on-a-stick.

    show ip route
    show ip interface brief
    show interfaces
    show interfaces trunk

Haga clic en cada botón para ver los resultados de usar cada uno de los comandos

show ip route

Compruebe que las subinterfaces aparecen en la tabla de enrutamiento de R1 mediante el show ip route comando. Observe que hay tres rutas conectadas (C) y sus respectivas interfaces de salida para cada VLAN enrutable. El resultado confirma que las subredes, las VLAN y las subinterfaces correctas están activas.

R1# show ip route | begin Gateway
Gateway of last resort is not set
      192.168.10.0/24 is variably subnetted, 2 subnets, 2 masks
C 192.168.10.0/24 is directly connected, GigabitEthernet0/0/1.10
L 192.168.10.1/32 is directly connected, GigabitEthernet0/0/1.10
      192.168.20.0/24 is variably subnetted, 2 subnets, 2 masks
C 192.168.20.0/24 is directly connected, GigabitEthernet0/0/1.20
L 192.168.20.1/32 is directly connected, GigabitEthernet0/0/1.20
      192.168.99.0/24 is variably subnetted, 2 subnets, 2 masks
C 192.168.99.0/24 is directly connected, GigabitEthernet0/0/1.99
L 192.168.99.1/32 is directly connected, GigabitEthernet0/0/1.99
R1#

show ip interface brief

Otro comando útil del router es show ip interface brief, como se muestra en el resultado. El resultado confirma que las subinterfaces tienen configurada la dirección IPv4 correcta y que están operativas.

R1# show ip interface brief | include up
GigabitEthernet0/0/1 unassigned YES unset up up
Gi0/0/1.10 192.168.10.1 YES manual up up
Gi0/0/1.20 192.168.20.1 YES manual up up
Gi0/0/1.99 192.168.99.1 YES manual up up
R1#

show interfaces

Las subinterfaces se pueden verificar mediante el comando show interfaces subinterface-id, como se muestra.

R1# show interfaces g0/0/1.10
GigabitEthernet0/0/1.10 is up, line protocol is up
  Hardware is ISR4221-2x1GE, address is 10b3.d605.0301 (bia 10b3.d605.0301)
  Description: Default Gateway for VLAN 10
  Internet address is 192.168.10.1/24
  MTU 1500 bytes, BW 100000 Kbit/sec, DLY 100 usec,
     reliability 255/255, txload 1/255, rxload 1/255
  Encapsulation 802.1Q Virtual LAN, Vlan ID 10.
  ARP type: ARPA, ARP Timeout 04:00:00
  Keepalive not supported
  Last clearing of "show interface" counters never
R1#

show interfaces trunk

La configuración incorrecta también podría estar en el puerto troncal del switch. Por lo tanto, también es útil verificar los enlaces troncales activos en un switch de Capa 2 mediante el show interfaces trunk comando, como se muestra en el ejemplo. El resultado confirma que el enlace a R1 es troncal para las VLAN requeridas.

Note: Aunque la VLAN 1 no se configuró explícitamente, se incluyó automáticamente porque el tráfico de control en los enlaces troncal siempre se reenvía en la VLAN 1.

S1# show interfaces trunk
Port Mode Encapsulation Status Native vlan
Fa0/1 on 802.1q trunking 1
Fa0/5 on 802.1q trunking 1
Port Vlans allowed on trunk
Fa0/1 1-4094
Fa0/5 1-4094
Port Vlans allowed and active in management domain
Fa0/1 1,10,20,99
Fa0/5 1,10,20,99
Port Vlans in spanning tree forwarding state and not pruned
Fa0/1 1,10,20,99
Fa0/5 1,10,20,99
S1#


Inter-VLAN Routing usando switches de capa 3
4.3.1
Inter-VLAN Routing en Switch de capa 3

Las redes empresariales modernas rara vez usan router-on-a-stick porque no se escalan fácilmente para cumplir los requisitos. En estas redes muy grandes, los administradores de red utilizan switches de capa 3 para configurar el inter-VLAN routing.

El inter-VLAN routing. mediante el método router-on-a-stick es fácil de implementar para una organización pequeña y mediana. Sin embargo, una gran empresa requiere un método más rápido y mucho más escalable para proporcionar inter-VLAN routing.

Las LAN de campus empresariales utilizan switches de capa 3 para proporcionar inter-VLAN routing. Los switches de capa 3 utilizan switching basado en hardware para lograr velocidades de procesamiento de paquetes más altas que los routers. Los switches de capa 3 también se implementan comúnmente en armarios de cableado de capa de distribución empresarial.

Las capacidades de un switch de capa 3 incluyen la capacidad de hacer lo siguiente:

    Ruta de una VLAN a otra mediante múltiples interfaces virtuales de switch (SVIs).
    Convierta un puerto de switch de capa 2 en una interfaz de capa 3 (es decir, un puerto enrutado). Un puerto enrutado es similar a una interfaz física en un router Cisco IOS.

Para proporcionar enrutamiento entre VLAN, los switches de capa 3 utilizan SVIs. Los SVIs se configuran utilizando el mismo comando interface vlan vlan-id utilizado para crear el SVI de administración en un switch de capa 2. Se debe crear un SVI de Capa 3 para cada una de las VLAN enrutables.
4.3.2
Escenario de switch de capa 3

En la figura, el switch de capa 3, D1, está conectado a dos hosts en diferentes VLAN. PC1 está en VLAN 10 y PC2 está en VLAN 20, como se muestra. El switch de capa 3 proporcionará servicios inter-VLAN routing a los dos hosts.

La topología de red física muestra dos PC, un switch y un router. PC1 a la izquierda tiene la dirección IP 192.168.10.10, la dirección del default gateway 192.168.10.1/24, está en VLAN 10 y está conectado el switch en el puerto G1/0/6. PC2 a la derecha tiene la dirección IP 192.168.20.10, la dirección del default gateway 192.168.20.10/24, está en VLAN 20 y está conectado el switch en el puerto G1/0/18.
D1 PC1 PC2 G1/0/6 G1/0/18 192.168.10.10/24
192.168.20.10/24
(VLAN 10)(VLAN 20)Gateway: 192.168.10.1Gateway: 192.168.20.1

La tabla muestra las direcciones IP de cada VLAN.
D1 VLAN IP Addresses
VLAN InterfaceIP Address10192.168.10.1/2420192.168.20.1/24
VLAN Interface	Dirección IP
10	192.168.10.1/24
20	192.168.20.1/24
4.3.3
Configuracion de switch de capa 3

Complete los siguientes pasos para configurar S1 con VLAN y trunking :

Paso 1. Crear las VLAN.

1. Crear las VLANs.

Primero, cree las dos VLAN como se muestra en el ejemplo

D1(config)# vlan 10
D1(config-vlan)# name LAN10
D1(config-vlan)# vlan 20
D1(config-vlan)# name LAN20
D1(config-vlan)# exit
D1(config)#

Paso 2. Crear las interfaces VLAN SVI.

2. Crear las interfaces VLAN SVI.

Configurar el SVI para VLANs 10 y 20 Las direcciones IP configuradas servirán como default gateways para los hosts de las VLAN respectivas. Observe que los mensajes informativos que muestran el protocolo de línea en ambos SVIs cambiaron a funcionales.

D1(config)# interface vlan 10
D1(config-if)# description Default Gateway SVI for 192.168.10.0/24
D1(config-if)# ip add 192.168.10.1 255.255.255.0
D1(config-if)# no shut
D1(config-if)# exit
D1(config)#
D1(config)# int vlan 20
D1(config-if)# description Default Gateway SVI for 192.168.20.0/24
D1(config-if)# ip add 192.168.20.1 255.255.255.0
D1(config-if)# no shut
D1(config-if)# exit
D1(config)#
*Sep 17 13:52:16.053: %LINEPROTO-5-UPDOWN: Line protocol on Interface Vlan10, changed state to up
*Sep 17 13:52:16.160: %LINEPROTO-5-UPDOWN: Line protocol on Interface Vlan20, changed state to up

Paso 3. Configurar puertos de acceso.

3. Configurar puertos de acceso.

A continuación, configure los puertos de acceso que se conectan a los hosts y asígnelos a sus respectivas VLAN.

D1(config)# interface GigabitEthernet1/0/6
D1(config-if)# description Access port to PC1
D1(config-if)# switchport mode access
D1(config-if)# switchport access vlan 10
D1(config-if)# exit
D1(config)#
D1(config)# interface GigabitEthernet1/0/18
D1(config-if)# description Access port to PC2
D1(config-if)# switchport mode access
D1(config-if)# switchport access vlan 20
D1(config-if)# exit

Paso 4. Habilitar IP routing.

4. Habilitar IP routing.

Por último, habilite el enrutamiento IPv4 con el comando de configuración ip routing global para permitir el intercambio de tráfico entre las VLAN 10 y 20. Este comando debe configurarse para habilitar el inter-VAN routing en un switch de capa 3 para IPv4.

D1(config)# ip routing
D1(config)#

Haga clic en cada botón para obtener detalles del paso de configuración.

4.3.4
Verificación Inter-VLAN Routing del switch de capa 3

El Inter-VLAN Routing mediante un switch de capa 3 es más sencillo de configurar que el método router-on-a-stick. Una vez completada la configuración, la configuración se puede verificar probando la conectividad entre los hosts.

Desde un host, compruebe la conectividad con un host de otra VLAN mediante el ping comando. Es una buena idea verificar primero la configuración IP del host actual mediante el comando ipconfig Windows host El resultado confirma la dirección IPv4 y el default gateway de PC1.

C:\Users\PC1> ipconfig
Windows IP Configuration
Ethernet adapter Ethernet0:
  Connection-specific DNS Suffix . :
  Link-local IPv6 Address          : fe80::5c43:ee7c:2959:da68%6
  IPv4 Address                     : 192.168.10.10
  Subnet Mask                      : 255.255.255.0
  Default Gateway                  : 192.168.10.1
C:\Users\PC1> 

A continuación, verifique la conectividad con PC2 mediante el comando host de ping Windows, como se muestra en el ejemplo. El ping resultado confirma correctamente que el enrutamiento entre VLANs está funcionando.

C:\Users\PC1> ping 192.168.20.10
Pinging 192.168.20.10 with 32 bytes of data:
Reply from 192.168.20.10: bytes=32 time<1ms TTL=127
Reply from 192.168.20.10: bytes=32 time<1ms TTL=127
Reply from 192.168.20.10: bytes=32 time<1ms TTL=127
Reply from 192.168.20.10: bytes=32 time<1ms TTL=127
Ping statistics for 192.168.20.10:
    Packets: Sent = 4, Received = 4, Lost = 0 (0% loss),
Approximate round trip times in milli-seconds:
    Minimum = 0ms, Maximum = 0ms, Average = 0ms
C:\Users\PC1>

4.3.5
Enrutamiento en un switch de capa 3

Si se quiere que otros dispositivos de Capa 3 puedan acceder a las VLAN, deben anunciarse mediante enrutamiento estático o dinámico. Para habilitar el enrutamiento en un switch de capa 3, se debe configurar un puerto enrutado.

Un puerto enrutado se crea en un switch de Capa 3 deshabilitando la función switchport de un switch de Capa 2 que está conectado a otro dispositivo de Capa 3. Específicamente, al configurar el comando de configuración de no switchport interfaz en un puerto de Capa 2, se convierte en una interfaz de Capa 3. A continuación, la interfaz se puede configurar con una configuración IPv4 para conectarse a un router u otro switch de capa 3.
4.3.6
Escenario de enrutamiento en un switch de capa 3

En la figura, el switch de capa 3 D1 previamente configurado ahora está conectado a R1. R1 y D1 están ambos en un dominio de protocolo de enrutamiento Open Shortest Path First (OSPF). Supongamos que Inter-VLAN se ha implementado correctamente en D1. La interfaz G0/0/1 de R1 también ha sido configurada y habilitada. Además, R1 está utilizando OSPF para anunciar sus dos redes, 10.10.10.0/24 y 10.20.20.0/24.

La configuración de enrutamientoNote: OSPF se cubre en otro curso. En este módulo, se le darán comandos de configuración OSPF en todas las actividades y evaluaciones. No es necesario que comprenda la configuración para habilitar el enrutamiento OSPF en el switch de capa 3.

La topología de red física muestra dos PC, un switch de capa 3 (D1), un router (R1) y un servidor. PC1 tiene la dirección IP 192.168.10.10, la dirección del default gateway 192.168.10.1/24, está en VLAN 10 y está conectado el switch en el puerto G1/0/6. PC2 tiene la dirección IP 192.168.20.10, la dirección del default gateway 192.168.20.10/24, está en VLAN 20 y está conectado el switch en el puerto G1/0/18. El switch, D1, interfaz G0/0/1 tiene dirección IP 10.10.10.2/24 y se conecta a la interfaz R1, G0/0/1 que tiene dirección IP 10.10.1/24. El router, R1, se conecta al servidor a través de la red 10.10.20.0/24 con el R1 que tiene la dirección ip 10.10.10.1 y el servidor que tiene la dirección ip 10.10.20.254. El router también está ejecutando OSPF.
PC1 PC2 G1/0/6 G1/0/18 192.168.10.10/24 192.168.20.10/24 D1 .2 G0/0/1 G0/0/1 .1 .1 .254 10.10.10.0/24 10.10.20.0/24 R1 Svr OSPF
G0/0/0
(VLAN 10)(VLAN 20)Gateway: 192.168.10.1Gateway: 192.168.20.1
4.3.7
Configuración de enrutamiento en un switch de capa 3

Complete los siguientes pasos para configurar D1 para enrutar con R1:

Paso 1. Configure el puerto enrutado.

1. Configure el puerto enrutado.

Configure G1/0/1 para que sea un puerto enrutado, asígnele una dirección IPv4 y habilítelo.

D1(config)# interface GigabitEthernet1/0/1
D1(config-if)# description routed Port Link to R1
D1(config-if)# no switchport
D1(config-if)# ip address 10.10.10.2 255.255.255.0
D1(config-if)# no shut
D1(config-if)# exit
D1(config)#

Paso 2. Activar el routing.

2. Activar el routing.

Asegúrese de que el enrutamiento IPv4 esté habilitado con el comando de configuración ip routing global.

D1(config)# ip routing
D1(config)#

Paso 3. Configurar el enrutamiento

3. Configurar el enrutamiento.

Configure el protocolo de enrutamiento OSPF para anunciar las redes VLAN 10 y VLAN 20, junto con la red que está conectada a R1. Observe el mensaje informándole de que se ha establecido una adyacencia con R1.

D1(config)# router ospf 10
D1(config-router)# network 192.168.10.0 0.0.0.255 area 0
D1(config-router)# network 192.168.20.0 0.0.0.255 area 0
D1(config-router)# network 10.10.10.0 0.0.0.3 area 0
D1(config-router)# ^Z
D1#
*Sep 17 13:52:51.163: %OSPF-5-ADJCHG: Process 10, Nbr 10.20.20.1 on GigabitEthernet1/0/1 from LOADING to FULL, Loading Done
D1#

Paso 4. Verificar enrutamiento.

4. Verificar enrutamiento.

Verifique la tabla de enrutamiento en D1. Observe que D1 ahora tiene una ruta a la red 10.20.20.0/24.

D1# show ip route | begin Gateway
Gateway of last resort is not set
      10.0.0.0/8 is variably subnetted, 3 subnets, 3 masks
C 10.10.10.0/30 is directly connected, GigabitEthernet1/0/1
L 10.10.10.2/32 is directly connected, GigabitEthernet1/0/1
O 10.20.20.0/24 [110/2] via 10.10.10.1, 00:00:06, GigabitEthernet1/0/1
      192.168.10.0/24 is variably subnetted, 2 subnets, 2 masks
C 192.168.10.0/24 is directly connected, Vlan10
L 192.168.10.1/32 is directly connected, Vlan10
      192.168.20.0/24 is variably subnetted, 2 subnets, 2 masks
C 192.168.20.0/24 is directly connected, Vlan20
L 192.168.20.1/32 is directly connected, Vlan20
D1#

Paso 5. Verificar la conectividad

5. Verificar la conectividad.

En este momento, PC1 y PC2 pueden hacer ping al servidor conectado a R1.

c:Userspc1> ping 10.20.20.254
Pinging 10.20.20.254 with 32 bytes of data: 
Request timed out.
Reply from 10.20.20.254: bytes=32 time<1ms TTL=127
Reply from 10.20.20.254: bytes=32 time<1ms TTL=127
Reply from 10.20.20.254: bytes=32 time<1ms TTL=127
Estadísticas de ping para 10.20.20.254:
    Packets: Sent = 4, Received = 3, Lost = 1 (25% loss).
Approximate round trip times in milli-seconds: 
    Minimum = 1ms, Maximum = 2ms, Average = 1ms 
C:\Users\PC1>
! ==================================================
C:Userspc2> ping 10.20.20.254
Pinging 10.20.20.254 with 32 bytes of data: 
Reply from 10.20.20.254: bytes=32 time<1ms TTL=127
Reply from 10.20.20.254: bytes=32 time<1ms TTL=127
Reply from 10.20.20.254: bytes=32 time<1ms TTL=127
Reply from 10.20.20.254: bytes=32 time<1ms TTL=127
Estadísticas de ping para 10.20.20.254:
    Packets: Sent = 4, Received = 4, Lost = 0 (0% loss).
Approximate round trip times in milli-seconds: 
    Minimum = 1ms, Maximum = 2ms, Average = 1ms
C:\Users\PC2 > 

Haga clic en cada botón para obtener detalles del paso de configuración.

Resolución de problemas de Inter-VLAN routing
4.4.1
Problemas comunes de Inter-VLAN routing

Ya sabe que cuando configure y verifique, también debe ser capaz de solucionar problemas. En este tema se describen algunos problemas comunes de red asociados con el Inter-VLAN routing

Hay varias razones por las que una configuración entre VLANs puede no funcionar. Todos están relacionados con problemas de conectividad. En primer lugar, compruebe la capa física para resolver cualquier problema en el que un cable pueda estar conectado al puerto incorrecto. Si las conexiones son correctas, utilice la lista de la tabla para otras razones comunes por las que puede fallar la conectividad entre VLAN.
Tipo de problema Cómo solucionar Cómo verificar las VLAN faltantes Crear (o volver a crear) la VLAN si no existe. Asegúrese de que el puerto de host está asignado a la VLAN correcta vlan [brief] show interfaces switchport Ping Problemas del puerto troncal del switch los enlaces troncales están configurados correctamente. Asegúrese de que el puerto es un puerto troncal y está activado.show interface trunk show running-config Switch Access Port IssuesAssign correct VLAN to access port. Asegúrese de que el puerto es un puerto de acceso y está activado. Host es configurado incorrectamente en la subred incorrecta.show interfaces switchport show running-config interface ipconfig Router Configuration IssuesRouter subinterfaz dirección IPv4 está configurada incorrectamente. La subinterfaz del router es asignado al ID de VLAN. Show ip interface brief show interfaces
Tipo de problema 	Cómo arreglar 	Cómo verificar
VLAN faltantes	

    Cree (o vuelva a crear) la VLAN si no existe.
    Asegúrese de que el puerto host está asignado a la VLAN correcta.

	

show vlan [brief]
show interfaces switchport
ping

Problemas con el puerto troncal del switch	

    Asegúrese de que los enlaces troncales estén configurados correctamente.
    Asegúrese de que el puerto es un puerto troncal y está habilitado.

	

show interfaces trunk
show running-config

Problemas en los puertos de acceso de switch	

    Asigne el puerto a la VLAN correcta.
    Asegúrese de que el puerto es un puerto de acceso y está habilitado.
    El host está configurado incorrectamente en la subred incorrecta.

	

show interfaces switchport
show running-config interface
ipconfig

Temas de configuración del router	

    La dirección IPv4 de la subinterfaz del router está configurada incorrectamente.
    La subinterfaz del router se asigna al ID de VLAN.

	

show ip interface brief
show interfaces

4.4.2
Escenario de resolución de problemas de Inter-VLAN Routing

Los ejemplos de algunos de estos problemas de Inter-VLAN Routing ahora se tratarán con más detalle.

Esta topología se utilizará para todos estos problemas.

La topología de red física muestra dos PC, dos switches y un router. PC1 tiene la dirección IP 192.168.10.10/24, un default gateway de 192.168.10.1 y está en VLAN 10. PC2 tiene la dirección IP 192.168.20.10/24, un default gateway 192.168.20.1 y está en VLAN 20. PC1 se conecta al switch S1 en el puerto F0/6. PC2 se conecta al switch S2 en el puerto F0/18. El switch S1 y el switch S2 están interconectados entre sí a través de un enlace troncal en el puerto F0/1. El switch S1 está conectado al router R1 a través de un enlace troncal en el puerto del switch F0/5 que se conecta a las interfaces G0/0/1 en R1. La dirección IP de administración en S1 es 192.168.99.2/24. La dirección IP de administración en S1 es 192.168.99.3/24.
R1 S1 S2 PC1 PC2 G0/0/1 192.168.99.2/24 F0/6 F0/18 F0/1 F0/1 192.168.99.3/24 192.168.10.10/24 192.168.20.10/24
F0/5
Enlaces troncalesGateway: 192.168.10.1
VLAN 10Gateway: 192.168.20.1
VLAN 20

La información de direccionamiento VLAN e IPv4 para R1 se muestra en la tabla.
Router R1 Subinterfaces
SubinterfaceVLANIP AddressG0/0/0.1010192.168.10.1/24G0/0/0.2020192.168.20.1/24G0/0/0.3099192.168.99.1/24
subinterfaz 	VLAN 	Dirección IP
G0/0/0.10	10	192.168.10.1/24
G0/0/0.20	20	192.168.20.1/24
G0/0/0.30	99	192.168.99.1/24
4.4.3
VLAN faltantes

Un problema de conectividad entre VLAN podría deberse a la falta de una VLAN. La VLAN podría faltar si no se creó, se eliminó accidentalmente o no se permite en el enlace troncal.

Por ejemplo, PC1 está conectado actualmente a la VLAN 10, como se muestra en el ejemplo del show vlan brief comando.

S1# show vlan brief
VLAN Name                             Status    Ports
---- -------------------------------- --------- -------------------------------
1    default                          active    Fa0/2, Fa0/3, Fa0/4, Fa0/7
                                                Fa0/8, Fa0/9, Fa0/10, Fa0/11
                                                Fa0/12, Fa0/13, Fa0/14, Fa0/15
                                                Fa0/16, Fa0/17, Fa0/18, Fa0/19
                                                Fa0/20, Fa0/21, Fa0/22, Fa0/23
                                                Fa0/24, Gi0/1, Gi0/2
10   LAN10                            active    Fa0/6
20   LAN20                            active
99   Management                       active
1002 fddi-default                     act/unsup
1003 token-ring-default               act/unsup
1004 fddinet-default                  act/unsup
1005 trnet-default                    act/unsup
S1#

Ahora suponga que la VLAN 10 se elimina accidentalmente, como se muestra en el siguiente resultado.

S1(config)# no vlan 10
S1(config)# do show vlan brief
VLAN Name                             Status    Ports
---- -------------------------------- --------- -------------------------------
1    default                          active    Fa0/2, Fa0/3, Fa0/4, Fa0/7
                                                Fa0/8, Fa0/9, Fa0/10, Fa0/11
                                                Fa0/12, Fa0/13, Fa0/14, Fa0/15
                                                Fa0/16, Fa0/17, Fa0/18, Fa0/19
                                                Fa0/20, Fa0/21, Fa0/22, Fa0/23
                                                Fa0/24, Gi0/1, Gi0/2
20   LAN20                            active
99   Management                       active
1002 fddi-default                     act/unsup
1003 token-ring-default               act/unsup
1004 fddinet-default                  act/unsup
1005 trnet-default                    act/unsup
S1(config)#

Observe que ahora falta VLAN 10 en el resultado Observe también que el puerto Fa0/6 no se ha reasignado a la VLAN predeterminada. Cuando elimina una VLAN, cualquier puerto asignado a esa VLAN queda inactivo. Permanecen asociados con la VLAN (y, por lo tanto, inactivos) hasta que los asigne a una nueva VLAN o vuelva a crear la VLAN que falta.

Utilice el show interface comando switchport interface-id para verificar la pertenencia a VLAN.

S1(config)# do show interface fa0/6 switchport
Name: Fa0/6
Switchport: Enabled
Administrative Mode: static access
Operational Mode: static access
Administrative Trunking Encapsulation: dot1q
Operational Trunking Encapsulation: native
Negotiation of Trunking: Off
Access Mode VLAN: 10 (Inactive)
Trunking Native Mode VLAN: 1 (default)
Administrative Native VLAN tagging: enabled
Voice VLAN: none
(Output omitted)

Si se vuelve a crear la VLAN que falta, se reasignarán automáticamente los hosts a ella, como se muestra en el siguiente resultado.

S1(config)# vlan 10
S1(config-vlan)# do show vlan brief
VLAN Name                             Status    Ports
---- -------------------------------- --------- -------------------------------
1    default                          active    Fa0/2, Fa0/3, Fa0/4, Fa0/7
                                                Fa0/8, Fa0/9, Fa0/10, Fa0/11
                                                Fa0/12, Fa0/13, Fa0/14, Fa0/15
                                                Fa0/16, Fa0/17, Fa0/18, Fa0/19
                                                Fa0/20, Fa0/21, Fa0/22, Fa0/23
                                                Fa0/24, Gi0/1, Gi0/2
20   LAN20                            active
99   Management                       active
1002 fddi-default                     act/unsup
1003 token-ring-default               act/unsup
1004 fddinet-default                  act/unsup
1005 trnet-default                    act/unsup
S1(config-vlan)#

Observe que la VLAN no se ha creado como se esperaba. La razón se debe a que debe salir del modo de subconfiguración de VLAN para crear la VLAN, como se muestra en el siguiente resultado.

S1(config-vlan)# exit
S1(config)# vlan 10
S1(config)# do show vlan brief
VLAN Name                             Status    Ports
---- -------------------------------- --------- -------------------------------
1    default                          active    Fa0/2, Fa0/3, Fa0/4, Fa0/7
                                                Fa0/8, Fa0/9, Fa0/10, Fa0/11
                                                Fa0/12, Fa0/13, Fa0/14, Fa0/15
                                                Fa0/16, Fa0/17, Fa0/18, Fa0/19
                                                Fa0/20, Fa0/21, Fa0/22, Fa0/23
                                                Fa0/24, Gi0/1, Gi0/2
10   VLAN0010                         active    Fa0/6
20   LAN20                            active
99   Management                       active
1002 fddi-default                     act/unsup
1003 token-ring-default               act/unsup
1004 fddinet-default                  act/unsup
1005 trnet-default                    act/unsup
S1(config)#

Ahora observe que la VLAN está incluida en la lista y que el host conectado a Fa0/6 está en la VLAN 10.
4.4.4
Problemas con el puerto troncal del switch

Otro problema para el enrutamiento entre VLAN incluye puertos de switch mal configurados. En una solución interVLAN heredada, esto podría deberse a que el puerto del router de conexión no está asignado a la VLAN correcta.

Sin embargo, con una solución router-on-a-stick, la causa más común es un puerto troncal mal configurado.

Por ejemplo, suponga que PC1 pudo conectarse a hosts de otras VLAN hasta hace poco. Un vistazo rápido a los registros de mantenimiento reveló que recientemente se accedió al switch S1 Capa 2 para el mantenimiento rutinario. Por lo tanto, sospecha que el problema puede estar relacionado con ese switch.

La topología de red física muestra dos PC, dos switches y un router. PC1 tiene la dirección IP 192.168.10.10/24, un default gateway de 192.168.10.1 y está en VLAN 10. PC2 tiene la dirección IP 192.168.20.10/24, un default gateway 192.168.20.1 y está en VLAN 20. PC1 se conecta al switch S1 en el puerto F0/6. PC2 se conecta al switch S2 en el puerto F0/18. El switch S1 y el switch S2 están interconectados entre sí a través de un enlace troncal en el puerto F0/1. El switch S1 está conectado al router R1 a través de un enlace troncal en el puerto del switch F0/5 que se conecta a las interfaces G0/0/1 en R1. La dirección IP de administración en S1 es 192.168.99.2/24. La dirección IP de administración en S1 es 192.168.99.3/24.
R1 S1 S2 PC1 PC2 G0/0/1 192.168.99.2/24 F0/6 F0/18 F0/1 F0/1 192.168.99.3/24 192.168.10.10/24 192.168.20.10/24
F0/5
Enlaces troncalesGateway: 192.168.10.1
VLAN 10Gateway: 192.168.20.1
VLAN 20

En S1, verifique que el puerto que se conecta a R1 (es decir, F0/5) esté configurado correctamente como enlace troncal utilizando el show interfaces trunk comando, como se muestra.

S1# show interfaces trunk
Port        Mode             Encapsulation  Status        Native vlan
Fa0/1       on               802.1q         trunking      1
Port        Vlans allowed on trunk
Fa0/1       1-4094
Port        Vlans allowed and active in management domain
Fa0/1       1,10,20,99
Port        Vlans in spanning tree forwarding state and not pruned
Fa0/1       1,10,20,99
S1#

El puerto Fa0/5 que conecta a R1 falta misteriosamente en el resultado. Verifique la configuración de la interfaz mediante el show running-config interface fa0/5 comando, como se muestra.

S1# show running-config | include interface fa0/5
Building configuration...
Current configuration : 96 bytes
!
interface FastEthernet0/5
 description Trunk link to R1
 switchport mode trunk
 shutdown
end
S1#

Como pueden ver, el puerto fue apagado accidentalmente. Para corregir el problema, vuelva a habilitar el puerto y verifique el estado de enlace troncal, como se muestra en el ejemplo.

S1(config)# interface fa0/5
S1(config-if)# no shut
S1(config-if)#
*Mar  1 04:46:44.153: %LINK-3-UPDOWN: Interface FastEthernet0/5, changed state to up
S1(config-if)#
*Mar  1 04:46:47.962: %LINEPROTO-5-UPDOWN: Line protocol on Interface FastEthernet0/5, changed state to up
S1(config-if)# do show interface trunk
Port        Mode             Encapsulation  Status        Native vlan
Fa0/1       on               802.1q         trunking      1
Fa0/5       on               802.1q         trunking      1
Port        Vlans allowed on trunk
Fa0/1       1-4094
Fa0/5       1-4094
Port        Vlans allowed and active in management domain
Fa0/1       1,10,20,99
Fa0/5       1,10,20,99
Port        Vlans in spanning tree forwarding state and not pruned
Fa0/1       1,10,20,99
Fa0/1       1,10,20,99
S1(config-if)#

Para reducir el riesgo de una falla en el enlace entre switch es que interrumpa el inter-VLAN routing, el diseño de red debe contar con enlaces redundantes y rutas alternativas.
4.4.5
Problemas en los puertos de acceso de switch

Cuando sospeche que hay un problema con una configuración del switch, utilice los distintos comandos de verificación para examinar la configuración e identificar el problema.

Supongamos que PC1 tiene la dirección IPv4 correcta y el default gateway, pero no es capaz de ping su propio default gateway PC1 se supone que debe estar conectado a un puerto VLAN 10.

La topología de red física muestra dos PC, dos switches y un router. PC1 tiene la dirección IP 192.168.10.10/24, un default gateway de 192.168.10.1 y está en VLAN 10. PC2 tiene la dirección IP 192.168.20.10/24, un default gateway 192.168.20.1 y está en VLAN 20. PC1 se conecta al switch S1 en el puerto F0/6. PC2 se conecta al switch S2 en el puerto F0/18. El switch S1 y el switch S2 están interconectados entre sí a través de un enlace troncal en el puerto F0/1. El switch S1 está conectado al router R1 a través de un enlace troncal en el puerto del switch F0/5 que se conecta a las interfaces G0/0/1 en R1. La dirección IP de administración en S1 es 192.168.99.2/24. La dirección IP de administración en S1 es 192.168.99.3/24.
R1 S1 S2 PC1 PC2 G0/0/1 192.168.99.2/24 F0/6 F0/18 F0/1 F0/1 192.168.99.3/24 192.168.10.10/24 192.168.20.10/24
F0/5
Enlaces troncalesGateway: 192.168.10.1
VLAN 10Gateway: 192.168.20.1
VLAN 20

Verifique la configuración del puerto en S1 mediante el show interfaces comando switchport interface-id.

S1# show interface fa0/6 switchport
Name: Fa0/6
Switchport: Enabled
Administrative Mode: static access
Operational Mode: static access
Administrative Trunking Encapsulation: dot1q
Operational Trunking Encapsulation: native
Negotiation of Trunking: Off
Access Mode VLAN: 1 (default)
Trunking Native Mode VLAN: 1 (default)
Administrative Native VLAN tagging: enabled
Voice VLAN: none

El puerto Fa0/6 se ha configurado como un puerto de acceso como se indica en «acceso estático». Sin embargo, parece que no se ha configurado para estar en VLAN 10. Verifique la configuración de la interfaz.

S1# show running-config interface fa0/6
Building configuration...
Current configuration : 87 bytes
!
interface FastEthernet0/6
 description PC-A access port
 switchport mode access
end
S1#

Asigne el puerto Fa0/6 a la VLAN 10 y verifique la asignación del puerto.

S1# configure terminal
S1(config)# interface fa0/6
S1(config-if)# switchport access vlan 10
S1(config-if)# 
S1(config-if)# do show interface fa0/6 switchport
Name: Fa0/6
Switchport: Enabled
Administrative Mode: static access
Operational Mode: static access
Administrative Trunking Encapsulation: dot1q
Operational Trunking Encapsulation: native
Negotiation of Trunking: Off
Access Mode VLAN: 10 (VLAN0010)
Trunking Native Mode VLAN: 1 (default)
Administrative Native VLAN tagging: enabled
Voice VLAN: none
(Output omitted)

PC1 ahora puede comunicarse con hosts de otras VLAN.
4.4.6
Temas de configuración del router

Los problemas de configuración del router-on-a-stick suelen estar relacionados con configuraciones incorrectas de la subinterfaz. Por ejemplo, se configuró una dirección IP incorrecta o se asignó un ID de VLAN incorrecto a la subinterfaz.

Por ejemplo, R1 debería proporcionar inter-VLAN routing para los usuarios de VLAN 10, 20 y 99. Sin embargo, los usuarios de VLAN 10 no pueden llegar a ninguna otra VLAN.

La topología de red física muestra dos PC, dos switches y un router. PC1 tiene la dirección IP 192.168.10.10/24, un default gateway de 192.168.10.1 y está en VLAN 10. PC2 tiene la dirección IP 192.168.20.10/24, un default gateway 192.168.20.1 y está en VLAN 20. PC1 se conecta al switch S1 en el puerto F0/6. PC2 se conecta al switch S2 en el puerto F0/18. El switch S1 y el switch S2 están interconectados entre sí a través de un enlace troncal en el puerto F0/1. El switch S1 está conectado al router R1 a través de un enlace troncal en el puerto del switch F0/5 que se conecta a las interfaces G0/0/1 en R1. La dirección IP de administración en S1 es 192.168.99.2/24. La dirección IP de administración en S1 es 192.168.99.3/24.
R1 S1 S2 PC1 PC2 G0/0/1 192.168.99.2/24 F0/6 F0/18 F0/1 F0/1 192.168.99.3/24 192.168.10.10/24 192.168.20.10/24
F0/5
Enlaces troncalesGateway: 192.168.10.1
VLAN 10Gateway: 192.168.20.1
VLAN 20

Verificó el enlace troncal del switch y todo parece estar en orden. Verificar el estatus de las interfaces usando el show ip interface brief comando

R1# show ip interface brief
Interface              IP-Address      OK? Method Status                Protocol
GigabitEthernet0/0/0   unassigned      YES unset  administratively down down
GigabitEthernet0/0/1   unassigned      YES unset  up                    up
Gi0/0/1.10             192.168.10.1    YES manual up                    up
Gi0/0/1.20             192.168.20.1    YES manual up                    up
Gi0/0/1.99             192.168.99.1    YES manual up                    up
Serial0/1/0            unassigned      YES unset  administratively down down
Serial0/1/1            unassigned      YES unset  administratively down down
R1#

A las subinterfaces se les han asignado las direcciones IPv4 correctas y están operativas.

Compruebe en qué VLAN se encuentra cada una de las subinterfaces. Para ello, el show interfaces comando es útil, pero genera una gran cantidad de resultados adicionales no requeridos. El resultado del comando se puede reducir utilizando filtros de comando IOS como se muestra en el ejemplo.

R1# show interfaces | include Gig|802.1Q
GigabitEthernet0/0/0 is administratively down, line protocol is down
GigabitEthernet0/0/1 is up, line protocol is up
  Encapsulation 802.1Q Virtual LAN, Vlan ID  1., loopback not set
GigabitEthernet0/0/1.10 is up, line protocol is up
  Encapsulation 802.1Q Virtual LAN, Vlan ID  100.
GigabitEthernet0/0/1.20 is up, line protocol is up
  Encapsulation 802.1Q Virtual LAN, Vlan ID  20.
GigabitEthernet0/0/1.99 is up, line protocol is up
  Encapsulation 802.1Q Virtual LAN, Vlan ID  99.
R1#

El símbolo de tubería (|) junto con algunas palabras clave de selección es un método útil para ayudar a filtrar el resultado del comando. En este ejemplo, la palabra clave se include utilizó para identificar que sólo se mostrarán las líneas que contienen las letras «Gig» o «802.1Q». Debido a la forma en que se enumera naturalmente la show interface salida, el uso de estos filtros genera una lista condensada de interfaces y sus VLAN asignadas.

Observe que la interfaz G0/0/1.10 se ha asignado incorrectamente a la VLAN 100 en lugar de a la VLAN 10. Esto se confirma mirando la configuración de la subinterfaz GigabitEthernet R1 0/0/1.10, como se muestra.

R1# show running-config interface g0/0/1.10
Building configuration...
Current configuration : 146 bytes
!
interface GigabitEthernet0/0/1.10
 description Default Gateway for VLAN 10
 encapsulation dot1Q 100
 ip address 192.168.10.1 255.255.255.0
end
R1#

Para corregir este problema, configure la subinterfaz G0/0/1.10 para que esté en la VLAN correcta mediante el comando encapsulation dot1q 10 en el modo de configuración de subinterfaz.

R1# conf t
Enter configuration commands, one per line.  End with CNTL/Z.
R1(config)# interface gigabitEthernet 0/0/1.10
R1(config-subif)# encapsulation dot1Q 10
R1(config-subif)# end
R1#
R1# show interfaces | include Gig|802.1Q
GigabitEthernet0/0/0 is administratively down, line protocol is down
GigabitEthernet0/0/1 is up, line protocol is up
  Encapsulation 802.1Q Virtual LAN, Vlan ID  1., loopback not set
GigabitEthernet0/0/1.10 is up, line protocol is up
  Encapsulation 802.1Q Virtual LAN, Vlan ID  10.
GigabitEthernet0/0/1.20 is up, line protocol is up
  Encapsulation 802.1Q Virtual LAN, Vlan ID  20.
GigabitEthernet0/0/1.99 is up, line protocol is up
R1#  

Una vez asignada la subinterfaz a la VLAN correcta, los dispositivos en esa VLAN pueden acceder a ella, y el router puede realizar inter-VLAN routing.

Con la correcta verificación, los problemas de configuración del router se resuelven rápidamente, lo que permite que el inter-VLAN routing funcione de forma adecuada.
4.4.7
Compruebe su comprensión - Solucionar problemas de inter-VLAN routing.

Elija la MEJOR repuesta para las siguientes preguntas y compruebe su conocimiento sobre inter-VLAN routing.

    Está solucionando un problema de inter-VLAN routing en un router y debe verificar que las subinterfaces estén en la tabla de enrutamiento. ¿Qué comando de solución de problemas de enrutamiento entre VLAN utilizaría para hacer esto?

Está solucionando un problema de inter-VLAN routing en un switch y debe verificar la lista de VLAN y sus puertos asignados. ¿Qué comando de solución de problemas de enrutamiento entre VLAN utilizaría para hacer esto?

Está solucionando un problema de inter-VLAN routing en un router y necesita verificar el estado de un puerto de acceso y su VLAN en modo de acceso. ¿Qué comando de solución de problemas usaría para hacer esto?

Está solucionando un problema de inter-VLAN routing en un router y necesita verificar el estado y la dirección IP de todas las interfaces en un formato condensado. ¿Qué comando de solución de problemas de enrutamiento entre VLAN utilizaría para hacer esto?


4.5.3
¿Qué aprenderé en este módulo?

Funcionamiento del routing entre redes VLAN

Los hosts de una VLAN no pueden comunicarse con los hosts de otra VLAN a menos que haya un router o un switch de capa 3 para proporcionar servicios de enrutamiento. Inter-VLA routing es el proceso de reenviar el tráfico de red de una VLAN a otra VLAN. Tres opciones incluyen heredado, router-on-a-stick y switch de capa 3 con SVIs. Heredado utiliza un router con múltiples interfaces Ethernet. Cada interfaz del router estaba conectada a un puerto del switch en diferentes VLAN . Requerir una interfaz física del router por VLAN agota rápidamente la capacidad de la interfaz física del router El método ‘router-on-a-stick’ inter-VLAN routing solo requiere una interfaz Ethernet física para enrutar el tráfico entre varias VLAN de una red. Una interfaz Ethernet del router Cisco IOS se configura como un troncal 802.1Q y se conecta a un puerto troncal en un switch de capa 2. La interfaz del router se configura mediante subinterfaces para identificar VLAN enrutables. Las subinterfaces son interfaces virtuales basadas en software, asociadas con una única interfaz física. El método moderno es el enrutamiento entre VLAN en un switch de capa 3 mediante SVIs. El SVI se crea para una VLAN que existe en el switch. El SVI realiza las mismas funciones para la VLAN que una interfaz del router. Proporciona procesamiento de capa 3 para los paquetes que se envían ao desde todos los puertos de conmutador asociados con esa VLAN.

Routing entre VLAN con router-on-a-stick

Para configurar un switch con VLAN y enlaces troncales, realice los siguientes pasos: cree y asigne un nombre a las VLAN, cree la interfaz de administración, configure los puertos de acceso y configure los puertos de enlace troncal. Para el método de router-on-a-stick, se requieren subinterfaces configuradas para cada VLAN que se pueda enrutar. Se crea una subinterfaz mediante el comando interface interface_id subinterface_id global configuration mode. Es necesario asignar una dirección IP a cada subinterfaz del router en una subred única para que se produzca el routing. Cuando se han creado todas las subinterfaces, la interfaz física debe habilitarse mediante el comando de configuración de no shutdown interfaz. Desde un host, compruebe la conectividad con un host de otra VLAN mediante el ping comando. ping Utilícelo para verificar la conectividad con el host y el switch. Para verificar y solucionar problemas utilice los comandos, ,show ip route, show ip interface brief, show interfaces y show interfaces trunk

Inter-VLAN Routing usando switches de capa 3

Las LAN de campus empresariales utilizan switches de capa 3 para proporcionar enrutamiento entre VLAN. Los switches de capa 3 utilizan switching basado en hardware para lograr velocidades de procesamiento de paquetes más altas que los routers. Las capacidades de un switch de Capa 3 incluyen el enrutamiento de una VLAN a otra utilizando múltiples interfaces virtuales conmutadas (SVI) y la conversión de un puerto de switch de Capa 2 a una interfaz de Capa 3 (es decir, un puerto enrutado). Para proporcionar enrutamiento entre VLAN, los switches de capa 3 utilizan SVIs. Los SVIs se configuran utilizando el mismo comando interface vlan vlan-id utilizado para crear el SVI de administración en un switch de capa 2. Se debe crear un SVI de Capa 3 para cada una de las VLAN enrutables. Para configurar un switch con VLAN y trunking, siga los pasos siguientes: cree las VLAN, cree las interfaces VLAN SVI, configure los puertos de acceso y habilite el enrutamiento IP. Desde un host, compruebe la conectividad con un host de otra VLAN mediante el ping comando. A continuación, compruebe la conectividad con el host mediante el comando host de ping Windows. Las VLAN deben anunciarse mediante enrutamiento estático o dinámico. Para habilitar el enrutamiento en un switch de capa 3, se debe configurar un puerto enrutado. Un puerto enrutado se crea en un switch de Capa 3 deshabilitando la función switchport de un switch de Capa 2 que está conectado a otro dispositivo de Capa 3. La interfaz se puede configurar con una configuración IPv4 para conectarse a un router u otro switch de capa 3. Para configurar un switch de capa 3 para enrutar con un router, siga estos pasos: configure el puerto enrutado, habilite el enrutamiento, configure el enrutamiento, verifique el enrutamiento y verifique la conectividad.

Resolución de problemas de Inter-VLAN routing

Hay varias razones por las que una configuración entre van puede no funcionar . Todos están relacionados con problemas de conectividad, como las VLAN faltantes, los problemas del puerto troncal del switch, los problemas del puerto de acceso del switch y los problemas de configuración del router. Podría faltar una VLAN si no se creó, se eliminó accidentalmente o no se permite en el enlace troncal. Otro problema para el enrutamiento entre VLAN incluye puertos de switch mal configurados. En una solución interVLAN heredada, podría producirse un puerto de switch mal configurado cuando el puerto del router de conexión no está asignado a la VLAN correcta. Con una solución router-on-a-stick, la causa más común es un puerto troncal mal configurado. Cuando se sospecha un problema con una configuración del puerto de acceso del switch, utilice los ping comandos show interfaces interface-id switchport y _interface-para identificar el problema. Los problemas de configuración del router con configuraciones de router-on-a-stick suelen estar relacionados con configuraciones erróneas de subinterfaz. Verificar el estatus de las interfaces usando el show ip interface brief comando
4.5.4
Prueba de módulo - Inter-VLAN Routing

    Un PC es acceder a un servidor web en otra red. ¿Qué método interVLAN proporcionará el ancho de banda más alto en la capa 3 y también proporcionará una puerta de enlace predeterminada para el PC?

¿Qué método escalable debe implementarse para proporcionar enrutamiento entre VLAN en una red de switch con más de 1000 VLAN?

Cuando se configura un router como parte de una topología de routing de router-on-a-stick entre VLAN, ¿dónde se debería asignar la dirección IP?

Una universidad pequeña utiliza VLAN 10 para la red de aulas y VLAN 20 para la red de oficinas. ¿Qué se necesita para habilitar la comunicación entre estas dos VLAN mientras se utiliza el inter-VLAN routing heredado?

¿Cuál es la desventaja de utilizar switches multicapa para el inter-VLAN routing?

¿Qué tipo de diseño de comunicación entre VLAN requiere la configuración de múltiples subinterfaces?

¿Cuál es la desventaja de usar el router-on-a-stick inter-VLAN routing?

¿Cuál es el significado del número 10 en el comando de subinterfaz del encapsulation dot1Q 10 native router?

Al configurar el inter-VLAN routing en un switch multicapa, un administrador de red emite el no switchport comando en una interfaz que está conectada a otro switch. ¿Cuál es el objetivo de este comando?

Un administrador de red ingresa la siguiente secuencia de comandos en un switch Cisco 3560. ¿Cuál es el objetivo de estos comandos?

Switch(config)# interface gigabitethernet 0/1
Switch(config-if)# no switchport

¿Qué modo operativo se debe utilizar en un puerto de switch para conectarlo a un router para el router-on-a-stick inter-VLAN routing?

¿Qué oración describe correctamente el método inter-VLAN routing con SVI?

¿Cómo se enruta el tráfico entre varias VLAN en un switch multicapa?

¿Qué se requiere para realizar el router-on-a-stick inter-VLAN routing?

Un administrador solucionaba problemas de una topología del router-on-a-stick y concluyó que el problema estaba relacionado con la configuración de las VLAN en las subinterfaces del router. ¿Cuáles son los dos comandos que el administrador puede utilizar en el router para identificar el problema? (Elija dos opciones).

5 STP Concepts

Introducción
5.0.1
¿Por qué debería tomar este módulo?

Bienvenido a STP Concepts!

Una red de nivel 2 bien diseñada tendrá conmutadores y rutas redundantes para garantizar que si un conmutador se apaga, otra ruta a otro conmutador esté disponible para reenviar datos. Los usuarios de la red no experimentarían ninguna interrupción del servicio. La redundancia en un diseño de red jerárquica soluciona el problema de un solo punto de falla, pero puede crear un tipo diferente de problema llamado bucles de Capa 2.

¿Qué es un bucle? Imagina que estás en un concierto. El micrófono del cantante y el altavoz amplificado pueden, por diversas razones, crear un bucle de retroalimentación. Lo que se oye es una señal amplificada del micrófono que sale del altavoz que luego es recogido de nuevo por el micrófono, amplificado más y pasado de nuevo a través del altavoz. El sonido rápidamente se vuelve muy fuerte, desagradable y hace que sea imposible escuchar música real. Esto continúa hasta que se corta la conexión entre el micrófono y el altavoz.

Un bucle de capa 2 crea un caos similar en una red. Puede suceder muy rápidamente y hacer imposible el uso de la red. Hay algunas formas comunes de crear y propagar un bucle de Capa 2. El protocolo de árbol de expansión (STP) está diseñado específicamente para eliminar los bucles de capa 2 en la red. Este módulo analiza las causas de los bucles y los diversos tipos de protocolos de árbol de expansión. Incluye un vídeo y una actividad Packet Tracer para ayudarle a entender los conceptos STP.
5.0.2
¿Qué aprenderé en este módulo?

Título del módulo: STP Conceptos

Objetivo del módulo: Explique cómo STP permite la redundancia en una red de capa 2.
Leyenda de la tabla
Título del tema 	Objetivo del tema
Propósito del STP 	Explique los problemas comunes en una red conmutada redundante L2.
Funcionamientos del STP 	Explicar cómo opera STP en una red conmutada simple.
Evolución del STP 	Explique la forma en que funciona PVST+ rápido.

Propósito del STP
5.1.1
Redundancia en redes conmutadas de capa 2

En este tema se tratan las causas de los bucles en una red de capa 2 y se explica brevemente cómo funciona el protocolo de árbol de expansión. La redundancia es una parte importante del diseño jerárquico para eliminar puntos únicos de falla y prevenir la interrupción de los servicios de red para los usuarios. Las redes redundantes requieren la adición de rutas físicas, pero la redundancia lógica también debe formar parte del diseño. Tener rutas físicas alternativas para que los datos atraviesen la red permite que los usuarios accedan a los recursos de red, a pesar de las interrupciones de la ruta. Sin embargo, las rutas redundantes en una red Ethernet conmutada pueden causar bucles físicos y lógicos en la capa 2.

Las LAN Ethernet requieren una topología sin bucles con una única ruta entre dos dispositivos. Un bucle en una LAN Ethernet puede provocar una propagación continua de tramas Ethernet hasta que un enlace se interrumpe y interrumpa el bucle.
5.1.2
Protocolo de árbol de extensión

El protocolo de árbol de expansión (STP) es un protocolo de red de prevención de bucles que permite redundancia mientras crea una topología de capa 2 sin bucles. IEEE 802.1D es el estándar original IEEE MAC Bridging para STP.

Haga clic en Reproducir en la figura para ver una animación de STP en acción.

The figure is an animation showing 4 p c s and 3 switches. The three switches are connected to each other in a triangle. three pcs are connected to s 2. p c 1 sends a broadcast frame. it is received by s 2. s 2 forwards teh broadcast out all ports except the originating port and the blocked port to s 3. the two other p cs and s1 receive the frame. s 1 forwards the broadcast out all ports except the originating port. the frame is received by p c 4 and s 3. s 3 forwards the frame back to s 2. s 2 drops the frame because it received it on a blocked port.
STP Normal Operation
La PC1 envía una trama de difusión.
El S2 reenvía la difusión por todos los puertos, excepto el puerto de origen y el puerto bloqueado.
El S1 reenvía la difusión por todos los puertos, excepto el puerto de origen.
El S3 recibe la trama y la reenvía al S2.
El S2 descarta la trama, ya que la recibió en un puerto bloqueado.
Enlace troncal 2
Enlace troncal1
Enlace troncal 3
5.1.3
Recalcular STP

Haga clic en Reproducir en la siguiente figura para ver una animación del recálculo de STP cuando ocurre una falla.

La figura es una animación con la misma topología que en la animación anterior. En la animación, el enlace troncal entre S2 y S1 ha fallado. S2 desbloquea el puerto para Trunk 2. La PC1 envía una trama de difusión al S2. S2 reenvía la transmisión a todos los puertos del conmutador, excepto el puerto de origen y el enlace fallido para el Troncal 1. El S3 reenvía la difusión por todos los puertos de switch disponibles, excepto el puerto de origen. El S1 reenvía la difusión solo por F0/3.
STP Compensates for Network Failure
El enlace troncal entre el S2 y el S1 falló.
El S2 desbloquea el puerto para Enlace_troncal2.
La PC1 envía una trama de difusión al S2.
El S2 reenvía la difusión por todos los puertos del switch, excepto el puerto de origen y el enlace que falló para Enlace_troncal1.
El S3 reenvía la difusión por todos los puertos de switch disponibles, excepto el puerto de origen.
El S1 reenvía la difusión solo por F0/3.
Enlace troncal 2
Enlace troncal1
Enlace troncal 3
5.1.4
Problemas con los vínculos de switch redundantes

La redundancia de ruta proporciona múltiples servicios de red al eliminar la posibilidad de un solo punto de falla. Cuando existen múltiples rutas entre dos dispositivos en una red Ethernet, y no hay implementación de árbol de expansión en los conmutadores, se produce un bucle de capa 2. Un bucle de capa 2 puede provocar inestabilidad en la tabla de direcciones MAC, saturación de enlaces y alta utilización de CPU en conmutadores y dispositivos finales, lo que hace que la red se vuelva inutilizable.

A diferencia de los protocolos de Capa 3, IPv4 e IPv6, Layer 2 Ethernet no incluye un mecanismo para reconocer y eliminar tramas de bucle sin fin. Tanto IPv4 como IPv6 incluyen un mecanismo que limita la cantidad de veces que un dispositivo de red de Capa 3 puede retransmitir un paquete. Un router disminuirá el TTL (Tiempo de vida) en cada paquete IPv4 y el campo Límite de saltos en cada paquete IPv6. Cuando estos campos se reducen a 0, un router dejará caer el paquete. Los switches Ethernet y Ethernet no tienen un mecanismo comparable para limitar el número de veces que un switches retransmite una trama de Capa 2. STP fue desarrollado específicamente como un mecanismo de prevención de bucles para Ethernet de Capa 2.
5.1.5
Bucles de la capa 2

Sin STP habilitado, se pueden formar bucles de capa 2, lo que hace que las tramas de difusión, multidifusión y unidifusión desconocidos se reproduzcan sin fin. Esto puede derribar una red en un período de tiempo muy corto, a veces en pocos segundos. Por ejemplo, las tramas de difusión, como una solicitud ARP, se reenvían a todos los puertos del conmutador, excepto el puerto de entrada original. Esto asegura que todos los dispositivos en un dominio de difusión reciban la trama. Si hay más de una ruta para reenviar la trama, se puede formar un bucle infinito. Cuando se produce un bucle, la tabla de direcciones MAC en un conmutador cambiará constantemente con las actualizaciones de las tramas de difusión, lo que resulta en la inestabilidad de la base de datos MAC. Esto puede causar una alta utilización de la CPU, lo que hace que el switch no pueda reenviar tramas.

Las tramas de difusión no son el único tipo de tramas que son afectadas por los bucles. Si se envían tramas de unidifusión desconocidas a una red con bucles, se puede producir la llegada de tramas duplicadas al dispositivo de destino. Una trama de unidifusión desconocida se produce cuando el switch no tiene la dirección MAC de destino en la tabla de direcciones MAC y debe reenviar la trama a todos los puertos, excepto el puerto de ingreso.

Haga clic en Reproducir en la figura para ver la animación. Cuando la animación se detiene, lea el texto que describe la acción. La animación continuará después de una pausa breve.

The figure is an animation with the same topology as in the previous animation.There are no blocked ports. p c 1 sends a broadcast frame. s 2 updates the mac address table. pc 1s mac address is mapped to f0-/11. s 2 forwards the broadcast out all ports, except the receiving port. s 3 and s 1 update their mac address tables with p c 1 information. s 3 and s 1 forward the broadcast out all ports, except the receiving port. s 1 and s 3 receive a packet from p c 1 on a new port. they update their mac address table accordingly. s 1 and s 3 forward the broadcast out all ports, except the receiving port. s 2 updates its mac address table for p c 1 with the last port on which it received the broadcast frame. s 2 forwards teh broadcast frame out all ports, except the last received port. the cycle starts again.
Tabla MAC de S3

Tabla MAC de S1

Tabla MAC de S2

Tabla MAC de S3

Tabla MAC de S1

S2 MAC Table
PC1 = F0/11
S3 MAC Table
PC1 = F0/2
S2 MAC Table
PC1 = F0/11
S1 MAC Table
PC1 = F0/1
S3 MAC Table
PC1 = F0/1
S2 MAC Table
PC1 = F0/11
S1 MAC Table
PC1 = F0/2
S3 MAC Table
PC1 = F0/1
S2 MAC Table
PC1 = F0/1
S1 MAC Table
PC1 = F0/2
El S2 actualiza la tabla de direcciones MAC. La dirección MAC de la PC1 se asigna a F0/11.
El S2 reenvía la difusión por todos los puertos, excepto el puerto en el que la recibió.
El S3 y el S1 actualizan sus tablas de direcciones MAC con la información de la PC1.
El S3 y el S1 reenvían la difusión por todos los puertos, excepto el puerto en el que la recibieron.
El S1 y el S3 reciben un paquete de la PC1 en un nuevo puerto. Estos actualizan su tabla de direcciones MAC según corresponda.
El S1 y el S3 reenvían la difusión por todos los puertos, excepto el puerto en el que la recibieron.
El S2 actualiza su tabla de direcciones MAC para la PC1 con el último puerto en el que recibió la trama de difusión.
El S2 reenvía la trama de difusión por todos los puertos, excepto el último puerto en el que la recibió. El ciclo vuelve a empezar.
Enlace troncal 2
Enlace troncal 1
Enlace troncal 3
5.1.6
Tormenta de difusión (Broadcast Storm)

Una tormenta de difusión es un número anormalmente alto de emisiones que abruman la red durante un período específico de tiempo. Las tormentas de difusión pueden deshabilitar una red en cuestión de segundos al abrumar los conmutadores y los dispositivos finales. Las tormentas de difusión pueden deberse a un problema de hardware como una NIC defectuosa o a un bucle de capa 2 en la red.

Las emisiones de capa 2 en una red, como las solicitudes ARP, son muy comunes. Es probable que un bucle de capa 2 tenga consecuencias inmediatas y de desactivación en la red. Las multidifusión de capa 2 normalmente se reenvían de la misma manera que una difusión por el conmutador. Por lo tanto, aunque los paquetes IPv6 nunca se reenvían como una difusión de Capa 2, ICMPv6 Neighbor Discovery utiliza multidifusión de Capa 2.

Haga clic en Reproducir en la figura para ver una animación que muestra los efectos cada vez más adversos de un bucle a medida que los fotogramas de difusión y de unidifusión desconocidos continúan propagándose indefinidamente en una tormenta de difusión.
La PC1 reenvía una difusión que queda atrapada en un bucle de capa 2.
La PC4 reenvía una nueva difusión que también queda atrapada en el bucle de capa 2.
La PC3 reenvía otra difusión que queda atrapada en el bucle de capa 2.
La PC2 reenvía una trama de difusión, pero no se puede procesar debido a la sobrecarga de tráfico en la red.
Enlace troncal 2
Enlace troncal 1
Enlace troncal 3

Un host atrapado en un bucle de capa 2 no está accesible para otros hosts en la red. Además, debido a los constantes cambios en su tabla de direcciones MAC, el conmutador no sabe desde qué puerto reenviar las tramas de unidifusión. En la animación anterior, los conmutadores tendrán los puertos incorrectos listados para PC1. Cualquier trama de unidifusión con destino a la PC1 se repite en bucle por la red, como lo hacen las tramas de difusión. Cuando se repiten en bucle cada vez más tramas, se termina creando una tormenta de difusión.

Para evitar que ocurran estos problemas en una red redundante, se debe habilitar algún tipo de árbol de expansión en los switches. De manera predeterminada, el árbol de expansión está habilitado en los switches Cisco para prevenir que ocurran bucles en la capa 2.
5.1.7
El algoritmo de árbol de expansión

STP se basa en un algoritmo inventado por Radia Perlman mientras trabajaba para Digital Equipment Corporation, y publicado en el artículo de 1985 "Un algoritmo para la computación distribuida de un árbol de expansión en una LAN extendida". Su algoritmo de árbol de expansión (STA) crea una topología sin bucles al seleccionar un único puente raíz donde todos los demás conmutadores determinan una única ruta de menor costo.

Sin el protocolo de prevención de bucles, se producirían bucles que harían inoperable una red de conmutadores redundantes.

Topología de la situación

Este escenario STA utiliza una LAN Ethernet con conexiones redundantes entre varios conmutadores.

La topología de red física muestra ocho conmutadores interconectados. El conmutador S1 se conecta a los conmutadores S2, S3 y S5. Switch S2 se conecta a los Switches S1 y S4. Switch S3 se conecta a los Switches S1 y S5. Switch S4 se conecta a los Switches S2 and S5. Switch S5 se conecta a los Switches S1, S3, S4, y S6. Switch S6 se conecta al Switch S5. El switch S7 se conecta al switch S8. El switch S8 se conecta a los switches S4, S5 y S7.
S1 S3 S2 S4 S5 S6 S7
S8

Seleccionar el Root Bridge

El algoritmo de árbol de expansión comienza seleccionando un único puente raíz. La figura muestra que el switch S1 se ha seleccionado como puente raíz. En esta topología, todos los enlaces tienen el mismo costo (mismo ancho de banda). Cada switch determinará una única ruta de menor costo desde sí mismo hasta el puente raíz.

Nota: STA y STP se refieren a conmutadores como puentes . Esto se debe a que en los primeros días de Ethernet, los switches se denominaban puentes.

La topología de red física muestra ocho conmutadores interconectados. Switch S1 es el puente raíz y se conecta a los conmutadores S2, S3 y S5. Switch S2 se conecta a los Switches S1 y S4. Una flecha muestra que la mejor ruta desde S2 es hacia S1. Switch S3 se conecta a los Switches S1 y S5. Una flecha muestra que la mejor ruta desde S3 es hacia S1. Switch S4 se conecta a los Switches S2 and S5. Una flecha muestra que la mejor ruta desde S4 es hacia S2. Switch S5 se conecta a los Switches S1, S3, S4, y S6. Una flecha muestra que la mejor ruta desde S5 es hacia S1. Switch S6 se conecta al Switch S5. Una flecha muestra la mejor ruta desde S6 es hacia S5. El switch S7 se conecta al switch S8. Una flecha muestra la mejor ruta desde S7 es hacia S8. El switch S8 se conecta a los switches S4, S5 y S7. Una flecha muestra la mejor ruta desde S8 es hacia S5.
S1 S3 S2 S4 S5 S6 S7
S8
Root BridgeBest
pathBest
pathBest
pathBest
pathBest
pathBest
pathBest
path


Bloquear rutas redundantes

STP asegura que solo haya una ruta lógica entre todos los destinos en la red al bloquear intencionalmente las rutas redundantes que podrían causar un bucle, como se muestra en la figura. Cuando se bloquea un puerto, se impide que los datos del usuario entren o salgan de ese puerto. El bloqueo de las rutas redundantes es fundamental para evitar bucles en la red.

La topología de red física muestra ocho conmutadores interconectados. Switch S1 es el puente raíz y se conecta a los conmutadores S2, S3 y S5. Switch S2 se conecta a los Switches S1 y S4. Una flecha muestra que la mejor ruta desde S2 es hacia S1. Switch S3 se conecta a los Switches S1 y S5. Una flecha muestra que la mejor ruta desde S3 es hacia S1. Switch S4 se conecta a los Switches S2 and S5. Una flecha muestra que la mejor ruta desde S4 es hacia S2 y el puerto del switch a S5 es un puerto bloqueado. El conmutador S5 se conecta a los conmutadores S1, S3, S4 y S6 y el puerto del conmutador a S3 es un puerto bloqueado. Una flecha muestra que la mejor ruta desde S5 es hacia S1. Switch S6 se conecta al Switch S5. Una flecha muestra la mejor ruta desde S6 es hacia S5. El switch S7 se conecta al switch S8. Una flecha muestra la mejor ruta desde S7 es hacia S8. El switch S8 se conecta a los switches S4, S5 y S7. Una flecha muestra que la mejor ruta desde S8 es hacia S5 y el puerto del switch a S4 es un puerto bloqueado. El texto en la parte inferior del gráfico indica que los conmutadores S4, S5 y S8 han bloqueado rutas redundantes al puente raíz.
S1 S3 S2 S4 S5 S6 S7
S8
Root BridgeBest
pathBest
pathBest
pathBest
pathBest
pathBest
pathBest
pathPuerto bloqueadoPuerto bloqueadoPuerto bloqueado

Los conmutadores S4, S5 y S8 han bloqueado rutas redundantes al puente raíz.


Topología sin bucle

Un puerto bloqueado tiene el efecto de convertir ese enlace en un vínculo no reenvío entre los dos switches, como se muestra en la figura. Observe que esto crea una topología en la que cada conmutador tiene una única ruta al puente raíz, similar a las ramas de un árbol que se conectan a la raíz del árbol.

La topología de red física muestra ocho conmutadores interconectados. Switch S1 es el puente raíz y se conecta a los conmutadores S2, S3 y S5. Switch S2 se conecta a los Switches S1 y S4. Switch S3 se conecta a los Switches S1 y S5. Switch S4 se conecta a los Switches S2 and S5. El puerto del conmutador a S5 es un puerto bloqueado. El conmutador S5 se conecta a los conmutadores S1, S3, S4 y S6 y el puerto del conmutador a S3 es un puerto bloqueado. Switch S6 se conecta al Switch S5. El switch S7 se conecta al switch S8. El switch S8 se conecta a los switches S4, S5 y S7. El puerto del switch a S4 es un puerto bloqueado. El texto en la parte inferior del gráfico dice Cada conmutador ahora tiene sólo una ruta de reenvío al puente raíz.
S1 S3 S2 S4 S5 S6 S7
S8
Puerto bloqueadoPuerto bloqueadoPuerto bloqueadoRoot Bridge

Cada conmutador tiene ahora sólo una ruta de reenvío al puente raíz.

Fallos de enlacecausan recálculo

Las rutas físicas aún existen para proporcionar la redundancia, pero las mismas se deshabilitan para evitar que se generen bucles. Si alguna vez la ruta es necesaria para compensar la falla de un cable de red o de un switch, STP vuelve a calcular las rutas y desbloquea los puertos necesarios para permitir que la ruta redundante se active. Los recálculos STP también pueden ocurrir cada vez que se agrega un nuevo conmutador o un nuevo vínculo entre switches a la red.

La figura muestra un error de enlace entre los conmutadores S2 y S4 que hace que STP se vuelva a calcular. Observe que el vínculo anteriormente redundante entre S4 y S5 se está reenviando para compensar este error. Todavía hay solo una ruta entre cada switch y el puente raíz.

La topología de red física muestra ocho conmutadores interconectados. Switch S1 es el puente raíz y se conecta a los conmutadores S2, S3 y S5. Switch S2 se conecta a los Switches S1 y S4. El enlace a S4 se indica hacia abajo con un X rojo Switch S3 se conecta a los conmutadores S1 y S5. Switch S4 se conecta a los Switches S2 and S5. El puerto del switch a S5 es un indicado como un puerto de fowarding. El conmutador S5 se conecta a los conmutadores S1, S3, S4 y S6 y el puerto del conmutador a S3 es un puerto bloqueado. Switch S6 se conecta al Switch S5. El switch S7 se conecta al switch S8. El switch S8 se conecta a los switches S4, S5 y S7. El puerto del switch a S4 es un puerto bloqueado.
S1 S3 S2 S4 S5 S6 S7
S8
Puente raízPuerto bloqueadoPuerto bloqueadoForwarding Port

STP evita que ocurran bucles mediante la configuración de una ruta sin bucles a través de la red, con puertos “en estado de bloqueo” ubicados estratégicamente. Los switches que ejecutan STP pueden compensar las fallas mediante el desbloqueo dinámico de los puertos bloqueados anteriormente y el permiso para que el tráfico se transmita por las rutas alternativas.

Verifique su comprensión - Propósito de STP

Verifique su comprensión del propósito de STP eligiendo la MEJOR respuesta a las siguientes preguntas.

    ¿Qué enunciado describe mejor STP?

Sin STP en la LAN Ethernet, ¿qué tres tipos de tramas podrían causar un bucle catastrófico en la red? (Escoja tres opciones).

¿Qué dispositivo es elegido por el algoritmo de árbol de expansión al que todos los demás conmutadores determinan una única ruta de menor costo?

Funcionamientos del STP
5.2.1
Pasos para una topología sin bucles

Ahora ya sabe cómo se crean los bucles y los conceptos básicos de usar el protocolo de árbol de expansión para prevenirlos. Este tema le llevará paso a paso a través de la operación de STP. Usando STA, STP crea una topología sin bucles en un proceso de cuatro pasos:

    Elige el puente raíz.
    Seleccione los root ports.
    Elegir puertos designados.
    Seleccione puertos alternativos (bloqueados).

Durante las funciones STA y STP, los conmutadores utilizan unidades de datos de protocolo de puente (BPDU) para compartir información sobre sí mismos y sus conexiones. Las BPDU se utilizan para elegir el root bridge, los root ports, los puertos designados y los puertos alternativos. Cada BPDU contiene una ID de puente (BID) que identifica qué switch envió la BPDU. El BID participa en la toma de muchas de las decisiones STA, incluidos los roles de puertos y root bridge. El BID contiene un valor de prioridad, la dirección MAC del conmutador y un ID de sistema extendido. El valor de BID más bajo lo determina la combinación de estos tres campos.

El gráfico muestra tres cuadros, cada uno de los cuales representa un componente del ID de puente. De izquierda a derecha, el primer cuadro es Bridge Priority, que tiene 4 bits de longitud, el segundo cuadro es Extended System ID, que tiene 12 bits de longitud, y el tercer cuadro es la dirección MAC que tiene 48 bits de longitud. El texto a la derecha de los cuadros indica Bridge ID con Extended System ID. El texto en la parte inferior del gráfico dice El BID incluye la prioridad del puente, el ID del sistema extendido y la dirección MAC del conmutador.
Prioridad de puenteID del
sistema extendidoDirección MACID de puente con la ID de sistema extendido4 bits12 bits48 bits

El BID está compuesto por un valor de prioridad del puente, una ID de sistema extendido y la dirección MAC del switch.

Prioridad de puente

El valor de prioridad predeterminado para todos los switches Cisco es el valor decimal 32768. El rango va de 0 a 61440 y aumenta de a 4096. Es preferible una prioridad de puente más baja. La prioridad de puente 0 prevalece sobre el resto de las prioridades de puente.

Sistema extendido ID

El valor de ID del sistema extendido es un valor decimal agregado al valor de prioridad del puente en el BID para identificar la VLAN para esta BPDU.

Las primeras implementaciones de IEEE 802.1D estaban diseñadas para redes que no utilizaban VLAN. Existía un único árbol de expansión común para todos los switches. Por esta razón, en los switches más antiguos, el ID del sistema extendido no se incluía en las BPDU. A medida que las VLAN se volvieron más comunes en la segmentación de la infraestructura de red, se fue mejorando el estándar 802.1D para incluir a las VLAN, lo que requirió que se incluyera la ID de VLAN en la trama de BPDU. La información de VLAN se incluye en la trama BPDU mediante el uso de la ID de sistema extendido.

El ID del sistema extendido permite que las implementaciones posteriores de STP, como Rapid STP (RSTP) tengan diferentes root bridge para diferentes conjuntos de VLAN. Esto puede permitir que enlaces redundantes y sin reenvío en una topología STP para un conjunto de VLAN sean utilizados por un conjunto diferente de VLAN que utilice un root bridge diferente.

Dirección MAC

Cuando dos switches están configurados con la misma prioridad y tienen la misma ID de sistema extendido, el switch que posee la dirección MAC con el menor valor, expresado en hexadecimal, tendrá el menor BID.
5.2.2
1. Elige el root bridge

El STA designa un único switch como root bridge y lo utiliza como punto de referencia para todos los cálculos de rutas. Los switches intercambian BPDU para crear la topología sin bucles comenzando con la selección del root bridge.

Un proceso de elección determina el switch que se transforma en el puente raíz. Todos los switches del dominio de difusión participan del proceso de elección. Una vez que el switch arranca, comienza a enviar tramas BPDU cada dos segundos. Estas tramas BPDU contienen el BID del switch de envío y el BID del root bridge, conocido como Root ID.

El switch que tiene el BID más bajo se convierte en el puente raíz. Al principio, todos los conmutadores se declaran a sí mismos como el puente raíz con su propio BID establecido como ID raíz. Eventualmente, los switches aprenden a través del intercambio de BPDU qué switch tiene el BID más bajo y acordarán un puente raíz.

En la figura, S1 se elige de root bridge porque tiene el BID más bajo.

La topología de red física muestra tres switches interconectados, S1, S2 y S3, y cuatro PC, PC1, PC2, PC3, PC4. S1 es el root bridge. El Bridge ID de S1 es prioridad = 32769 y dirección MAC = 000A00333333. S1 se conecta a S3 a través del puerto del switch F0/2 y se conecta a S2 a través del puerto del switch F0/1. El enlace entre S1 y S2 se etiqueta Trunk 1. El enlace entre S1 y S3 se etiqueta Trunk 3. S1 se conecta a PC4 a través del puerto del switch F0/3. El Bridge ID de S2 es prioridad = 32769 y dirección MAC = 000A00111111. S2 se conecta a S3 a través del puerto del switch F0/2 y se conecta a S1 a través del puerto del switch F0/1. El enlace entre S2 y S3 se etiqueta Trunk 2. S2 se conecta a PC1 a través del puerto del switch F0/11, se conecta a PC2 a través del puerto del switch F0/18 y a PC3 a través del puerto del switch F0/6. El Bridge ID de S3 es prioridad = 32769 y dirección MAC = 000A00222222. S3 se conecta a S2 a través del puerto del switch F0/2 y se conecta a S1 a través del puerto del switch F0/1. La dirección IP de PC1 es 172.17.10.21. La dirección IP de PC2 es 172.17.10.22. La dirección IP de PC3 es 172.17.10.23. La dirección IP de PC4 es 172.17.10.27.
PC2 PC1 PC3 S3 S2 S1 PC4 F0/1 F0/2 F0/ 18 F0/2 F0/1 F0/2 F0/1 F0/11 F0/6 172.17.10.27 172.17.10.23 172.17.10.22 172.17.10.21
F0/3
Enlace troncal3Enlace troncal1Enlace troncal2Root BridgeBridge ID:
Priority = 32769
MAC Address = 000A00222222Bridge ID:
Priority = 24577
MAC Address = 000A00333333Bridge ID:
Priority = 32769
MAC Address = 000A00111111
5.2.3
Impacto de las pujas por defecto

Dado que el BID predeterminado es 32768, es posible que dos o más switches tengan la misma prioridad. En este escenario, donde las prioridades son las mismas, el conmutador con la dirección MAC más baja se convertirá en el puente raíz. Para asegurar que el puente raíz elegido cumpla con los requisitos de la red, se recomienda que el administrador configure el switch de puente raíz deseado con una prioridad menor.

En la figura, todos los switches están configurados con la misma prioridad de 32769. Aquí la dirección MAC se convierte en el factor decisivo en cuanto a qué interruptor se convierte en el puente raíz. El conmutador con el valor de dirección MAC hexadecimal más bajo es el puente raíz preferido. En este ejemplo, S2 tiene el valor más bajo para su dirección MAC y se elige como el puente raíz para esa instancia de árbol de expansión.

Note: En el ejemplo, la prioridad de todos los switches es 32769. El valor se basa en la prioridad de puente predeterminada 32768 y la ID del sistema extendida (asignación de VLAN 1) asociada con cada conmutador (32768 + 1).

La topología de red física muestra tres switches interconectados, S1, S2 y S3, y cuatro PC, PC1, PC2, PC3, PC4. S2 es el root bridge. El Bridge ID de S1 es prioridad = 32769 y dirección MAC = 000A00333333. S1 se conecta a S3 a través del puerto del switch F0/2 y se conecta a S2 a través del puerto del switch F0/1. El enlace entre S1 y S2 se etiqueta Trunk 1. El enlace entre S1 y S3 se etiqueta Trunk 3. S1 se conecta a la PC4 a través del puerto del conmutador F0/3. El Bridge ID de S2 es prioridad = 32769 y dirección MAC = 000A00111111. S2 se conecta a S3 a través del puerto del switch F0/2 y se conecta a S1 a través del puerto del switch F0/1. El enlace entre S2 y S3 se etiqueta Trunk 2. S2 se conecta a la PC1 a través del puerto del switch F0/11, se conecta a la PC2 a través del puerto del switch F0/18 y se conecta a la PC3 a través del puerto del switch F0/6. El Bridge ID de S3 es prioridad = 32769 y dirección MAC = 000A00222222. S3 se conecta a S2 a través del puerto del switch F0/2 y se conecta a S1 a través del puerto del switch F0/1. La dirección IP de PC1 es 172.17.10.21. La dirección IP de PC2 es 172.17.10.22. La dirección IP de PC3 es 172.17.10.23. La dirección IP de PC4 es 172.17.10.27
PC2 PC1 PC3 S3 S2 PC4 S1 F0/1 F0/2 F0/ 18 F0/2 F0/1 F0/2 F0/1 F0/11 F0/6 172.17.10.27 172.17.10.23 172.17.10.22 172.17.10.21
F0/3
Enlace troncal3Enlace troncal1Enlace troncal2Puente raízBridge ID:
Priority = 32769
MAC Address = 000A00222222Bridge ID:
Priority = 32769
MAC Address = 000A00333333Bridge ID:
Priority = 32769
MAC Address = 000A00111111
5.2.4
Determinar el costo de la ruta raíz

Una vez que se eligió el puente raíz para la instancia de árbol de expansión, el STA comienza el proceso para determinar las mejores rutas hacia el puente raíz desde todos los destinos en el dominio de difusión. La información de la ruta, conocida como el costo interno de la ruta raíz, está determinada por la suma de todos los costos de los puertos individuales a lo largo de la ruta desde el conmutador hasta el puente raíz.

Note: La BPDU incluye el costo de la ruta raíz. Este es el costo de la ruta que va desde el switch que envía los datos hasta el puente raíz.

Cuando un switch recibe la BPDU, agrega el costo del puerto de ingreso del segmento para determinar el costo interno de la ruta hacia la raíz.

Los costos de los puertos predeterminados se definen por la velocidad a la que funcionan los mismos. La tabla muestra los costos de puerto predeterminados sugeridos por IEEE. Los switches Cisco utilizan de forma predeterminada los valores definidos por el estándar IEEE 802.1D, también conocido como costo de ruta corta, tanto para STP como para RSTP. Sin embargo, el estándar IEEE sugiere usar los valores definidos en el IEEE-802.1w, también conocido como costo de ruta larga, cuando se usan enlaces de 10 Gbps y más rápido.

Note: RSTP se discute con más detalle más adelante en este módulo.
Velocidad de enlaceCosto de STP: IEEE 802.1D-1998 Costo de RSTP: IEEE 802.1w-2004 10 GB/S22.0001 GB/S420.000100 MB/S19200.00010 MB/S1002.000.000
Velocidad de enlace	STP Cost: IEEE 802.1D-1998 	Costo de RSTP: IEEE 802.1w-2004
10Gbps	2	2000
1Gbps	4	20000
100Mbps	19	200000
10 Mbps	100	2000000

Pese a que los puertos de switch cuentan con un costo de puerto predeterminado asociado a los mismos, tal costo puede configurarse. La capacidad de configurar costos de puerto individuales le da al administrador la flexibilidad para controlar de forma manual las rutas de árbol de expansión hacia el puente raíz.
5.2.5
2. Elegir los puertos raíz

Después de determinar el puente raíz, se utiliza el algoritmo STA para seleccionar el puerto raíz. Cada switch que no sea root seleccionará un puerto raíz. El puerto raíz es el puerto más cercano al root bridge en términos de costo general para el puente raíz. Este costo general se conoce como costo de ruta raíz interna.

El costo interno de la ruta raíz es igual a la suma de todos los costos del puerto a lo largo de la ruta al root bridge, como se muestra en la figura. Las rutas con el costo más bajo se convierten en las preferidas, y el resto de las rutas redundantes se bloquean. En el ejemplo, el costo de ruta interno desde S2 al root bridge S1 a través de la ruta 1 es de 19 (según el costo de puerto individual especificado por el IEEE), mientras que el costo interno de la ruta hacia la raíz a través de la ruta 2 es de 38. Debido a que la ruta 1 tiene un costo de ruta general más bajo para el root bridge, es la ruta preferida y F0 / 1 se convierte en el root port en S2.

La topología de red física muestra tres switches interconectados, S1, S2 y S3, y cuatro PC, PC1, PC2, PC3, PC4. S1 es el root bridge. El Bridge ID de S1 es prioridad = 32769 y dirección MAC = 000A00333333. S1 se conecta a S3 a través del puerto del switch F0/2 y se conecta a S2 a través del puerto del switch F0/1. El enlace entre S1 y S2 se etiqueta Trunk 1. El enlace entre S1 y S3 se etiqueta Trunk 3. S1 se conecta a PC4 a través del puerto del switch F0/3. El Bridge ID de S2 es prioridad = 32769 y dirección MAC = 000A00111111. S2 se conecta a S3 a través del puerto del switch F0/2 y se conecta a S1 a través del puerto del switch F0/1. El puerto del switch F0/1 en S2 se indica como el puerto raíz. El enlace entre S2 y S3 se etiqueta Trunk 2. La ruta de S2 a S1 se llama Ruta 1. La ruta de S2 a S3 se llama path2. S2 se conecta a PC1 a través del puerto del switch F0/11, se conecta a PC2 a través del puerto del switch F0/18 y a PC3 a través del puerto del switch F0/6. El Bridge ID de S3 es prioridad = 32769 y dirección MAC = 000A00222222. S3 se conecta a S2 a través del puerto del switch F0/2 y se conecta a S1 a través del puerto del switch F0/1. El puerto del switch F0/1 en S3 se indica como el puerto raíz. La ruta de S3 a S1 se etiqueta ruta 2. La dirección IP de PC1 es 172.17.10.21. La dirección IP de PC2 es 172.17.10.22. La dirección IP de PC3 es 172.17.10.23. La dirección IP de PC4 es 172.17.10.27. El texto en la parte inferior del gráfico dice Ruta 1 Costo = 19x1=19. Coste de la ruta 2 = 19x2=38. La ruta 1 es la ruta preferida.
PC2 PC1 PC3 S3 S2 S1 PC4 F0/1 F0/2 F0/ 18 F0/2 F0/1 F0/2 F0/1 F0/11 F0/6 172.17.10.27 172.17.10.23 172.17.10.22 172.17.10.21
F0/3
Enlace troncal3Enlace troncal1Enlace troncal2Root bridgeRoot portRuta 2Ruta 1Ruta 2Root portRuta 1 Cost = 19 x 1 = 19
Ruta 2 Cost = 19 x 2 = 38
Ruta 1 es el camino preferido.
5.2.6
3. Seleccionar puertos designados

La parte de prevención de bucles del árbol de expansión se hace evidente durante estos dos pasos siguientes. Después de que cada switch selecciona un puerto raíz, los switches seleccionarán los puertos designados.

Cada segmento entre dos switches tendrá un puerto designado. El puerto designado es un puerto en el segmento (con dos switches) que tiene el costo de ruta raíz interna al puente raíz. En otras palabras, el puerto designado tiene la mejor ruta para recibir el tráfico que conduce al puente raíz.

Lo que no es un puerto raíz o un puerto designado se convierte en un puerto alternativo o bloqueado. El resultado final es una ruta única desde cada conmutador al puente raíz.

Puertos designados en el puente raíz

Todos los puertos en el root bridge son puertos designados. Esto se debe a que el root bridge tiene el costo más bajo para sí mismo.

La topología de red física muestra tres switches interconectados, S1, S2 y S3, y cuatro PC, PC1, PC2, PC3, PC4. S1 es el root bridge. S1 se conecta a S3 a través del puerto del switch F0/2 y se conecta a S2 a través del puerto del switch F0/1. El enlace entre S1 y S2 se etiqueta Trunk 1. El enlace entre S1 y S3 se etiqueta Trunk 3. S1 se conecta a PC4 a través del puerto del switch F0/3. El puerto del switch F0/3 en S1 es un puerto designado. El puerto del switch F0/2 en S1 es un puerto designado. El puerto del switch F0/1 en S1 es un puerto designado. S2 se conecta a S3 a través del puerto del switch F0/2 y se conecta a S1 a través del puerto del switch F0/1. El enlace entre S2 y S3 se etiqueta Trunk 2. S2 se conecta a PC1 a través del puerto del switch F0/11, se conecta a PC2 a través del puerto del switch F0/18 y a PC3 a través del puerto del switch F0/6. El puerto del switch F0/1 en S2 es el puerto raíz. S3 se conecta a S2 a través del puerto del switch F0/2 y se conecta a S1 a través del puerto del switch F0/1. El puerto de switch 3 es un puerto raíz, La dirección IP de PC1 es 172.17.10.21. La dirección IP de PC2 es 172.17.10.22. La dirección IP de PC3 es 172.17.10.23. La dirección IP de PC4 es 172.17.10.27. El texto en la parte inferior de la figura dice Todos los puertos en el puente raíz son puertos designados.
PC2 PC1 PC3 S3 S2 S1 PC4 F0/1 F0/2 F0/ 18 F0/2 F0/1 F0/2 F0/1 F0/11 F0/6 172.17.10.27 172.17.10.23 172.17.10.22 172.17.10.21
F0/3
Enlace troncal3Enlace troncal1Enlace troncal2Puente raízRoot portPuerto designadoPuerto designadoRoot portPuerto designado

Todos los puertos en el puente raíz (root bridge) son puertos designados.

Puerto designado cuando hay un puerto raíz

Si un extremo de un segmento es un puerto raíz, el otro extremo es un puerto designado. Para demostrar esto, la figura muestra que el conmutador S4 está conectado a S3. La interfaz Fa0/1 en S4 es su puerto raíz porque tiene la mejor y única ruta al root bridge. Por lo tanto, la interfaz Fa0/3 en S3 en el otro extremo del segmento sería el puerto designado.

Note: Todos los puertos del switch con dispositivos finales (hosts) conectados son puertos designados.

La topología de red física muestra cuatro conmutadores interconectados, S1, S2, S3 y S4, y cuatro PC1, PC2, PC3, PC4. S1 es el root bridge. S1 se conecta a S3 a través del puerto del switch F0/2 y se conecta a S2 a través del puerto del switch F0/1. El enlace entre S1 y S2 se etiqueta Trunk 1. El enlace entre S1 y S3 se etiqueta Trunk 3. S1 se conecta a PC4 a través del puerto del switch F0/3. El puerto del switch F0/3 en S1 es un puerto designado. El puerto del switch F0/2 en S1 es un puerto designado. El puerto del switch F0/1 en S1 es un puerto designado. S2 se conecta a S3 a través del puerto del switch F0/2 y se conecta a S1 a través del puerto del switch F0/1. El enlace entre S2 y S3 se etiqueta Trunk 2. S2 se conecta a PC1 a través del puerto del switch F0/11, se conecta a PC2 a través del puerto del switch F0/18 y a PC3 a través del puerto del switch F0/6. El puerto del switch F0/1 en S2 es el puerto raíz. S3 se conecta a S2 a través del puerto del switch F0/2 y a S1 a través del puerto del switch F0/1 y también se conecta a S4 a través del puerto del switch Fa0/3. El puerto del switch F0/1 en S3 es un puerto raíz y el puerto del switch Fa0/3 en S3 es un puerto designado. El puerto del switch F0/1 en S2 es el puerto raíz. La dirección IP de PC1 es 172.17.10.21. La dirección IP de PC2 es 172.17.10.22. La dirección IP de PC3 es 172.17.10.23. La dirección IP de PC4 es 172.17.10.27. El texto en la parte inferior de la figura lee la interfaz Fa0/1 en S4 es un puerto designado porque la interfaz Fa0/3 de S3 es un puerto raíz.
PC2 PC1 PC3 S3 S2 S1 PC4 F0/1 F0/2 F0/ 18 F0/2 F0/1 F0/2 F0/1 F0/11 F0/6 172.17.10.27 172.17.10.23 172.17.10.22 172.17.10.21 F0/3 S4 Fa0/1
Fa0/3
Root portPuerto designadoPuerto designadoRoot portPuerto designadoEnlace troncal3Enlace troncal1Enlace troncal2Puente raízPuerto designadoRoot port

La interfaz Fa0/1 en S4 es un puerto designado porque la interfaz Fa0/3 de S3 es un puerto raíz.

Puerto designado cuando no hay puerto raíz

Esto deja solo segmentos entre dos switches donde ninguno de los switches es el puente raíz. En este caso, el puerto del switch con la ruta de menor costo al puente raíz es el puerto designado para el segmento. Por ejemplo, en la figura, el último segmento es el que está entre S2 y S3. Tanto S2 como S3 tienen el mismo costo de ruta para el puente raíz. El algoritmo del árbol de expansión utilizará el ID del puente como un interruptor de corbata. Aunque no se muestra en la figura, S2 tiene un BID menor. Por lo tanto, el puerto F0/2 de S2 se elegirá como el puerto designado. Los puertos designados están en estado de reenvío.

La topología de red física muestra tres conmutadores interconectados, S1, S2 y S3 y cuatro PC1, PC2, PC3, PC4. S1 es el root bridge. S1 se conecta a S3 a través del puerto del switch F0/2 y se conecta a S2 a través del puerto del switch F0/1. El enlace entre S1 y S2 se etiqueta Trunk 1. El enlace entre S1 y S3 se etiqueta Trunk 3. S1 se conecta a PC4 a través del puerto del switch F0/3. El puerto del switch F0/3 en S1 es un puerto designado. El puerto del switch F0/2 en S1 es un puerto designado. El puerto del switch F0/1 en S1 es un puerto designado. S2 se conecta a S3 a través del puerto del switch F0/2 y se conecta a S1 a través del puerto del switch F0/1. El enlace entre S2 y S3 se etiqueta Trunk 2. S2 se conecta a PC1 a través del puerto del switch F0/11, se conecta a PC2 a través del puerto del switch F0/18 y a PC3 a través del puerto del switch F0/6. El puerto del switch F0/1 en S2 es el puerto raíz. El puerto del switch F0/2 en S2 es el puerto designado. S3 se conecta a S2 a través del puerto del switch F0/2 y se conecta a S1 a través del puerto del switch F0/1. El puerto de switch 3 es un puerto raíz, La dirección IP de PC1 es 172.17.10.21. La dirección IP de PC2 es 172.17.10.22. La dirección IP de PC3 es 172.17.10.23. La dirección IP de PC4 es 172.17.10.27. El texto en la parte inferior de la figura dice La interfaz Fa0/2 de S2 es el puerto designado en el segmento con S3.
PC2 PC1 PC3 S3 S2 S1 PC4 F0/1 F0/2 F0/ 18 F0/2 F0/1 F0/2 F0/1 F0/11 F0/6 172.17.10.27 172.17.10.23 172.17.10.22 172.17.10.21
F0/3
Enlace troncal3Enlace troncal1Enlace troncal2Puente raízRoot portPuerto designadoPuerto designadoRoot portPuerto designadoPuerto designado

La interfaz Fa0/2 de S2 es el puerto designado en el segmento con S3.

5.2.7
4. Seleccionar puertos alternativos (bloqueados)

Si un puerto no es un puerto raíz o un puerto designado, se convierte en un puerto alternativo (o de copia de seguridad). Los puertos alternativos y los puertos de respaldo están en estado de descarte o bloqueo para evitar bucles. En la figura, la STA ha configurado el puerto F0 / 2 en S3 en el rol alternativo. El puerto F0/2 en S3 está en estado de bloqueo y no reenviará tramas Ethernet. Todos los demás puertos entre conmutadores están en estado de reenvío. Esta es la parte de prevención de bucles de STP.

La topología de red física muestra tres conmutadores interconectados, S1, S2 y S3 y cuatro PC1, PC2, PC3, PC4. S1 es el root bridge. S1 se conecta a S3 a través del puerto del switch F0/2 y se conecta a S2 a través del puerto del switch F0/1. El enlace entre S1 y S2 se etiqueta Trunk 1. El enlace entre S1 y S3 se etiqueta Trunk 3. S1 se conecta a PC4 a través del puerto del switch F0/3. El puerto del switch F0/3 en S1 es un puerto designado. El puerto del switch F0/2 en S1 es un puerto designado. El puerto del switch F0/1 en S1 es un puerto designado. S2 se conecta a S3 a través del puerto del switch F0/2 y se conecta a S1 a través del puerto del switch F0/1. El enlace entre S2 y S3 se etiqueta Trunk 2. S2 se conecta a PC1 a través del puerto del switch F0/11, se conecta a PC2 a través del puerto del switch F0/18 y a PC3 a través del puerto del switch F0/6. El puerto del switch F0/1 en S2 es el puerto raíz. El puerto del switch F0/2 en S2 es el puerto designado. S3 se conecta a S2 a través del puerto del switch F0/2 y se conecta a S1 a través del puerto del switch F0/1. El puerto de switch 3 es un puerto raíz, El puerto del switch F0/2 en S3 es un puerto alternativo. Un símbolo de bloqueo circular rojo se coloca en el enlace troncal entre S3 y S2 junto a la interfaz F0/2 de S3. La dirección IP de PC1 es 172.17.10.21. La dirección IP de PC2 es 172.17.10.22. La dirección IP de PC3 es 172.17.10.23. La dirección IP de PC4 es 172.17.10.27. El texto en la parte inferior de la figura dice La interfaz Fa0/2 de S2 es el puerto designado en el segmento con S3.
PC2 PC1 PC3 S3 S2 S1 PC4 F0/1 F0/2 F0/ 18 F0/2 F0/1 F0/2 F0/1 F0/11 F0/6 172.17.10.27 172.17.10.23 172.17.10.22 172.17.10.21
F0/3
Enlace troncal3Enlace troncal1Enlace troncal2Puente raízRoot portPuerto designadoPuerto designado Root portPuerto designadoPuerto alternativoPuerto designado

La interfaz Fa0/2 de S3 no es un puerto raíz o un puerto designado, por lo que se convierte en un puerto alternativo o bloqueado.
5.2.8
Seleccione un puerto raíz a partir de varias rutas de igual coste

Los puertos designados se seleccionan en base al menor costo del trayecto al Puerto raíz para un segmento. Pero, ¿qué sucede si el switch tiene múltiples rutas de igual costo al puente raíz? ¿Cómo designa un puerto raíz un switch?

Cuando un switch tiene varias rutas de igual costo al puente raíz, el switch determinará un puerto utilizando los siguientes criterios:

    Oferta de remitente más baja
    Prioridad de puerto del remitente más baja
    ID de puerto del remitente más bajo

1. Oferta de remitente más baja

La figura muestra una topología con cuatro conmutadores, incluido el conmutador S1 como puente raíz. Al examinar los roles de puerto, vemos que el puerto F0/1 del switch S3 y el puerto F0/3 del switch S4 se han seleccionado como puertos raíz porque tienen la ruta con el menor costo (costo de la ruta hacia la raíz) al puente raíz para sus respectivos switches. S2 tiene dos puertos, F0 / 1 y F0 / 2 con rutas de igual costo al puente raíz. En este caso los ID de puente de los switches vecinos, S3 y S4, se utilizan para definir el empate. Esto se conoce como BID del emisor. S3 tiene un BID de 32769.5555.5555.5555 y S4 tiene un BID de 32769.1111.1111.1111. Como S4 tiene un BID más bajo, el puerto F0 / 1 de S2, que es el puerto conectado a S4, será el puerto raíz.

La topología de red física muestra cuatro conmutadores interconectados, S1, S2, S3 y S4. S1 es el puente raíz y se conecta a S4 a través del puerto del switch F0/1 y S3 a través del puerto troncal F0/2. El enlace entre S1 y S4 se etiqueta Trunk 1. La interfaz F0/1 en S1 es un puerto designado. El ID de puente de S1 es 24577.3333.3333.3333. S1 se conecta a S3 a través del puerto del switch F0/2. El enlace entre S1 y S3 se etiqueta Trunk 3. La interfaz F0/2 en S1 es un puerto designado. S4 está conectado a S1 a través del puerto del switch F0/3, que es un puerto raíz. S4 está conectado a S2 a través del puerto del switch F0/1, que es un puerto designado. El enlace entre S1 y S2 se etiqueta Trunk 1. El ID de puente de S4 es 32769.1111.1111.1111. S2 está conectado a S4 a través del puerto del switch F0/1, que es un puerto raíz y está conectado a S3 a través del puerto del switch F0/2, que es un puerto alternativo. El enlace entre S2 y S3 se llama Trunk 2. Hay una X roja junto a la interfaz F0/2 de S2 que indica que está bloqueando el tráfico. El ID de puente de S2 es 32769.AAAA.AAAA.AAA. S3 está conectado a S2 sobre el puerto del switch F0/2 que es un puerto designado y a S1 sobre el puerto del switch F0/1 que es un puerto raíz. El ID de puente de S3 es 32769.5555.5555.5555.
S3 S1 S2 S4 F0/1 F0/2 F0/3 F0/1 F0/1 F0/2 F0/1
F0/2
Enlace troncal3Enlace troncal2Enlace troncal1Puente raízEnlace troncal4Bridge ID = 24577.3333.3333.3333Root portPuerto designadoPuerto alternativoPuerto designadoRoot portPuerto designadoPuerto designadoRoot portID de puente = 32769.5555.5555.5555ID de puente = 32769.AAAA.AAAA.AA.AAAABridge ID= 32769.1111.1111.1111

2. Prioridad de puerto del remitente más baja

Para demostrar estos dos criterios siguientes, la topología se cambia a uno donde dos switches están conectados con dos paths de igual costo entre ellos. S1 es el puente raíz, por lo que ambos puertos son puertos designados.

S4 tiene dos puertos con rutas de igual costo al puente raíz. Dado que ambos puertos están conectados al mismo conmutador, el BID (S1) del remitente es igual. Entonces el primer paso es un empate.

A continuación en la lista está la prioridad del puerto del remitente (S1). La prioridad de puerto predeterminada es 128, por lo que ambos puertos de S1 tienen la misma prioridad de puerto. Esto también es una corbata. Sin embargo, si cualquiera de los puertos de S1 se configuraba con una prioridad de puerto más baja, S4 pondría su puerto adyacente en estado de reenvío. El otro puerto en S4 sería un estado de bloqueo.

La topología de red física muestra dos conmutadores interconectados, S1 y S2. S1 se conecta a S2 a través de dos puertos de conmutación, F0/1 y F0/2. F0/1 es un puerto designado y PARTIALURLPLACEHOLDER también un puerto designado. La prioridad de puerto de los puertos del conmutador F0/1 y F0/2 en S1 es 128. El Bridge ID de S1 es 24577.3333.3333.3333. S4 está conectado a S1 a través de dos puertos de conmutación, F0/6 y F0/5. El Bridge ID de S4 es 32769.1111.1111.1111.
S4 S1 F0/1 F0/5 F0/6
F0/2
Bridge ID= 32769.1111.1111.1111Bridge ID = 24577.3333.3333.3333Puente raízPort Priority = 128Port Priority =128Puerto designadoPuerto designado

3. ID de puerto del remitente más bajo

El último desempate es el ID de puerto del remitente más bajo. El conmutador S4 ha recibido BPDU desde el puerto F0/1 y el puerto F0/2 en S1. Recuerde que la decisión se basa en el ID del puerto del remitente, no en el ID del puerto del receptor. Dado que el Id. de puerto de F0/1 en S1 es menor que el puerto F0/2, el puerto F0/6 en el conmutador S4 será el puerto raíz. Este es el puerto de S4 que está conectado al puerto F0/1 de S1.

El puerto F0/5 en S4 se convertirá en un puerto alternativo y se colocará en el estado de bloqueo, que es la parte de prevención de bucles de STP.

La topología de red física muestra dos conmutadores interconectados, S1 y S2. S1 se conecta a S2 a través de dos puertos de conmutación, F0/1 y F0/2. F0/1 es un puerto designado y PARTIALURLPLACEHOLDER también un puerto designado. La prioridad de puerto de los puertos del conmutador F0/1 y F0/2 en S1 es 128. El Bridge ID de S1 es 24577.3333.3333.3333. S4 está conectado a S1 a través de dos puertos de conmutación, F0/6 y F0/5. F0/6 es un puerto raíz y PARTIALURLPLACEHOLDER es un puerto alternativo. El Bridge ID de S4 es 32769.1111.1111.1111.
S4 S1 F0/1 F0/5 F0/6
F0/2
Bridge ID= 32769.1111.1111.1111Bridge ID = 24577.3333.3333.3333Puente raízPort Priority = 128Port Priority =128Puerto designadoPuerto designadoPuerto alternativoRoot port

5.2.9
Temporizadores STP y Estados de puerto

La convergencia STP requiere tres temporizadores, como sigue:

    Temporizador de saludo - El tiempo de saludo es el intervalo entre BPDU. El valor predeterminado es 2 segundos, pero se puede modificar entre 1 y 10 segundos.
    Temporizador de retardo de reenvío - El retraso directo es el tiempo que se pasa en el estado de escucha y aprendizaje. El valor predeterminado es 15 segundos, pero se puede modificar a entre 4 y 30 segundos.
    Temporizador de antigüedad máxima - La antigüedad máxima es la duración máxima de tiempo que un switch espera antes de intentar cambiar la topología STP. El valor predeterminado es 20 segundos, pero se puede modificar entre 6 y 40 segundos.

Nota: Los tiempos predeterminados se pueden cambiar en el puente raíz, que dicta el valor de estos temporizadores para el dominio STP.

STP facilita la ruta lógica sin bucles en todo el dominio de difusión. El árbol de expansión se determina a través de la información obtenida en el intercambio de tramas de BPDU entre los switches interconectados. Si un puerto de switch pasa directamente del estado de bloqueo al de reenvío sin información acerca de la topología completa durante la transición, el puerto puede crear un bucle de datos temporal. Por esta razón, STP tiene cinco estados de puertos, cuatro de los cuales son estados de puertos operativos, como se muestra en la figura. El estado deshabilitado se considera no operativo.

El gráfico muestra un diagrama de flujo que representa los cuatro estados operativos STP. En la parte superior del diagrama de flujo se encuentra el estado de bloqueo. En el estado de bloqueo No se recibe BPDU y la edad máxima = 20 segundos. Una flecha apunta desde el estado Bloqueo al estado Listening. El estado de escucha tiene un retraso de avance de 15 segundos. Hay una flecha que apunta desde el estado Listening al estado Learning. El estado de aprendizaje tiene un delday hacia adelante = 15 segundos. Hay una flecha que apunta desde el estado de aprendizaje al estado de reenvío. Hay un diagrama de flujo títulos cuadro Enlace viene con una flecha que apunta a un segundo cuadro titulado Bloqueo. El texto del cuadro Bloqueo indica En estado de bloqueo hasta que SPT determine si el puerto es raíz o puerto designado. Este cuadro tiene una flecha que apunta al estado Listening.
Bloqueo

    No se recibió BPDU
    Edad máxima = 20 segundos

Escucha

    Forward Delay = 15 segundos

Aprendizaje

    Forward Delay = 15 segundos

Reenvío
Bloqueo

    En estado de bloqueo hasta que STP determine si el puerto es raíz o puerto designado

El
enlace aparece

Los detalles de cada estado de puerto se muestran en la tabla.
Leyenda de la tabla
Estado del puerto	Descripción
Bloqueo	el puerto es un puerto alternativo y no participa en el reenvío de tramas. reenvío. El puerto recibe tramas BPDU para determinar la ubicación y ID deraíz del puente raíz . Las tramas BPDU también determinan qué roles de puerto cada puerto del switch debe asumir en la topología STP activa final. Con un Temporizador de edad máxima de 20 segundos, un puerto del switch que no ha recibido un BPDU esperado de un switch vecino entrará en el estado de bloqueo.
Escucha	Después del estado de bloqueo, un puerto se moverá al estado de escucha. La recibe BPDU para determinar la ruta a la raíz. Puerto del switch también transmite sus propias tramas BPDU e informa a los conmutadores adyacentes que el puerto del conmutador se está preparando para participar en la topología activa.
Aprendizaje	Un puerto de switch pasa al estado de aprendizaje después de la escucha STP. Durante el estado de aprendizaje, el puerto del switch recibe y procesa BPDU y se prepara para participar en el reenvío de tramas. También comienza a rellenar la tabla de direcciones MAC. Sin embargo, en el estado de aprendizaje, el usuario frames are not forwarded to the destination.
Reenvío	En el estado de reenvío, un puerto de switch se considera parte de la dividida. El puerto del switch reenvía el tráfico de usuario y envía y recibe Marcos BPDU.
Deshabilitado	Un puerto de switch en el estado deshabilitado no participa en la expansión árbol y no reenvía marcos. El estado deshabilitado se establece cuando el El puerto se ha desactivado administrativamente.
5.2.10
Detalles Operativos de cada Estado Portuario

En la tabla se resumen los detalles operativos de cada estado de puerto.
Port StateBPDUMAC Address TableForwarding Data FramesDisabledNone sent or receivedNo updateNoBlockingReceive onlyNo updateNoListeningReceive and sendNo updateNoLearningReceive and sendUpdating tableNoForwardingReceive and sendUpdating tableYes
Estado del puerto 	BPDU 	Tabla de direcciones MAC 	Reenvío de framesde datos
Bloqueo	Recibir solo	No hay actualización	No
Escucha	Recibir y enviar	No hay actualización	No
Aprendizaje	Recibir y enviar	Actualización de la tabla	No
Reenvío	Recibir y enviar	Actualización de la tabla	Sí
Deshabilitado	No se ha enviado ni recibido	No hay actualización	No
5.2.11
Per-VLAN Spanning Tree

Hasta ahora, hemos hablado de STP en un entorno donde sólo hay una VLAN. Sin embargo, STP se puede configurar para que funcione en un entorno con varias VLAN.

In Per-VLAN Spanning Tree (PVST) versions of STP, there is a root bridge elected for each spanning tree instance. Esto hace posible tener diferentes puentes raíz para diferentes conjuntos de VLAN. STP opera una instancia independiente de STP para cada VLAN individual. Si todos los puertos de todos los switches pertenecen a la VLAN 1, solo se da una instancia de árbol de expansión.
5.2.12
Compruebe su comprensión — Operaciones STP

Elija la MEJOR repuesta para las siguientes preguntas y compruebe su conocimiento sobre VLANs.

    De forma predeterminada (sin ninguna configuración en un switch), ¿qué determinará qué switch es el bridge raíz?

El puente raíz será el switch con:

El puerto más cercano al puente raíz en términos de menor costo global (mejor ruta) al puente raíz es:

El puerto en el segmento (con dos switches) que tiene el costo de ruta más bajo para el puente raíz es:

¿Cuál de los siguientes puertos reenviará tramas Ethernet? (Escoja dos opciones).

La suma de los costos de puerto individuales a lo largo de la ruta desde el switch al bridge raíz se conoce como:

¿Con qué frecuencia envía un switch una BPDU?


Evolución del STP
5.3.1
Diferentes versiones de STP

En este tema se detallan las diferentes versiones de STP y otras opciones para evitar bucles en la red.

Hasta ahora, hemos utilizado el término Protocolo Spanning Tree y el acrónimo STP, que puede ser engañoso. La mayoría de los profesionales suele utilizar estas denominaciones para referirse a las diversas implementaciones del árbol de expansión, como el protocolo de árbol de expansión rápido (RSTP) y el protocolo de árbol de expansión múltiple (MSTP). Para comunicar los conceptos del árbol de expansión correctamente, es importante hacer referencia a la implementación o al estándar del árbol de expansión en contexto.

El último estándar para árbol de expansión está contenido en IEEE-802-1D-2004, el estándar IEEE para redes de área local y metropolitana:puentes de control de acceso a medios (MAC). Esta versión del estándar indica que los conmutadores y puentes que cumplen con el estándar utilizarán Rapid Spanning Tree Protocol (RSTP) en lugar del protocolo STP anterior especificado en el estándar 802.1d original. En este currículo, cuando se analiza el protocolo de árbol de expansión original, se utiliza la frase “árbol de expansión 802.1D original” para evitar confusiones. Debido a que los dos protocolos comparten gran parte de la misma terminología y métodos para la ruta sin bucles, el enfoque principal estará en el estándar actual y las implementaciones propietarias de Cisco de STP y RSTP.

Desde el lanzamiento del estándar IEEE 802.1D original, surgió una gran variedad de protocolos de árbol de expansión.
Leyenda de la tabla
Variedad STP	Descripción
STP	Esta es la versión original de IEEE 802.1D (802.1D-1998 y versiones anteriores) que proporciona una topología sin bucles en una red con enlaces redundantes. También llamado Common Spanning Tree (CST), asume una instancia de árbol de expansión para toda la red puenteada, independientemente de la cantidad de VLAN.
PVST+	El árbol de expansión por VLAN (PVST +) es una mejora de Cisco de STP que provides a separate 802.1D spanning tree instance for each VLAN Configure la red PVST+ soporta PortFast, UplinkFast, BackboneFast, BPDU guard, BPDU filter, root guard, y loop guard.
802.1D-2004	Esta es una versión actualizada del estándar STP, que incorpora IEEE 802.1w.
RSTP	Protocolo de Árbol de Expansión Rápido (RSTP), o IEEE&nbsp;802.1w, es una evolución de STP que proporciona una convergencia más veloz de STP. Proporciona una convergencia más rápida de STP.
PVST+ rápido	Esta es una mejora de Cisco de RSTP que utiliza PVST + y proporciona un instancia separada de 802.1w por VLAN. Cada instancia independiente admite PortFast, BPDU guard, BPDU filter, root guard, y loop guard.
MSTP	El Protocolo de árbol de expansión múltiple (MSTP) es un estándar IEEE inspirado en el STP de instancia múltiple (MISTP) anterior propietario de Cisco de Cisco. MSTP asigna varias VLAN en la misma instancia de árbol de expansión. VRF.
Instancia	Múltiple Spanning Tree (MST) es la implementación de MSTP de Cisco, que proporciona hasta 16 instancias de RSTP y combina muchas VLAN con el misma topología física y lógica en una instancia RSTP común. Cada instancia aparte admite PortFast, protección de BPDU, filtro de BPDU, protección de raíz y protección de bucle. loop guard.

Es posible que un profesional de red, cuyas tareas incluyen la administración de los switches, deba decidir cuál es el tipo de protocolo de árbol de expansión que se debe implementar.

Los switches de Cisco con IOS 15.0 o posterior ejecutan PVST+ de manera predeterminada. Esta versión incluye muchas de las especificaciones IEEE 802.1D-2004, como puertos alternativos en lugar de los puertos no designados anteriores. Los conmutadores deben configurarse explícitamente para el modo de árbol de expansión rápida para ejecutar el protocolo de árbol de expansión rápida.
5.3.2
Conceptos de RSTP

RSTP (IEEE 802.1w) reemplaza al 802.1D original mientras conserva la compatibilidad con versiones anteriores. La terminología de STP 802.1w sigue siendo fundamentalmente la misma que la de STP IEEE 802.1D original. La mayoría de los parámetros se han dejado sin cambios. Los usuarios que estén familiarizados con el estándar STP original pueden configurar fácilmente RSTP. El mismo algoritmo de árbol de expansión se utiliza tanto para STP como para RSTP para determinar los roles de puerto y la topología.

RSTP aumenta la velocidad del recálculo del árbol de expansión cuando cambia la topología de la red de Capa 2. RSTP puede lograr una convergencia mucho más rápida en una red configurada en forma adecuada, a veces sólo en unos pocos cientos de milisegundos. Si un puerto está configurado como puerto alternativo o de respaldo, puede cambiar automáticamente al estado de reenvío sin esperar a que converja la red.

Note: PVST+ rápido es la implementación que hace Cisco de RSTP por VLAN. Con Rapid PVST + se ejecuta una instancia independiente de RSTP para cada VLAN.
5.3.3
Estados de puerto RSTP y roles de puerto

Los estados de puerto y las funciones de puerto entre STP y RSTP son similares.

Haga clic en cada botón para una comparación entre los estados de puerto STP y RSTP y los roles de puerto.

Estados de puertos STP y RSTP

Solo hay tres estados de puerto en RSTP que corresponden a los tres estados operativos posibles en STP. Los estados de desactivación, bloqueo y escucha 802.1D se fusionan en un único estado de descarte 802.1w.

El gráfico muestra las estadísticas del puerto STP y RSTP junto a la otra para la comparación. A la izquierda se muestran los estados del puerto STP en orden de arriba hacia abajo: Deshabilitado, Bloqueo, Escuchar, Aprendizaje, Reenvío. A la derecha se muestran los estados del puerto RSTP en orden de arriba hacia abajo: Descartar, Aprendizaje, Reenviar.
DeshabilitadoBloqueoEscuchaAprendizajeReenvíoRSTPDescarteAprendizajeReenvíoSTP

Estados de puertos STP y RSTP

Como se muestra en la figura, los puertos raíz y los puertos designados son los mismos para STP y RSTP. Sin embargo, hay dos roles de puerto RSTP que corresponden al estado de bloqueo de STP. En STP, un puerto bloqueado se define como no ser el puerto designado o raíz. RSTP tiene dos funciones de puerto para este propósito.

El gráfico muestra los rollos de puertos STP y RSTP al lado del otro para la comparación. A la izquierda están los rollos de puertos STP enumerados en orden de arriba hacia abajo: Puerto raíz, Puerto designado, Puerto bloqueado (Puerto no designado). A la derecha están los rollos de puertos RSTP listados en orden de arriba hacia abajo: Puerto raíz, Puerto designado, Puerto de copia de seguridad, Puerto alternativo.
Root portPuerto designadoRoot portPuerto designado

Puertobloqueado
(puerto no designado)
Backup PortPuerto alternativoRSTPSTP

Puertos RSTP alternativos y de copia de seguridad

Como se muestra en la figura, el puerto alternativo tiene una ruta alternativa al puente raíz. El puerto de copia de seguridad es una copia de seguridad en un medio compartido, como un concentrador. Un puerto de copia de seguridad es menos común porque ahora los concentradores se consideran dispositivos heredados.

La topología de red física muestra tres conmutadores interconectados, S1, S2 y S3 y un Hub. S1 es el puente raíz y se conecta a S2 y S3. Ambos puertos del switch en S1 son puertos designados. S2 está conectado a S1 y S3. El puerto del conmutador S2 que se conecta a S1 es un puerto raíz. El puerto del conmutador S2 que se conecta a S3 es un puerto alternativo y tiene un círculo rojo con una barra diagonal a través de él. S3 está conectado a S1 y S2 y tiene conexiones redundantes al Hub. El puerto del conmutador S3 conectado a S1 es un puerto raíz. El puerto del conmutador S3 conectado a S2 es un puerto designado. Uno de los puertos del conmutador en S3 conectado al concentrador es un puerto designado y el otro es un puerto de copia de seguridad y tiene un círculo rojo con una barra a través de él.
S2 S1 S2 S3
Hub
Puente raízPuerto designadoPuerto designadoRoot portPuerto alternativoRoot portPuerto designadoPuerto designadoBackup Port

5.3.4
PortFast y protección BPDU

Cuando un dispositivo está conectado a un puerto del conmutador o cuando un conmutador se enciende, el puerto del conmutador pasa por los estados de escucha y aprendizaje, esperando cada vez que expire el temporizador de retardo de reenvío. Este retraso es de 15 segundos para cada estado, escuchando y aprendiendo, para un total de 30 segundos. Este retraso puede presentar un problema para los clientes DHCP que intentan detectar un servidor DHCP. Los mensajes DHCP del host conectado no se reenviarán durante los 30 segundos de temporizadores de retardo de reenvío y el proceso DHCP puede agotarse. El resultado es que un cliente IPv4 no recibirá una dirección IPv4 válida.

Note: Aunque esto puede ocurrir con clientes que envían mensajes de solicitud de enrutador ICMPv6, el enrutador continuará enviando mensajes de anuncio de enrutador ICMPv6 para que el dispositivo sepa cómo obtener su información de dirección.

Cuando un puerto de conmutador se configura con PortFast, ese puerto pasa del bloqueo al estado de reenvío inmediatamente, omitiendo los estados de escucha y aprendizaje STP y evitando un retraso de 30 segundos. Use PortFast en los puertos de acceso para permitir que los dispositivos conectados a estos puertos, como los clientes DHCP, accedan a la red de inmediato, en lugar de esperar a que STP converja en cada VLAN. Debido a que el propósito de PortFast es minimizar el tiempo que los puertos de acceso deben esperar a que el árbol de expansión converja, solo debe usarse en los puertos de acceso. Si habilita PortFast en un puerto que se conecta a otro switch, corre el riesgo de crear un bucle de árbol de expansión. PortFast solo se puede usar en puertos conmutadores que se conectan a dispositivos finales.

La topología de red física muestra tres conmutadores interconectados, S1, S2 y S3 y tres PC, PC1, PC2 y PC3. S1 se conecta a S3 a través del puerto del switch F0/2 y se conecta a S2 a través del puerto del switch F0/1 que tiene la letra D junto a él. El enlace entre S1 y S2 se etiqueta Trunk 1. El enlace entre S1 y S3 se etiqueta Trunk 3. S1 se conecta a PC4 a través del puerto del switch F0/2 que tiene la letra D junto a él. S2 se conecta a S3 a través del puerto del switch F0/2, que tiene la letra D junto a él y se conecta a S1 a través del puerto del switch F0/1 que tiene la letra R junto a él. El enlace entre S2 y S3 se etiqueta Trunk 2. S2 se conecta a PC1 a través del puerto del switch F0/11, se conecta a PC2 a través del puerto del switch F0/18 y a PC3 a través del puerto del switch F0/6. S3 se conecta a S2 sobre el puerto del switch F0/2 que como la letra A junto a él y se conecta a S1 sobre el puerto del switch F0/1 que tiene la letra R junto a él. Se coloca un símbolo X rojo en el enlace troncal entre S3 y S2. La dirección IP de PC1 es 172.17.10.21. La dirección IP de PC2 es 172.17.10.22. La dirección IP de PC3 es 172.17.10.23. Un cuadro de texto lee PortFast y BPDU Guard y tiene flechas que apuntan a los tres puertos del conmutador en S2, F0/11, F0/18 y F0/6.
PC2 PC1 PC3 S3 S1 S2 F0/1 172.17.10.21 172.17.10.23 172.17.10.22 F0/2 F0/2 F0/1 F0/2 F0/1 F0/11 F0/6
F0/18
Enlace troncal 3Enlace troncal 1Enlace troncal 2PortFast y protección BPDUDDDRRA

En una configuración de PortFast válida, nunca se deben recibir BPDU, ya que esto indicaría que hay otro puente o switch conectado al puerto, lo que podría causar un bucle de árbol de expansión. Esto potencialmente causa un bucle de árbol de expansión. Para evitar que se produzca este tipo de escenario, los switches Cisco admiten una función llamada guardia BPDU. Cuando está habilitado, inmediatamente pone el puerto del conmutador en un estado errdisabled (error-disabled) al recibir cualquier BPDU. Esto protege contra posibles bucles al apagar eficazmente el puerto. La característica de protección BPDU proporciona una respuesta segura a la configuración no válida, ya que se debe volver a activar la interfaz de forma manual.
5.3.5
Alternativas a STP

STP era y sigue siendo un protocolo de prevención de bucles Ethernet. A lo largo de los años, las organizaciones requerían una mayor resiliencia y disponibilidad en la LAN. Las LAN Ethernet pasaron de unos pocos conmutadores interconectados conectados conectados a un único enrutador, a un sofisticado diseño de red jerárquica que incluye conmutadores de acceso, distribución y capa central, como se muestra en la figura.

Dos topologías de red físicas que muestran un diseño de red jerárquico y un diseño de núcleo contraído
Núcleo contraídoInternetInternetInternetInternetCapa de núcleo centralCapa de distribuciónCapa de acceso

Dependiendo de la implementación, la capa 2 puede incluir no solo la capa de acceso, sino también la distribución o incluso las capas principales. Estos diseños pueden incluir cientos de switches, con cientos o incluso miles de VLAN. STP se ha adaptado a la redundancia y complejidad añadida con mejoras, como parte de RSTP y MSTP.

Un aspecto importante del diseño de red es la convergencia rápida y predecible cuando se produce un error o un cambio en la topología. El árbol de expansión no ofrece las mismas eficiencias y predecibilidades proporcionadas por los protocolos de enrutamiento en la Capa 3. La figura muestra un diseño de red jerárquica tradicional con los conmutadores multicapa de distribución y núcleo que realizan enrutamiento.

La topología de red física muestra cuatro conmutadores de capa 3, tres conmutadores de capa 2 y seis PC. Dos switches de capa 3 en la parte superior de la topología están en el núcleo. Dos switches de capa 3 están en la capa de distribución. Los tres conmutadores de capa 2 y los seis equipos están en la capa Access.
NúcleoDistribuciónAccesoRouting de capa 3Switching de capa 2

El enrutamiento de capa 3 permite rutas y bucles redundantes en la topología, sin bloquear puertos. Por esta razón, algunos entornos están en transición a la capa 3 en todas partes, excepto donde los dispositivos se conectan al conmutador de capa de acceso. En otras palabras, las conexiones entre los conmutadores de capa de acceso y los conmutadores de distribución serían Capa 3 en lugar de Capa 2, como se muestra en la siguiente figura.

La topología de red física muestra siete switches de capa 3 y seis PC. Dos switches de capa 3 en la parte superior de la topología están en el núcleo. Dos switches de capa 3 están en la capa de distribución. Tres conmutadores de capa 3 están conectando las capas de distribución y acceso. Los seis equipos están completamente en la capa Access.
NúcleoDistribuciónAccesoRouting de capa 3Switching de capa 2

Aunque es muy probable que STP siga utilizándose como mecanismo de prevención de bucles en la empresa, en los conmutadores de capa de acceso también se están utilizando otras tecnologías, incluidas las siguientes:

Agregación de enlaces de

    Múltiples sistemas (MLAG)
    Puente de ruta más corta (SPB)
    Interconexión transparente de muchos enlaces. (TRILL)

Note: Estas tecnologías están fuera del alcance de este curso.
5.3.6
Compruebe su comprensión - Evolución de STP

Compruebe su comprensión de la evolución de STP eligiendo la mejor respuesta a las siguientes preguntas.

    ¿Qué tres estados de puerto STP se fusionan en el estado de puerto de descarte RSTP? (Escoja tres opciones).

¿Qué protocolo fue diseñado para lograr una convergencia más rápida a STP?

¿Qué tecnología resuelve el problema de que un dispositivo no pueda obtener una dirección IPv4 de un servidor DHCP debido a los temporizadores de retardo de reenvío STP?

Práctica del módulo y cuestionario
5.4.1
¿Qué aprenderé en este módulo?

Propósito de STP

Las rutas redundantes en una red Ethernet conmutada pueden causar bucles de Capa 2 físicos y lógicos. Un bucle de capa 2 puede provocar inestabilidad en la tabla de direcciones MAC, saturación de enlaces y alta utilización de CPU en conmutadores y dispositivos finales. Esto hace que la red se vuelva inutilizable. A diferencia de los protocolos de Capa 3, IPv4 e IPv6, Layer 2 Ethernet no incluye un mecanismo para reconocer y eliminar tramas de bucle sin fin. Las LAN Ethernet requieren una topología sin bucles con una única ruta entre dos dispositivos. STP es un protocolo de red de prevención de bucles que permite redundancia mientras crea una topología de capa 2 sin bucles. Sin STP, se pueden formar bucles de capa 2, lo que hace que las tramas de difusión, multidifusión y unicast desconocidos se reproduzcan sin fin, lo que reduce una red. Una tormenta de difusión es un número anormalmente alto de emisiones que abruman la red durante un período específico de tiempo. Las tormentas de difusión pueden deshabilitar una red en cuestión de segundos al abrumar los conmutadores y los dispositivos finales. STP se basa en un algoritmo inventado por Radia Perlman. Su algoritmo de árbol de expansión (STA) crea una topología sin bucles al seleccionar un único puente raíz donde todos los demás conmutadores determinan una única ruta de menor costo.

Operaciones STP

Usando STA, STP crea una topología sin bucles en un proceso de cuatro pasos: elija el puente raíz, elija los puertos raíz, elija los puertos designados y elija los puertos alternativos (bloqueados). Durante las funciones STA y STP, los conmutadores utilizan BPDU para compartir información sobre sí mismos y sus conexiones. Las BPDU se utilizan para elegir el puente raíz, los puertos raíz, los puertos designados y los puertos alternativos. Cada BPDU contiene un BID que identifica al switch que envió la BPDU. El BID participa en la toma de muchas de las decisiones STA, incluidos los roles de puente raíz y puerto. El BID contiene un valor de prioridad, la dirección MAC del conmutador y un ID de sistema extendido. El valor de BID más bajo lo determina la combinación de estos tres campos. El switch que tiene el BID más bajo se convierte en el puente raíz. Dado que el BID predeterminado es 32.768, es posible que dos o más conmutadores tengan la misma prioridad. En este escenario, donde las prioridades son las mismas, el conmutador con la dirección MAC más baja se convertirá en el puente raíz. Cuando se ha elegido el puente raíz para una instancia de árbol de expansión dado, el STA determina las mejores rutas al puente raíz desde todos los destinos en el dominio de difusión. La información de la ruta, conocida como el costo interno de la ruta raíz, está determinada por la suma de todos los costos de los puertos individuales a lo largo de la ruta desde el conmutador hasta el puente raíz. Después de determinar el puente raíz, el algoritmo STA selecciona el puerto raíz. El puerto raíz es el puerto más cercano al puente raíz en términos de costo total, que se denomina costo de ruta raíz interna. Después de que cada switch selecciona un puerto raíz, los switches seleccionarán los puertos designados. El puerto designado es un puerto en el segmento (con dos switches) que tiene el costo de ruta raíz interna al puente raíz. Si un puerto no es un puerto raíz o un puerto designado, se convierte en un puerto alternativo (o de copia de seguridad). Los puertos alternativos y los puertos de respaldo están en estado de descarte o bloqueo para evitar bucles. Cuando un switch tiene varias rutas de igual costo al puente raíz, el switch determinará un puerto utilizando los siguientes criterios: BID del remitente más bajo, prioridad del puerto del remitente más bajo y, finalmente, el ID del puerto del remitente más bajo. La convergencia STP requiere tres temporizadores: el temporizador de saludo, el temporizador de retardo de avance y el temporizador de edad máxima. Los estados de puerto están bloqueando, escuchando, aprendiendo, reenviando y deshabilitados. En las versiones PVST de STP, hay un puente raíz elegido para cada instancia de árbol de expansión. Esto hace posible tener diferentes puentes raíz para diferentes conjuntos de VLAN.

Evolución de STP

El término Protocolo Spanning Tree y el acrónimo STP pueden ser engañosos. STP se utiliza a menudo para hacer referencia a las diversas implementaciones del árbol de expansión, como RSTP y MSTP. RSTP es una evolución de STP que proporciona una convergencia más rápida que STP. Los estados del puerto RSTP están aprendiendo, reenviando y descartando. PVST + es una mejora de Cisco de STP que proporciona una instancia de árbol de expansión separada para cada VLAN configurada en la red. PVST + admite PortFast, UplinkFast, BackboneFast, protección BPDU, filtro BPDU, protección raíz y protección de bucle. Los switches de Cisco con IOS 15.0 o posterior ejecutan PVST+ de manera predeterminada. Rapid PVST+ es una mejora de Cisco de RSTP que utiliza PVST+ y proporciona una instancia independiente de 802.1w por VLAN. Cuando un puerto de conmutador se configura con PortFast, ese puerto pasa del bloqueo al estado de reenvío inmediatamente, omitiendo los estados de escucha y aprendizaje STP y evitando un retraso de 30 segundos. Use PortFast en los puertos de acceso para permitir que los dispositivos conectados a estos puertos, como los clientes DHCP, accedan a la red de inmediato, en lugar de esperar a que STP converja en cada VLAN. Los switches Cisco admiten una función llamada BPDU guard que coloca inmediatamente el puerto del switch en un estado de error deshabilitado al recibir cualquier BPDU para protegerlo contra posibles bucles. A lo largo de los años, las LAN Ethernet pasaron de unos pocos conmutadores interconectados conectados conectados a un único router, a un sofisticado diseño de red jerárquica. Dependiendo de la implementación, la capa 2 puede incluir no solo la capa de acceso, sino también la distribución o incluso las capas principales. Estos diseños pueden incluir cientos de switches, con cientos o incluso miles de VLAN. STP se ha adaptado a la redundancia y complejidad añadida con mejoras como parte de RSTP y MSTP. El enrutamiento de capa 3 permite rutas y bucles redundantes en la topología, sin bloquear puertos. Por esta razón, algunos entornos están en transición a la capa 3 en todas partes, excepto donde los dispositivos se conectan al conmutador de capa de acceso.
5.4.2
Preguntas del módulo - STP

    ¿A qué estado de puerto cambiarán los puertos inmediatamente cuando estén configurados para PortFast?

Después de que se haya completado la elección del puente raíz, ¿cómo encontrarán los switches los mejores caminos hacia el puente raíz?

¿Qué función de puerto de STP adopta un puerto de switch si no hay ningún otro puerto con un costo menor al puente raíz?

¿Qué valor determina el puente raíz cuando todos los switches conectados mediante enlaces troncales tienen configuraciones de STP predeterminadas?

Durante la implementación del protocolo de árbol de expansión, el administrador de red reinicia todos los conmutadores. ¿Cuál es el primer paso del proceso electoral de árbol expandido?

¿Qué dos conceptos se relacionan con un puerto de switch que se crea para tener solo terminales conectados y nunca para ser utilizado para conectarse a otro switch? (Elija dos opciones).

¿Qué tres estados de puerto utiliza Rapid PVST+? (Escoja tres opciones).

Cuando PVST se ejecuta a través de una red conmutada, ¿qué estado de puerto puede participar en el reenvío de tramas BPDU basado en BPDU recibidas, pero no reenvía tramas de datos?

¿Qué función de puerto de STP adopta un puerto de switch si no hay ningún otro puerto con un costo menor al puente raíz?

¿Qué dos afirmaciones describen un puerto de switch configurado con PortFast? (Elija dos opciones).

Cuando PVST se ejecuta a través de una red conmutada, ¿qué estado de puerto puede participar en el reenvío de tramas BPDU basado en BPDU recibidas, pero no reenvía tramas de datos?

¿Qué información adicional contiene el ID de sistema extendido de 12 bits de una BPDU?

Un administrador está solucionando problemas de un conmutador y desea verificar si se trata de un puente raíz. ¿Qué comando se puede usar para hacer esto?

¿Qué es una descripción precisa de la redundancia?

6 EtherChannel

Introducción
6.0.1
¿Por qué debería tomar este módulo?

¡Bienvenido a EtherChannel!

El diseño de la red incluye switches y enlaces redundantes. Usted tiene alguna versión de STP configurada para evitar bucles de Capa 2. Pero ahora usted, como la mayoría de los administradores de red, se da cuenta de que podría usar más ancho de banda y redundancia en su red. ¡Nada de qué preocuparse, EtherChannel está aquí para ayudarle! EtherChannel agrega enlaces entre dispositivos en paquetes. Estos paquetes incluyen enlaces redundantes. STP puede bloquear uno de esos enlaces, pero no los bloqueará todos. ¡Con EtherChannel su red puede tener redundancia, prevención de bucles y mayor ancho de banda!

Hay dos protocolos, PAgP y LACP. Este módulo explica ambos y también muestra cómo configurarlos, verificarlos y solucionarlos. Un Verificador de sintaxis y dos actividades Packet Tracer le ayudan a comprender mejor estos protocolos. ¿Qué está esperando?
6.0.2
¿Qué aprenderé en este módulo?

Título del módulo: EtherChannel

Objetivos del módulo: Resuelva problemas de EtherChannel en enlaces conmutados.
Leyenda de la tabla
Título del tema 	Objetivo del tema
Funcionamiento de EtherChannel 	Describa la tecnología EtherChannel.
Configuración de EtherChannel 	Configure EtherChannel.
Verificación y solución de problemas de EtherChannel 	Solucione problemas de EtherChannel.

Funcionamiento de EtherChannel
6.1.1
Añadidura de enlaces

Hay escenarios en los que se necesita más ancho de banda o redundancia entre dispositivos que lo que puede proporcionar un único enlace. Se pueden conectar varios enlaces entre dispositivos para aumentar el ancho de banda. Sin embargo, el Spanning Tree Protocol (STP), que está habilitado en dispositivos de capa 2 como switches de Cisco de forma predeterminada, bloqueará enlaces redundantes para evitar bucles de switching, como se muestra en la figura.

Se necesita una tecnología de agregación de enlaces que permita enlaces redundantes entre dispositivos que no serán bloqueados por STP. Esa tecnología se conoce como EtherChannel.

EtherChannel es una tecnología de agregación de enlaces que agrupa varios enlaces Ethernet físicos en un único enlace lógico. Se utiliza para proporcionar tolerancia a fallos, uso compartido de carga, mayor ancho de banda y redundancia entre switches, routers y servidores.

La tecnología de EtherChannel hace posible combinar la cantidad de enlaces físicos entre los switches para aumentar la velocidad general de la comunicación switch a switch.

dos switches multicapa conectados cada uno a un switch LAN a través de dos conexiones de red físicas; una de las dos conexiones se muestra como bloqueada por STP
Bloqueado

De manera predeterminada, STP bloquea los enlaces redundantes.
6.1.2
EtherChannel

En los inicios, Cisco desarrolló la tecnología EtherChannel como una técnica switch a switch LAN para agrupar varios puertos Fast Ethernet o gigabit Ethernet en un único canal lógico. Cuando se configura un EtherChannel, la interfaz virtual resultante se denomina “canal de puertos”. Las interfaces físicas se agrupan en una interfaz de canal de puertos, como se muestra en la figura.

dos switches multicapa conectados cada uno a un switch LAN a través de dos conexiones de red físicas; ambas conexiones se han combinado en un EtherChannel
EtherChannelEtherChannel
6.1.3
Ventajas de EtherChannel

La tecnología EtherChannel tiene muchas ventajas, que incluye:

    La mayoría de las tareas de configuración se pueden realizar en la interfaz EtherChannel en lugar de en cada puerto individual, lo que asegura la coherencia de configuración en todos los enlaces.
    EtherChannel depende de los puertos de switch existentes. No es necesario actualizar el enlace a una conexión más rápida y más costosa para tener más ancho de banda.
    El equilibrio de carga ocurre entre los enlaces que forman parte del mismo EtherChannel. Según la plataforma de hardware, se pueden implementar uno o más métodos de equilibrio de carga. Estos métodos incluyen equilibrio de carga de la MAC de origen a la MAC de destino o equilibrio de carga de la IP de origen a la IP de destino, a través de enlaces físicos.
    EtherChannel crea una agregación que se ve como un único enlace lógico. Cuando existen varios grupos EtherChannel entre dos switches, STP puede bloquear uno de los grupos para evitar los bucles de switching. Cuando STP bloquea uno de los enlaces redundantes, bloquea el EtherChannel completo. Esto bloquea todos los puertos que pertenecen a ese enlace EtherChannel. Donde solo existe un único enlace EtherChannel, todos los enlaces físicos en el EtherChannel están activos, ya que STP solo ve un único enlace (lógico).
    EtherChannel proporciona redundancia, ya que el enlace general se ve como una única conexión lógica. Además, la pérdida de un enlace físico dentro del canal no crea ningún cambio en la topología. Por lo tanto, no es necesario volver a calcular el árbol de expansión. Suponiendo que haya por lo menos un enlace físico presente, el EtherChannel permanece en funcionamiento, incluso si su rendimiento general disminuye debido a la pérdida de un enlace dentro del EtherChannel.

6.1.4
Restricciones de implementación

EtherChannel tiene ciertas restricciones de implementación, entre las que se incluyen las siguientes:

    No pueden mezclarse los tipos de interfaz. Por ejemplo, Fast Ethernet y Gigabit Ethernet no se pueden mezclar dentro de un único EtherChannel.
    En la actualidad, cada EtherChannel puede constar de hasta ocho puertos Ethernet configurados de manera compatible. El EtherChannel proporciona un ancho de banda full-duplex de hasta 800 Mbps (Fast EtherChannel) u 8 Gbps (Gigabit EtherChannel) entre un switch y otro switch o host.
    El switch Cisco Catalyst 2960 Layer 2 soporta actualmente hasta seis EtherChannels. Sin embargo, a medida que se desarrollan nuevos IOS y cambian las plataformas, algunas tarjetas y plataformas pueden admitir una mayor cantidad de puertos dentro de un enlace EtherChannel, así como una mayor cantidad de Gigabit EtherChannels.
    La configuración de los puertos individuales que forman parte del grupo EtherChannel debe ser coherente en ambos dispositivos. Si los puertos físicos de un lado se configuran como enlaces troncales, los puertos físicos del otro lado también se deben configurar como enlaces troncales dentro de la misma VLAN nativa. Además, todos los puertos en cada enlace EtherChannel se deben configurar como puertos de capa 2.
    Cada EtherChannel tiene una interfaz de canal de puertos lógica, como se muestra en la figura. La configuración aplicada a la interfaz de canal de puertos afecta a todas las interfaces físicas que se asignan a esa interfaz.

El diagrama ilustra la vista frontal de un switch 2960 que muestra los enlaces de grupos de canales de múltiples puertos físicos 10/100/1000 en interfaces lógicas de canal de puerto. Una interfaz de canal de puerto lógico une los puertos físicos 1 - 6 juntos y la otra une los puertos 9 - 12 juntos.
Catalyst 2960 SERIES MODE SYS T S T R T U T I L D U P L X   S P E E D RPS 1 2 3 4 5 6 7 8 9 10 1 1
12
Interfaz del canal
de puerto lógicoInterfaz del canal
de puerto lógicoUnión de grupo
de canalesPuertos 10/100/1000Puertos físicos
6.1.5
Protocolos de negociación automática

Los EtherChannels se pueden formar por medio de una negociación con uno de dos protocolos: Port Aggregation Protocol (PAgP) o Link Aggregation Control Protocol (LACP). Estos protocolos permiten que los puertos con características similares formen un canal mediante una negociación dinámica con los switches adyacentes.

Nota: También es posible configurar un EtherChannel estático o incondicional sin PAgP o LACP.
6.1.6
Funcionamiento PAgP

PAgP (pronunciado “Pag - P”) es un protocolo patentado por Cisco que ayuda en la creación automática de enlaces EtherChannel. Cuando se configura un enlace EtherChannel mediante PAgP, se envían paquetes PAgP entre los puertos aptos para EtherChannel para negociar la formación de un canal. Cuando PAgP identifica enlaces Ethernet compatibles, agrupa los enlaces en un EtherChannel. El EtherChannel después se agrega al árbol de expansión como un único puerto.

Cuando se habilita, PAgP también administra el EtherChannel. Los paquetes PAgP se envían cada 30 segundos. PAgP revisa la coherencia de la configuración y administra los enlaces que se agregan, así como las fallas entre dos switches. Cuando se crea un EtherChannel, asegura que todos los puertos tengan el mismo tipo de configuración.

Nota: En EtherChannel, es obligatorio que todos los puertos tengan la misma velocidad, la misma configuración de dúplex y la misma información de VLAN. Cualquier modificación de los puertos después de la creación del canal también modifica a los demás puertos del canal.

PAgP ayuda a crear el enlace EtherChannel al detectar la configuración de cada lado y asegurarse de que los enlaces sean compatibles, de modo que se pueda habilitar el enlace EtherChannel cuando sea necesario. Los modos de PAgP de la siguiente manera:

    On - Este modo obliga a la interfaz a proporcionar un canal sin PAgP. Las interfaces configuradas en el modo encendido no intercambian paquetes PAgP.
    PAgP deseable - Este modo PAgP coloca una interfaz en un estado de negociación activa en el que la interfaz inicia negociaciones con otras interfaces al enviar paquetes PAgP.
    PAgP automático - Este modo PAgP coloca una interfaz en un estado de negociación pasiva en el que la interfaz responde a los paquetes PAgP que recibe, pero no inicia la negociación PAgP.

Los modos deben ser compatibles en cada lado. Si se configura un lado en modo automático, se coloca en estado pasivo, a la espera de que el otro lado inicie la negociación del EtherChannel. Si el otro lado se establece en modo automático, la negociación nunca se inicia y no se forma el canal EtherChannel. Si se deshabilitan todos los modos usando no el comando, o si se configura el modo no, el EtherChannel se deshabilitará.

El modo encendido coloca manualmente la interfaz en un EtherChannel, sin ninguna negociación. Funciona solo si el otro lado también se establece en modo encendido. Si el otro lado se establece para negociar los parámetros a través de PAgP, no se forma ningún EtherChannel, ya que el lado que se establece en modo encendido no negocia.

El hecho de que no haya negociación entre los dos switches significa que no hay un control para asegurarse de que todos los enlaces en el EtherChannel terminen del otro lado o de que haya compatibilidad con PAgP en el otro switch.
6.1.7
Ejemplo de configuración del modo PAgP

Considere los dos switches en la figura. Si S1 y S2 establecen un EtherChannel usando PAgP depende de la configuración de modo en cada lado del canal.

dos switches LAN conectados entre sí a través de dos conexiones de red físicas que han formado un EtherChannel mediante PAgP
S1
S2
PAgP

La tabla muestra las diversas combinaciones de modos PAgP en S1 y S2 y el resultado del establecimiento de canales.
PAgP Modes
Canal S1s2 EstablishmentOnOnYesOnDesirable/AutoNoDesirableDesirableYesDesirableAutoYesAutoDesirableYesAutoAutoNo
S1 	S2 	Establecimiento del canal
Activo	Activo	Sí
Activado	Desdeseable/Automático	No
Deseado	Deseado	Sí
Deseado	Automático	Sí 
Automático	Deseado	Sí
Automático	Automático	No
6.1.8
Operación LACP

LACP forma parte de una especificación IEEE (802.3ad) que permite agrupar varios puertos físicos para formar un único canal lógico. LACP permite que un switch negocie un grupo automático mediante el envío de paquetes LACP al otro switch. Realiza una función similar a PAgP con EtherChannel de Cisco. Debido a que LACP es un estándar IEEE, se puede usar para facilitar los EtherChannels en entornos de varios proveedores. En los dispositivos de Cisco, se admiten ambos protocolos.

Nota: LACP en los inicios, se definió como IEEE 802.3ad. Sin embargo, LACP ahora se define en el estándar más moderno IEEE 802.1AX para la redes de área local y metropolitana.

LACP proporciona los mismos beneficios de negociación que PAgP. LACP ayuda a crear el enlace EtherChannel al detectar la configuración de cada lado y al asegurarse de que sean compatibles, de modo que se pueda habilitar el enlace EtherChannel cuando sea necesario. Los modos para LACP son los siguientes:

    On - Este modo obliga a la interfaz a proporcionar un canal sin LACP. Las interfaces configuradas en el modo encendido no intercambian paquetes LACP.
    LACP activo - Este modo de LACP coloca un puerto en estado de negociación activa. En este estado, el puerto inicia negociaciones con otros puertos mediante el envío de paquetes LACP.
    LACP pasivo - Este modo de LACP coloca un puerto en estado de negociación pasiva. En este estado, el puerto responde a los paquetes LACP que recibe, pero no inicia la negociación de paquetes LACP.

Al igual que con PAgP, los modos deben ser compatibles en ambos lados para que se forme el enlace EtherChannel. Se repite el modo encendido, ya que crea la configuración de EtherChannel incondicionalmente, sin la negociación dinámica de PAgP o LACP.

El protocolo LACP permite ocho enlaces activos y, también, ocho enlaces de reserva. Un enlace de reserva se vuelve activo si falla uno de los enlaces activos actuales.
6.1.9
Ejemplo de configuración del modo LACP

Considere los dos switches en la figura. Si S1 y S2 establecen un EtherChannel usando LACP depende de la configuración de modo en cada lado del canal.

dos switches LAN conectados entre sí a través de dos conexiones de red físicas que han formado un EtherChannel utilizando LACP
S1
S2
LACP

La tabla muestra las diversas combinaciones de modos LACP en S1 y S2 y el resultado resultante del establecimiento de canales.
Canal S1s2 EstablishmentOnOnYesOnActive/PassiveNoActiveActiveYesActivePassiveYesPassiveActiveYesPassivePassiveNo
S1 	S2 	Establecimiento del canal
Activo	Activo	Sí
Activado	Activo/pasivo	No
Activo	Activo	Sí
Activo	Pasivo	Sí 
Pasivo	Activo	Sí
Pasivo	Pasivo	No
6.1.10
Verifique su comprensión - Funcionamiento de EtherChannel

Verifique su comprensión del funcionamiento de EtherChannel eligiendo la MEJOR respuesta a las siguientes preguntas.

    ¿Cuáles son los beneficios de la tecnología EtherChannel? (Elija todas las opciones que correspondan).

¿Verdadero o falso? Los enlaces FastEthernet y GigabitEthernet se pueden combinar en un único EtherChannel.

¿Verdadero o falso? PAgP y LACP son protocolos de agregación de enlaces propiedad de Cisco.

¿Cuáles son los tres modos de interfaz PAgP? (Escoja tres opciones).

¿Qué modo de interfaz PAgP iniciará la negociación con otras interfaces?

¿Qué combinaciones de modos PAgP formarán un EtherChannel? (Elija todas las opciones que correspondan).

Configuración de EtherChannel
6.2.1
Instrucciones de configuración

Ahora que ya sabe qué es EtherChannel, en este tema se explica cómo configurarlo. Las siguientes pautas y restricciones son útiles para configurar EtherChannel:

    Soporte de EtherChannel - Todas las interfaces Ethernet deben admitir EtherChannel, sin necesidad de que las interfaces sean físicamente contiguas
    Velocidad y dúplex - Configure todas las interfaces en un EtherChannel para que funcionen a la misma velocidad y en el mismo modo dúplex.
    Coincidencia VLAN - Todas las interfaces en el grupo EtherChannel se deben asignar a la misma VLAN o se deben configurar como enlace troncal (mostrado en la figura).
    Rango de VLAN - An EtherChannel supports the same allowed range of VLANs on all the interfaces in a trunking EtherChannel. If the allowed range of VLANs is not the same, the interfaces do not form an EtherChannel, even when they are set to modo or auto desirable.

La figura muestra una configuración que permitiría que se forme un EtherChannel entre el S1 y el S2.

El diagrama muestra dos switches LAN conectados entre sí a través de dos conexiones de red físicas que han formado un EtherChannel basado en sus configuraciones de puerto. Las configuraciones de puertos S1 y S2 son; velocidad de 1 Gbps, dúplex completo y VLAN 10.
Configuración de puertos del S1
Velocidad 	1 Gbps
Dúplex 	Completo
VLAN 	10
Configuración de puertos del S2
Velocidad 	1 Gbps
Dúplex 	Completo
VLAN 	10
EtherChannel formado

Un EtherChannel se forma cuando los ajustes de configuración coinciden en ambos switches.

En la siguiente figura, los puertos de S1 están configurados en modo semidúplex. Por lo tanto, no se formará un EtherChannel entre el S1 y el S2.

El diagam muestra dos switches LAN conectados entre sí a través de dos conexiones de red físicas que no han formado un EtherChannel en función de sus configuraciones de puerto. Las configuraciones de puerto S1 son; velocidad de 1 Gbps, mitad dúplex y VLAN 10. Las configuraciones de puertos S2 son; velocidad de 1 Gbps, dúplex completo y VLAN 10.
Configuración de puertos del S1
Velocidad 	1 Gbps
Dúplex 	Medio
VLAN 	10
Configuración de puertos del S2
Velocidad 	1 Gbps
Dúplex 	Completo
VLAN 	10
EtherChannel no formado

Un EtherChannel no se forma cuando los ajustes de configuración son diferentes en cada switch.

Si se deben modificar estos parámetros, configúrelos en el modo de configuración de interfaz de canal de puertos. Cualquier configuración que se aplique a la interfaz de canal de puertos también afectará a las interfaces individuales. Sin embargo, las configuraciones que se aplican a las interfaces individuales no afectan a la interfaz de canal de puertos. Por ello, realizar cambios de configuración a una interfaz que forma parte de un enlace EtherChannel puede causar problemas de compatibilidad de interfaces.

El canal de puertos se puede configurar en modo de acceso, modo de enlace troncal (más frecuente) o en un puerto enrutado.
6.2.2
Ejemplo de Configuración de LACP

EtherChannel está deshabilitado de forma predeterminada y debe configurarse. La topología de la figura se utilizará para demostrar un ejemplo de configuración de EtherChannel utilizando LACP.

dos switches, S1 y S2, están conectados entre sí a través de dos conexiones de red físicas que han formado un EtherChannel; el puerto F0/1 en S1 está conectado al puerto F0/1 en S2; el puerto F0/2 en S1 está conectado al puerto F0/2 en S2
S2 S1 Fa0/1 Fa0/1 Fa0/2
Fa0/2

La configuración de EtherChannel con LACP requiere tres pasos:

Paso 1. Especifique las interfaces que conforman el grupo EtherChannel mediante el interface range el comando de modo de configuración interface global. La palabra clave range le permite seleccionar varias interfaces y configurarlas a la vez.

Paso 2. Cree la interfaz port channel con el channel-group comando mode active identifier en el modo de configuración de interface range. El identificador especifica el número del grupo del canal. Las mode active palabras clave identifican a esta configuración como EtherChannel LACP.

Paso 3. Para cambiar la configuración de capa 2 en la interfaz de canal de puertos, ingrese al modo de configuración de interfaz de canal de puertos mediante el interface port-channel comando, seguido del identificador de la interfaz. En el ejemplo, S1 está configurado con un EtherChannel LACP. El canal de puertos está configurado como interfaz de enlace troncal con VLAN permitidas específicas.

S1(config)# interface range FastEthernet 0/1 - 2
S1(config-if-range)# channel-group 1 mode active
Creating a port-channel interface Port-channel 1
S1(config-if-range)# exit
S1(config)# interface port-channel 1
S1(config-if)# switchport mode trunk
S1(config-if)# switchport trunk allowed vlan 1,2,20

6.2.3
Verificador de sintaxis - Configuración EtherChannel

Configurar EtherChannel para S2 en función de los requisitos especificados

dos switches, S1 y S2, están conectados entre sí a través de dos conexiones de red físicas que han formado un EtherChannel; el puerto F0/1 en S1 está conectado al puerto F0/1 en S2; el puerto F0/2 en S1 está conectado al puerto F0/2 en S2
S2 S1 Fa0/1 Fa0/1 Fa0/2
Fa0/2

Ingrese al modo interface range para FastEthernet0/1 y FastEthernet0/2. Úselo fa 0/1 - 2 como designación de interfaz.

S1(config)#interface range fa 0/1 - 2

Usar ayuda sensible al contexto (?) para mostrar las opciones del channel-group comando.
S1(config-if-range)#channel-group ?

<1-6> Channel group number

Seleccione channel-group 1 y muestre la siguiente opción.
S1(config-if-range)#channel-group 1 ?

mode Etherchannel Mode of the interface

Introduzca la mode palabra clave y muestre las siguientes opciones.
S1(config-if-range)#channel-group 1 mode ?

active     Enable LACP unconditionally  
auto       Enable PAgP only if a PAgP device is   detected  
desirable  Enable PAgP unconditionally  
on         Enable Etherchannel only  
passive    Enable LACP only if a LACP device is detected

Configure el grupo de canales para que use LACP incondicionalmente.
S1(config-if-range)#channel-group 1 mode active

*Mar 21 00:02:28.184: %LINEPROTO-5-UPDOWN: Line protocol on Interface FastEthernet0/1, changed state   
to down   
*Mar 21 00:02:28.193: %LINEPROTO-5-UPDOWN: Line protocol on Interface FastEthernet0/2, changed state   
to down   
*Mar 21 00:02:36.179: %LINEPROTO-5-UPDOWN: Line protocol on Interface FastEthernet0/1, changed state   
to up   
*Mar 21 00:02:36.674: %LINEPROTO-5-UPDOWN: Line protocol on Interface FastEthernet0/2, changed state   
to up    
*Mar 21 00:04:31.170: %LINEPROTO-5-UPDOWN: Line protocol on Interface FastEthernet0/1, changed state   
to down   
*Mar 21 00:04:31.186: %LINEPROTO-5-UPDOWN: Line protocol on Interface FastEthernet0/2, changed state   
to down   
*Mar 21 00:04:33.116: %LINEPROTO-5-UPDOWN: Line protocol on Interface FastEthernet0/1, changed state   
to up   
*Mar 21 00:04:34.114: %LINK-3-UPDOWN: Interface Port-channel1, changed state to up   
*Mar 21 00:04:35.037: %LINEPROTO-5-UPDOWN: Line protocol on Interface FastEthernet0/2, changed state   
to up   
*Mar 21 00:04:35.121: %LINEPROTO-5-UPDOWN: Line protocol on Interface Port-channel1, changed state to   
up

Configure los parámetros de switchport para el canal de puertos que se creó.

    Enter interface configuration mode for canal de puertos 1
    Configurar el canal de puerto 1 como troncal
    Allow VLANS 1,2,20 para cruzar el enlace troncal. Introduzca las VLAN como se muestra sin espacios.

S1(config-if-range)#interface port-channel 1
S1(config-if)#switchport mode trunk
S1(config-if)#switchport trunk allowed vlan 1,2,20

Configuró correctamente EtherChannel.

Verificación y solución de problemas de EtherChannel
6.3.1
Verificar EtherChannel

Como siempre, al configurar dispositivos en su red, debe verificar su configuración. Si hay problemas, también deberá poder solucionarlos y solucionarlos. En este tema se proporcionan los comandos que se deben verificar, así como algunos problemas comunes de red EtherChannel y sus soluciones.

Los ejemplos de comandos de verificación utilizarán la topología mostrada en la figura.

dos switches, S1 y S2, están conectados entre sí a través de dos conexiones de red físicas que han formado un EtherChannel; el puerto F0/1 en S1 está conectado al puerto F0/1 en S2; el puerto F0/2 en S1 está conectado al puerto F0/2 en S2
S2 S1 Fa0/1 Fa0/2 Fa0/2
Fa0/1

Existe una variedad de comandos para verificar una configuración EtherChannel. Haga clic en cada botón para obtener una explicación y un resultado de comando.

show interfaces port-channel

El show interfaces port-channel commando muestra el estado general de la interfaz de canal de puertos. En la figura, la interfaz de canal de puertos 1 está activa.

S1# show interfaces port-channel 1
Port-channel1 is up, line protocol is up (connected)
  Hardware is EtherChannel, address is c07b.bcc4.a981 (bia c07b.bcc4.a981)
  MTU 1500 bytes, BW 200000 Kbit/sec, DLY 100 usec,
     reliability 255/255, txload 1/255, rxload 1/255
(resultado omitido)

show etherchannel summary 

Cuando se configuren varias interfaces de canal de puertos en el mismo dispositivo, puede usar el comando show etherchannel summary para mostrar una única línea de información por canal de puertos. En el resultado, el switch tiene un EtherChannel configurado; el grupo 1 utiliza el LACP.

El grupo de interfaces consta de las interfaces FastEthernet0/1 y FastEthernet0/2. El grupo es un EtherChannel de capa 2 y está en uso, según lo indican las letras SU junto al número de canal de puertos.

S1# show etherchannel summary
Flags: D - down P - bundled in port-channel
        I - stand-alone s - suspended
        H - Hot-standby (LACP only)
        R - Layer3 S - Layer2
        U - in use N - not in use, no aggregation
        f - failed to allocate aggregator
        M - not in use, minimum links not met
        m - not in use, port not aggregated due to minimum links not met
        u - unsuitable for bundling
        w - waiting to be aggregated
        d - default port
        A - formed by Auto LAG
Number of channel-groups in use: 1
Number of aggregators: 1
Group Port-channel Protocol Ports
------+-------------+-----------+-----------------------------------------------
1 Po1(SU) LACP Fa0/1(P) Fa0/2(P)

show etherchannel port-channel

Use el comando show etherchannel port-channel para mostrar información sobre la interfaz del canal de puertos específica, como se muestra en el resultado. En el ejemplo, la interfaz de canal de puertos 1 consta de dos interfaces físicas, FastEthernet0/1 y FastEthernet0/2. Esta usa LACP en modo activo. Está correctamente conectada a otro switch con una configuración compatible, razón por la cual se dice que el canal de puertos está en uso.

S1# show etherchannel port-channel
                Channel-group listing:
                —
Group: 1
----------
                Canales de puerto en el grupo:
                ---------------------------
Canal de puerto: Po1 (agregador principal)
------------
Age of the Port-channel = 0d:01h:02m:10s
Logical slot/port = 2/1 Number of ports = 2
HotStandBy port = null
Port state = Port-channel Ag-Inuse
Protocol = LACP
Port security = Disabled
Load share deferral = Disabled
Ports in the Port-channel:
Index Load Port EC state No of bits
------+------+------+------------------+-----------
  0 00 Fa0/1 Active 0
  0 00 Fa0/2 Active 0
Time since last port bundled: 0d:00h:09m:30s Fa0/2

show interfaces etherchanne

En cualquier miembro de una interfaz física de un grupo EtherChannel, el show interfaces etherchannel comando puede proporcionar información sobre la función de la interfaz en el EtherChannel, como se muestra en el resultado. La interfaz FastEthernet0/1 forma parte del grupo EtherChannel 1. El protocolo para este EtherChannel es LACP.

S1# show interfaces f0/1 etherchannel
Port state = Up Mstr Assoc In-Bndl
Channel group = 1 Mode = Active Gcchange = -
Port-channel = Po1 GC = - Pseudo port-channel = Po1
Port index = 0 Load = 0x00 Protocol = LACP
Flags: S - Device is sending Slow LACPDUs F - Device is sending fast LACPDUs.
        A - Device is in active mode.        P - Device is in passive mode.
Local information:
                            LACP port Admin Oper Port       
Port Flags State Priority Key Number State
Fa0/1 SA bndl 32768 0x1 0x1 0x102 0x3D
Partner's information:
                  CP port Admin Oper Port Port
Port Flags Priority Dev ID Age key Key Number State
Fa0/1 SA 32768 c025.5cd7.ef00 12s 0x0 0x1 0x102 0x3Dof the port in the current state: 0d:00h:11m:51sllowed vlan 1,2,20

6.3.2
Common Issues with EtherChannel Configurations

Todas las interfaces dentro de un EtherChannel deben tener la misma configuración de velocidad y modo dúplex, de VLAN nativas y permitidas en los enlaces troncales, y de VLAN de acceso en los puertos de acceso. Garantizar estas configuraciones reducirá significativamente los problemas de red relacionados con EtherChannel. Entre los problemas comunes de EtherChannel se incluyen los siguientes:

    Los puertos asignados en el EtherChannel no son parte de la misma VLAN ni son configurados como enlace troncal. Los puertos con VLAN nativas diferentes no pueden formar un EtherChannel. La* conexión troncal se configuró en algunos de los puertos que componen el EtherChannel, pero no en todos ellos. No se recomienda que configure el modo de enlace troncal en los puertos individuales que conforman el EtherChannel. Al configurar un enlace troncal en un EtherChannel, compruebe el modo de enlace troncal en EtherChannel.
    If the allowed range of VLANs is not the same, the ports do not form an EtherChannel even when PAgP is set to the modo or auto deseable.
    Las opciones de negociación dinámica para PAgP y LACP no se encuentran configuradas de manera compatible en ambos extremos del EtherChannel.

Nota: Es fácil confundir PAgP o LACP con DTP, ya que ambos son protocolos que se usan para automatizar el comportamiento en los enlaces troncales. PAgP y LACP se usan para la agregación de enlaces (EtherChannel). DTP se usa para automatizar la creación de enlaces troncales. Cuando se configura un enlace troncal de EtherChannel, normalmente se configura primero EtherChannel (PAgP o LACP) y después DTP.
6.3.3
Ejemplo de solucionar problemas de EtherChannel.

En la figura, las interfaces F0/1 y F0/2 en los switches S1 y S2 se conectan con un EtherChannel. Sin embargo, el EtherChannel no está operativo.

dos switches, S1 y S2, están conectados entre sí a través de dos conexiones de red físicas que han formado un EtherChannel; el puerto F0/1 en S1 está conectado al puerto F0/1 en S2; el puerto F0/2 en S1 está conectado al puerto F0/2 en S2
S2 S1 Fa0/1 Fa0/2 Fa0/2
Fa0/1

Haga clic en cada botón para ver los pasos para solucionar problemas del EtherChannel.

Paso 1. Ver la información de resumen de EtherChannel

La salida del show etherchannel summary comando indica que el EtherChannel está caído.

S1# show etherchannel summary
Flags: D - down P - bundled in port-channel
        I - stand-alone s - suspended
        H - Hot-standby (LACP only)
        R - Layer3 S - Layer2
        U - in use N - not in use, no aggregation
        f - failed to allocate aggregator
        M - not in use, minimum links not met
        m - not in use, port not aggregated due to minimum links not met
        u - unsuitable for bundling
        w - waiting to be aggregated
        d - default port
        A - formed by Auto LAG
Number of channel-groups in use: 1
Number of aggregators: 1
Group Port-channel Protocol Ports
------+-------------+-----------+-----------------------------------------------
1 PO1 (SD) - Fa0/1 (D) Fa0/2 (D)

Paso 2. Verifique la configuración de canalización de puerto

En la show run | begin interface port-channel salida, una salida más detallada indica que existen modos PAgP incompatibles configurados en los switches S1 y S2.

S1# show run | begin interface port-channel
interface Port-channel1
 switchport trunk allowed vlan 1,2,20
 switchport mode trunk
!
interface FastEthernet0/1
 switchport trunk allowed vlan 1,2,20
 switchport mode trunk
 channel-group 1 mode on
!
interface FastEthernet0/2
 switchport trunk allowed vlan 1,2,20
 switchport mode trunk
 channel-group 1 mode on
! ======================================
S2# show run | begin interface port-channel
interface Port-channel1
 switchport trunk allowed vlan 1,2,20
 switchport mode trunk
!
interface FastEthernet0/1
 switchport trunk allowed vlan 1,2,20
 switchport mode trunk
 channel-group 1 mode desirable
!
interface FastEthernet0/2
 switchport trunk allowed vlan 1,2,20
 switchport mode trunk
 channel-group 1 mode desirable

Paso 3. Corregir las configuraciones incorrectas

Para corregir el problema, el modo PAgP en el EtherChannel se cambia a deseable.

Nota: EtherChannel y STP deben interoperar. Por este motivo, el orden en el que se introducen los comandos relacionados con EtherChannel es importante, y por ello se puede ver que se quitó el canal de puertos de interfaz1 y después se volvió a agregar con el channel-group comando, en vez de cambiarse directamente. Si se intenta cambiar la configuración directamente, los errores STP hacen que los puertos asociados entren en estado de bloqueo o errdisabled.

S1(config)# no interface port-channel 1
S1(config)# interface range fa0/1 - 2
S1(config-if-range)# channel-group 1 mode desirable
Creating a port-channel interface Port-channel 1
S1(config-if-range)# no shutdown
S1(config-if-range)# exit
S1(config)# interface range fa0/1 - 2
S1(config-if-range)# channel-group 1 mode desirable
S1(config-if-range)# no shutdown
S1(config-if-range)# interface port-channel 1
S1(config-if)# switchport mode trunk
S1(config-if)# finalizar
S1# 

Paso 4. Verificar que EtherChannel este en funcionamiento

El EtherChannel ahora está activo según lo verificado por la salida del show etherchannel summary comando.

S1# show etherchannel summary
Flags: D - down P - bundled in port-channel
        I - stand-alone s - suspended
        H - Hot-standby (LACP only)
        R - Layer3 S - Layer2
        U - in use N - not in use, no aggregation
        f - failed to allocate aggregator
        M - not in use, minimum links not met
        m - not in use, port not aggregated due to minimum links not met
        u - unsuitable for bundling
        w - waiting to be aggregated
        d - default port
        A - formed by Auto LAG
Number of channel-groups in use: 1
Number of aggregators: 1
Group Port-channel Protocol Ports
------+-------------+-----------+-----------------------------------------------
1 Po1(SU) PAgP Fa0/1(P) Fa0/2(P)

6.4.3
¿Qué aprenderé en este módulo?

Operación con EtherChannel

Para aumentar el ancho de banda o la redundancia, se pueden conectar varios enlaces entre dispositivos. Sin embargo, el STP bloquea los enlaces redundantes para evitar los bucles de switching. EtherChannel es una tecnología de agregación de enlaces que permite enlaces redundantes entre dispositivos que no serán bloqueados por STP. EtherChannel agrupa varios enlaces Ethernet físicos en un único enlace lógico. Proporciona tolerancia a fallos, uso compartido de carga, mayor ancho de banda y redundancia entre conmutadores, enrutadores y servidores. Cuando se configura un EtherChannel, la interfaz virtual resultante se denomina “canal de puertos”. EtherChannel tiene varias ventajas, así como algunas restricciones a la implementación. Los EtherChannels se pueden formar por medio de una negociación con uno de dos protocolos: PAgP o LACP. Estos protocolos permiten que los puertos con características similares formen un canal mediante una negociación dinámica con los switches adyacentes. Cuando se configura un enlace EtherChannel mediante un propietario Cisco PAgP, se envían paquetes PAgP entre los puertos aptos para EtherChannel para negociar la formación de un canal. Los modos PAgP se encienden, PAgP deseable y PAgP automático. LACP realiza una función similar a PAgP con EtherChannel de Cisco. Debido a que LACP es un estándar IEEE, se puede usar para facilitar los EtherChannels en entornos de varios proveedores. Los modos LACP se encienden, LACP activo y LACP pasivo.

Configurar EtherChannel

Las siguientes pautas y restricciones son útiles para configurar EtherChannel:

    Compatibilidad con EtherChannel - Todas las interfaces Ethernet en todos los módulos deben admitir EtherChannel, sin necesidad de que las interfaces sean físicamente contiguas o estén en el mismo módulo.
    Velocidad y dúplex - Configure todas las interfaces en un EtherChannel para que funcionen a la misma velocidad y en el mismo modo dúplex.
    VLAN match - Todas las interfaces en el grupo EtherChannel se deben asignar a la misma VLAN o se deben configurar como enlace troncal.
    Rango de VLAN - Un EtherChannel admite el mismo rango permitido de VLAN en todas las interfaces de un EtherChannel de enlace troncal.

La configuración de EtherChannel con LACP requiere tres pasos:

Paso 1. Especifique las interfaces que conforman el grupo EtherChannel mediante el comando de modo de configuración global interface range.

Paso 2. Cree la interfaz de canal de puerto con el comando channel-group identifier mode active en el modo de configuración de rango de interfaz.

Paso 3. Para cambiar la configuración de capa 2 en la interfaz de canal de puertos, ingrese al modo de configuración de interfaz de canal de puertos mediante el comando interface port-channel, seguido del identificador de la interfaz.

Verificar y resolver problemas de EtherChannel.

Existe una variedad de comandos para verificar una configuración EtherChannel que incluye, show interfaces port-channel, show etherchannel summary, show etherchannel port-channel y show interfaces etherchannel. Entre los problemas comunes de EtherChannel se incluyen los siguientes:

    Los puertos asignados en el EtherChannel no son parte de la misma VLAN ni son configurados como enlace troncal. Los puertos con VLAN nativas diferentes no pueden formar un EtherChannel.
    La conexión troncal se configuró en algunos de los puertos que componen el EtherChannel, pero no en todos ellos. Si el rango permitido de VLAN no es el mismo, los puertos no forman un EtherChannel, incluso cuando PAgP se establece en modo automático o deseado. Las opciones de negociación dinámica para PAgP y LACP no se encuentran configuradas de manera compatible en ambos extremos del EtherChannel.

6.4.4
Módulo Quiz - Etherchannel

    Se formó un enlace EtherChannel  usando LACP entre dos switches, S1 y S2. Al verificar la configuración, ¿qué combinación de modos se podría utilizar en ambos switches?​

Cuando se configura un rango de puertos para EtherChannel, ¿qué modo configurará PAgP para que inicie la negociación EtherChannel?

¿Qué tres parámetros de interfaz deben coincidir para que se forme un EtherChannel? (Escoja tres opciones).

¿Cuáles son las tres ventajas de utilizar la tecnología EtherChannel? (Escoja tres opciones).

Un administrador de red está configurando un enlace EtherChannel entre dos puertos físicos de un switch. ¿Qué declaración describe el resultado cuando falla uno de los puertos físicos?

Cuando se implementa EtherChannel, múltiples interfaces físicas se agrupan en qué tipo de conexión lógica?

Cuando se configura un rango de puertos para EtherChannel mediante el uso de PAgP, ¿qué modo formará el canal agrupado sólo si el puerto recibe paquetes PAgP de otro dispositivo?

¿Qué dos métodos de equilibrio de carga se pueden implementar con la tecnología EtherChannel? (Escoja dos opciones).

¿Qué función proporciona EtherChannel?

¿Cuáles dos afirmaciones sobre la tecnología EtherChannel son verdaderas?

¿Cuáles dos combinaciones de modos resultarían en la negociación exitosa de un EtherChannel? (Escoja dos opciones).

¿Qué dos protocolos son protocolos de agregación de enlaces? (Escoja dos opciones).

Cuando se configura un rango de puertos para EtherChannel, ¿qué modo configurará LACP para que inicie la negociación EtherChannel?

¿Qué sucederá si un administrador de red coloca un puerto que forma parte de un paquete EtherChannel en una VLAN diferente a los otros puertos de ese paquete?

Cuando se configura un rango de puertos para EtherChannel, ¿qué modo configurará LACP en un puerto sólo si el puerto recibe paquetes LACP de otro dispositivo?

7 DHCPv4

Introducción
7.0.1
¿Por qué debería tomar este módulo?

¡Bienvenido a DHCPv4!

El protocolo de configuración dinámica de host (DHCP) se utiliza para asignar direcciones IPv4 dinámicamente a hosts de red. DHCPv4 es para una red IPv4. (No se preocupe, aprenderá acerca de DHCPv6 en otro módulo.) Esto significa que usted, el administrador de la red, no tiene que pasar el día configurando direcciones IP para cada dispositivo de la red. En una pequeña casa u oficina, eso no sería muy difícil, pero cualquier red grande podría tener cientos, o incluso miles de dispositivos.

En este módulo, aprenderá a configurar un router Cisco IOS para que sea un servidor DHCPv4. A continuación, aprenderá cómo configurar un router Cisco IOS como cliente. Este módulo incluye algunos comprobadores de sintaxis y una actividad Packet Tracer para ayudarle a probar sus nuevos conocimientos. Las habilidades de configuración DHCPv4 reducirán significativamente su carga de trabajo, ¿y quién no quiere eso?
7.0.2
¿Qué aprenderé en este módulo?

Título del módulo: DHCPv4

Objetivos del módulo: Implemente DHCPv4 para operar en varias LAN.
Leyenda de la tabla
Título del tema 	Objetivo del tema
Conceptos DHCPv4 	Explicar la forma en la que funciona DHCPv4 en la red de una pequeña o mediana empresa .
Configurar un servidor DHCPv4 del IOS de Cisco 	Configure un router como servidor DHCPv4.
Configurar un cliente DHCPv4 	Configure un router como cliente DHCPv4.

Conceptos DHCPv4
7.1.1
Servidor y cliente DHCPv4

Dynamic Host Configuration Protocol v4 (DHCPv4) asigna direcciones IPv4 y otra información de configuración de red dinámicamente. Dado que los clientes de escritorio suelen componer gran parte de los nodos de red, DHCPv4 es una herramienta extremadamente útil para los administradores de red y que ahorra mucho tiempo.

Un servidor de DHCPv4 dedicado es escalable y relativamente fácil de administrar. Sin embargo, en una sucursal pequeña o ubicación SOHO, se puede configurar un router Cisco para proporcionar servicios DHCPv4 sin necesidad de un servidor dedicado. El software Cisco IOS admite un servidor DHCPv4 con funciones completas opcional.

El servidor DHCPv4 asigna dinámicamente, o arrienda, una dirección IPv4 de un conjunto de direcciones durante un período limitado elegido por el servidor o hasta que el cliente ya no necesite la dirección.

Los clientes arriendan la información del servidor durante un período definido administrativamente. Los administradores configuran los servidores de DHCPv4 para establecer los arrendamientos, a fin de que caduquen a distintos intervalos. El arrendamiento típicamente dura de 24 horas a una semana o más. Cuando caduca el arrendamiento, el cliente debe solicitar otra dirección, aunque generalmente se le vuelve a asignar la misma.

Servidor DHCPv4 conectado a un switch conectado a un cliente DHCPv4; en el paso uno, el cliente DHCPv4 envía un mensaje; en el paso dos, el servidor DHCPv6 responde con un mensaje
1
2
Servidor DHCPv4Cliente DHCPv4

    El proceso de concesión DHCPv4 comienza con el cliente enviando un mensaje solicitando los servicios de un servidor DHCP.
    Si hay un servidor DHCPv4 que recibe el mensaje, responderá con una dirección IPv4 y otra información de configuración de red posible.

7.1.2
Funcionamiento de DHCPv4

DHCPv4 funciona en un modo cliente/servidor. Cuando un cliente se comunica con un servidor de DHCPv4, el servidor asigna o arrienda una dirección IPv4 a ese cliente. El cliente se conecta a la red con esa dirección IPv4 arrendada hasta que caduque el arrendamiento. El cliente debe ponerse en contacto con el servidor de DHCP periódicamente para extender el arrendamiento. Este mecanismo de arrendamiento asegura que los clientes que se trasladan o se desconectan no mantengan las direcciones que ya no necesitan. Cuando caduca un arrendamiento, el servidor de DHCP devuelve la dirección al conjunto, donde se puede volver a asignar según sea necesario.
7.1.3
Pasos para obtener un arrendamiento

Cuando el cliente arranca (o quiere unirse a una red), comienza un proceso de cuatro pasos para obtener un arrendamiento:

    Detección de DHCP (DHCPDISCOVER)
    Oferta de DHCP (DHCPOFFER)
    Solicitud de DHCP (DHCPREQUEST)
    Acuse de recibo de DHCP (DHCPACK)

Haga clic en cada botón para conocer el proceso de cuatro pasos para obtener una concesión DHCP.

Paso 1. Detección DHCP (DHCPDISCOVER)

El cliente inicia el proceso con un mensaje de difusión DHCPDISCOVER con su propia dirección MAC para detectar los servidores de DHCPv4 disponibles. Dado que el cliente no tiene información de IPv4 válida durante el arranque, utiliza direcciones de difusión de capa 2 y de capa 3 para comunicarse con el servidor. El próposito del mensaje DHCPDISCOVER es encontrar los servidores de DHCPv4 en la red.

paso 1 del proceso DHCPv4 comienza con un mensaje de difusión DHCPDISCOVER desde el cliente DHCPv4 a un servidor DHCPv6 que dice, en esencia, que me gustaría solicitar una dirección
1
DHCPREQUEST
Difusión“Deseo solicitar una dirección”.Servidor DHCPv4Cliente DHCPv4

Paso 2. Ofrecimiento de DHCP (DHCPOFFER)

Cuando el servidor de DHCPv4 recibe un mensaje DHCPDISCOVER, reserva una dirección IPv4 disponible para arrendar al cliente. El servidor también crea una entrada ARP que consta de la dirección MAC del cliente que realiza la solicitud y la dirección IPv4 arrendada del cliente. El servidor de DHCPv4 envía el mensaje DHCPOFFER asignado al cliente que realiza la solicitud.

paso 2 del proceso DHCPv4 es un mensaje de unidifusión DHCPOFFER enviado desde el servidor DHCPv4 al cliente DHCPv4 que dice, en esencia, soy un servidor DHCPv4, aquí hay una oferta de direcciones
1 2
"Soy un servidor DHCPv4. Here is an address offer."DHCPOFFER
Unidifusión
/ DifusiónDHCPDISCOVER
Difusión“Deseo solicitar una dirección”.Servidor DHCPv4Cliente DHCPv4

Paso 3. Solicitud de DHCP (DHCPREQUEST)

Cuando el cliente recibe el mensaje DHCPOFFER proveniente del servidor, envía un mensaje DHCPREQUEST. Este mensaje se utiliza tanto para el origen como para la renovación del arrendamiento. Cuando se utiliza para el origen del arrendamiento, el mensaje DHCPREQUEST sirve como notificación de aceptación vinculante al servidor seleccionado para los parámetros que ofreció y como un rechazo implícito a cualquier otro servidor que pudiera haber proporcionado una oferta vinculante al cliente.

Muchas redes empresariales utilizan varios servidores de DHCPv4. El mensaje DHCPREQUEST se envía en forma de difusión para informarle a este servidor de DHCPv4 y a cualquier otro servidor de DHCPv4 acerca de la oferta aceptada.

paso 3 del proceso DHCPv4 es un mensaje de difusión DHCPREQUEST desde el cliente DHCPv4 al servidor DHCPv6 que dice, en esencia, acepto la oferta de direcciones IPv4
1 2
3
"Soy un servidor DHCPv4. Aquí está una oferta de dirección”.DHCPOFFER
Unidifusión
/ DifusiónDHCPDISCOVER
DifusiónDHCPREQUEST
Difusión“Deseo solicitar una dirección”.“Acepto la oferta de la dirección IPv4”.Servidor DHCPv4Cliente DHCPv4


Paso 4. Confirmación de DHCP (DHCPACK)

Al recibir el mensaje DHCPREQUEST, el servidor verifica la información del arrendamiento con un ping ICMP a esa dirección para asegurarse de que no esté en uso, crea una nueva entrada ARP para el arrendamiento del cliente y responde con un mensaje DHCPACK. El mensaje DHCPACK es un duplicado del mensaje DHCPOFFER, a excepción de un cambio en el campo de tipo de mensaje. Cuando el cliente recibe el mensaje DHCPACK, registra la información de configuración y realiza una búsqueda de ARP para la dirección asignada. Si no hay respuesta al ARP, el cliente sabe que la dirección IPv4 es válida y comienza a utilizarla como propia.

paso 4 del proceso DHCPv4 es un mensaje de unidifusión DHCPACK enviado desde el servidor DHCPv4 al cliente DHCPv4 que dice, en esencia, que se reconoce su aceptación
1 2 3
4
"Soy un servidor DHCPv4. Aquí está una oferta de dirección”.DHCPOFFER
Unidifusión
/ DifusiónDHCPDISCOVER
DifusiónDHCPREQUEST
Difusión“Deseo solicitar una dirección”.“Acepto la oferta de la dirección IPv4”.“Se hace acuse de recibo de su aceptación”.DHCPACK
UnidifusiónServidor DHCPv4Cliente DHCPv4

7.1.4
Pasos para renovar un contrato de arrendamiento

Antes de la expiración de la concesión, el cliente inicia un proceso de dos pasos para renovar la concesión con el servidor DHCPv4, como se muestra en la figura:

1. Detección DHCP (DHCPREQUEST)

Antes de que caduque el arrendamiento, el cliente envía un mensaje DHCPREQUEST directamente al servidor de DHCPv4 que ofreció la dirección IPv4 en primera instancia. Si no se recibe un mensaje DHCPACK dentro de una cantidad de tiempo especificada, el cliente transmite otro mensaje DHCPREQUEST de modo que uno de los otros servidores de DHCPv4 pueda extender el arrendamiento.

2. Ofrecimiento de DHCP (DHCPACK)

Al recibir el mensaje DHCPREQUEST, el servidor verifica la información del arrendamiento al devolver un DHCPACK.

Nota: Estos mensajes (principalmente DHCPOFFER y DHCPACK) se pueden enviar como unidifusión o difusión según la IETF RFC 2131.

El diagrama muestra el proceso de dos pasos y el intercambio de mensajes entre un cliente DHCPv4 y un servidor DHCPv4 cuando el cliente desea renovar un arrendamiento. En el primer paso, el cliente envía un mensaje de unicast DCHPREQUEST al servidor diciendo, en esencia, que me gustaría renovar mi contrato de arrendamiento. En el paso dos, el servidor responde con un mensaje de unidifusión DHCPACK que dice, se confirma su aceptación.
1
2
“Se hace acuse de recibo de su solicitud”.DHCPACK
UnidifusiónDHCPREQUEST
Unidifusión“Deseo renovar mi arrendamiento”.Servidor DHCPv4Cliente DHCPv4
7.1.5
Compruebe su comprensión - DHCPv4 Conceptos

Verifique su comprensión de los conceptos de DHCPv4 eligiendo la MEJOR respuesta a las siguientes preguntas.

    ¿Qué mensaje envía un cliente DHCPv4 para iniciar el proceso de obtención de la concesión?

¿Qué dos mensajes DHCPv4 son enviados por el servidor en el proceso de obtención de un arrendamiento? (Escoja dos opciones).

¿Qué dos mensajes DHCPv4 se utilizan en el proceso de renovación de un arrendamiento? (Escoja dos opciones).

Configure un servidor DHCPv4 del IOS de Cisco
7.2.1
Servidor Cisco IOS DHCPv4

Ahora usted tiene una comprensión básica de cómo funciona DHCPv4 y cómo puede hacer su trabajo un poco más fácil. Si no tiene un servidor DHCPv4 independiente, este tema le mostrará cómo configurar un router Cisco IOS para que actúe como uno. Un router Cisco que ejecuta el software IOS de Cisco puede configurarse para que funcione como servidor de DHCPv4. El servidor de DHCPv4 que utiliza IOS de Cisco asigna y administra direcciones IPv4 de conjuntos de direcciones especificados dentro del router para los clientes DHCPv4.

La topología de red muestra un router, que funciona como un servidor DHCPv4, conectando dos LAN juntas. A la izquierda está la red 192.168.10.0/24 que consiste en el host PC1 conectado al switch S1 conectado al router R1 en G0/0/0 con una dirección de .1. A la derecha está la red 192.168.11.0/24 que consiste en el host PC2 y un servidor DNS en la dirección 192.168.11.6/24 conectado al switch S2 que está conectado a R1 en G0/0/1 con una dirección de .1.
PC2 S1 PC1 S2 R1 G0/0/0.1 192.168.11.0/24 192.168.10.0/24
G0/0/1.1
Servidor DNS 192.168.11.5/24Servidor DHCPv4
7.2.2
Pasos para configurar un servidor DHCPv4 del IOS de Cisco

Utilice los siguientes pasos para configurar un servidor DHCPv4 del IOS de Cisco:

Paso 1. Excluir direcciones IPv4
Paso 2. Defina un nombre de grupo DHCPv4.
Paso 3. Configure el grupo DHCPv4.

Paso 1. Excluir direcciones IPv4

El router que funciona como servidor de DHCPv4 asigna todas las direcciones IPv4 en un conjunto de direcciones DHCPv4, a menos que esté configurado para excluir direcciones específicas. Generalmente, algunas direcciones IPv4 de un conjunto se asignan a dispositivos de red que requieren asignaciones de direcciones estáticas. Por lo tanto, estas direcciones IPv4 no deben asignarse a otros dispositivos. La sintaxis del comando para excluir direcciones IPv4 es la siguiente:

Router(config)# ip dhcp excluded-address low-address [high-address]

Se puede excluir una única dirección o un rango de direcciones especificando la dirección más baja y la dirección más alta del rango. Las direcciones excluidas deben incluir las direcciones asignadas a los routers, a los servidores, a las impresoras y a los demás dispositivos que se configuraron o se configurarán manualmente. También puede introducir el comando varias veces.

Paso 2. Defina un nombre de grupo DHCPv4

La configuración de un servidor de DHCPv4 implica definir un conjunto de direcciones que se deben asignar.

Como se muestra en el ejemplo, el ip dhcp pool comando _pool-name_crea un conjunto con el nombre especificado y coloca al router en el modo de configuración de DHCPv4, que se identifica con el indicador Router(dhcp-config)#.

La sintaxis del comando para definir el grupo es la siguiente:

Router(config)# ip dhcp pool pool-name
Router(dhcp-config)# 

Paso 3. Configure el grupo DHCPv4

La tabla indica las tareas para finalizar la configuración del pool de DHCPv4.

El conjunto de direcciones y el router de gateway predeterminado deben estar configurados. Use la network instrucción para definir el rango de direcciones disponibles. Use el default-router comando para definir el router de gateway predeterminado. Normalmente, el gateway es la interfaz LAN del router más cercano a los dispositivos clientes. Se requiere un gateway, pero se pueden indicar hasta ocho direcciones si hay varios gateways.

Otros comandos del pool de DHCPv4 son optativos. Por ejemplo, la dirección IPv4 del servidor DNS que está disponible para un cliente DHCPv4 se configura mediante el comando dns-server. El comando domain-name se utiliza para definir el nombre de dominio. La duración del arrendamiento de DHCPv4 puede modificarse mediante el comando lease. El valor de arrendamiento predeterminado es un día. El comando netbios-name-server se utiliza para definir el servidor WINS con NetBIOS.
Comando TaskiOS Definir la dirección pool.network network-number [mask | /prefix-length] Defina la dirección predeterminada del router o la puerta de enlace. default-router [address2.... address8] Definir una dirección DNS server.dns-server [address2... address8] Defina el nombre de dominio.domain-name domainDefinir la duración del arrendamiento DHCP.lease {days [hours [minutes]] | infinite} Definir la dirección del servidor WINS de NetBIOS. netbios-nombre-servidor [dirección2... dirección8]
Tarea 	Comando de IOS
Definir el conjunto de direcciones.	

network network-number [mask | / prefix-length]

Definir el router o gateway predeterminado.	

default-router address [ address2….address8]

Definir un servidor DNS.	

dns-server address [ address2…address8]

Definir el nombre de dominio.	

domain-name domain

Definir la duración de la concesión DHCP.	

lease {days [hours [ minutes]] | infinite}

Definir el servidor WINS con NetBIOS.	

netbios-name-server address [ address2…address8]

Nota: Microsoft recomienda no implementar WINS, en su lugar configurar DNS para la resolución de nombres de Windows y retirar WINS.
7.2.3
Ejemplo de configuración

La topología para el ejemplo de configuración se muestra en la figura.

La topología de red muestra un router, que funciona como un servidor DHCPv4, conectando dos LAN juntas. A la izquierda está la red 192.168.10.0/24 que consiste en el host PC1 conectado al switch S1 conectado al router R1 en G0/0/0 con una dirección de .1. A la derecha está la red 192.168.11.0/24 que consiste en el host PC2 y un servidor DNS en la dirección 192.168.11.5/24 conectado al switch S2 que está conectado a R1 en G0/0/1 con una dirección de .1.
PC2 S1 PC1 S2 R1 G0/0/0.1 192.168.11.0/24 192.168.10.0/24 G0/0/1.1
192.168.11.5/24
Servidor DNSServidor de DHCPv4

El ejemplo muestra la configuración para convertir a R1 en un servidor DHCPv4 para la LAN 192.168.10.0/24.

R1(config)# ip dhcp excluded-address 192.168.10.1 192.168.10.9
R1(config)# ip dhcp excluded-address 192.168.10.254
R1(config)# ip dhcp pool LAN-POOL-1
R1(dhcp-config)# network 192.168.10.0 255.255.255.0
R1(dhcp-config)# default-router 192.168.10.1
R1(dhcp-config)# dns-server 192.168.11.5
R1(dhcp-config)# domain-name example.com
R1(dhcp-config)# end
R1#

7.2.4
Comandos de verificación DHCPv4

Utilice los comandos de la tabla para verificar que el servidor DHCPv4 del IOS de Cisco esté funcionando.
CommandDescriptionshow running-config | section dhcpMuestra los comandos DHCPv4 configurados en el router.show ip dhcp bindingMuestra una lista de todos los enlaces de direcciones IPv4 a direcciones MAC proporcionados por el servicio DHCPv4. show ip dhcp server statisticsMuestra información de recuento relativa al número de mensajes DHCPv4 que se han enviado y recibido.
Comando 	Descripción

show running-config | section dhcp

	Muestra los comandos DHCPv4 configurados en el router.

show ip dhcp binding

	Muestra una lista de todos los enlaces de direcciones IPv4 a direcciones MAC proporcionados por el servicio DHCPv4.

show ip dhcp server statistics

	Muestra información de conteo con respecto a la cantidad de mensajes DHCPv4 que han sido enviados y recibidos.
7.2.5
Verifique que DHCPv4 esté operando

La topología que se muestra en la figura es usada en el resultado de ejemplo. En este ejemplo, se configuró el R1 para que proporcione servicios DHCPv4. Dado que la PC1 no se encendió, no tiene una dirección IP.

La topología de red muestra un router, que funciona como un servidor DHCPv4, conectando dos LAN juntas. A la izquierda está la red 192.168.10.0/24 que consiste en el host PC1 conectado al switch S1 que está conectado al router R1 en G0/0/0 con una dirección de .1. On the right is network 192.168.11.0/24 consisting of host PC2 and a DNS server at address 192.168.11.5/24 connected to switch S2 which is connected to R1 at G0/0/1 with an address of .1.
PC2 S1 PC1 S2 R1 G0/0/0.1 192.168.11.0/24 192.168.10.0/24 G0/0/1.1
192.168.11.5/24
Servidor DNSServidor de DHCPv4

El resultado de los siguientes comandos supone que PC1 ha recibido su información de direccionamiento IPv4 del servidor DHCPv4. Es posible que tenga que introducir ipconfig /renew en un PC con Windows para obligarlo a enviar un mensaje DHCPDISCOVER. Haga clic en cada botón para ver el resultado del comando verificando que DHCPv4 está operando.

Verificar la configuración DHCPv4

Como se muestra en el ejemplo, el resultado del comando show running-config | section dhcp muestran los comandos de DHCPv4 configurados en el R1. El | section parámetro muestra solo los comandos asociados a la configuración DHCPv4.

R1# show running-config | section dhcp
ip dhcp excluded-address 192.168.10.1 192.168.10.9
ip dhcp excluded-address 192.168.10.254
ip dhcp pool LAN-POOL-1
 network 192.168.10.0 255.255.255.0
 default-router 192.168.10.1
 dns-server 192.168.11.5
 domain-name ejemplo.com

Verificar las asignaciones de DHCP

Como se muestra en el ejemplo, se puede verificar el funcionamiento de DHCPv4 mediante el comando show ip dhcp binding. Este comando muestra una lista de todas las vinculaciones de la dirección IPv4 con la dirección MAC que fueron proporcionadas por el servicio DHCPv4.

R1# show ip dhcp binding
Bindings from all pools not associated with VRF:
IP address Client-ID/ Lease expiration Type State Interface
                Hardware address/
                Nombre de usuario
192.168.10.10 0100.5056.b3ed.d8 15 sep 2019 8:42 AM Active GigabiteThernet0/0/0

Verificar estadísticas DHCPv4

La salida de la show ip dhcp server statistics se utiliza para verificar que los mensajes están siendo recibidos o enviados por el router. Este comando muestra información de conteo con respecto a la cantidad de mensajes DHCPv4 que se enviaron y recibieron.

R1# show ip dhcp server statistics
Memory usage 19465
Address pools 1
Database agents 0
Automatic bindings 2
Manual bindings 0
Expired bindings 0
Malformed messages 0
Secure arp entries 0
Renew messages 0
Workspace timeouts 0
Static routes 0
Relay bindings 0
Relay bindings active 0
Relay bindings terminated 0
Relay bindings selecting 0
Message Received
BOOTREQUEST 0
DHCPDISCOVER 4
DHCPREQUEST 2
DHCPDECLINE 0
DHCPRELEASE 0
DHCPINFORM 0

Verificar el direccionamiento IPv4 recibido del cliente DHCPv4

El comando ipconfig /all cuando se emite en la PC1, muestra los parámetros TCP/IP, como se muestra en el ejemplo. Dado que la PC1 se conectó al segmento de red 192.168.10.0/24, recibió automáticamente un sufijo DNS, una dirección IPv4, una máscara de subred, un gateway predeterminado y una dirección del servidor DNS de ese pool. No se requiere ninguna configuración de interfaz del router específica de DHCP. Si una computadora está conectada a un segmento de red que tiene un pool de DHCPv4 disponible, la computadora puede obtener una dirección IPv4 del pool adecuado de manera automática.

C:\Users\Student> ipconfig /all
Configuración IP de Windows
   Host Name . . . . . . . . . . . .: ciscolab
   Primary Dns Suffix . . . . . . . :
   Node Type . . . . . . . . . . . . : Hybrid
   IP Routing Enabled. . . . . . . . : No
   WINS Proxy Enabled. . . . . . . . : No
Ethernet adapter Ethernet0:
   Connection-specific DNS Suffix . : example.com
   Description . . . . . . . . . . . : Realtek PCIe GBE Family Controller
   Physical Address. . . . . . . . . : 00-05-9A-3C-7A-00
   DHCP Enabled. . . . . . . . . . . : Yes
   Autoconfiguration Enabled . . . . : Yes
   Dirección IPv4. . . . . . . . . . . : 192.168.10.10
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Lease Obtained . . . . . . . . . : Saturday, September 14, 2019 8:42:22AM
   Lease Expires . . . . . . . . . : Saturday, September 14, 2019 8:42:22AM
   Gateway predeterminado. . . . . . . . . : 192.168.10.1
   DHCP Server . . . . . . . .. . .  : 192.168.10.1
   Servidores DNS. . . . . . . .. . .  : 192.168.11.5

7.2.6
Verificador de sintaxis - Configuración de DHCPv4

En esta actividad del Verificador de sintaxis, usted configurará R1 para que sea el servidor DHCPv4 para la red 192.168.11.0/24.

La topología de red muestra un router, que funciona como un servidor DHCPv4, conectando dos LAN juntas. A la izquierda está la red 192.168.10.0/24 que consiste en el host PC1 conectado al conmutador S1 que está conectado al router R1 en G0/0/0 con una dirección de .1. A la derecha está la red 192.168.11.0/24 que consiste en el host PC2 y un servidor DNS en la dirección 192.168.11.5/24 conectado al switch S2 que está conectado a R1 en G0/0/1 con una dirección de .1.
PC2 S1 PC1 S2 R1 G0/0/0.1 192.168.11.0/24 192.168.10.0/24
G0/0/1.1
DNS Server 192.168.11.6/24Servidor DHCPv4

Excluya las siguientes direcciones del intervalo de direcciones 192.168.11.0/24:

    Excluya la dirección.1 a la .9.
    Excluya la dirección .254.

R1(config)#

Excluya las siguientes direcciones del intervalo de direcciones 192.168.11.0/24:

    Excluya la dirección.1 a la .9.
    Excluya la dirección .254.

R1(config)#ip dhcp excluded-address 192.168.11.1 192.168.11.9
R1(config)#ip dhcp excluded-address 192.168.11.254

Configure el grupo DHCPv4 con los siguientes requisitos:

    Define the pool name of LAN-POOL-2.
    Configure la dirección de red.
    Configure la dirección de gateway predeterminado.
    Configure la dirección del servidor DNS.
    Configure example.com como nombre de dominio.
    Volver al modo EXEC privilegiado.

R1(config)#ip dhcp pool LAN-POOL-2
R1(dhcp-config)#network 192.168.11.0 255.255.255.0
R1(dhcp-config)#default-router 192.168.11.1
R1(dhcp-config)#dns-server 192.168.11.6
R1(dhcp-config)#domain-name example.com
R1(dhcp-config)#end

Ha configurado correctamente el servidor DHCPv4 y el agente de retransmisión

7.2.7
Desactive el servidor DHCPv4 del IOS de Cisco

El servicio DHCPv4 está habilitado de manera predeterminada. Para desabilitar el servicio, use el comando no service dhcp del modo de configuración global. Use el comando del modo service dhcp de configuración global para volver a habilitar el proceso del servidor DHCPv4, como se muestra en el ejemplo. Si los parámetros no se configuran, habilitar el servicio no tiene ningún efecto.

Nota: Si se borra los enlaces DHCP o se detiene y reinicia el servicio DHCP, se pueden asignar temporalmente direcciones IP duplicadas en la red.

R1(config)# no service dhcp
R1(config)# service dhcp
R1(config)# 

7.2.8
Retransmisión DHCPv4

En una red jerárquica compleja, los servidores empresariales suelen estar ubicados en una central. Estos servidores pueden proporcionar servicios DHCP, DNS, TFTP y FTP para la red. Generalmente, los clientes de red no se encuentran en la misma subred que esos servidores. Para ubicar los servidores y recibir servicios, los clientes con frecuencia utilizan mensajes de difusión.

En la figura, la PC1 intenta adquirir una dirección IPv4 de un servidor de DHCPv4 mediante un mensaje de difusión. En esta situación, el router R1 no está configurado como servidor de DHCPv4 y no reenvía el mensaje de difusión. Dado que el servidor de DHCPv4 está ubicado en una red diferente, la PC1 no puede recibir una dirección IP mediante DHCP. R1 debe configurarse para retransmitir mensajes DHCPv4 al servidor DHCPv4.

La topología de red muestra un router que conecta dos LAN juntas. A la izquierda está la red 192.168.10.0/24 que consiste en el host PC1 conectado al switch S1 que está conectado al router R1 en G0/0/0 con una dirección de .1. Texto debajo de PC1 lee; buscando un servidor DHCPv4. Texto debajo del router lee; No puedo reenviar transmisiones entre redes. A la derecha se encuentra la red 192.168.11.0/24 que consiste en el host PC2, un servidor DNS en la dirección 192.168.11.5/24 y un servidor DHCPv4 en la dirección 192.168.11.6/24, todos conectados al switch S2 que está conectado a R1 en G0/0/1 con una dirección de .1.
PC2 S1 PC1 S2 R1 G0/0/0.1 192.168.11.0/24 192.168.10.0/24
G0/0/1.1
DHCPv4 Server 192.168.11.6/24DNS Server 192.168.11.5/24Buscando un servidor DHCPv4.No puedo reenviar las difusiones entre las redes.

En este escenario, un administrador de red está intentando renovar la información de direccionamiento IPv4 para PC1. Haga clic en cada botón para ver la salida del comando a medida que el administrador de red resuelve este problema.

ipconfig /release

PC1 es una computadora con Windows. El administrador de red libera toda la información de direccionamiento IPv4 actual mediante el comando ipconfig /release. Observe que se libera la dirección IPv4 y ninguna dirección aparece.

C:\Users\Student> ipconfig /release
Configuración IP de Windows
Ethernet adapter Ethernet0:
   Sufijo de conexión específica DNS. :
   Default Gateway . . . . . . . . . :

ipconfig /renew

A continuación, el administrador de red intenta renovar la información de direccionamiento IPv4 con el comando ipconfig /renew. Este comando hace que la PC1 transmita por difusión un mensaje DHCPDISCOVER. En el resultado se muestra que la PC1 no puede ubicar el servidor de DHCPv4. Dado que los routers no reenvían mensajes de difusión, la solicitud no es correcta.

El administrador de red podría agregar servidores DHCPv4 en R1 para todas las subredes. Sin embargo, esto crearía costos adicionales y gastos administrativos.

C:\Users\Student> ipconfig /renew
Configuración IP de Windows
Error al renovar la interfaz Ethernet0: no se puede conectar al servidor DHCP. Expiró la solicitud.

ip helper-address

Una mejor solución es configurar R1 con el comando ip helper-address address interface configuration. Esto hará que R1 retransmita transmisiones DHCPv4 al servidor DHCPv4. Como se muestra en el ejemplo, la interfaz en R1 que recibe la difusión desde PC1 está configurada para retransmitir la dirección DHCPv4 al servidor DHCPv4 en 192.168.11.6.

R1(config)# interface g0/0/0
R1(config-if)# ip helper-address 192.168.11.6
R1(config-if)# finalizar
R1#

show ip interface

Cuando se configura el R1 como agente de retransmisión DHCPv4, acepta solicitudes de difusión para el servicio DHCPv4 y, a continuación, reenvía dichas solicitudes en forma de unidifusión a la dirección IPv4 192.168.11.6. El administrador de red puede utilizar el comando show ip interface para verificar la configuración.

R1# show ip interface g0/0/0
GigabitEthernet0/0/0 is up, line protocol is up
  Internet address is 192.168.10.1/24
  Broadcast address is 255.255.255.255
  Address determined by setup command
  MTU is 1500 bytes
  Helper address is 192.168.11.6
(resultado omitido)

ipconfig /all

Como se muestra en la salida, PC1 ahora puede adquirir una dirección IPv4 del servidor DHCPv4 como se ha verificado con el ipconfig /all comando .

C:\Users\Student> ipconfig /all
Configuración IP de Windows
  
Ethernet adapter Ethernet0:
   Connection-specific DNS Suffix . : example.com
   IPv4 Address. . . . . . . . . . . : 192.168.10.10
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Default Gateway . . . . . . . . . : 192.168.10.1

7.2.9
Otras transmisiones de servicio retransmitidas

DHCPv4 no es el único servicio que puede configurarse para que retransmita el router. De manera predeterminada, el ip helper-address comando reenvia los siguientes ocho servidcios UDP:

    Port 37: Tiempo
    Port 49: TACACS
    Port 53: Envenenamiento
    Port 67: DHCP/BOOTP server
    Port 68: DHCP/BOOTP client
    Port 69: TFTP
    Port 137: Servicio de nombre NetBIOS
    Port 138: Servicio de datagrama NetBIOS

Configurar un router como cliente DHCPv4
7.3.1
Cisco Router como cliente DHCPv4

Hay escenarios en los que puede tener acceso a un servidor DHCP a través de su ISP. En estos casos, puede configurar un router Cisco IOS como cliente DHCPv4. En esta guía se explicará ese proceso.

En ocasiones, los routers Cisco en oficinas pequeñas y oficinas domésticas (SOHO) y en los sitios de sucursales deben configurarse como clientes DHCPv4 de manera similar a los equipos cliente. El método específico utilizado depende del ISP. Sin embargo, en su configuración más simple, se utiliza la interfaz Ethernet para conectarse a un cable módem o a un módem DSL.

Para configurar una interfaz Ethernet como cliente DHCP, utilice el ip address dhcp comando del modo de configuración de interfaz.

En la figura, suponga que un ISP ha sido configurado para proporcionar a clientes seleccionados direcciones IP del rango de red 209.165.201.0/27 después de que la interfaz G0/0/1 es configurada con el comando ip address dhcp.

un router configurado como cliente DHCPv4 se conecta a través de G0/0/1 a un módem por cable o DSL que luego se conecta a la nube que luego se conecta a un router ISP que funciona como servidor DHCPv4
G0/0/1 SOHO
ISP
Cliente DHCPv4Cable or DSL
ModemServidor DHCPv4
7.3.2
Ejemplo de configuración

Para configurar una interfaz Ethernet como cliente DHCP, utilice el ip address dhcp comando del modo de configuración de interfaz, como se muestra en el ejemplo. Esta configuración supone que el ISP se ha configurado para proporcionar a los clientes seleccionados información de direcciones IPv4.

SOHO(config)# interface G0/0/1
SOHO(config-if)# ip address dhcp
SOHO(config-if)# no shutdown
Sep 12 10:01:25.773: %DHCP-6-ADDRESS_ASSIGN: Interface GigabitEthernet0/0/1 assigned DHCP address 209.165.201.12, mask 255.255.255.224, hostname SOHO

El comando show ip interface g0/0/1 confirma que la interfaz está activa y que la dirección fue asignada por un servidor DHCPv4.

SOHO# show ip interface g0/0/1
GigabitEthernet0/0/1 is up, line protocol is up
  Internet address is 209.165.201.12/27
  Broadcast address is 255.255.255.255
  Address determined by DHCP
(output omitted)

7.3.3
Enrutador doméstico como cliente DHCPv4

Los routers de los hogares se configuran para recibir información de asignación de dirección IPv4 automáticamente desde el ISP. Esto es para que los clientes puedan configurar fácilmente el enrutador y conectarse a Internet.

Por ejemplo, en la ilustración se muestra la página de configuración de WAN predeterminada para un router inalámbrico de Packet Tracer. Observe que el tipo de conexión a Internet está establecido como Automatic Configuration - DHCP. Se utiliza esta selección cuando el router se conecta a un cable módem o DSL y actúa como cliente DHCPv4 y solicita una dirección IPv4 del ISP.

Varios fabricantes de enrutadores domésticos tendrán una configuración similar.
The figure shows the Internet setup screen of a typical home router. the internet connection type is set to Automatic Configuration - DHCP

7.3.4
Verificador de sintaxis: configuración de un router como cliente DHCPv4

En esta actividad del Comprobador de sintaxis, configurará un router Cisco como cliente DHCP.

un router configurado como cliente DHCPv4 se conecta a través de G0/0/1 a un módem por cable o DSL que luego se conecta a la nube que luego se conecta a un router ISP que funciona como servidor DHCPv4
G0/0/1 SOHO
ISP
Cliente de DHCPv4Servidor de DHCPv4Cable or DSL
Modem

Ingrese el modo de configuración de interfaz. Use g0/0/1 para el nombre de la interfaz.

SOHO(config)#interface g0/0/1

Configure la interfaz para obtener información de direccionamiento IPv4 del ISP.
SOHO(config-if)#ip address dhcp

Active la interfaz.
SOHO(config-if)#no shutdown

Sep 12 10:01:25.773: %DHCP-6-ADDRESS_ASSIGN: Interface GigabitEthernet0/0/1 assigned DHCP address 209.165.201.12, mask 255.255.255.224, hostname SOHO

Volver al modo EXEC privilegiado.
SOHO(config-if)#end

Utilice el comando show ip interface g0/0/1 para verificar la información IPv4.
SOHO#show ip interface g0/0/1

GigabitEthernet0/0/1 is up, line protocol is up
  Internet address is 209.165.201.12/27
  Broadcast address is 255.255.255.255
  Address determined by DHCP
(output omitted)

Configuró correctamente el router como cliente de DHCP.

7.4.3
¿Qué aprenderé en este módulo?

Conceptos DHCPv4

El servidor DHCPv4 asigna dinámicamente, o arrienda, una dirección IPv4, a un cliente, de un conjunto de direcciones durante un período limitado elegido por el servidor o hasta que el cliente ya no necesite la dirección. El proceso de concesión DHCPv4 comienza con el cliente que envía el mensaje solicitando los servicios de un servidor DHCP. Si hay un servidor DHCPv4 que recibe el mensaje, responderá con una dirección IPv4 y otra información de configuración de red posible. El cliente debe ponerse en contacto con el servidor de DHCP periódicamente para extender el arrendamiento. Este mecanismo de arrendamiento asegura que los clientes que se trasladan o se desconectan no mantengan las direcciones que ya no necesitan. Cuando el cliente arranca (o quiere unirse a una red), comienza un proceso de cuatro pasos para obtener un arrendamiento: DHCPDISCOVER, luego DHCPOFFER, luego DHCPREQUEST y finalmente DHCPACK. Antes de la expiración de la concesión, el cliente inicia un proceso de dos pasos para renovar la concesión con el servidor DHCPv4: DHCPREQUEST y luego DHCPACK.

Configurar un Servidor CISCO IOS DHCPv4

Un router Cisco que ejecuta el software IOS de Cisco puede configurarse para que funcione como servidor de DHCPv4. Siga los pasos siguientes para configurar un servidor DHCPv4 del IOS de Cisco: excluir direcciones IPv4, definir un nombre de grupo DHCPv4 y configurar el grupo DHCPv4. Verifique la configuración usando los comandos show running-config | section dhcp, show ip dhcp bindingy show ip dhcp server statistics. El servicio DHCPv4 está habilitado de manera predeterminada. Para desabilitar el servicio, use el comando no service dhcp del modo de configuración global. En una red jerárquica compleja, los servidores empresariales suelen estar ubicados en una central. Estos servidores pueden proporcionar servicios DHCP, DNS, TFTP y FTP para la red. Generalmente, los clientes de red no se encuentran en la misma subred que esos servidores. Para ubicar los servidores y recibir servicios, los clientes con frecuencia utilizan mensajes de difusión. La PC1 intenta adquirir una dirección IPv4 de un servidor de DHCPv4 mediante un mensaje de difusión. Si el router R1 no está configurado como servidor de DHCPv4, no reenviará el mensaje de difusión. Si el servidor DHCPv4 está ubicado en una red distinta, el PC no podrá recibir la dirección IP mediante DHCP. El router debe estar configurado para retransmitir mensajes DHCPv4 al servidor DHCPv4. El administrador de red libera toda la información de direccionamiento IPv4 actual mediante el comando ipconfig /release. A continuación, el administrador de red intenta renovar la información de direccionamiento IPv4 con el comando ipconfig /renew. Una mejor solución es configurar R1 con el comando ip helper-address address interface configuration. El administrador de red puede utilizar el comando show ip interface para verificar la configuración. El PC ahora puede adquirir una dirección IPv4 del servidor DHCPv4 como se ha verificado con el comando ipconfig /all. De manera predeterminada, el ip helper-address comando reenvia los siguientes ocho servidcios UDP:

    Port 37: Tiempo
    Port 49: TACACS
    Port 53: Envenenamiento
    Port 67: DHCP/BOOTP server
    Port 68: DHCP/BOOTP client
    Port 69: TFTP
    Port 137: Servicio de nombre NetBIOS
    Port 138: Servicio de datagrama NetBIOS

Configurar un Cliente DHCPv4

La interfaz Ethernet se usa para conectarse a un cable o modem DSL. Para configurar una interfaz Ethernet como cliente DHCP, utilice el ip address dhcp interface comando del modo de configuración. Los routers de los hogares se configuran para recibir información de asignación de dirección IPv4 automáticamente desde el ISP. El tipo de conexión de internet está establecido en Automatic Configuration - DHCP. Se utiliza esta selección cuando el router se conecta a un cable módem o DSL y actúa como cliente DHCPv4 y solicita una dirección IPv4 del ISP.
7.4.4
Módulo Quiz - DHCPv4

    Un PC cliente habilitado para DHCP acaba de arrancar. ¿Durante qué dos pasos utilizará el PC cliente mensajes de difusión cuando se comunique con un servidor DHCP? (Escoja dos opciones).

Un administrador emite los comandos:

Router(config)# interface g0/1
Router(config-if)# ip address dhcp

¿Qué está tratando de lograr el administrador?

Cuando un cliente solicita una concesión de dirección inicial de un servidor DHCP, ¿por qué se envía el mensaje DHCPREQUEST como difusión?

¿Qué mensaje DHCP IPv4 contiene la siguiente información?

Dirección de destino: 255.255.255.255
Dirección IPv4 del cliente: 0.0.0.0
Dirección del gateway predeterminado: 0.0.0.0
Máscara de subred: 0.0.0.0

¿Qué tipo de mensaje es enviado por un cliente DHCPv4 solicitando una dirección IP?

Cuando el arrendamiento de un cliente DHCPv4 está por caducar, ¿cuál es el mensaje que el cliente envía al servidor DHCP?

¿Cuál es la dirección IP de destino cuando un host IPv4 envía un mensaje DHCPDISCOVER?

Si hay más de un servidor DHCP disponible en la red local, ¿en qué orden se enviarán los mensajes DHCP entre un host y un servidor DHCP?

¿Cuál es el escenario más probable en el que la interfaz WAN de un router se configuraría como un cliente DHCP al que se le asignara una dirección IP dinámica desde un ISP?

¿Cuál es un método de asignación de direcciones DHCPv4 que asigna direcciones IPv4 para un período de arrendamiento limitado?

¿Cuál es la razón por la que el mensaje DHCPREQUEST se envía como una difusión durante el proceso DHCPv4?

¿Cómo se transmite un mensaje DHCPDISCOVER a través de una red para llegar a un servidor DHCP?

¿Qué dirección IPv4 de destino utiliza un cliente DHCPv4 para enviar el paquete DHCP Discover inicial cuando el cliente está buscando un servidor DHCP?

¿En qué dos circunstancias se configuraría un router como cliente DHCPv4? (Escoja dos opciones).

¿A qué dirección apunta un servidor DHCPv4 cuando se envía un mensaje DHCPOFFER a un cliente que solicita una dirección?

8 SLAAC Y dhcpV6

Introducción
8.0.1
Bienvenido

Bienvenido a SLAAC y DHCPv6!

SLAAC y DHCPv6 son protocolos de direccionamiento dinámico para una red IPv6. Por lo tanto, un poco de configuración hará que su día como administrador de red sea mucho más fácil. En este módulo, aprenderá a usar SLAAC para permitir a los hosts crear su propia dirección de unidifusión global IPv6, así como configurar un router Cisco IOS para que sea un servidor DHCPv6, un cliente DHCPv6 o un agente de retransmisión DHCPv6. Este módulo incluye un laboratorio donde configurará DHCPv6 en equipos reales!
8.0.2
¿Qué aprenderé en este módulo?

Título del tema: SLAAC y DHCPv6

Objetivo del tema: Configure la asignación dinámica de direcciones en redes IPv6.
Leyenda de la tabla
Título del tema 	Objetivo del tema
Asignación de direcciones de unidifusión global IPv6 	Explique cómo un host IPv6 puede adquirir su configuración IPv6.
SLAAC 	Explicar el funcionamiento de SLAAC.
DHCPv6 	Explique el funcionamiento de DHCPv6.
Configurar un servidor DHCPv6 	Configurar servidor DHCPv6 stateful y stateless.

IPv6 GUA Assignment
8.1.1
Configuración de host con IPv6

En primer lugar, lo más importante. Para utilizar la configuración automática de direcciones stateless (SLAAC) o DHCPv6, debe revisar las direcciones globales de unidifusión (GUA) y las direcciones link-local (LLAs). Este tema abarca ambas cosas.

En un router, una dirección global de unidifusión (GUA) IPv6 se configura manualmente mediante el comando de configuración ipv6 address ipv6-address/prefix-length interface.

Un host de Windows también se puede configurar manualmente con una configuración de dirección IPv6 GUA, como se muestra en la figura.

muestra la ventana de propiedades del Protocolo de Internet versión 6 y la dirección IPv6 estática y la configuración del servidor DNS

Introducir manualmente una GUA IPv6 puede llevar mucho tiempo y ser algo propenso a errores. Por lo tanto, la mayoría de los hosts de Windows están habilitados para adquirir dinámicamente una configuración GUA IPv6, como se muestra en la figura.

muestra la ventana de propiedades del Protocolo de Internet versión 6 y la configuración automática de la dirección IPv6 DHCP y del servidor DNS
8.1.2
IPv6 Host Link-Local Address

Cuando se selecciona el direccionamiento IPv6 automático, el host intentará obtener y configurar automáticamente la información de direcciones IPv6 en la interfaz. El host utilizará uno de los tres métodos definidos por el Internet Control Message Protocol version 6 (ICMPv6) mensaje Router Advertisement (RA) recibidos en la interfaz. Un router IPv6 que está en el mismo vínculo que el host envía mensajes de RA que sugieren a los hosts cómo obtener su información de direccionamiento IPv6. El host crea automáticamente la dirección local del vínculo IPv6 cuando se inicia y la interfaz Ethernet está activa. El ipconfig resultado de ejemplo muestra una dirección link-local (LLA) generada automáticamente en una interfaz.

En la figura, observe que la interfaz no creó una GUA IPv6. La razón se debe a que, en este ejemplo, el segmento de red no tiene un router que proporcione instrucciones de configuración de red para el host.

Nota: A veces, los sistemas operativoshost mostrarán una dirección link-local anexada con un "%" y un número. Esto se conoce como Id. de zona o Id. de ámbito. Es utilizado por el sistema operativo para asociar el LLA con una interfaz específica.

Nota: DHCPv6 se define en RFC 3315.

C:\PC1> ipconfig
Windows IP Configuration
Ethernet adapter Ethernet0:
   Connection-specific DNS Suffix  . : 
   IPv6 Address. . . . . . . . . . . : 
   Link-local IPv6 Address . . . . . : fe80::fb:1d54:839f:f595%21
   IPv4 Address. . . . . . . . . . . : 169.254.202.140
   Subnet Mask . . . . . . . . . . . : 255.255.0.0
   Default Gateway . . . . . . . . . : 
C:\PC1>

8.1.3
IPv6 GUA Assignment

IPv6 fue diseñado para simplificar la forma en que un host puede adquirir su configuración IPv6. De forma predeterminada, un router habilitado para IPv6 anuncia su información IPv6. Esto permite a un host crear o adquirir dinámicamente su configuración IPv6.

IPv6 GUA se puede asignar dinámicamente utilizando servicios stateless y stateful, como se muestra en la figura.

Todos los métodos stateless y stateful de este módulo utilizan mensajes de RA ICMPv6 para sugerir al host cómo crear o adquirir su configuración IPv6. Aunque los sistemas operativos del host siguen la sugerencia del RA, la decisión real depende en última instancia del host.

un diagrama de árbol invertido comienza con Asignación GUA dinámica, se divide en dos: stateless y stateful Stateless se divide en SLAAC y SLAAC con servidor DHCPv6 y conduce a un servidor DHCPv6 stateful.
Asignación dinámica de GUAStateless

    Ningún dispositivo realiza un seguimiento de la asignación de direcciones IPv6.

Stateful

    Un servidor DHCPv6 administra la asignación de direcciones IPv6.

Sólo SLAAC

    El router envía mensajes Router Advertisement (RA) que proporcionan toda la información de direccionamiento IPv6 (es decir, prefijo de red, longitud de prefijos e información del default gateway)
    Los hosts utilizan la información de RA exclusivamente para todas sus direcciones, incluida la creación de su propia GUA.

SLAAC con servidor DHCP
(DHCPv6 stateless)

    Los mensajes RA proporcionan información de configuración IPv6 a los hosts y les informan de que deben ponerse en contacto con un servidor DHCPv6 stateless para obtener información adicional de configuración.
    Los hosts utilizan la información de RA para crear su propia GUA única y obtener información adicional de un servidor DHCPv6.

DHCPv6 Server
(Stateful DHCPv6)

    Los mensajes RA del router informan a los hosts de ponerse en contacto con un servidor DHCPv6 stateful o un router habilitado para DHCPv6 para obtener toda la información de configuración IPv6, excepto la dirección del default gateway.
    Los hosts se ponen en contacto con un servidor DHCPv6 para adquirir toda su información de direccionamiento IPv6.
    El host obtiene la información del default gateway de los mensajes RA del router.

8.1.4
Tres flags de mensaje RA

La decisión de cómo un cliente obtendrá un GUA IPv6 depende de la configuración dentro del mensaje RA.

Un mensaje de RA ICMPv6 incluye tres flags para identificar las opciones dinámicas disponibles para un host, como se indica a continuación:

    Un flag - Este es el indicador de configuración automática de direcciones. Usa Stateless Address Autoconfiguration (SLAAC) para crear un GUA de IPv6.
    O flag - Este es otro indicador de configuración (Other) Otra información está disponible desde un servidor DHCPv6 stateless.
    M flag - Este es es indicador Managed Address. Utilice un servidor DHCPv6 stateful para obtener una GUA IPv6.

Mediante diferentes combinaciones de los flags A, O y M, los mensajes RA informan al host sobre las opciones dinámicas disponibles.

La figura ilustra estos tres métodos.

muestra R1 enviando un mensaje de RA en respuesta a un RS de PC1. Los campos de opción RA pueden especificar tres opciones diferentes: sólo SLAAC, SLAAC stateless con servidor DHCPv6 y sólo servidor DHCPv6 stateful.
R1 PC1
G0/0/1
ClienteRS“Use solo este RA”.Opciones de RA“Necesito un RA del R1”.SLAAC solo (predeterminado)“Use este RA y un servidor DHCPv6”.DHCP stateless: SLAAC y DHCPv6“Use un servidor DHCPv6”.DHCPv6 stateful: DHCPv6 solamenteA flag=1O flag=0M flag=0A flag=1O flag=1M flag=0A flag=0M flag=1
8.1.5
Compruebe su comprensión - Asignación de IPv6 GUA

Verifique su comprensión de los métodos de asignación de direcciones de unidifusión global IPv6 eligiendo la MEJOR respuesta a las siguientes preguntas.

    ¿Qué tipo de dirección se crea automáticamente de forma predeterminada en una interfaz de host cuando no se reciben RA?

¿Qué método describe mejor DHCP stateless?

SLAAC
8.2.1
Descripción general de SLAAC

No todas las redes tienen acceso a un servidor DHCPv6. Pero todos los dispositivos de una red IPv6 necesitan un GUA. El método SLAAC permite a los hosts crear su propia dirección única global IPv6 sin los servicios de un servidor DHCPv6.

SLAAC es un servicio stateless. Esto significa que no hay ningún servidor que mantenga información de direcciones de red para saber qué direcciones IPv6 se están utilizando y cuáles están disponibles.

SLAAC utiliza mensajes ICMPv6 RA para proporcionar direccionamiento y otra información de configuración que normalmente proporcionaría un servidor DHCP Un host configura su dirección IPv6 en función de la información que se envía en la RA. Los mensajes RA son enviados por un router IPv6 cada 200 segundos.

Un host también puede enviar un mensaje Router Solicitation (RS) solicitando que un router habilitado para IPv6 envíe al host un RA.

SLAAC se puede implementar como SLAAC solamente, o SLAAC con DHCPv6.
8.2.2
Activación de SLAAC

Consulte la topología siguiente para ver cómo está habilitado SLAAC para proporcionar asignación GUA dinámica stateless.

muestra una topología con un router conectado a un switch conectado a un PC host
PC1 R1 G0/0/1 fe80::1 2001:db8:acad:1::1/64
2001:db8:acad:1::/64

Suponga que R1 GigabitEthernet 0/0/1 se ha configurado con la GUA IPv6 indicada y direcciones link-local. Haga clic en cada botón para obtener una explicación de cómo R1 está habilitado para SLAAC.

Verificar direcciones IPv6

El resultado del show ipv6 interface comando muestra la configuración actual en la interfaz G0/0/1.

Como se destaca, a R1 se le han asignado las siguientes direcciones IPv6:

    Link-local IPv6 address - fe80::1
    GUA and subnet - 2001:db8:acad:1: :1 y 2001:db8:acad:1: :/64
    IPv6 all-nodes group - ff02::1

R1# show ipv6 interface G0/0/1
GigabitEthernet0/0/1 is up, line protocol is up
  IPv6 is enabled, link-local address is FE80::1
  No Virtual link-local address(es):
  Description: Link to LAN
  Global unicast address(es):
    2001:DB8:ACAD:1::1, subnet is 2001:DB8:ACAD:1::/64
  Unido a la direccion grupal(es):
    FF02::1
    FF02::1:FF00:1
(output omitted)
R1#

Habilitar enrutamiento IPv6

Aunque la interfaz del router tiene una configuración IPv6, todavía no está habilitada para enviar RA que contengan información de configuración de direcciones a hosts que utilicen SLAAC.

Para habilitar el envío de mensajes RA, un router debe unirse al grupo de todos los routers IPv6 mediante el comando ipv6 unicast-routing global config, como se muestra en el ejemplo.

R1(config)# ipv6 unicast-routing
R1(config)# exit
R1#

Verificar que SLAAC está habilitado

El grupo de todos los routers IPv6 responde a la dirección de multidifusión IPv6 ff02 :: 2. Puede utilizar el show ipv6 interface comando para verificar si un router está habilitado como se muestra, en el ejemplo.

Un router Cisco habilitado para IPv6 envía mensajes RA a la dirección de multidifusión de todos los nodos IPv6 ff02: :1 cada 200 segundos.

R1# show ipv6 interface G0/0/1 | section Joined
  Unido a la direccion grupal(es):
    FF02::1
    FF02::2
    FF02::1:FF00:1
R1#

8.2.3
Método Sólo SLAAC

El método sólo SLAAC está habilitado de forma predeterminada cuando se configura el ipv6 unicast-routing comando. Todas las interfaces Ethernet habilitadas con un GUA IPv6 configurado comenzarán a enviar mensajes RA con el flag A establecido en 1 y los flags O y M establecidos en 0, como se muestra en la figura.

El A = 1 flag sugiere al cliente que cree su propio IPv6 GUA usando el prefijo anunciado en la RA. El cliente puede crear su propio ID de interfaz utilizando el método Extended Unique Identifier (EUI-64) o hacer que se genere aleatoriamente.

Los flags O =0 y M=0 le indican al cliente que use la información del mensaje RA exclusivamente. Esto incluye información del prefijo, de la longitud de prefijo, del servidor DNS, de la MTU y del default gateway. No se encuentra disponible ninguna otra información de un servidor de DHCPv6.

muestra que con sólo SLAAC el router tiene el flag A establecido en 1 en el RA
R1 PC1 G0/0/1 fe80::1 2001:db8:acad:1::1/64
2001:db8:acad:1::/64
Mensaje de RA
Flag 	value
A 	1
O 	0
M 	0

En el ejemplo, PC1 esta habilitada para obtener su información de direccion de IPv6 de forma automática. Debido a la configuración de los flags A, O y M, PC1 sólo realiza SLAAC, utilizando la información contenida en el mensaje RA enviado por R1.

La dirección del default gateway es la dirección IPv6 de origen del mensaje RA, que es la LLA para R1. El default gateway solo se puede obtener de forma automática mediante un mensaje RA. Un servidor DHCPv6 no proporciona esta información.

C:\PC1> ipconfig
Windows IP Configuration
Ethernet adapter Ethernet0:
   Connection-specific DNS Suffix  . : 
   IPv6 Address. . . . . . . . . . . : 2001:db8:acad:1:1de9:c69:73ee:ca8c
   Link-local IPv6 Address . . . . . : fe80::fb:1d54:839f:f595%21
   IPv4 Address. . . . . . . . . . . : 169.254.202.140
   Subnet Mask . . . . . . . . . . . : 255.255.0.0
   Default Gateway . . . . . . . . . : fe80::1%6
C:\PC1>

8.2.4
ICMPv6 RS Messages

Un router envía mensajes de RA cada 200 segundos. Sin embargo, también enviará un mensaje RA si recibe un mensaje RS de un host.

Cuando un cliente está configurado para obtener su información de direccionamiento automáticamente, envía un mensaje RS a la dirección de multidifusión IPv6 de ff02: :2.

La figura ilustra cómo un host inicia el método SLAAC.

mostrar el PC enviando un mensaje RS a la dirección de multidifusión de todos los routers y obteniendo una RA en respuesta
1 2 PC1 R1 G0/0/1 fe80::1 2001:db8:acad:1::1/64
2001:db8:acad:1::/64
Mensaje de RARS Message

    PC1 acaba de encender y aún no ha recibido un mensaje de RA. Por lo tanto, envía un mensaje RS a la dirección de multidifusión IPv6 de todos los routers ff02: :2 solicitando una RA.
    R1 forma parte del grupo de todos los routers IPv6 y recibió el mensaje RS. Genera un RA que contiene el prefijo de red local y la longitud del prefijo (por ejemplo, 2001:db8:acad:1: :/64). Entonces envía el mensaje RA a la dirección de multidifusión de todos los nodos IPv6 ff02::1. PC1 utiliza esta información para crear una GUA IPv6 única.

8.2.5
Proceso de host para generar ID de interfaz

Mediante SLAAC, un host suele adquirir su información de subred IPv6 de 64 bits del RA del router. Sin embargo, debe generar el resto del identificador de interfaz (ID) de 64 bits utilizando uno de estos dos métodos:

    De generación aleatoria - La identificación de la interfaz de 64 bits es generada aleatoriamente por el sistema operativo del cliente. Este es el método utilizado ahora por los hosts de Windows 10.
    EUI-64 - El host crea un ID de interfaz utilizando su dirección MAC de 48 bits e inserta el valor hexadecimal de fffe en el medio de la dirección. Algunos sistemas operativos utilizan por defecto el ID de interfaz generado aleatoriamente en lugar del método EUI-64, debido a problemas de privacidad. Esto se debe a que EUI-64 utiliza la dirección MAC Ethernet del host para crear el ID de interfaz.

Nota: Windows, Linux y Mac OS permiten al usuario modificar la generación del ID de interfaz para que se genere aleatoriamente o utilice EUI-64.

Por ejemplo, en el siguiente ipconfig resultado, el host PC1 de Windows 10 utilizó la información de subred IPv6 contenida en el R1 RA y generó aleatoriamente un ID de interfaz de 64 bits como se destaca en el ejemplo.

C:\PC1> ipconfig
Windows IP Configuration
Ethernet adapter Ethernet0:
   Connection-specific DNS Suffix  . : 
   IPv6 Address. . . . . . . . . . . : 2001:db8:acad:1:1de9:c69:73ee:ca8c
   Link-local IPv6 Address . . . . . : fe80::fb:1d54:839f:f595%21
   IPv4 Address. . . . . . . . . . . : 169.254.202.140
   Subnet Mask . . . . . . . . . . . : 255.255.0.0
   Default Gateway . . . . . . . . . : fe80::1%6
C:\PC1>

8.2.6
Detección de direcciones duplicadas

El proceso permite al host crear una dirección IPv6. Sin embargo, no hay garantía de que la dirección sea única en la red.

Ya que SLAAC es stateless; por lo tanto, un host tiene la opción de verificar que una dirección IPv6 recién creada sea única antes de que pueda usarse Un host utiliza el proceso de detección de direcciones duplicadas (DAD) para asegurarse de que IPv6 GUA es único.

DAD se implementa usando ICMPv6. Para realizar DAD, el host envía un mensaje ICMPv6 NS con una dirección de multidifusión especialmente construida, llamada dirección de multidifusión de nodo solicitado. Esta dirección duplica los últimos 24 bits de dirección IPv6 del host.

Si ningún otro dispositivo responde con un mensaje NA, prácticamente se garantiza que la dirección es única y puede ser utilizada por la PC1. Si un mensaje NA es recibido por el host, la dirección no es única, y el sistema operativo debe determinar una nueva ID de interfaz para utilizar.

Internet Engineering Task Force (IETF) recomienda que DAD se utilice en todas las direcciones de unidifusión IPv6 independientemente de si se crea con SLAAC sólo, se obtiene con DHCPv6 stateful, o se configura manualmente. DAD no es obligatorio porque un ID de interfaz de 64 bits proporciona 18 quintillion de posibilidades y la posibilidad de que haya una duplicación es remota. Sin embargo, la mayoría de los sistemas operativos realizan DAD en todas las direcciones de unidifusión IPv6, independientemente de cómo se configure la dirección.
8.2.7
Verifique su comprensión - SLAAC

Verifique su comprensión de SLAAC eligiendo la MEJOR respuesta a las siguientes preguntas.

    ¿Qué dos mensajes ICMPv6 se utilizan en el proceso SLAAC? (Escoja dos opciones).

¿Qué comando debe configurarse en un router para que pueda unirse a la dirección multidifusión de IPv6 ff02: :2?

¿Cuáles son los ajustes de flag cuando un host debe usar la opción SLAAC solo?

¿Qué mensaje ICMPv6 es enviado por un host en un intento de localizar un router habilitado para IPv6 en línea para obtener información de direccionamiento IPv6?

¿Qué método utiliza un host para verificar que una dirección IPv6 es única en la red local antes de asignar esa dirección a una interfaz?

DHCPv6
8.3.1
Pasos de operación DHCPv6

En este tema se explica DHCPv6 stateless y stateful DHCPv6 stateless utiliza partes de SLAAC para asegurarse de que toda la información necesaria se suministra al host. DHCPv6 stateful no requiere SLAAC.

Si bien DHCPv6 es similar a DHCPv4 en cuanto a lo que proporciona, los dos protocolos son independientes respecto sí.

El host comienza las comunicaciones cliente / servidor DHCPv6 después de que se indica DHCPv6 stateles o DHCPv6 stateful en el RA.

Los mensajes DHCPv6 de servidor a cliente utilizan el puerto de destino UDP 546, mientras que los mensajes DHCPv6 de cliente a servidor utilizan el puerto de destino UDP 547.

Los pasos para las operaciones DHCPv6 son los siguientes:

    Paso 1. El host envía un mensaje RS.
    Paso 2. El router responde con un mensaje RA.
    Paso 3. El host envía un mensaje DHCPv6 SOLIT.
    Paso 4. El servidor DHCPv6 responde con un mensaje ADVERTISE.
    Paso 5. El host responde al servidor DHCPv6.
    Paso 6. El servidor DHCPv6 envía un mensaje REPLY

Haga clic en cada botón para obtener una explicación e ilustración de estos pasos de operación de DHCPv6.

Paso 1. El host envía un mensaje RS.

PC1 envía un mensaje RS a todos los routers habilitados para IPv6.
R1 PC1 G0/0/1
1
Operaciones de SLAACRouter SolicitationServidor DHCPv6

Paso 2. Router responde con un mensaje RA.

R1 recibe el RS y responde con un RA indicando que el cliente debe iniciar la comunicación con un servidor DHCPv6.
R1 PC1 1 G0/0/1 1
2
Operaciones de SLAACRouter SolicitationRouter AdvertisementServidor DHCPv6

Paso 3. El host envía un mensaje DHCPv6 SOLIT.

El cliente, ahora un cliente DHCPv6, necesita localizar un servidor DHCPv6 y envía un mensaje DHCPv6 SOLICIT a la dirección reservada de todos los servidores DHCPv6 de multidifusión IPv6 de ff02 :: 1: 2. Esta dirección de multidifusión tiene alcance link-local, lo cual significa que los routers no reenvían los mensajes a otras redes.
R1 PC1 G0/0/1 1 2
3
Operaciones de SLAACRouter SolicitationRouter AdvertisementServidor DHCPv6Operaciones de DHCPv6SOLICIT a todos los servidores DHCPv6

Paso 4. El servidor DHCPv6 responde con un mensaje ADVERTISE.

Uno o más servidores DHCPv6 responden con un mensaje unidifusión DHCPv6 ADVERTISE El mensaje ADVERTISE le informa al cliente DHCPv6 que el servidor se encuentra disponible para el servicio DHCPv6.
4 R1 PC1 G0/0/1 1 2 3
Operaciones de SLAACRouter SolicitationRouter AdvertisementServidor DHCPv6Operaciones de DHCPv6ADVERTISE unidifusiónSOLICIT a todos los servidores DHCPv6

Paso 5. El host responde al servidor DHCPv6.

La respuesta PC1 depende de si está utilizando DHCPv6 stateful o stateless:

    Cliente DHCPv6 Stateless - El cliente crea una dirección IPv6 utilizando el prefijo en el mensaje RA y una ID de interfaz autogenerada. El cliente envía un mensaje DHCPv6 INFORMATION-REQUEST al servidor de DHCPv6 en el que solicita solamente parámetros de configuración, como la dirección del servidor DNS.
    Cliente DHCPv6 Stateful - el cliente envía un mensaje DHCPv6 REQUEST al servidor para obtener una dirección IPv6 y todos los demás parámetros de configuración del servidor.

3 4 5 R1 PC1 G0/0/1 1 2
Operaciones de SLAACRouter SolicitationRouter AdvertisementServidor DHCPv6REQUEST o INFORMATION-REQUEST unidifusiónSOLICIT a todos los servidores DHCPv6Operaciones de DHCPv6ADVERTISE unidifusión

Paso 6. El servidor DHCPv6 envía un mensaje REPLY

El servidor envía un mensaje de unidifusión DHCPv6 REPLY al cliente. El contenido del mensaje varía en función de si responde a un mensaje REQUEST o INFORMATION-REQUEST

Note: El cliente usara la direccion IPv6 link-local de origen del RA como su direccion default gateway. Un servidor DHCPv6 no proporciona esta información .
3 4 5 6 R1 PC1 G0/0/1 1 2
Operaciones de SLAACRouter SolicitationRouter AdvertisementServidor DHCPv6Operaciones de DHCPv6SOLICIT a todos los servidores DHCPv6ADVERTISE unidifusiónREQUEST o INFORMATION-REQUEST unidifusiónREPLY Unicast

8.3.2
Operación DHCPv6 stateless

La opción de DHCPv6 stateless informa al cliente que utilice la información del mensaje RA para el direccionamiento, pero que hay más parámetros de configuración disponibles de un servidor de DHCPv6.

Este proceso se conoce como DHCPv6 stateless, debido a que el servidor no mantiene información de estado del cliente (es decir, una lista de direcciones IPv6 asignadas y disponibles). El servidor de DHCPv6 stateless solo proporciona parámetros de configuración para los clientes, no direcciones IPv6.

La figura ilustra la operación DHCPv6 stateless.

muestra un diagrama en el que el PC obtiene la información del servidor DHCPv6 stateless del router R1
2001:db8:acad:1::1/64 fe80::1 G0/0/1 1 2 R1
PC1
Flag 	Valor
A 	1
O 	1
M 	0
Servidor DHCPv6 StatelessMensaje de RA

    PC1 recibe un mensaje de RA DHCP stateless. El mensaje RA contiene el prefijo de red y la longitud del prefijo. El flag M para DHCP stateful se establece en el valor predeterminado 0. El flag A=1 indica al cliente que use SLAAC. El flag O=1 flag se utiliza para informarle al cliente que hay información de configuración adicional disponible de un servidor de DHCPv6 stateless.
    El cliente envía un mensaje DHCPv6 SOLCIT buscando un servidor DHCPv6 stateless para obtener información adicional (por ejemplo, direcciones de servidor DNS).

8.3.3
Habilitar DHCPv6 stateless en una interfaz

DHCPv6 Stateless está habilitado en una interfaz de router mediante el comandoipv6 nd other-config-flag interface configuration. Esto establece el flag O en 1.

El resultado resaltado confirma que la RA le indicará a los hosts receptores que usen la configuración automática stateless (A flag = 1) y se comunique con un servidor DHCPv6 para obtener otra información de configuración (O flag = 1).

Note: You can use the no ipv6 nd other-config flag para restablecer la interfaz a la opción predeterminada de SLAAC sólo (O flag = 0).

R1(config-if)# ipv6 nd other-config-flag
R1(config-if)# end
R1#
R1# show ipv6 interface g0/0/1 | begin ND
  ND DAD is enabled, number of DAD attempts: 1
  ND reachable time is 30000 milliseconds (using 30000)
  ND advertised reachable time is 0 (unspecified)
  ND advertised retransmit interval is 0 (unspecified)
  ND router advertisements are sent every 200 seconds
  ND router advertisements live for 1800 seconds
  ND advertised default router preference is Medium
  Hosts use stateless autoconfig for addresses.
  Hosts use DHCP to obtain other configuration.
R1#

8.3.4
Operaciones de DHCPv6 stateful

Esta opción es la más similar a DHCPv4. En este caso, el mensaje RA indica al cliente que obtenga toda la información de direccionamiento de un servidor DHCPv6 stateful, excepto la dirección del default gateway que es la dirección link-local IPv6 de origen de la RA.

Esto se conoce como DHCPv6 stateful, debido a que el servidor de DHCPv6 mantiene información de estado de IPv6. Esto es similar a la asignación de direcciones para IPv4 por parte de un servidor de DHCPv4.

La figura ilustra la operación DHCPv6 stateful.

muestra un diagrama con un servidor DHCPv6 stateful, conectado a un switch, conectado a un PC cliente y un router cliente DHCPv6
2001:db8:acad:1::1/64 fe80::1 G0/0/1 1 2 R1
PC1
Flag 	Valor
A 	0
O 	0
M 	1
Servidor DHCPv6 StatefulMensaje de RA

    PC1 recibe un mensaje RA DHCPv6 con el flag O establecido en 0 y el flag M establecido en 1, lo que indica a PC1 que recibirá toda su información de direccionamiento IPv6 de un servidor DHCPv6 stateful.
    PC1 envía un mensaje DHCPv6 SOLIT buscando un servidor DHCPv6 stateful.

Nota: Si A=1 y M=1, algunos sistemas operativos como Windows crearán una dirección IPv6 mediante SLAAC y obtendrán una dirección diferente del servidor DHCPv6 stateful. En la mayoría de los casos, se recomienda establecer manualmente el flag A en 0.
8.3.5
Habilitar DHCPv6 stateful en una interfaz

DHCPv6 Stateful es habilitado en una interfaz de router mediante el comando ipv6 nd managed-config-flag interface configuration Esto establece el flag M en 1.

El resultado resaltado en el ejemplo confirma que RA indicará al host que obtenga toda la información de configuración IPv6 de un servidor DHCPv6 (flag M = 1).

R1(config)# int g0/0/1
R1(config-if)# ipv6 nd managed-config-flag
R1(config-if)# ipv6 nd prefix default no-autoconfig
R1(config-if)# end
R1#
R1# show ipv6 interface g0/0/1 | begin ND
  ND DAD is enabled, number of DAD attempts: 1
  ND reachable time is 30000 milliseconds (using 30000)
  ND advertised reachable time is 0 (unspecified)
  ND advertised retransmit interval is 0 (unspecified)
  ND router advertisements are sent every 200 seconds
  ND router advertisements live for 1800 seconds
  ND advertised default router preference is Medium
  Hosts use DHCP to obtain routable addresses.
R1#

8.3.6
Verifique su comprensión - DHCPv6

Verifique su comprensión de DHCPv6 eligiendo la MEJOR respuesta a las siguientes preguntas.

    ¿Qué puerto UDP usan los clientes DHCPv6 para enviar mensajes DHCPv6?

¿Qué mensaje DHCPv6 envía un host para buscar un servidor DHCPv6?

¿Qué mensaje DHCPv6 envía un host al servidor DHCPv6 si utiliza DHCPv6 stateful?

¿Qué combinación de configuración de flags se utiliza para DHCP stateless?

¿Qué configuración del flag M indica que se utiliza DHCPv6 stateful?

Configure DHCPv6 Server
8.4.1
Roles de router DHCPv6

Los routers IOS de Cisco son dispositivos potentes. En redes más pequeñas, no es necesario tener dispositivos separados para tener un servidor DHCPv6, un cliente o un agente de retransmisión. Se puede configurar un router Cisco para proporcionar servicios DHCPv6.

Específicamente, se puede configurar para que sea uno de los siguientes:

    Servidor DHCPv6 - El router proporciona servicios DHCPv6 stateless o stateful.
    Cliente DHCPv6 - la interfaz del router adquiere una configuración IP IPv6 de un servidor DHCPv6.
    Agente de retransmisión DHCPv6 - Router proporciona servicios de reenvío DHCPv6 cuando el cliente y el servidor se encuentran en diferentes redes.

8.4.2
Configurar un servidor DHCPv6 stateless.

La opción de servidor DHCPv6 stateless requiere que el router anuncie la información de direccionamiento de red IPv6 en los mensajes RA. Sin embargo, el cliente debe ponerse en contacto con un servidor DHCPv6 para obtener más información.

Consulte la topología de ejemplo para aprender a configurar el método de servidor DHCPv6 stateless.

muestra un diagrama en el que un router cliente obtiene la información del servidor DHCPv6 stateless del router R1
G0/0/1 G0/0/1 fe80::1 2001:db8:acad:1::1/64 R1 R3
PC1
Servidor DHCPv6 StatelessCliente

En este ejemplo, R1 proporcionará servicios SLAAC para la configuración IPv6 del host y los servicios DHCPv6.

Hay cinco pasos para configurar y verificar un router como servidor DHCPv6 stateless:

    Paso 1. Habilite el enrutamiento IPv6.
    Paso 2. Defina un nombre de grupo DHCPv6.
    Paso 3. Configure el grupo DHCPv6.
    Paso 4. Enlace el grupo DHCPv6 a una interfaz.
    Paso 5. Compruebe que los hosts han recibido información de direccionamiento IPv6.

Haga clic en cada botón para ver un ejemplo de estos pasos.

Paso 1. Habilite el enrutamiento IPv6.

El ipv6 unicast-routing comando es requerido para habilitar el enrutamiento IPv6 Este comando no es necesario para que el router sea un servidor de DHCPv6 stateless, pero se requiere para que el router origine los mensajes RA ICMPv6.

R1(config)# ipv6 unicast-routing
R1(config)# 

Paso 2. Defina un nombre de grupo DHCPv6.

Cree el grupo DHCPv6 mediante el comando ipv6 dhcp pool POOL-NAME global config. Esto entra en el modo de subconfiguración del grupo DHCPv6 identificado por elRouter(config-dhcpv6)# mensaje .

Note: El nombre del grupo no tiene que estar en mayúsculas. Sin embargo, el uso de un nombre en mayúsculas facilita la visualización en una configuración.

R1(config)# ipv6 dhcp pool IPV6-STATELESS
R1(config-dhcpv6)#

Paso 3. Configure el grupo DHCPv6.

R1 se configurará para proporcionar información DHCP adicional, incluida la dirección del servidor DNS y el nombre de dominio, como se muestra en el resultado del comando.

R1(config-dhcpv6)# dns-server 2001:db8:acad:1::254
R1(config-dhcpv6)# domain-name example.com
R1(config-dhcpv6)# exit
R1(config)#

Paso 4. Enlace el grupo DHCPv6 a una interfaz.

El grupo DHCPv6 debe vincularse a la interfaz mediante el comando ipv6 dhcp server POOL-NAME interface config como se muestra en el ejemplo.

El router responde a las solicitudes de DHCPv6 stateless en esta interfaz con la información incluida en el pool. El flag O debe cambiarse manualmente de 0 a 1 utilizando el comando de interfazipv6 nd other-config-flag. Los mensajes RA enviados en esta interfaz indican que hay información adicional disponible de un servidor de DHCPv6 stateless. El flag A es 1 de forma predeterminada, indicando a los clientes que usen SLAAC para crear su propio GUA.

R1(config)# interface GigabitEthernet0/0/1
R1(config-if)# description Link to LAN
R1(config-if)# ipv6 address fe80::1 link-local
R1(config-if)# ipv6 address 2001:db8:acad:1::1/64
R1(config-if)# ipv6 nd other-config-flag
R1(config-if)# ipv6 dhcp server IPV6-STATELESS
R1(config-if)# no shut
R1(config-if)# end
R1#

Paso 5. Compruebe que los hosts han recibido información de direccionamiento IPv6.

Para comprobar DHCP stateless en un host de Windows, utilice el ipconfig /all comando. El resultado de ejemplo muestra la configuración en PC1.

Observe en el resultado que PC1 creó su GUA IPv6 utilizando el prefijo 2001:db8:acad:1: :/64. Observe también que el default gateway es la dirección link-local IPv6 de R1. Esto confirma que PC1 derivó su configuración IPv6 de la RA de R1.

El resultado resaltado confirma que PC1 ha aprendido el nombre de dominio y la dirección del servidor DNS del servidor DHCPv6 stateless.

C:\PC1> ipconfig /all
Configuración IP de Windows
Ethernet adapter Ethernet0:
   Connection-specific DNS Suffix . : example.com
   Description . . . . . . . . . . . : Intel(R) 82574L Gigabit Network Connection
   Physical Address. . . . . . . . . : 00-05-9A-3C-7A-00
   DHCP Enabled. . . . . . . . . . . : Yes
   Autoconfiguration Enabled . . . . : Yes
   IPv6 Address. . . . . . . . . . . : 2001:db8:acad:1:1dd:a2ea:66e7 Preferred)
   Link-local IPv6 Address. . . . . : fe80::fb:1d54:839f:f595%21(Preferred)
   IPv4 Address. . . . . . . . . . . : 169.254.102.23 (Preferred)
   Máscara de subred . . . . . . . . . . : 255.255.0.0
   Default Gateway. . . . . . . . . : fe80::1%6
   DHCPv6 IAID . . . . . . . . . . . : 318768538
   DHCPv6 IAID . . . . . . . . : 00-01-00-01-21-F3-76-75-54-E1-AD-DE-DA-9A
   Servidor DNS . . . . . . . . . . : 2001:db8:acad:1: :1
   NetBIOS sobre Tcpip. . . . . . . . : Enabled
C:\PC1>

8.4.3
Configurar un cliente DHCPv6 stateless.

Un router también puede ser un cliente DHCPv6 y obtener una configuración IPv6 de un servidor DHCPv6, como un router que funcione como servidor DHCPv6. En la figura, R1 es un servidor DHCPv6 stateless.
G0/0/1 G0/0/1 fe80::1 2001:db8:acad:1::1/64 R1 R3
PC1
Servidor DHCPv6 StatelessCliente

Hay cinco pasos para configurar y verificar un router como servidor DHCPv6 stateless:

    Paso 1. Habilite el enrutamiento IPv6.
    Paso 2. Configure el router cliente para crear una LLA.
    Paso 3. Configure el router cliente para usar SLAAC.
    Paso 4. Verifique que el router cliente tenga asignado un GUA.
    Paso 5. Verifique que el enrutador cliente haya recibido otra información DHCPv6 necesaria.

Haga clic en cada botón para ver un ejemplo de estos pasos.

Paso 1. Habilite el enrutamiento IPv6.

El router cliente DHCPv6 debe estar ipv6 unicast-routing habilitado.

R3(config)# ipv6 unicast-routing
R3(config)#

Paso 2. Configure el router cliente para crear una LLA.

El router cliente necesita tener una dirección link-local. Una dirección link-local IPv6 se crea en una interfaz de router cuando se configura una dirección de unidifusión global. También se puede crear sin un GUA mediante el comando de configuración de ipv6 enable interfaz. Cisco IOS utiliza EUI-64 para crear un ID de interfaz aleatorio.

En el resultado, el ipv6 enable comando se configura en la interfaz Gigabit Ethernet 0/0/1 del router cliente R3.

R3(config)# interface g0/0/1
R3(config-if)# ipv6 enable
R3(config-if)# 

Paso 3. Configure el router cliente para usar SLAAC.

El router cliente debe configurarse para usar SLAAC para crear una configuración IPv6. El ipv6 address autoconfig comando habilita la configuración automática del direccionamiento IPv6 mediante SLAAC.

R3(config-if)# ipv6 address autoconfig
R3(config-if)# end
R3#

Paso 4. Verifique que el router cliente tenga asignado un GUA.

Utilice el show ipv6 interface brief comando para verificar la configuración del host como se muestra. El resultado confirma que a la interfaz G0/0/1 en R3 se le asignó una GUA válida.

Nota: la interfaz puede tardar unos segundos en completar el proceso .

R3# show ipv6 interface brief
GigabitEthernet0/0/0   [up/up]
    unassigned
GigabitEthernet0/0/1   [up/up]
    FE80::2FC:BAFF:FE94:29B1
    2001:DB8:ACAD:1:2FC:BAFF:FE94:29B1
Serial0/1/0            [up/up]
    unassigned
Serial0/1/1            [up/up]
    unassigned
R3#

Paso 5. Verifique que el router cliente haya recibido otra información DHCPv6 necesaria.

El show ipv6 dhcp interface g0/0/1 comando confirma que R3 también aprendió el DNS y los nombres de dominio.

R3# show ipv6 dhcp interface g0/0/1
GigabitEthernet0/0/1 is in client mode
  Prefix State is IDLE (0)
  Information refresh timer expires in 23:56:06
  Address State is IDLE
  List of known servers:
    Reachable via address: FE80::1
    DUID: 000300017079B3923640
    Preference: 0
    Configuration parameters:
      DNS server: 2001:DB8:ACAD:1::254
      Domain name: example.com
      Information refresh time: 0
  Prefix Rapid-Commit: disabled
  Address Rapid-Commit: disabled
R3#

8.4.4
Configurar un servidor DHCPv6 stateful.

La opción de servidor DHCP stateful requiere que el router habilitado para IPv6 indique al host que se ponga en contacto con un servidor DHCPv6 para obtener toda la información de direccionamiento de red IPv6 necesaria.

En la figura, R1 proporcionará servicios DHCPv6 stateful a todos los hosts de la red local. Configurar un servidor de DHCPv6 stateful es similar a configurar un servidor stateless. La diferencia más importante es que un servidor stateful también incluye información de direccionamiento IPv6 de manera similar a un servidor DHCPv4.
R1 R3 PC1 G0/0/1 fe80::1 2001:db8:acad:1::1/64
G0/0/1
Servidor DHCPv6 StatefulCliente DHCPv6

Hay cinco pasos para configurar y verificar un router como servidor DHCPv6 stateless:

    Paso 1. Habilite el enrutamiento IPv6.
    Paso 2. Defina un nombre de grupo DHCPv6.
    Paso 3. Configure el grupo DHCPv6.
    Paso 4. Enlace el grupo DHCPv6 a una interfaz.
    Paso 5. Compruebe que los hosts han recibido información de direccionamiento IPv6.

Haga clic en cada botón para ver un ejemplo de estos pasos.

Paso 1. Habilite el enrutamiento IPv6.

El ipv6 unicast-routing comando es requerido para habilitar el enrutamiento IPv6

R1(config)# ipv6 unicast-routing
R1(config)# 

Paso 2. Defina un nombre de grupo DHCPv6.

Cree el grupo DHCPv6 mediante el comando ipv6 dhcp pool POOL-NAME global config.

R1(config)# ipv6 dhcp pool IPV6-STATEFUL
R1(config-dhcpv6)#

Paso 3. Configure el grupo DHCPv6.

R1 se configurará para proporcionar direccionamiento IPv6, dirección del servidor DNS y nombre de dominio, como se muestra en el resultado del comando. Con DHCPv6 stateful, todos los parámetros de direccionamiento y otros parámetros de configuración deben ser asignados por el servidor de DHCPv6. El address prefix comando se utiliza para indicar el conjunto de direcciones que debe asignar el servidor. Otra información proporcionada por el servidor de DHCPv6 stateful suele incluir la dirección del servidor DNS y el nombre de dominio.

Note: Este ejemplo está configurando el servidor DNS en el servidor DNS público de Google.

R1(config-dhcpv6)# address prefix 2001:db8:acad:1::/64
R1(config-dhcpv6)# dns-server 2001:4860:4860: :8888
R1(config-dhcpv6)# domain-name example.com
R1(config-dhcpv6)#

Paso 4. Enlace el grupo DHCPv6 a una interfaz.

El ejemplo muestra la configuración completa de la interfaz GigabitEthernet 0/0/1 en R1.

El grupo DHCPv6 debe vincularse a la interfaz mediante el comando ipv6 dhcp server POOL-NAME interface config.

    The M flag is manually changed from 0 to 1 using the interface command ipv6 nd managed-config-flag.
    The A flag is manually changed from 1 to 0 using the interface command ipv6 nd prefix default no-autoconfig. El flag A se puede dejar en 1, pero algunos sistemas operativos cliente como Windows crearán una GUA usando SLAAC y obtendrán una GUA del servidor DHCPv6 stateful. Establecer el flag A en 0 indica al cliente que no utilice SLAAC para crear un GUA.
    The El comando IPv6 dhcp server vincula el conjunto de DHCPv6 con la interfaz. R1 responderá ahora con la información contenida en el grupo cuando reciba solicitudes DHCPv6 stateful en esta interfaz.

Note: You can use the no ipv6 nd managed-config-flag to set the M flag back to its default of 0. The no ipv6 nd prefix default no-autoconfig comando establece el flag A su valor predeterminado de 1.

R1(config)# interface GigabitEthernet0/0/1
R1(config-if)# description Link to LAN
R1(config-if)# ipv6 address fe80::1 link-local
R1(config-if)# ipv6 address 2001:db8:acad:1::1/64
R1(config-if)# ipv6 nd managed-config-flag
R1(config-if)# ipv6 nd prefix default no-autoconfig
R1(config-if)# ipv6 dhcp server IPV6-STATEFUL
R1(config-if)# no shut
R1(config-if)# end
R1#

Paso 5. Compruebe que los hosts han recibido información de direccionamiento IPv6.

Para comprobar en un host de Windows, utilice el ipconfig /all comando para comprobar el método de configuración DHCP stateful. El ejemplo muestra la configuración en PC1. El resultado resaltado muestra que PC1 ha recibido su GUA IPv6 de un servidor DHCPv6 stateful.

C:\PC1> ipconfig /all
Configuración IP de Windows
Ethernet adapter Ethernet0:
   Connection-specific DNS Suffix . : example.com
   Description . . . . . . . . . . . : IntelI 82574L Gigabit Network Connection
   Physical Address. . . . . . . . . : 00-05-9A-3C-7A-00
   DHCP Enabled. . . . . . . . . . . : Yes
   Autoconfiguration Enabled . . . . : Yes
   IPv6 Address. . . . . . . . . . . : 2001:db8:acad:1a43c:fd 28:9 d 79:9 e42 (Preferred)
   Lease Obtained. . . . . . . . . . : Saturday, September 27, 2019, 10:45:30 AM
   Lease Expires. . . . . . . . . . : Monday, September 29, 2019 10:05:04 AM
   Link-local IPv6 Address. . . . .: fe80: :192f:6fbc:9db:b 749% 6 (Preferred)
   Autoconfiguration IPv4 Address. . : 169.254.102.73 (Preferred)
   Máscara de subred . . . . . . . . . . : 255.255.0.0
   Default Gateway. . . . . . . . . : fe80::1%6
   DHCPv6 IAID . . . . . . . . . . . : 318768538
   DHCPv6 IAID . . . . . . . . : 00-01-00-01-21-F3-76-75-54-E1-AD-DE-DA-9A
   Servidor DNS . . . . . . . . . . : 2001:4860:4860::8888
   NetBIOS sobre Tcpip. . . . . . . . : Enabled
C:\PC1>

8.4.5
Configurar un cliente DHCPv6 stateful.

Un router también puede ser un cliente DHCPv6. El router cliente debe tener ipv6 unicast-routing habilitado y una dirección link-local IPv6 para enviar y recibir mensajes IPv6.

Consulte la topología de ejemplo para aprender a configurar el cliente DHCPv6 stateful.
PC1 R3 2001:db8:acad:1::1/64fe80::1 G0/0/1 G0/0/1
R1
Servidor DHCPv6 StatefulDHCPv6
Client

Hay cinco pasos para configurar y verificar un router como servidor DHCPv6 stateless:

    Paso 1. Habilite el enrutamiento IPv6.
    Paso 2. Configure el router cliente para crear una LLA.
    Paso 3. Configure el router cliente para que use DHCPv6.
    Paso 4. Verifique que el router cliente tenga asignado un GUA.
    Paso 5. Verifique que el enrutador cliente haya recibido otra información DHCPv6 necesaria.

Haga clic en cada botón para ver un ejemplo de estos pasos.

Paso 1. Habilite el enrutamiento IPv6.

El router cliente DHCPv6 debe estar ipv6 unicast-routing habilitado.

R3(config)# ipv6 unicast-routing
R3(config)#

Paso 2. Configure el router cliente para crear una LLA.

En el ejemplo, el ipv6 enable comando se configura en la interfaz R3 Gigabit Ethernet 0/0/1. Esto permite al router crear una LLA IPv6 sin necesidad de un GUA.

R3(config)# interface g0/0/1
R3(config-if)# ipv6 enable
R3(config-if)# 

Paso 3. Configure el router cliente para que use DHCPv6.

El ipv6 address dhcp comando configura R3 para solicitar su información de direccionamiento IPv6 de un servidor DHCPv6.

R3(config-if)# ipv6 address dhcp
R3(config-if)# end
R3#

Paso 4. Verifique que el router cliente tenga asignado un GUA.

Utilice el show ipv6 interface brief comando para verificar la configuración del host como se muestra.

R3# show ipv6 interface brief
GigabitEthernet0/0/0   [up/up]
    unassigned
GigabitEthernet0/0/1   [up/up]
    FE80::2FC:BAFF:FE94:29B1
    2001:DB8:ACAD:1:B4CB:25FA:3C9:747C
Serial0/1/0            [up/up]
    unassigned
Serial0/1/1            [up/up]
    unassigned
R3#

Paso 5. Verifique que el router cliente haya recibido otra información DHCPv6 necesaria.

El show ipv6 dhcp interface g0/0/1 comando confirma que R3 aprendió el DNS y los nombres de dominio.

R3# show ipv6 dhcp interface g0/0/1
GigabitEthernet0/0/1 is in client mode
  Prefix State is IDLE
  Address State is OPEN
  Renew for address will be sent in 11:56:33
  List of known servers:
    Reachable via address: FE80::1
    DUID: 000300017079B3923640
    Preference: 0
    Configuration parameters:
      IA NA: IA ID 0x00060001, T1 43200, T2 69120
        Address: 2001:DB8:ACAD:1:B4CB:25FA:3C9:747C/128
                preferred lifetime 86400, valid lifetime 172800
                expires at Sep 29 2019 11:52 AM (172593 seconds)
      DNS server: 2001:4860:4860::8888
      Domain name: example.com
      Information refresh time: 0
  Prefix Rapid-Commit: disabled
  Address Rapid-Commit: disabled
R3#

8.4.6
Comandos de verificación del server DHCPv6

Utilice los show ipv6 dhcp pool comandos show ipv6 dhcp binding y para verificar el funcionamiento DHCPv6 en un router.

Haga clic en cada botón para obtener el ejemplo.

show ipv6 dhcp pool

El show ipv6 dhcp pool comando verifica el nombre del pool de DHCPv6 y sus parámetros. El comando también identifica el número de clientes activos. En este ejemplo, el grupo IPV6-STATEFUL tiene actualmente 2 clientes, lo que refleja PC1 y R3 que reciben su dirección de unidifusión global IPv6 de este servidor.

Cuando un router proporciona servicios DHCPv6 stateful, también mantiene una base de datos de direcciones IPv6 asignadas.

R1# show ipv6 dhcp pool
DHCPv6 pool: IPV6-STATEFUL
  Address allocation prefix: 2001:DB8:ACAD:1::/64 valid 172800 preferred 86400 (2 in use,  0 conflicts)
  DNS Serer: 2001:4860:4860: :8888 Domain name: example.com Acitve clients: 2
R1#

show ipv6 dhcp binding

Utilice el resultado del show ipv6 dhcp binding comando para mostrar la dirección link-local IPv6 del cliente y la dirección de unidifusión global asignada por el servidor.

El resultado muestra el enlace con estado actual en R1. El primer cliente en el resultado es PC1 y el segundo cliente es R3.

Esta información la mantiene un servidor de DHCPv6 stateful. Un servidor DHCPv6 stateless no mantendría esta información.

R1# show ipv6 dhcp binding Client: FE80: :192F:6FBC:9DB:B749
  DUID: 0001000125148183005056B327D6
  Username : unassigned
  VRF : default
  IA NA: IA ID 0x03000C29, T1 43200, T2 69120
    Address: 2001:DB8:ACAD:1:A43C:FD 28:9 D 79:9 E42
            preferred lifetime 86400, valid lifetime 172800
            expires at Sep 27 2019 09:10 AM (171192 seconds)
Client: FE80: :2FC:BAFF:FE 94:29 B1
  DUID: 0003000100FCBA9429B0
  Username : unassigned
  VRF : default
  IA NA: IA ID 0x00060001, T1 43200, T2 69120
    Address: 2001:DB8:ACAD:1:B4CB:25FA:3C 9:747 C
            preferred lifetime 86400, valid lifetime 172800
            expires at Sep 27 2019 09:29 AM (172339 seconds)
R1#

8.4.7
Configuración del agente de retransmisión DHCPv6

Si el servidor de DHCPv6 está ubicado en una red distinta de la del cliente, el router IPv6 puede configurarse como agente de retransmisión DHCPv6. La configuración de un agente de retransmisión DHCPv6 es similar a la configuración de un router IPv4 como retransmisor DHCPv4.

En la figura, R3 se configura como un servidor DHCPv6 stateful. PC1 está en la red 2001:db8:acad:2: :/64 y requiere los servicios de un servidor DHCPv6 stateful para adquirir su configuración IPv6. R1 debe configurarse como el Agente de retransmisión DHCPv6.
PC1 R1 R3 2001:db8:acad:2::/64 2001:db8:acad:1::/64 :1fe80::1 :1fe80::1 :2fe80::3 G0/0/1 G0/0/0
G0/0/0
DHCPv6
ClientDHCPv6
Relay AgentStateful DHCPv6
Server

La sintaxis del comando para configurar un router como agente de retransmisión DHCPv6 es la siguiente:

Router(config-if)# ipv6 dhcp relay destination ipv6-address [interface-type interface-number]

Este comando se configura en la interfaz que frente a los clientes DHCPv6 y especifica la dirección del servidor DHCPv6 y la interfaz de salida para llegar al servidor, como se muestra en el ejemplo. La interfaz de salida sólo es necesaria cuando la dirección de salto siguiente es una LLA.

R1(config)# interface gigabitethernet 0/0/1
R1(config-if)# ipv6 dhcp relay destination 2001:db8:acad:1::2 G0/0/0
R1(config-if)# exit
R1(config)#

8.4.8
Verificar el agente de retransmisión de DHCPv6

Compruebe que el agente de retransmisión DHCPv6 esté operativo con los show ipv6 dhcp interface comandos show ipv6 dhcp binding Compruebe que los hosts de Windows recibieron información de direccionamiento IPv6 con el ipconfig /all comando.

Haga clic en cada botón para obtener el ejemplo.

show ipv6 dhcp interface

El agente de retransmisión DHCPv6 se puede verificar mediante el show ipv6 dhcp interface comando. Esto verificará que la interfaz G0/0/1 esté en modo de retransmisor.

R1# show ipv6 dhcp interface GigabiteThernet0/0/1 is in relay mode
  Destinos de retransmisión:
    2001:DB8:ACAD:1: :2
    2001:DB8:ACAD:1: :2 a través de GigabiteThernet0/0/0
R1#

show ipv6 dhcp binding

En R3, utilice el show ipv6 dhcp binding command para comprobar si se ha asignado una configuración IPv6 a alguno de los hosts.

Observe que a una dirección link-local de cliente se le ha asignado un GUA IPv6. Podemos suponer que esto es PC1.

R3# show ipv6 dhcp binding
Client: FE80: :5C43:EE7C:2959:DA68
  DUID: 0001000124F5CEA2005056B36D
  Username : unassigned
  VRF : default
  IA NA: IA ID 0x03000C29, T1 43200, T2 69120
    Address: 2001:DB8:ACAD: 2:9 C3C:64DE:AADA:7857
            preferred lifetime 86400, valid lifetime 172800
            expires at Sep 29 2019 08:26 PM (172710 seconds)
R3#

ipconfig /all

Por último, utilice ipconfig /all en PC1 para confirmar que se le ha asignado una configuración IPv6. Como puede ver, PC1 ha recibido su configuración IPv6 del servidor DHCPv6.

C:\PC1> ipconfig /all
Configuración IP de Windows
Ethernet adapter Ethernet0:
   Connection-specific DNS Suffix . : example.com
   Description . . . . . . . . . . . : Intel(R) 82574L Gigabit Network Connection
   Physical Address. . . . . . . . . : 00-05-9A-3C-7A-00
   DHCP Enabled. . . . . . . . . . . : Yes
   Autoconfiguration Enabled . . . . : Yes
   IPv6 Address. . . . . . . . . . . : 2001:db8:acad: 2:9 c3c:64de:aada:7857 (Preferred)
   Link-local IPv6 Address . . . . .: fe80: :5c43:ee7c:2959:da68%6(Preferido)
   Lease Obtained . . . . . . . . . : Saturday, September 27, 2019, 11:45:30 AM
   Lease Expires . . . . . . . . . . : Monday, September 29, 2019 11:05:04 AM
   IPv4 Address. . . . . . . . . . . : 169.254.102.73 (Preferred)
   Máscara de subred . . . . . . . . . . : 255.255.0.0
   Default Gateway . . . . . . . . . : fe80::1%6
   DHCPv6 IAID . . . . . . . . . . . : 318768538
   DHCPv6 IAID . . . . . . . . : 00-01-00-01-21-F3-76-75-54-E1-AD-DE-DA-9A
   DNS Servers . . . . . . . . . . . : 2001:4860:4860::8888
   NetBIOS sobre Tcpip. . . . . . . . : Enabled
C:\PC1>

8.4.9
Compruebe su comprensión - Configurar el servidor DHCPv6

Verifique su comprensión de servidor DHCPv6 eligiendo la MEJOR respuesta a las siguientes preguntas.

    ¿Qué tres roles DHCPv6 puede realizar un router? (Elija todas las opciones que correspondan).

¿Qué comando no está configurado en DHCPv6 stateless?

Un router habilitado para IPv6 debe adquirir su GUA IPv6 de otro router IPv6 mediante SLAAC. ¿Qué comando de configuración de interfaz debe configurarse en el router cliente?

Un router es proporcionar servicios de servidor DHCPv6. ¿Qué comando debe configurarse en la interfaz orientada al cliente?

Un router habilitado para IPv6 debe adquirir su GUA IPv6 de un servidor DHCPv6. ¿Qué comando de configuración de interfaz debe configurarse en el router cliente?

¿Qué comando de verificación DHCPv6 mostraría la dirección asignada al vínculo local y GUA para cada cliente activo?

¿Qué comando está configurado en la interfaz LAN del cliente del agente de retransmisión DHCPv6?

8.5.2
¿Qué aprenderé en este módulo?

Asignación IPv6 GUA

En un router, las direcciones globales de unidifusión (GUA) IPv6 se configuran manualmente mediante el comando de configuración ipv6 address ipv6-address/prefix-length interface. Cuando se selecciona el direccionamiento IPv6 automático, el host intentará obtener y configurar automáticamente la dirección IPv6 información en la interfaz. La dirección local del vínculo IPv6 es creada automáticamente por el host cuando se inicia y la interfaz Ethernet es activo. De forma predeterminada, un router habilitado para IPv6 anuncia su información IPv6, lo que permite a un host crear o adquirir dinámicamente su configuración IPv6. IPv6 GUA se puede asignar dinámicamente utilizando servicios stateless y stateful. La decisión de cómo un cliente obtendrá un GUA IPv6 depende de la configuración dentro del mensaje RA. Un mensaje de RA ICMPv6 incluye tres flags para identificar las opciones dinámicas disponibles para un host, como se indica a continuación:

    Un flag - este es el indicador de configuración automática de direcciones. Utilice SLAAC para crear una GUA IPv6.
    O flag - Este es otro indicador de configuración (Other) Otra información está disponible desde un servidor DHCPv6 stateless.
    M flag - Este es es indicador Managed Address. Utilice un servidor DHCPv6 stateful para obtener una GUA IPv6.

SLAAC

El método SLAAC permite a los hosts crear su propia dirección única global IPv6 sin los servicios de un servidor DHCPv6. SLAAC, que es stateless, utiliza mensajes ICMPv6 RA para proporcionar direccionamiento y otra información de configuración que normalmente proporcionaría un servidor DHCP SLAAC se puede implementar como SLAAC solamente, o SLAAC con DHCPv6. Para habilitar el envío de mensajes RA, un router debe unirse al grupo de todos los routers IPv6 mediante el comando ipv6 unicast-routing global config. Utilice el show ipv6 interface comando para verificar si un router está habilitado. El método SLAAC sólo, está habilitado de forma predeterminada cuando se configura el comando ipv6 unicast-routing. Todas las interfaces Ethernet habilitadas con un GUA IPv6 configurado comenzarán a enviar mensajes RA con el flag A establecido en 1 y los flags O y M establecidos en 0. El flag A = 1 sugiere al cliente crear su propio IPv6 GUA usando el prefijo anunciado en RA. Los flags O =0 y M=0 le indican al cliente que use la información del mensaje RA exclusivamente. Un router envía mensajes de RA cada 200 segundos. Sin embargo, también enviará un mensaje RA si recibe un mensaje RS de un host. Mediante SLAAC, un host suele adquirir su información de subred IPv6 de 64 bits del RA del router . Sin embargo, debe generar el identificador de interfaz (ID) de 64 bits restante utilizando uno de estos dos métodos: generado aleatoriamente, o EUI-64. Un host utiliza el proceso DAD para asegurarse de que IPv6 GUA es único. DAD se implementa usando ICMPv6. Para realizar DAD, el host envía un mensaje ICMPv6 NS con una dirección de multidifusión especialmente construida, llamada dirección de multidifusión de nodo solicitado. Esta dirección duplica los últimos 24 bits de dirección IPv6 del host .

DHCPv6

El host comienza las comunicaciones cliente / servidor DHCPv6 después de que se indica DHCPv6 stateles o DHCPv6 stateful en el RA. Los mensajes DHCPv6 de servidor a cliente utilizan el puerto de destino UDP 546, mientras que los mensajes DHCPv6 de cliente a servidor utilizan el puerto de destino UDP 547. La opción de DHCPv6 stateless informa al cliente que utilice la información del mensaje RA para el direccionamiento, pero que hay más parámetros de configuración disponibles de un servidor de DHCPv6. Esto se denomina DHCPv6 stateless porque el servidor no mantiene ninguna información de estado del cliente. DHCPv6 Stateless está habilitado en una interfaz de router mediante el comandoipv6 nd other-config-flag interface configuration. Esto establece el flag O en 1. En este caso, el mensaje RA indica al cliente que obtenga toda la información de direccionamiento de un servidor DHCPv6 stateful, excepto la dirección del default gateway que es la dirección link-local IPv6 de origen de la RA. Esto se conoce como DHCPv6 stateful, debido a que el servidor de DHCPv6 mantiene información de estado de IPv6. DHCPv6 Stateful es habilitado en una interfaz de router mediante el comando ipv6 nd managed-config-flag interface configuration Esto establece el flag M en 1.

Configurar Servidor DHCPv6

Un router Cisco IOS se puede configurar para proporcionar servicios de servidor DHCPv6 como uno de los tres tipos siguientes: servidor DHCPv6, cliente DHCPv6 o agente de retransmisión DHCPv6. La opción de servidor DHCPv6 stateless requiere que el router anuncie la información de direccionamiento de red IPv6 en los mensajes RA. Un router también puede ser un cliente DHCPv6 y obtener una configuración IPv6 de un servidor DHCPv6. La opción de servidor DHCP stateful requiere que el router habilitado para IPv6 indique al host que se ponga en contacto con un servidor DHCPv6 para obtener toda la información de direccionamiento de red IPv6 necesaria. El router cliente debe tener have ipv6 unicast-routing habilitado y una dirección link-local IPv6 para enviar y recibir mensajes IPv6. Utilice los show ipv6 dhcp pool comandos show ipv6 dhcp binding y para verificar el funcionamiento DHCPv6 en un router. Si el servidor de DHCPv6 está ubicado en una red distinta de la del cliente, el router IPv6 puede configurarse como agente de retransmisión DHCPv6 utilizando el comando ipv6 dhcp relay destination ipv6-address [interface-type interface-number] Este comando se configura en la interfaz que enfrenta a los clientes DHCPv6 y especifica la dirección del servidor DHCPv6 y la interfaz de salida para llegar al servidor. La interfaz de salida sólo es necesaria cuando la dirección de salto siguiente es una LLA. Compruebe que el agente de retransmisión DHCPv6 esté operativo con los show ipv6 dhcp interface comandos show ipv6 dhcp binding
8.5.3
Prueba de módulo - SLAAC y DHCPv6

    ¿Cómo un cliente IPv6 se asegura de que tiene una dirección única después de configurar su dirección IPv6 utilizando el método de asignación de SLAAC?

¿Qué método emplearía un host habilitado para IPv6 que usa SLAAC para aprender la dirección del default gateway?

¿Qué dos métodos se pueden usar para que un host IPv6 que utiliza la SLAAC genere una ID de interfaz? (Elija dos opciones).

Un cliente está utilizando SLAAC para obtener una dirección IPv6 para su interfaz. Después de que una dirección se ha generado y aplicado a la interfaz, ¿qué debe hacer el cliente antes de que pueda comenzar a usar esta dirección IPv6?

¿Qué comando debe configurarse en una interfaz de router para establecer el router como un cliente DHCPv6 stateful?

¿Qué mensaje informa a las interfaces habilitadas para IPv6 que utilicen DHCPv6 stateful para obtener una dirección IPv6?

¿Qué dirección IP de destino se usa cuando un host IPv6 envía un mensaje DHCPv6 SOLICIT para localizar un servidor DHCPv6?

¿En qué alternativa a DHCPv6 un router proporciona dinámicamente información de la configuración IPv6 a los hosts?

Una empresa implementa el método DHCPv6 stateless para configurar direcciones IPv6 en estaciones de trabajo de los empleados. Después de que una estación de trabajo recibe mensajes de varios servidores DHCPv6 para indicar su disponibilidad para el servicio DHCPv6, ¿qué mensaje envía a un servidor para obtener información de configuración?

¿Qué proceso se utiliza en ICMPv6 para que un host verifique que una dirección IPv6 es única antes de configurarlo en una interfaz?

¿Cuáles son las dos características del método SLAAC para la configuración de direcciones IPv6? (Escoja dos opciones).

Después del arranque, un cliente recibe un mensaje RA ICMPv6 con el flag M establecido en 0 y el flag O establecido en 1. ¿Qué indica esto?

Un administrador de red ingresa el comando ipv6 unicast-routing para empezar a configurar la operación de DHCPv6 en un router. ¿Qué afirmación describe la función de este comando?
